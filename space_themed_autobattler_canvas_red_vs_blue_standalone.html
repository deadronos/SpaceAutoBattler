<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
    <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span style="opacity:.7">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  <script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
<script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
<script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
<script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
<script type="module">
var ht=Object.defineProperty;var rt=(l,i,s)=>i in l?ht(l,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[i]=s;var ot=(l,i,s)=>(rt(l,typeof i!="symbol"?i+"":i,s),s);var ct=!1,z=123456789;function dt(){return ct?(z=1664525*z+1013904223>>>0,z/4294967296):Math.random()}function c(l=0,i=1){return l+(i-l)*dt()}function nt(l,i){return Math.floor(c(l,i+1))}var P={RED:0,BLUE:1},j=class{constructor(i,s,t,o,n,a=null){this.x=i,this.y=s,this.vx=t,this.vy=o,this.team=n,this.ownerId=a,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},W=class W{constructor(i,s,t,o="corvette"){this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=o;let n={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},a=n[o]||n.corvette;this.radius=a.radius,this.maxSpeed=a.maxSpeed,this.accel=a.accel,this.turn=4.5,this.hpMax=a.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=a.reload,this.vision=a.vision,this.range=a.range,this.id=W._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),o==="carrier"?(this.isCarrier=!0,this.launchCooldown=a.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let o=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(o*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,o=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let a=n.x-this.x,y=n.y-this.y,r=a*a+y*y;r<o&&r<t&&(t=r,s=n)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),o=0,n=0;if(t){let x=t.x-this.x,g=t.y-this.y,h=Math.hypot(x,g)||1,p=Math.max(0,Math.min(1.2,h/240)),m=t.x+(t.vx||0)*p,u=t.y+(t.vy||0)*p,f=m-this.x,_=u-this.y,M=Math.hypot(f,_)||1;if(o+=f/M*this.accel,n+=_/M*this.accel,h<this.range){let H=((this.vx||1)*x+(this.vy||1)*g)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&H>0){let D=300+c(-20,20),G=x/h,F=g/h;if(arguments.length>=3&&Array.isArray(arguments[2])){let K=arguments[2],q=new j(this.x+G*12,this.y+F*12,G*D+this.vx*.2,F*D+this.vy*.2,this.team,this.id);q.dmg*=1+.06*(this.level-1),K.push(q)}this.cooldown=this.reload}}}else o+=Math.cos(this.angle)*(this.accel*.3),n+=Math.sin(this.angle)*(this.accel*.3);let a=0,y=0,r=0,b=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let g=this.x-x.x,h=this.y-x.y,p=g*g+h*h;if(p<b*b&&p>1){let m=Math.sqrt(p);a+=g/m,y+=h/m,r++}}r>0&&(o+=a/r*this.accel*.9,n+=y/r*this.accel*.9),this.vx+=o*i,this.vy+=n*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(W,"_id",1);var C=W;function lt(l,i,s={W:800,H:600}){for(let t of l.ships)t.alive&&t.update(i,l.ships,l.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,o=s.H;for(let n of l.ships){if(!n.alive)continue;let a=n.radius||0;n.x<-a?n.x+=t+a*2:n.x>t+a&&(n.x-=t+a*2),n.y<-a?n.y+=o+a*2:n.y>o+a&&(n.y-=o+a*2)}}for(let t of l.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let o=Math.max(1,Math.floor(t.launchAmount||1));for(let n=0;n<o;n++){let a=c(0,Math.PI*2),y=t.radius+12+c(4,12),r=t.x+Math.cos(a)*y,b=t.y+Math.sin(a)*y,d=new C(t.team,r,b,"fighter"),x=c(40,120);d.vx=Math.cos(a)*x+(t.vx||0)*.2,d.vy=Math.sin(a)*x+(t.vy||0)*.2,l.ships.push(d)}t.launchCooldown=c(2.5,6)}for(let t=l.bullets.length-1;t>=0;t--){let o=l.bullets[t];o.update(i),o.alive(s)||l.bullets.splice(t,1)}for(let t=l.bullets.length-1;t>=0;t--){let o=l.bullets[t];for(let n of l.ships){if(!n.alive||n.team===o.team)continue;let a=n.x-o.x,y=n.y-o.y,r=a*a+y*y,b=n.radius+o.radius;if(r<b*b){let d=o.dmg,x=typeof n.shield=="number"?n.shield:0,g=typeof n.hp=="number"?n.hp:0,h=n.damage(d),p=Math.max(0,x-(typeof n.shield=="number"?n.shield:0)),m=Math.max(0,g-(typeof n.hp=="number"?n.hp:0));if(p>0&&l&&Array.isArray(l.shieldHits)&&l.shieldHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:p}),m>0&&l&&Array.isArray(l.healthHits)&&l.healthHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:m}),o.ownerId!=null){let u=l.ships.find(f=>f.id===o.ownerId);u&&u.gainXp(d*.05)}if(l.bullets.splice(t,1),h&&l.explosions&&l.explosions.push(h),!n.alive&&(o.team===0?l.score.red++:l.score.blue++,o.ownerId!=null)){let u=l.ships.find(f=>f.id===o.ownerId);u&&u.gainXp(20+(n.level||1)*.2)}break}}}}var I,e,E,v;function Wt(){I=document.getElementById("world"),e=I.getContext("2d"),E=I.width=window.innerWidth,v=I.height=window.innerHeight,window.addEventListener("resize",()=>{E=I.width=window.innerWidth,v=I.height=window.innerHeight})}function it(){return(typeof e>"u"||e===void 0)&&typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],B=[],X=[],k=[],A=new Map,T=[],st=[],V=0,Y=!1,U=1,O=!0,Q={red:0,blue:0},R={ships:T,bullets:st,score:Q,particles:w,shieldHits:[],healthHits:[],explosions:[]},L=Math.PI*2,Z=(l,i,s)=>Math.max(i,Math.min(s,l)),N=(l=0,i=1)=>l+(i-l)*Math.random();function J(l){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=l,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var tt=[];function Mt(){tt.length=0;let l=[.2,.5,1];for(let i of l)for(let s=0;s<120;s++)tt.push({x:N(0,E),y:N(0,v),r:N(.3,1.8)*i,d:i,tw:N(.4,1),phase:N(0,L)})}Mt();var S=(l,i=1)=>l===P.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,$=class{constructor(i,s,t,o,n,a){this.x=i,this.y=s,this.vx=t,this.vy=o,this.life=n,this.max=n,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;it(),!(typeof e>"u"||!e)&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},et=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;it();let s=B.some(h=>h.shieldHit&&h.x===i.x&&h.y===i.y&&h.life>0);if(O){let h=i.x-Math.cos(i.angle)*i.radius*1.2,p=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new $(h,p,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,S(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=S(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=S(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,L),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,L),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,L),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let h=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,p=t+4+(1-h)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,p,0,L);let m=e.createRadialGradient(i.x,i.y,p*.6,i.x,i.y,p);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let u of X){if(u.id!==i.id)continue;let f=Math.max(0,Math.min(1,u.life/.22)),_=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),M=Math.max(.08,Math.min(1,_)),D=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*M),G=u.angle-D/2,F=u.angle+D/2,K=p+4*(1-f)+2*M;e.beginPath(),e.arc(i.x,i.y,K,G,F),e.lineWidth=(3+6*f)*(1+4*M);let q=Math.min(1,.25+f*(.9+1.6*M));e.strokeStyle=`rgba(160,220,255,${q})`,e.save(),e.shadowBlur=12*M,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let o=Math.max(16,t*3.2),n=Math.max(3,t*.4),a=i.x-o/2,y=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let h=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,y,o,n),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,y,o*h,n))}let r=i.y+(t+8),b=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,n);typeof e<"u"&&(e.beginPath(),e.moveTo(a+d,r),e.lineTo(a+o-d,r),e.quadraticCurveTo(a+o,r,a+o,r+d),e.lineTo(a+o,r+n-d),e.quadraticCurveTo(a+o,r+n,a+o-d,r+n),e.lineTo(a+d,r+n),e.quadraticCurveTo(a,r+n,a,r+n-d),e.lineTo(a,r+d),e.quadraticCurveTo(a,r,a+d,r),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=k.find(h=>h.id===i.id&&h.life>0),g=`rgba(120,220,120,${.95})`;if(x){let h=Math.max(0,Math.min(1,x.life/.45)),p=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-p*h)),u=Math.floor(60+160*(1-h*p));g=`rgba(${Math.min(255,m)},${Math.min(255,u)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+d,r),e.lineTo(a+o-d,r),e.quadraticCurveTo(a+o,r,a+o,r+d),e.lineTo(a+o,r+n-d),e.quadraticCurveTo(a+o,r+n,a+o-d,r+n),e.lineTo(a+d,r+n),e.quadraticCurveTo(a,r+n,a,r+n-d),e.lineTo(a,r+d),e.quadraticCurveTo(a,r,a+d,r),e.closePath(),e.clip(),e.fillStyle=g,e.fillRect(a,r,o*b,n))}};function Vt(){}function Tt(l){if(lt(R,l,{W:E,H:v}),Array.isArray(R.healthHits)&&R.healthHits.length){for(let s of R.healthHits){let t=T.find(o=>o.id===s.id);if(t){k.push({id:t.id,life:.45,amount:s.amount});for(let o=0;o<6;o++){let n=c(0,L),a=c(40,120);w.push(new $(s.hitX,s.hitY,Math.cos(n)*a,Math.sin(n)*a,c(.12,.4),"rgba(200,230,255,$a)"))}}}R.healthHits.length=0}if(Array.isArray(R.shieldHits)&&R.shieldHits.length){for(let s of R.shieldHits){let t=T.find(o=>o.id===s.id);if(t){let o=Math.atan2(s.hitY-t.y,s.hitX-t.x);X.push({id:t.id,angle:o,life:.22,amount:s.amount}),B.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}R.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(l),t.life<=0&&w.splice(s,1)}for(let s=B.length-1;s>=0;s--){let t=B[s];t.life-=l,t.r+=600*l,t.life<=0&&B.splice(s,1)}for(let s=X.length-1;s>=0;s--){let t=X[s];t.life-=l,t.life<=0&&X.splice(s,1)}for(let s=k.length-1;s>=0;s--){let t=k[s];t.life-=l,t.life<=0&&k.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)A.has(s.id)?A.get(s.id).syncFromLogic():A.set(s.id,new et(s));for(let s of Array.from(A.keys()))i.has(s)||A.delete(s)}function bt(){if(it(),typeof e>"u"||!e)return;e.clearRect(0,0,E,v);let l=e.createRadialGradient(E*.6,v*.3,50,E*.6,v*.3,Math.max(E,v));l.addColorStop(0,"rgba(60,80,140,0.10)"),l.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=l,e.fillRect(0,0,E,v);for(let t of tt){let o=.6+.4*Math.sin(t.phase);e.globalAlpha=Z(.5*o*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of B){let o=Z(t.life/.25,0,1);e.strokeStyle=S(t.team,o*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,L),e.stroke()}for(let t of st)e.save(),e.shadowBlur=12,e.shadowColor=S(t.team,.9),e.fillStyle=S(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,L),e.fill(),e.restore();for(let t of w)t.draw();for(let t of A.values())t.draw();let i=T.some(t=>t.alive&&t.team===P.RED),s=T.some(t=>t.alive&&t.team===P.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",o=i?S(P.RED,.95):s?S(P.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=o,e.shadowBlur=14,e.shadowColor=o,e.fillText(`${t} Wins!`,E/2,64),e.restore()}}function Yt(){if(typeof document>"u")return;let l=document.getElementById("startPause"),i=document.getElementById("reset"),s=document.getElementById("addRed"),t=document.getElementById("addBlue"),o=document.getElementById("toggleTrails"),n=document.getElementById("speed"),a=document.getElementById("redScore"),y=document.getElementById("blueScore"),r=document.getElementById("stats"),b=document.getElementById("seedBtn"),d=document.getElementById("formationBtn");function x(){a.textContent=`Red ${Q.red}`,y.textContent=`Blue ${Q.blue}`,r.textContent=`Ships: ${T.filter(h=>h.alive).length}  Bullets: ${st.length}  Particles: ${w.length}`}l.addEventListener("click",()=>{Y=!Y,l.textContent=Y?"\u23F8 Pause":"\u25B6 Start"}),i.addEventListener("click",()=>{reset()}),s.addEventListener("click",()=>{T.push(new C(P.RED,c(40,E*.35),c(80,v-80))),J("+1 Red")}),t.addEventListener("click",()=>{T.push(new C(P.BLUE,c(E*.65,E-40),c(80,v-80))),J("+1 Blue")}),o.addEventListener("click",()=>{O=!O,o.textContent=`\u2604 Trails: ${O?"On":"Off"}`}),n.addEventListener("click",()=>{let h=[.5,1,2,4],p=(h.indexOf(U)+1)%h.length;U=h[p],n.textContent=`Speed: ${U}\xD7`}),b.addEventListener("click",()=>{let h=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);h!==null&&reset(Number(h))}),d.addEventListener("click",()=>{let h=T.filter(f=>f.alive&&f.team===P.RED),p=T.filter(f=>f.alive&&f.team===P.BLUE),m=20,u=6;h.forEach((f,_)=>{let M=_%u,H=Math.floor(_/u);f.x=E*.25-M*20,f.y=v*.5+(H-u/2)*m,f.vx=f.vy=0}),p.forEach((f,_)=>{let M=_%u,H=Math.floor(_/u);f.x=E*.75+M*20,f.y=v*.5+(H-u/2)*m,f.vx=f.vy=0}),J("Fleets re-formed")}),I.addEventListener("click",h=>{B.push({x:h.clientX,y:h.clientY,r:24,life:.25,team:nt(0,1)});for(let m=0;m<24;m++){let u=c(0,L),f=c(40,220);w.push(new $(h.clientX,h.clientY,Math.cos(u)*f,Math.sin(u)*f,c(.2,1),"rgba(255,255,255,$a)"))}});function g(h){V||(V=h);let p=(h-V)/1e3;V=h;let m=Z(p,0,.033)*(Y?U:0);Tt(m),bt(),x(),requestAnimationFrame(g)}reset(),requestAnimationFrame(g)}export{$ as Particle,et as ShipV,st as bullets,B as flashes,k as healthFlashes,Wt as initRenderer,Yt as initRendererUI,V as lastTime,w as particles,bt as render,Y as running,Q as score,X as shieldFlashes,T as ships,A as shipsVMap,O as showTrails,Tt as simulate,U as speed,R as state,S as teamColor,J as toast,Vt as updateUI};

</script>
<script type="module">
var rt=Object.defineProperty;var ht=(l,i,s)=>i in l?rt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[i]=s;var ot=(l,i,s)=>ht(l,typeof i!="symbol"?i+"":i,s);var ct=!1,z=123456789;function dt(){return ct?(z=1664525*z+1013904223>>>0,z/4294967296):Math.random()}function c(l=0,i=1){return l+(i-l)*dt()}function nt(l,i){return Math.floor(c(l,i+1))}var S={RED:0,BLUE:1},j=class{constructor(i,s,e,n,o,a=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=a,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},F=class F{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},a=o[n]||o.corvette;this.radius=a.radius,this.maxSpeed=a.maxSpeed,this.accel=a.accel,this.turn=4.5,this.hpMax=a.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=a.reload,this.vision=a.vision,this.range=a.range,this.id=F._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=a.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,M=o.y-this.y,h=a*a+M*M;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,T=e.y-this.y,r=Math.hypot(x,T)||1,p=Math.max(0,Math.min(1.2,r/240)),m=e.x+(e.vx||0)*p,u=e.y+(e.vy||0)*p,d=m-this.x,E=u-this.y,y=Math.hypot(d,E)||1;if(n+=d/y*this.accel,o+=E/y*this.accel,r<this.range){let g=((this.vx||1)*x+(this.vy||1)*T)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&g>0){let v=300+c(-20,20),P=x/r,q=T/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let K=arguments[2],W=new j(this.x+P*12,this.y+q*12,P*v+this.vx*.2,q*v+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),K.push(W)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,M=0,h=0,w=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let T=this.x-x.x,r=this.y-x.y,p=T*T+r*r;if(p<w*w&&p>1){let m=Math.sqrt(p);a+=T/m,M+=r/m,h++}}h>0&&(n+=a/h*this.accel*.9,o+=M/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let f=Math.hypot(this.vx,this.vy);if(f>this.maxSpeed){let x=this.maxSpeed/f;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(F,"_id",1);var H=F;function lt(l,i,s={W:800,H:600}){for(let e of l.ships)e.alive&&e.update(i,l.ships,l.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of l.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=e+a*2:o.x>e+a&&(o.x-=e+a*2),o.y<-a?o.y+=n+a*2:o.y>n+a&&(o.y-=n+a*2)}}for(let e of l.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let a=c(0,Math.PI*2),M=e.radius+12+c(4,12),h=e.x+Math.cos(a)*M,w=e.y+Math.sin(a)*M,f=new H(e.team,h,w,"fighter"),x=c(40,120);f.vx=Math.cos(a)*x+(e.vx||0)*.2,f.vy=Math.sin(a)*x+(e.vy||0)*.2,l.ships.push(f)}e.launchCooldown=c(2.5,6)}for(let e=l.bullets.length-1;e>=0;e--){let n=l.bullets[e];n.update(i),n.alive(s)||l.bullets.splice(e,1)}for(let e=l.bullets.length-1;e>=0;e--){let n=l.bullets[e];for(let o of l.ships){if(!o.alive||o.team===n.team)continue;let a=o.x-n.x,M=o.y-n.y,h=a*a+M*M,w=o.radius+n.radius;if(h<w*w){let f=n.dmg,x=typeof o.shield=="number"?o.shield:0,T=typeof o.hp=="number"?o.hp:0,r=o.damage(f),p=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,T-(typeof o.hp=="number"?o.hp:0));if(p>0&&l&&Array.isArray(l.shieldHits)&&l.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:p}),m>0&&l&&Array.isArray(l.healthHits)&&l.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:m}),n.ownerId!=null){let u=l.ships.find(d=>d.id===n.ownerId);u&&u.gainXp(f*.05)}if(l.bullets.splice(e,1),r&&l.explosions&&l.explosions.push(r),!o.alive&&(n.team===0?l.score.red++:l.score.blue++,n.ownerId!=null)){let u=l.ships.find(d=>d.id===n.ownerId);u&&u.gainXp(20+(o.level||1)*.2)}break}}}}var A,t,b,_;function Ft(){A=document.getElementById("world"),t=A.getContext("2d"),b=A.width=window.innerWidth,_=A.height=window.innerHeight,window.addEventListener("resize",()=>{b=A.width=window.innerWidth,_=A.height=window.innerHeight})}function it(){return(typeof t>"u"||t===void 0)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t}var I=[],X=[],k=[],$=[],D=new Map,R=[],st=[],V=0,Y=!1,U=1,O=!0,Q={red:0,blue:0},L={ships:R,bullets:st,score:Q,particles:I,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,Z=(l,i,s)=>Math.max(i,Math.min(s,l)),N=(l=0,i=1)=>l+(i-l)*Math.random();function J(l){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=l,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var tt=[];function Mt(){tt.length=0;let l=[.2,.5,1];for(let i of l)for(let s=0;s<120;s++)tt.push({x:N(0,b),y:N(0,_),r:N(.3,1.8)*i,d:i,tw:N(.4,1),phase:N(0,B)})}Mt();var C=(l,i=1)=>l===S.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,G=class{constructor(i,s,e,n,o,a){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;it(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},et=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;it();let s=X.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(O){let r=i.x-Math.cos(i.angle)*i.radius*1.2,p=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new G(r,p,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,C(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=C(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=C(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,B),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,B),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,B),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,p=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,p,0,B);let m=t.createRadialGradient(i.x,i.y,p*.6,i.x,i.y,p);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=m,t.globalCompositeOperation="lighter",t.fill());for(let u of k){if(u.id!==i.id)continue;let d=Math.max(0,Math.min(1,u.life/.22)),E=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),y=Math.max(.08,Math.min(1,E)),v=(Math.PI*.25+Math.PI*.6*(1-d))*(.6+1.6*y),P=u.angle-v/2,q=u.angle+v/2,K=p+4*(1-d)+2*y;t.beginPath(),t.arc(i.x,i.y,K,P,q),t.lineWidth=(3+6*d)*(1+4*y);let W=Math.min(1,.25+d*(.9+1.6*y));t.strokeStyle=`rgba(160,220,255,${W})`,t.save(),t.shadowBlur=12*y,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),a=i.x-n/2,M=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(a,M,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(a,M,n*r,o))}let h=i.y+(e+8),w=Math.max(0,Math.min(1,i.hp/i.hpMax)),f=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),p=Math.max(10,Math.round(o*5));t.save(),t.font=`700 ${p}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let m=t.measureText(r).width,u=6,d=Math.max(2,Math.round((p-o)/3)),E=Math.max(18,m+u*2),y=Math.max(o+2,p*.9),g=a-8-E,v=h+o/2-y/2,P=y/2;t.beginPath(),t.moveTo(g+P,v),t.lineTo(g+E-P,v),t.quadraticCurveTo(g+E,v,g+E,v+P),t.lineTo(g+E,v+y-P),t.quadraticCurveTo(g+E,v+y,g+E-P,v+y),t.lineTo(g+P,v+y),t.quadraticCurveTo(g,v+y,g,v+y-P),t.lineTo(g,v+P),t.quadraticCurveTo(g,v,g+P,v),t.closePath(),t.fillStyle=C(i.team,.95),t.fill(),t.lineWidth=1,t.strokeStyle="rgba(255,255,255,0.08)",t.stroke(),t.fillStyle="rgba(255,255,255,0.98)",t.fillText(r,g+E/2,v+y/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(a+f,h),t.lineTo(a+n-f,h),t.quadraticCurveTo(a+n,h,a+n,h+f),t.lineTo(a+n,h+o-f),t.quadraticCurveTo(a+n,h+o,a+n-f,h+o),t.lineTo(a+f,h+o),t.quadraticCurveTo(a,h+o,a,h+o-f),t.lineTo(a,h+f),t.quadraticCurveTo(a,h,a+f,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=$.find(r=>r.id===i.id&&r.life>0),T=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),p=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-p*r)),u=Math.floor(60+160*(1-r*p));T=`rgba(${Math.min(255,m)},${Math.min(255,u)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(a+f,h),t.lineTo(a+n-f,h),t.quadraticCurveTo(a+n,h,a+n,h+f),t.lineTo(a+n,h+o-f),t.quadraticCurveTo(a+n,h+o,a+n-f,h+o),t.lineTo(a+f,h+o),t.quadraticCurveTo(a,h+o,a,h+o-f),t.lineTo(a,h+f),t.quadraticCurveTo(a,h,a+f,h),t.closePath(),t.clip(),t.fillStyle=T,t.fillRect(a,h,n*w,o))}};function Vt(){}function Tt(l){if(lt(L,l,{W:b,H:_}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let e=R.find(n=>n.id===s.id);if(e){$.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,B),a=c(40,120);I.push(new G(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,c(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let e=R.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);k.push({id:e.id,angle:n,life:.22,amount:s.amount}),X.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(l),e.life<=0&&I.splice(s,1)}for(let s=X.length-1;s>=0;s--){let e=X[s];e.life-=l,e.r+=600*l,e.life<=0&&X.splice(s,1)}for(let s=k.length-1;s>=0;s--){let e=k[s];e.life-=l,e.life<=0&&k.splice(s,1)}for(let s=$.length-1;s>=0;s--){let e=$[s];e.life-=l,e.life<=0&&$.splice(s,1)}let i=new Set(R.map(s=>s.id));for(let s of R)D.has(s.id)?D.get(s.id).syncFromLogic():D.set(s.id,new et(s));for(let s of Array.from(D.keys()))i.has(s)||D.delete(s)}function bt(){if(it(),typeof t>"u"||!t)return;t.clearRect(0,0,b,_);let l=t.createRadialGradient(b*.6,_*.3,50,b*.6,_*.3,Math.max(b,_));l.addColorStop(0,"rgba(60,80,140,0.10)"),l.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=l,t.fillRect(0,0,b,_);for(let e of tt){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=Z(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of X){let n=Z(e.life/.25,0,1);t.strokeStyle=C(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,B),t.stroke()}for(let e of st)t.save(),t.shadowBlur=12,t.shadowColor=C(e.team,.9),t.fillStyle=C(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,B),t.fill(),t.restore();for(let e of I)e.draw();for(let e of D.values())e.draw();let i=R.some(e=>e.alive&&e.team===S.RED),s=R.some(e=>e.alive&&e.team===S.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?C(S.RED,.95):s?C(S.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,b/2,64),t.restore()}}function Yt(){if(typeof document>"u")return;let l=document.getElementById("startPause"),i=document.getElementById("reset"),s=document.getElementById("addRed"),e=document.getElementById("addBlue"),n=document.getElementById("toggleTrails"),o=document.getElementById("speed"),a=document.getElementById("redScore"),M=document.getElementById("blueScore"),h=document.getElementById("stats"),w=document.getElementById("seedBtn"),f=document.getElementById("formationBtn");function x(){a.textContent=`Red ${Q.red}`,M.textContent=`Blue ${Q.blue}`,h.textContent=`Ships: ${R.filter(r=>r.alive).length}  Bullets: ${st.length}  Particles: ${I.length}`}l.addEventListener("click",()=>{Y=!Y,l.textContent=Y?"\u23F8 Pause":"\u25B6 Start"}),i.addEventListener("click",()=>{reset()}),s.addEventListener("click",()=>{R.push(new H(S.RED,c(40,b*.35),c(80,_-80))),J("+1 Red")}),e.addEventListener("click",()=>{R.push(new H(S.BLUE,c(b*.65,b-40),c(80,_-80))),J("+1 Blue")}),n.addEventListener("click",()=>{O=!O,n.textContent=`\u2604 Trails: ${O?"On":"Off"}`}),o.addEventListener("click",()=>{let r=[.5,1,2,4],p=(r.indexOf(U)+1)%r.length;U=r[p],o.textContent=`Speed: ${U}\xD7`}),w.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),f.addEventListener("click",()=>{let r=R.filter(d=>d.alive&&d.team===S.RED),p=R.filter(d=>d.alive&&d.team===S.BLUE),m=20,u=6;r.forEach((d,E)=>{let y=E%u,g=Math.floor(E/u);d.x=b*.25-y*20,d.y=_*.5+(g-u/2)*m,d.vx=d.vy=0}),p.forEach((d,E)=>{let y=E%u,g=Math.floor(E/u);d.x=b*.75+y*20,d.y=_*.5+(g-u/2)*m,d.vx=d.vy=0}),J("Fleets re-formed")}),A.addEventListener("click",r=>{X.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:nt(0,1)});for(let m=0;m<24;m++){let u=c(0,B),d=c(40,220);I.push(new G(r.clientX,r.clientY,Math.cos(u)*d,Math.sin(u)*d,c(.2,1),"rgba(255,255,255,$a)"))}});function T(r){V||(V=r);let p=(r-V)/1e3;V=r;let m=Z(p,0,.033)*(Y?U:0);Tt(m),bt(),x(),requestAnimationFrame(T)}reset(),requestAnimationFrame(T)}export{G as Particle,et as ShipV,st as bullets,X as flashes,$ as healthFlashes,Ft as initRenderer,Yt as initRendererUI,V as lastTime,I as particles,bt as render,Y as running,Q as score,k as shieldFlashes,R as ships,D as shipsVMap,O as showTrails,Tt as simulate,U as speed,L as state,C as teamColor,J as toast,Vt as updateUI};

</script>
<script type="module">
var ut=Object.defineProperty;var xt=(a,i,s)=>i in a?ut(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var ct=(a,i,s)=>xt(a,typeof i!="symbol"?i+"":i,s);var mt=!1,et=123456789;function yt(){return mt?(et=1664525*et+1013904223>>>0,et/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*yt()}function dt(a,i){return Math.floor(c(a,i+1))}var w={RED:0,BLUE:1},it=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},j=class j{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=j._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,g=o.y-this.y,h=l*l+g*g;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,v=e.y-this.y,r=Math.hypot(x,v)||1,p=Math.max(0,Math.min(1.2,r/240)),m=e.x+(e.vx||0)*p,u=e.y+(e.vy||0)*p,d=m-this.x,M=u-this.y,y=Math.hypot(d,M)||1;if(n+=d/y*this.accel,o+=M/y*this.accel,r<this.range){let k=((this.vx||1)*x+(this.vy||1)*v)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&k>0){let D=300+c(-20,20),Y=x/r,C=v/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],P=new it(this.x+Y*12,this.y+C*12,Y*D+this.vx*.2,C*D+this.vy*.2,this.team,this.id);P.dmg*=1+.06*(this.level-1),N.push(P)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,g=0,h=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let v=this.x-x.x,r=this.y-x.y,p=v*v+r*r;if(p<_*_&&p>1){let m=Math.sqrt(p);l+=v/m,g+=r/m,h++}}h>0&&(n+=l/h*this.accel*.9,o+=g/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let f=Math.hypot(this.vx,this.vy);if(f>this.maxSpeed){let x=this.maxSpeed/f;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ct(j,"_id",1);var $=j;function pt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=c(0,Math.PI*2),g=e.radius+12+c(4,12),h=e.x+Math.cos(l)*g,_=e.y+Math.sin(l)*g,f=new $(e.team,h,_,"fighter"),x=c(40,120);f.vx=Math.cos(l)*x+(e.vx||0)*.2,f.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(f)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,g=o.y-n.y,h=l*l+g*g,_=o.radius+n.radius;if(h<_*_){let f=n.dmg,x=typeof o.shield=="number"?o.shield:0,v=typeof o.hp=="number"?o.hp:0,r=o.damage(f),p=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,v-(typeof o.hp=="number"?o.hp:0));if(p>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:p}),m>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:m}),n.ownerId!=null){let u=a.ships.find(d=>d.id===n.ownerId);u&&u.gainXp(f*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let u=a.ships.find(d=>d.id===n.ownerId);u&&u.gainXp(20+(o.level||1)*.2)}break}}}}var G,t,E,R;function zt(){G=document.getElementById("world"),t=G.getContext("2d"),E=G.width=window.innerWidth,R=G.height=window.innerHeight,window.addEventListener("resize",()=>{E=G.width=window.innerWidth,R=G.height=window.innerHeight})}function rt(){return(typeof t>"u"||t===void 0)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t}var A=[],W=[],U=[],O=[],K=[],F=new Map,S=[],ht=[],J=0,Q=!1,Z=1,tt=!0,ot={red:0,blue:0},H={ships:S,bullets:ht,score:ot,particles:A,shieldHits:[],healthHits:[],explosions:[]},X=Math.PI*2,nt=(a,i,s)=>Math.max(i,Math.min(s,a)),V=(a=0,i=1)=>a+(i-a)*Math.random();function st(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var lt=[];function _t(){lt.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)lt.push({x:V(0,E),y:V(0,R),r:V(.3,1.8)*i,d:i,tw:V(.4,1),phase:V(0,X)})}_t();var L=(a,i=1)=>a===w.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,z=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;rt(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},at=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;rt();let s=W.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(tt){let r=i.x-Math.cos(i.angle)*i.radius*1.2,p=i.y-Math.sin(i.angle)*i.radius*1.2;A.push(new z(r,p,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,L(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=L(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=L(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,X),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,X),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,X),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,p=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,p,0,X);let m=t.createRadialGradient(i.x,i.y,p*.6,i.x,i.y,p);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=m,t.globalCompositeOperation="lighter",t.fill());for(let u of U){if(u.id!==i.id)continue;let d=Math.max(0,Math.min(1,u.life/.22)),M=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),y=Math.max(.08,Math.min(1,M)),D=(Math.PI*.25+Math.PI*.6*(1-d))*(.6+1.6*y),Y=u.angle-D/2,C=u.angle+D/2,N=p+4*(1-d)+2*y;t.beginPath(),t.arc(i.x,i.y,N,Y,C),t.lineWidth=(3+6*d)*(1+4*y);let P=Math.min(1,.25+d*(.9+1.6*y));t.strokeStyle=`rgba(160,220,255,${P})`,t.save(),t.shadowBlur=12*y,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,g=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,g,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,g,n*r,o))}let h=i.y+(e+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),f=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),p=Math.max(10,Math.round(o*5));t.save(),t.font=`700 ${p}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let m=t.measureText(r).width,u=6,d=Math.max(2,Math.round((p-o)/3)),M=Math.max(18,m+u*2),y=Math.max(o+2,p*.9),k=l-8-M,D=h+o/2-y/2,Y=y/2,C=K.find(q=>q.id===i.id&&q.life>0),N=1;C&&(N=1+.6*Math.max(0,Math.min(1,C.life/1)));let P=M*N,I=y*N,T=k-(P-M),b=D-(I-y)/2,B=I/2;if(t.beginPath(),t.moveTo(T+B,b),t.lineTo(T+P-B,b),t.quadraticCurveTo(T+P,b,T+P,b+B),t.lineTo(T+P,b+I-B),t.quadraticCurveTo(T+P,b+I,T+P-B,b+I),t.lineTo(T+B,b+I),t.quadraticCurveTo(T,b+I,T,b+I-B),t.lineTo(T,b+B),t.quadraticCurveTo(T,b,T+B,b),t.closePath(),C){let q=Math.max(.6,Math.min(1,C.life));t.save(),t.shadowBlur=18*q,t.shadowColor="rgba(255,255,255,0.9)",t.fillStyle=L(i.team,.96),t.fill(),t.restore(),t.lineWidth=1.5,t.strokeStyle=`rgba(255,255,255,${.16+.5*q})`,t.stroke()}else t.fillStyle=L(i.team,.95),t.fill(),t.lineWidth=1,t.strokeStyle="rgba(255,255,255,0.08)",t.stroke();t.fillStyle="rgba(255,255,255,0.98)",t.fillText(r,T+P/2,b+I/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=O.find(r=>r.id===i.id&&r.life>0),v=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),p=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-p*r)),u=Math.floor(60+160*(1-r*p));v=`rgba(${Math.min(255,m)},${Math.min(255,u)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.clip(),t.fillStyle=v,t.fillRect(l,h,n*_,o))}};function jt(){}function wt(a){if(pt(H,a,{W:E,H:R}),Array.isArray(H.healthHits)&&H.healthHits.length){for(let s of H.healthHits){let e=S.find(n=>n.id===s.id);if(e){O.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,X),l=c(40,120);A.push(new z(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}H.healthHits.length=0}if(Array.isArray(H.shieldHits)&&H.shieldHits.length){for(let s of H.shieldHits){let e=S.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);U.push({id:e.id,angle:n,life:.22,amount:s.amount}),W.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}H.shieldHits.length=0}for(let s=A.length-1;s>=0;s--){let e=A[s];e.update(a),e.life<=0&&A.splice(s,1)}for(let s=W.length-1;s>=0;s--){let e=W[s];e.life-=a,e.r+=600*a,e.life<=0&&W.splice(s,1)}for(let s=U.length-1;s>=0;s--){let e=U[s];e.life-=a,e.life<=0&&U.splice(s,1)}for(let s=O.length-1;s>=0;s--){let e=O[s];e.life-=a,e.life<=0&&O.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}let i=new Set(S.map(s=>s.id));for(let s of S)if(F.has(s.id)){let e=F.get(s.id);e.level!==s.level&&(K.push({id:s.id,life:1}),e.level=s.level),e.syncFromLogic()}else{let e=new at(s);e.level=s.level,F.set(s.id,e)}for(let s of Array.from(F.keys()))i.has(s)||F.delete(s)}function Lt(){if(rt(),typeof t>"u"||!t)return;t.clearRect(0,0,E,R);let a=t.createRadialGradient(E*.6,R*.3,50,E*.6,R*.3,Math.max(E,R));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,E,R);for(let e of lt){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=nt(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of W){let n=nt(e.life/.25,0,1);t.strokeStyle=L(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,X),t.stroke()}for(let e of ht)t.save(),t.shadowBlur=12,t.shadowColor=L(e.team,.9),t.fillStyle=L(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,X),t.fill(),t.restore();for(let e of A)e.draw();for(let e of F.values())e.draw();let i=S.some(e=>e.alive&&e.team===w.RED),s=S.some(e=>e.alive&&e.team===w.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?L(w.RED,.95):s?L(w.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,E/2,64),t.restore()}}function Jt(){if(typeof document>"u")return;let a=document.getElementById("startPause"),i=document.getElementById("reset"),s=document.getElementById("addRed"),e=document.getElementById("addBlue"),n=document.getElementById("toggleTrails"),o=document.getElementById("speed"),l=document.getElementById("redScore"),g=document.getElementById("blueScore"),h=document.getElementById("stats"),_=document.getElementById("seedBtn"),f=document.getElementById("formationBtn");function x(){l.textContent=`Red ${ot.red}`,g.textContent=`Blue ${ot.blue}`,h.textContent=`Ships: ${S.filter(r=>r.alive).length}  Bullets: ${ht.length}  Particles: ${A.length}`}a.addEventListener("click",()=>{Q=!Q,a.textContent=Q?"\u23F8 Pause":"\u25B6 Start"}),i.addEventListener("click",()=>{reset()}),s.addEventListener("click",()=>{S.push(new $(w.RED,c(40,E*.35),c(80,R-80))),st("+1 Red")}),e.addEventListener("click",()=>{S.push(new $(w.BLUE,c(E*.65,E-40),c(80,R-80))),st("+1 Blue")}),n.addEventListener("click",()=>{tt=!tt,n.textContent=`\u2604 Trails: ${tt?"On":"Off"}`}),o.addEventListener("click",()=>{let r=[.5,1,2,4],p=(r.indexOf(Z)+1)%r.length;Z=r[p],o.textContent=`Speed: ${Z}\xD7`}),_.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),f.addEventListener("click",()=>{let r=S.filter(d=>d.alive&&d.team===w.RED),p=S.filter(d=>d.alive&&d.team===w.BLUE),m=20,u=6;r.forEach((d,M)=>{let y=M%u,k=Math.floor(M/u);d.x=E*.25-y*20,d.y=R*.5+(k-u/2)*m,d.vx=d.vy=0}),p.forEach((d,M)=>{let y=M%u,k=Math.floor(M/u);d.x=E*.75+y*20,d.y=R*.5+(k-u/2)*m,d.vx=d.vy=0}),st("Fleets re-formed")}),G.addEventListener("click",r=>{W.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:dt(0,1)});for(let m=0;m<24;m++){let u=c(0,X),d=c(40,220);A.push(new z(r.clientX,r.clientY,Math.cos(u)*d,Math.sin(u)*d,c(.2,1),"rgba(255,255,255,$a)"))}});function v(r){J||(J=r);let p=(r-J)/1e3;J=r;let m=nt(p,0,.033)*(Q?Z:0);wt(m),Lt(),x(),requestAnimationFrame(v)}reset(),requestAnimationFrame(v)}export{z as Particle,at as ShipV,ht as bullets,W as flashes,O as healthFlashes,zt as initRenderer,Jt as initRendererUI,J as lastTime,K as levelFlashes,A as particles,Lt as render,Q as running,ot as score,U as shieldFlashes,S as ships,F as shipsVMap,tt as showTrails,wt as simulate,Z as speed,H as state,L as teamColor,st as toast,jt as updateUI};

</script>
<script type="module">
var gt=Object.defineProperty;var Et=(a,i,s)=>i in a?gt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var ut=(a,i,s)=>Et(a,typeof i!="symbol"?i+"":i,s);var Mt=!1,ot=123456789;function Tt(){return Mt?(ot=1664525*ot+1013904223>>>0,ot/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*Tt()}function mt(a,i){return Math.floor(c(a,i+1))}var _={RED:0,BLUE:1},nt=class{constructor(i,s,e,o,n,l=null){this.x=i,this.y=s,this.vx=e,this.vy=o,this.team=n,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},Z=class Z{constructor(i,s,e,o="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=o;let n={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=n[o]||n.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=Z._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),o==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let o=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(o*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,o=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let l=n.x-this.x,v=n.y-this.y,h=l*l+v*v;h<o&&h<e&&(e=h,s=n)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),o=0,n=0;if(e){let m=e.x-this.x,g=e.y-this.y,r=Math.hypot(m,g)||1,d=Math.max(0,Math.min(1.2,r/240)),x=e.x+(e.vx||0)*d,u=e.y+(e.vy||0)*d,f=x-this.x,E=u-this.y,y=Math.hypot(f,E)||1;if(o+=f/y*this.accel,n+=E/y*this.accel,r<this.range){let L=((this.vx||1)*m+(this.vy||1)*g)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&L>0){let X=300+c(-20,20),Y=m/r,C=g/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let V=arguments[2],G=new nt(this.x+Y*12,this.y+C*12,Y*X+this.vx*.2,C*X+this.vy*.2,this.team,this.id);G.dmg*=1+.06*(this.level-1),V.push(G)}this.cooldown=this.reload}}}else o+=Math.cos(this.angle)*(this.accel*.3),n+=Math.sin(this.angle)*(this.accel*.3);let l=0,v=0,h=0,S=26;for(let m of s){if(!m.alive||m===this||m.team!==this.team)continue;let g=this.x-m.x,r=this.y-m.y,d=g*g+r*r;if(d<S*S&&d>1){let x=Math.sqrt(d);l+=g/x,v+=r/x,h++}}h>0&&(o+=l/h*this.accel*.9,n+=v/h*this.accel*.9),this.vx+=o*i,this.vy+=n*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let m=this.maxSpeed/p;this.vx*=m,this.vy*=m}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ut(Z,"_id",1);var N=Z;function yt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,o=s.H;for(let n of a.ships){if(!n.alive)continue;let l=n.radius||0;n.x<-l?n.x+=e+l*2:n.x>e+l&&(n.x-=e+l*2),n.y<-l?n.y+=o+l*2:n.y>o+l&&(n.y-=o+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let o=Math.max(1,Math.floor(e.launchAmount||1));for(let n=0;n<o;n++){let l=c(0,Math.PI*2),v=e.radius+12+c(4,12),h=e.x+Math.cos(l)*v,S=e.y+Math.sin(l)*v,p=new N(e.team,h,S,"fighter"),m=c(40,120);p.vx=Math.cos(l)*m+(e.vx||0)*.2,p.vy=Math.sin(l)*m+(e.vy||0)*.2,a.ships.push(p)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let o=a.bullets[e];o.update(i),o.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let o=a.bullets[e];for(let n of a.ships){if(!n.alive||n.team===o.team)continue;let l=n.x-o.x,v=n.y-o.y,h=l*l+v*v,S=n.radius+o.radius;if(h<S*S){let p=o.dmg,m=typeof n.shield=="number"?n.shield:0,g=typeof n.hp=="number"?n.hp:0,r=n.damage(p),d=Math.max(0,m-(typeof n.shield=="number"?n.shield:0)),x=Math.max(0,g-(typeof n.hp=="number"?n.hp:0));if(d>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:d}),x>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:x}),o.ownerId!=null){let u=a.ships.find(f=>f.id===o.ownerId);u&&u.gainXp(p*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!n.alive&&(o.team===0?a.score.red++:a.score.blue++,o.ownerId!=null)){let u=a.ships.find(f=>f.id===o.ownerId);u&&u.gainXp(20+(n.level||1)*.2)}break}}}}var $,t,M,P;function ee(){$=document.getElementById("world"),t=$.getContext("2d"),M=$.width=window.innerWidth,P=$.height=window.innerHeight,window.addEventListener("resize",()=>{M=$.width=window.innerWidth,P=$.height=window.innerHeight})}function dt(){return(typeof t>"u"||t===void 0)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t}var A=[],q=[],O=[],K=[],z=[],F=new Map,R=[],ft=[],tt=0,et=!1,it=1,st=!0,at={red:0,blue:0},H={ships:R,bullets:ft,score:at,particles:A,shieldHits:[],healthHits:[],explosions:[]},k=Math.PI*2,rt=(a,i,s)=>Math.max(i,Math.min(s,a)),U=(a=0,i=1)=>a+(i-a)*Math.random();function Bt(a,i,s,e,o,n){let l=Math.min(n,o/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+o-l),a.quadraticCurveTo(i+e,s+o,i+e-l,s+o),a.lineTo(i+l,s+o),a.quadraticCurveTo(i,s+o,i,s+o-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function lt(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ht=[];function Ht(){ht.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ht.push({x:U(0,M),y:U(0,P),r:U(.3,1.8)*i,d:i,tw:U(.4,1),phase:U(0,k)})}Ht();var w=(a,i=1)=>a===_.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,j=class{constructor(i,s,e,o,n,l){this.x=i,this.y=s,this.vx=e,this.vy=o,this.life=n,this.max=n,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;dt(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ct=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;dt();let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(st){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;A.push(new j(r,d,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,w(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=w(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=w(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,k),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,k),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,k),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,d,0,k);let x=t.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);x.addColorStop(0,`rgba(140,200,255,${.06})`),x.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=x,t.globalCompositeOperation="lighter",t.fill());for(let u of O){if(u.id!==i.id)continue;let f=Math.max(0,Math.min(1,u.life/.22)),E=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),y=Math.max(.08,Math.min(1,E)),X=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*y),Y=u.angle-X/2,C=u.angle+X/2,V=d+4*(1-f)+2*y;t.beginPath(),t.arc(i.x,i.y,V,Y,C),t.lineWidth=(3+6*f)*(1+4*y);let G=Math.min(1,.25+f*(.9+1.6*y));t.strokeStyle=`rgba(160,220,255,${G})`,t.save(),t.shadowBlur=12*y,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let o=Math.max(16,e*3.2),n=Math.max(3,e*.4),l=i.x-o/2,v=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,v,o,n),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,v,o*r,n))}let h=i.y+(e+8),S=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,n);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),d=Math.max(12,Math.round(n*6));t.save(),t.font=`700 ${d}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let x=t.measureText(r).width,u=8,f=Math.max(2,Math.round((d-n)/2)),E=Math.max(18,x+u*2),y=Math.max(n+2,d*.9),L=l-8-E,X=h+n/2-y/2,Y=y/2,C=4,V=L-C,G=X-C,vt=E+C*2,pt=y+C*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",Bt(t,V,G,vt,pt,pt/2),t.fill(),t.restore();let J=z.find(W=>W.id===i.id&&W.life>0),Q=1;J&&(Q=1+.6*Math.max(0,Math.min(1,J.life/1)));let D=E*Q,I=y*Q,T=L-(D-E),b=X-(I-y)/2,B=I/2;if(t.beginPath(),t.moveTo(T+B,b),t.lineTo(T+D-B,b),t.quadraticCurveTo(T+D,b,T+D,b+B),t.lineTo(T+D,b+I-B),t.quadraticCurveTo(T+D,b+I,T+D-B,b+I),t.lineTo(T+B,b+I),t.quadraticCurveTo(T,b+I,T,b+I-B),t.lineTo(T,b+B),t.quadraticCurveTo(T,b,T+B,b),t.closePath(),J){let W=Math.max(.6,Math.min(1,J.life));t.save(),t.shadowBlur=20*W,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=w(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*W})`,t.stroke()}else t.fillStyle=w(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(d*Q)}px Inter, system-ui, sans-serif`,t.fillText(r,T+D/2,b+I/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+p,h),t.lineTo(l+o-p,h),t.quadraticCurveTo(l+o,h,l+o,h+p),t.lineTo(l+o,h+n-p),t.quadraticCurveTo(l+o,h+n,l+o-p,h+n),t.lineTo(l+p,h+n),t.quadraticCurveTo(l,h+n,l,h+n-p),t.lineTo(l,h+p),t.quadraticCurveTo(l,h,l+p,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let m=K.find(r=>r.id===i.id&&r.life>0),g=`rgba(120,220,120,${.95})`;if(m){let r=Math.max(0,Math.min(1,m.life/.45)),d=Math.min(1,m.amount/(i.hpMax||1)),x=Math.floor(220*(1-d*r)),u=Math.floor(60+160*(1-r*d));g=`rgba(${Math.min(255,x)},${Math.min(255,u)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+p,h),t.lineTo(l+o-p,h),t.quadraticCurveTo(l+o,h,l+o,h+p),t.lineTo(l+o,h+n-p),t.quadraticCurveTo(l+o,h+n,l+o-p,h+n),t.lineTo(l+p,h+n),t.quadraticCurveTo(l,h+n,l,h+n-p),t.lineTo(l,h+p),t.quadraticCurveTo(l,h,l+p,h),t.closePath(),t.clip(),t.fillStyle=g,t.fillRect(l,h,o*S,n))}};function ie(){}function At(a){if(yt(H,a,{W:M,H:P}),Array.isArray(H.healthHits)&&H.healthHits.length){for(let s of H.healthHits){let e=R.find(o=>o.id===s.id);if(e){K.push({id:e.id,life:.45,amount:s.amount});for(let o=0;o<6;o++){let n=c(0,k),l=c(40,120);A.push(new j(s.hitX,s.hitY,Math.cos(n)*l,Math.sin(n)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}H.healthHits.length=0}if(Array.isArray(H.shieldHits)&&H.shieldHits.length){for(let s of H.shieldHits){let e=R.find(o=>o.id===s.id);if(e){let o=Math.atan2(s.hitY-e.y,s.hitX-e.x);O.push({id:e.id,angle:o,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}H.shieldHits.length=0}for(let s=A.length-1;s>=0;s--){let e=A[s];e.update(a),e.life<=0&&A.splice(s,1)}for(let s=q.length-1;s>=0;s--){let e=q[s];e.life-=a,e.r+=600*a,e.life<=0&&q.splice(s,1)}for(let s=O.length-1;s>=0;s--){let e=O[s];e.life-=a,e.life<=0&&O.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}let i=new Set(R.map(s=>s.id));for(let s of R)if(F.has(s.id)){let e=F.get(s.id);e.level!==s.level&&(z.push({id:s.id,life:1}),e.level=s.level),e.syncFromLogic()}else{let e=new ct(s);e.level=s.level,F.set(s.id,e)}for(let s of Array.from(F.keys()))i.has(s)||F.delete(s)}function kt(){if(dt(),typeof t>"u"||!t)return;t.clearRect(0,0,M,P);let a=t.createRadialGradient(M*.6,P*.3,50,M*.6,P*.3,Math.max(M,P));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,M,P);for(let e of ht){let o=.6+.4*Math.sin(e.phase);t.globalAlpha=rt(.5*o*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of q){let o=rt(e.life/.25,0,1);t.strokeStyle=w(e.team,o*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,k),t.stroke()}for(let e of ft)t.save(),t.shadowBlur=12,t.shadowColor=w(e.team,.9),t.fillStyle=w(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,k),t.fill(),t.restore();for(let e of A)e.draw();for(let e of F.values())e.draw();let i=R.some(e=>e.alive&&e.team===_.RED),s=R.some(e=>e.alive&&e.team===_.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",o=i?w(_.RED,.95):s?w(_.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=o,t.shadowBlur=14,t.shadowColor=o,t.fillText(`${e} Wins!`,M/2,64),t.restore()}}function se(){if(typeof document>"u")return;let a=document.getElementById("startPause"),i=document.getElementById("reset"),s=document.getElementById("addRed"),e=document.getElementById("addBlue"),o=document.getElementById("toggleTrails"),n=document.getElementById("speed"),l=document.getElementById("redScore"),v=document.getElementById("blueScore"),h=document.getElementById("stats"),S=document.getElementById("seedBtn"),p=document.getElementById("formationBtn");function m(){l.textContent=`Red ${at.red}`,v.textContent=`Blue ${at.blue}`,h.textContent=`Ships: ${R.filter(r=>r.alive).length}  Bullets: ${ft.length}  Particles: ${A.length}`}a.addEventListener("click",()=>{et=!et,a.textContent=et?"\u23F8 Pause":"\u25B6 Start"}),i.addEventListener("click",()=>{reset()}),s.addEventListener("click",()=>{R.push(new N(_.RED,c(40,M*.35),c(80,P-80))),lt("+1 Red")}),e.addEventListener("click",()=>{R.push(new N(_.BLUE,c(M*.65,M-40),c(80,P-80))),lt("+1 Blue")}),o.addEventListener("click",()=>{st=!st,o.textContent=`\u2604 Trails: ${st?"On":"Off"}`}),n.addEventListener("click",()=>{let r=[.5,1,2,4],d=(r.indexOf(it)+1)%r.length;it=r[d],n.textContent=`Speed: ${it}\xD7`}),S.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),p.addEventListener("click",()=>{let r=R.filter(f=>f.alive&&f.team===_.RED),d=R.filter(f=>f.alive&&f.team===_.BLUE),x=20,u=6;r.forEach((f,E)=>{let y=E%u,L=Math.floor(E/u);f.x=M*.25-y*20,f.y=P*.5+(L-u/2)*x,f.vx=f.vy=0}),d.forEach((f,E)=>{let y=E%u,L=Math.floor(E/u);f.x=M*.75+y*20,f.y=P*.5+(L-u/2)*x,f.vx=f.vy=0}),lt("Fleets re-formed")}),$.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:mt(0,1)});for(let x=0;x<24;x++){let u=c(0,k),f=c(40,220);A.push(new j(r.clientX,r.clientY,Math.cos(u)*f,Math.sin(u)*f,c(.2,1),"rgba(255,255,255,$a)"))}});function g(r){tt||(tt=r);let d=(r-tt)/1e3;tt=r;let x=rt(d,0,.033)*(et?it:0);At(x),kt(),m(),requestAnimationFrame(g)}reset(),requestAnimationFrame(g)}export{j as Particle,ct as ShipV,ft as bullets,q as flashes,K as healthFlashes,ee as initRenderer,se as initRendererUI,tt as lastTime,z as levelFlashes,A as particles,kt as render,et as running,at as score,O as shieldFlashes,R as ships,F as shipsVMap,st as showTrails,At as simulate,it as speed,H as state,w as teamColor,lt as toast,ie as updateUI};

</script>
<script type="module">
var vt=Object.defineProperty;var Et=(a,i,s)=>i in a?vt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var pt=(a,i,s)=>Et(a,typeof i!="symbol"?i+"":i,s);var Mt=!1,nt=123456789;function Tt(){return Mt?(nt=1664525*nt+1013904223>>>0,nt/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*Tt()}function mt(a,i){return Math.floor(c(a,i+1))}var _={RED:0,BLUE:1},ot=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},Z=class Z{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=Z._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,g=o.y-this.y,h=l*l+g*g;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let m=e.x-this.x,v=e.y-this.y,r=Math.hypot(m,v)||1,f=Math.max(0,Math.min(1.2,r/240)),x=e.x+(e.vx||0)*f,p=e.y+(e.vy||0)*f,u=x-this.x,E=p-this.y,y=Math.hypot(u,E)||1;if(n+=u/y*this.accel,o+=E/y*this.accel,r<this.range){let B=((this.vx||1)*m+(this.vy||1)*v)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&B>0){let D=300+c(-20,20),V=m/r,C=v/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let U=arguments[2],G=new ot(this.x+V*12,this.y+C*12,V*D+this.vx*.2,C*D+this.vy*.2,this.team,this.id);G.dmg*=1+.06*(this.level-1),U.push(G)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,g=0,h=0,P=26;for(let m of s){if(!m.alive||m===this||m.team!==this.team)continue;let v=this.x-m.x,r=this.y-m.y,f=v*v+r*r;if(f<P*P&&f>1){let x=Math.sqrt(f);l+=v/x,g+=r/x,h++}}h>0&&(n+=l/h*this.accel*.9,o+=g/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let m=this.maxSpeed/d;this.vx*=m,this.vy*=m}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};pt(Z,"_id",1);var $=Z;function yt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=c(0,Math.PI*2),g=e.radius+12+c(4,12),h=e.x+Math.cos(l)*g,P=e.y+Math.sin(l)*g,d=new $(e.team,h,P,"fighter"),m=c(40,120);d.vx=Math.cos(l)*m+(e.vx||0)*.2,d.vy=Math.sin(l)*m+(e.vy||0)*.2,a.ships.push(d)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,g=o.y-n.y,h=l*l+g*g,P=o.radius+n.radius;if(h<P*P){let d=n.dmg,m=typeof o.shield=="number"?o.shield:0,v=typeof o.hp=="number"?o.hp:0,r=o.damage(d),f=Math.max(0,m-(typeof o.shield=="number"?o.shield:0)),x=Math.max(0,v-(typeof o.hp=="number"?o.hp:0));if(f>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:f}),x>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:x}),n.ownerId!=null){let p=a.ships.find(u=>u.id===n.ownerId);p&&p.gainXp(d*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let p=a.ships.find(u=>u.id===n.ownerId);p&&p.gainXp(20+(o.level||1)*.2)}break}}}}var X,t,M,R;function ee(){X=document.getElementById("world"),t=X.getContext("2d"),M=X.width=window.innerWidth,R=X.height=window.innerHeight,window.addEventListener("resize",()=>{M=X.width=window.innerWidth,R=X.height=window.innerHeight})}function dt(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var L=[],q=[],K=[],z=[],j=[],F=new Map,S=[],ft=[],tt=0,et=!1,it=1,st=!0,at={red:0,blue:0},k={ships:S,bullets:ft,score:at,particles:L,shieldHits:[],healthHits:[],explosions:[]},I=Math.PI*2,rt=(a,i,s)=>Math.max(i,Math.min(s,a)),O=(a=0,i=1)=>a+(i-a)*Math.random();function Ct(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function lt(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ht=[];function Ht(){ht.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ht.push({x:O(0,M),y:O(0,R),r:O(.3,1.8)*i,d:i,tw:O(.4,1),phase:O(0,I)})}Ht();var w=(a,i=1)=>a===_.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,Y=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;dt(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ct=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;dt();let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(st){let r=i.x-Math.cos(i.angle)*i.radius*1.2,f=i.y-Math.sin(i.angle)*i.radius*1.2;L.push(new Y(r,f,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,w(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=w(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=w(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,I),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,I),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,I),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,f=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,f,0,I);let x=t.createRadialGradient(i.x,i.y,f*.6,i.x,i.y,f);x.addColorStop(0,`rgba(140,200,255,${.06})`),x.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=x,t.globalCompositeOperation="lighter",t.fill());for(let p of K){if(p.id!==i.id)continue;let u=Math.max(0,Math.min(1,p.life/.22)),E=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),y=Math.max(.08,Math.min(1,E)),D=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*y),V=p.angle-D/2,C=p.angle+D/2,U=f+4*(1-u)+2*y;t.beginPath(),t.arc(i.x,i.y,U,V,C),t.lineWidth=(3+6*u)*(1+4*y);let G=Math.min(1,.25+u*(.9+1.6*y));t.strokeStyle=`rgba(160,220,255,${G})`,t.save(),t.shadowBlur=12*y,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,g=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,g,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,g,n*r,o))}let h=i.y+(e+8),P=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),f=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${f}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let x=t.measureText(r).width,p=8,u=Math.max(2,Math.round((f-o)/2)),E=Math.max(18,x+p*2),y=Math.max(o+2,f*.9),B=l-8-E,D=h+o/2-y/2,V=y/2,C=4,U=B-C,G=D-C,gt=E+C*2,ut=y+C*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",Ct(t,U,G,gt,ut,ut/2),t.fill(),t.restore();let J=j.find(W=>W.id===i.id&&W.life>0),Q=1;J&&(Q=1+.6*Math.max(0,Math.min(1,J.life/1)));let N=E*Q,H=y*Q,T=B-(N-E),b=D-(H-y)/2,A=H/2;if(t.beginPath(),t.moveTo(T+A,b),t.lineTo(T+N-A,b),t.quadraticCurveTo(T+N,b,T+N,b+A),t.lineTo(T+N,b+H-A),t.quadraticCurveTo(T+N,b+H,T+N-A,b+H),t.lineTo(T+A,b+H),t.quadraticCurveTo(T,b+H,T,b+H-A),t.lineTo(T,b+A),t.quadraticCurveTo(T,b,T+A,b),t.closePath(),J){let W=Math.max(.6,Math.min(1,J.life));t.save(),t.shadowBlur=20*W,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=w(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*W})`,t.stroke()}else t.fillStyle=w(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(f*Q)}px Inter, system-ui, sans-serif`,t.fillText(r,T+N/2,b+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+d,h),t.lineTo(l+n-d,h),t.quadraticCurveTo(l+n,h,l+n,h+d),t.lineTo(l+n,h+o-d),t.quadraticCurveTo(l+n,h+o,l+n-d,h+o),t.lineTo(l+d,h+o),t.quadraticCurveTo(l,h+o,l,h+o-d),t.lineTo(l,h+d),t.quadraticCurveTo(l,h,l+d,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let m=z.find(r=>r.id===i.id&&r.life>0),v=`rgba(120,220,120,${.95})`;if(m){let r=Math.max(0,Math.min(1,m.life/.45)),f=Math.min(1,m.amount/(i.hpMax||1)),x=Math.floor(220*(1-f*r)),p=Math.floor(60+160*(1-r*f));v=`rgba(${Math.min(255,x)},${Math.min(255,p)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+d,h),t.lineTo(l+n-d,h),t.quadraticCurveTo(l+n,h,l+n,h+d),t.lineTo(l+n,h+o-d),t.quadraticCurveTo(l+n,h+o,l+n-d,h+o),t.lineTo(l+d,h+o),t.quadraticCurveTo(l,h+o,l,h+o-d),t.lineTo(l,h+d),t.quadraticCurveTo(l,h,l+d,h),t.closePath(),t.clip(),t.fillStyle=v,t.fillRect(l,h,n*P,o))}};function ie(){}function At(a){if(yt(k,a,{W:M,H:R}),Array.isArray(k.healthHits)&&k.healthHits.length){for(let s of k.healthHits){let e=S.find(n=>n.id===s.id);if(e){z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,I),l=c(40,120);L.push(new Y(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}k.healthHits.length=0}if(Array.isArray(k.shieldHits)&&k.shieldHits.length){for(let s of k.shieldHits){let e=S.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);K.push({id:e.id,angle:n,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}k.shieldHits.length=0}for(let s=L.length-1;s>=0;s--){let e=L[s];e.update(a),e.life<=0&&L.splice(s,1)}for(let s=q.length-1;s>=0;s--){let e=q[s];e.life-=a,e.r+=600*a,e.life<=0&&q.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let e=j[s];e.life-=a,e.life<=0&&j.splice(s,1)}let i=new Set(S.map(s=>s.id));for(let s of S)if(F.has(s.id)){let e=F.get(s.id);if(e.level!==s.level){j.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=c(0,I),l=c(60,240);L.push(new Y(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,c(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new ct(s);e.level=s.level,F.set(s.id,e)}for(let s of Array.from(F.keys()))i.has(s)||F.delete(s)}function kt(){if(dt(),typeof t>"u"||!t)return;t.clearRect(0,0,M,R);let a=t.createRadialGradient(M*.6,R*.3,50,M*.6,R*.3,Math.max(M,R));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,M,R);for(let e of ht){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=rt(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of q){let n=rt(e.life/.25,0,1);t.strokeStyle=w(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,I),t.stroke()}for(let e of ft)t.save(),t.shadowBlur=12,t.shadowColor=w(e.team,.9),t.fillStyle=w(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,I),t.fill(),t.restore();for(let e of L)e.draw();for(let e of F.values())e.draw();let i=S.some(e=>e.alive&&e.team===_.RED),s=S.some(e=>e.alive&&e.team===_.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?w(_.RED,.95):s?w(_.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,M/2,64),t.restore()}}function se(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),h=document.getElementById&&document.getElementById("stats"),P=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function m(){l&&(l.textContent=`Red ${at.red}`),g&&(g.textContent=`Blue ${at.blue}`),h&&(h.textContent=`Ships: ${S.filter(r=>r.alive).length}  Bullets: ${ft.length}  Particles: ${L.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{et=!et,a.textContent=et?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{S.push(new $(_.RED,c(40,M*.35),c(80,R-80))),lt("+1 Red")}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{S.push(new $(_.BLUE,c(M*.65,M-40),c(80,R-80))),lt("+1 Blue")}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{st=!st,n.textContent=`\u2604 Trails: ${st?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=[.5,1,2,4],f=(r.indexOf(it)+1)%r.length;it=r[f],o.textContent=`Speed: ${it}\xD7`}),P&&typeof P.addEventListener=="function"&&P.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=S.filter(u=>u.alive&&u.team===_.RED),f=S.filter(u=>u.alive&&u.team===_.BLUE),x=20,p=6;r.forEach((u,E)=>{let y=E%p,B=Math.floor(E/p);u.x=M*.25-y*20,u.y=R*.5+(B-p/2)*x,u.vx=u.vy=0}),f.forEach((u,E)=>{let y=E%p,B=Math.floor(E/p);u.x=M*.75+y*20,u.y=R*.5+(B-p/2)*x,u.vx=u.vy=0}),lt("Fleets re-formed")}),X&&typeof X.addEventListener=="function"&&X.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:mt(0,1)});for(let x=0;x<24;x++){let p=c(0,I),u=c(40,220);L.push(new Y(r.clientX,r.clientY,Math.cos(p)*u,Math.sin(p)*u,c(.2,1),"rgba(255,255,255,$a)"))}});function v(r){tt||(tt=r);let f=(r-tt)/1e3;tt=r;let x=rt(f,0,.033)*(et?it:0);At(x),kt(),m(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(v)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(v)}export{Y as Particle,ct as ShipV,ft as bullets,q as flashes,z as healthFlashes,ee as initRenderer,se as initRendererUI,tt as lastTime,j as levelFlashes,L as particles,kt as render,et as running,at as score,K as shieldFlashes,S as ships,F as shipsVMap,st as showTrails,At as simulate,it as speed,k as state,w as teamColor,lt as toast,ie as updateUI};

</script>
<script type="module">
var Et=Object.defineProperty;var Mt=(a,i,s)=>i in a?Et(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var mt=(a,i,s)=>Mt(a,typeof i!="symbol"?i+"":i,s);var Tt=!1,nt=123456789;function bt(){return Tt?(nt=1664525*nt+1013904223>>>0,nt/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*bt()}function ot(a,i){return Math.floor(c(a,i+1))}var w={RED:0,BLUE:1},lt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},Q=class Q{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=Q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,v=o.y-this.y,h=l*l+v*v;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,E=e.y-this.y,d=Math.hypot(x,E)||1,r=Math.max(0,Math.min(1.2,d/240)),p=e.x+(e.vx||0)*r,u=e.y+(e.vy||0)*r,y=p-this.x,m=u-this.y,g=Math.hypot(y,m)||1;if(n+=y/g*this.accel,o+=m/g*this.accel,d<this.range){let _=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&_>0){let R=300+c(-20,20),D=x/d,O=E/d;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],G=new lt(this.x+D*12,this.y+O*12,D*R+this.vx*.2,O*R+this.vy*.2,this.team,this.id);G.dmg*=1+.06*(this.level-1),N.push(G)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,v=0,h=0,P=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,d=this.y-x.y,r=E*E+d*d;if(r<P*P&&r>1){let p=Math.sqrt(r);l+=E/p,v+=d/p,h++}}h>0&&(n+=l/h*this.accel*.9,o+=v/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let f=Math.hypot(this.vx,this.vy);if(f>this.maxSpeed){let x=this.maxSpeed/f;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};mt(Q,"_id",1);var q=Q;function yt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=c(0,Math.PI*2),v=e.radius+12+c(4,12),h=e.x+Math.cos(l)*v,P=e.y+Math.sin(l)*v,f=new q(e.team,h,P,"fighter"),x=c(40,120);f.vx=Math.cos(l)*x+(e.vx||0)*.2,f.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(f)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,v=o.y-n.y,h=l*l+v*v,P=o.radius+n.radius;if(h<P*P){let f=n.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,d=o.damage(f),r=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),p=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(r>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:r}),p>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:p}),n.ownerId!=null){let u=a.ships.find(y=>y.id===n.ownerId);u&&u.gainXp(f*.05)}if(a.bullets.splice(e,1),d&&a.explosions&&a.explosions.push(d),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let u=a.ships.find(y=>y.id===n.ownerId);u&&u.gainXp(20+(o.level||1)*.2)}break}}}}var X,t,M,S;function ie(){X=document.getElementById("world"),t=X.getContext("2d"),M=X.width=window.innerWidth,S=X.height=window.innerHeight,window.addEventListener("resize",()=>{M=X.width=window.innerWidth,S=X.height=window.innerHeight})}function ft(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var I=[],F=[],K=[],z=[],Z=[],Y=new Map,L=[],ut=[],tt=0,et=!1,it=1,st=!0,rt={red:0,blue:0};var k={ships:L,bullets:ut,score:rt,particles:I,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,ht=(a,i,s)=>Math.max(i,Math.min(s,a)),U=(a=0,i=1)=>a+(i-a)*Math.random();function Ht(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function at(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ct=[];function At(){ct.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ct.push({x:U(0,M),y:U(0,S),r:U(.3,1.8)*i,d:i,tw:U(.4,1),phase:U(0,B)})}At();var C=(a,i=1)=>a===w.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,V=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ft(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},dt=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;ft();let s=F.some(d=>d.shieldHit&&d.x===i.x&&d.y===i.y&&d.life>0);if(st){let d=i.x-Math.cos(i.angle)*i.radius*1.2,r=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new V(d,r,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,C(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=C(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=C(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,B),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,B),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,B),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,r=e+4+(1-d)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,r,0,B);let p=t.createRadialGradient(i.x,i.y,r*.6,i.x,i.y,r);p.addColorStop(0,`rgba(140,200,255,${.06})`),p.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=p,t.globalCompositeOperation="lighter",t.fill());for(let u of K){if(u.id!==i.id)continue;let y=Math.max(0,Math.min(1,u.life/.22)),m=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),g=Math.max(.08,Math.min(1,m)),R=(Math.PI*.25+Math.PI*.6*(1-y))*(.6+1.6*g),D=u.angle-R/2,O=u.angle+R/2,N=r+4*(1-y)+2*g;t.beginPath(),t.arc(i.x,i.y,N,D,O),t.lineWidth=(3+6*y)*(1+4*g);let G=Math.min(1,.25+y*(.9+1.6*g));t.strokeStyle=`rgba(160,220,255,${G})`,t.save(),t.shadowBlur=12*g,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,v=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,v,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,v,n*d,o))}let h=i.y+(e+8),P=Math.max(0,Math.min(1,i.hp/i.hpMax)),f=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let d=String(i.level||1),p=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${p}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let u=t.measureText(d).width,y=8,m=Math.max(2,Math.round((p-o)/2)),g=Math.max(18,u+y*2),_=Math.max(o+2,p*.9),R=l-8-g,D=h+o/2-_/2,O=_/2,N=4,G=R-N,gt=D-N,vt=g+N*2,pt=_+N*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",Ht(t,G,gt,vt,pt,pt/2),t.fill(),t.restore();let j=Z.find(W=>W.id===i.id&&W.life>0),J=1;j&&(J=1+.6*Math.max(0,Math.min(1,j.life/1)));let $=g*J,H=_*J,T=R-($-g),b=D-(H-_)/2,A=H/2;if(t.beginPath(),t.moveTo(T+A,b),t.lineTo(T+$-A,b),t.quadraticCurveTo(T+$,b,T+$,b+A),t.lineTo(T+$,b+H-A),t.quadraticCurveTo(T+$,b+H,T+$-A,b+H),t.lineTo(T+A,b+H),t.quadraticCurveTo(T,b+H,T,b+H-A),t.lineTo(T,b+A),t.quadraticCurveTo(T,b,T+A,b),t.closePath(),j){let W=Math.max(.6,Math.min(1,j.life));t.save(),t.shadowBlur=20*W,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=C(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*W})`,t.stroke()}else t.fillStyle=C(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(p*J)}px Inter, system-ui, sans-serif`,t.fillText(d,T+$/2,b+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=z.find(d=>d.id===i.id&&d.life>0),E=`rgba(120,220,120,${.95})`;if(x){let d=Math.max(0,Math.min(1,x.life/.45)),r=Math.min(1,x.amount/(i.hpMax||1)),p=Math.floor(220*(1-r*d)),u=Math.floor(60+160*(1-d*r));E=`rgba(${Math.min(255,p)},${Math.min(255,u)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.clip(),t.fillStyle=E,t.fillRect(l,h,n*P,o))}};function se(){}function kt(a){if(yt(k,a,{W:M,H:S}),Array.isArray(k.healthHits)&&k.healthHits.length){for(let s of k.healthHits){let e=L.find(n=>n.id===s.id);if(e){z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,B),l=c(40,120);I.push(new V(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}k.healthHits.length=0}if(Array.isArray(k.shieldHits)&&k.shieldHits.length){for(let s of k.shieldHits){let e=L.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);K.push({id:e.id,angle:n,life:.22,amount:s.amount}),F.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}k.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(a),e.life<=0&&I.splice(s,1)}for(let s=F.length-1;s>=0;s--){let e=F[s];e.life-=a,e.r+=600*a,e.life<=0&&F.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}let i=new Set(L.map(s=>s.id));for(let s of L)if(Y.has(s.id)){let e=Y.get(s.id);if(e.level!==s.level){Z.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=c(0,B),l=c(60,240);I.push(new V(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,c(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new dt(s);e.level=s.level,Y.set(s.id,e)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Xt(){if(ft(),typeof t>"u"||!t)return;t.clearRect(0,0,M,S);let a=t.createRadialGradient(M*.6,S*.3,50,M*.6,S*.3,Math.max(M,S));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,M,S);for(let e of ct){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=ht(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of F){let n=ht(e.life/.25,0,1);t.strokeStyle=C(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,B),t.stroke()}for(let e of ut)t.save(),t.shadowBlur=12,t.shadowColor=C(e.team,.9),t.fillStyle=C(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,B),t.fill(),t.restore();for(let e of I)e.draw();for(let e of Y.values())e.draw();let i=L.some(e=>e.alive&&e.team===w.RED),s=L.some(e=>e.alive&&e.team===w.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?C(w.RED,.95):s?C(w.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,M/2,64),t.restore()}}function ne(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),v=document.getElementById&&document.getElementById("blueScore"),h=document.getElementById&&document.getElementById("stats"),P=document.getElementById&&document.getElementById("seedBtn"),f=document.getElementById&&document.getElementById("formationBtn");function x(){l&&(l.textContent=`Red ${rt.red}`),v&&(v.textContent=`Blue ${rt.blue}`),h&&(h.textContent=`Ships: ${L.filter(r=>r.alive).length}  Bullets: ${ut.length}  Particles: ${I.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{et=!et,a.textContent=et?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()});function E(){let r=["corvette","frigate","destroyer","carrier","fighter"];return r[ot(0,r.length-1)]}s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=E();L.push(new q(w.RED,c(40,M*.35),c(80,S-80),r)),at(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=E();L.push(new q(w.BLUE,c(M*.65,M-40),c(80,S-80),r)),at(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{st=!st,n.textContent=`\u2604 Trails: ${st?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=[.5,1,2,4],p=(r.indexOf(it)+1)%r.length;it=r[p],o.textContent=`Speed: ${it}\xD7`}),P&&typeof P.addEventListener=="function"&&P.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),f&&typeof f.addEventListener=="function"&&f.addEventListener("click",()=>{let r=L.filter(m=>m.alive&&m.team===w.RED),p=L.filter(m=>m.alive&&m.team===w.BLUE),u=20,y=6;r.forEach((m,g)=>{let _=g%y,R=Math.floor(g/y);m.x=M*.25-_*20,m.y=S*.5+(R-y/2)*u,m.vx=m.vy=0}),p.forEach((m,g)=>{let _=g%y,R=Math.floor(g/y);m.x=M*.75+_*20,m.y=S*.5+(R-y/2)*u,m.vx=m.vy=0}),at("Fleets re-formed")}),X&&typeof X.addEventListener=="function"&&X.addEventListener("click",r=>{F.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ot(0,1)});for(let u=0;u<24;u++){let y=c(0,B),m=c(40,220);I.push(new V(r.clientX,r.clientY,Math.cos(y)*m,Math.sin(y)*m,c(.2,1),"rgba(255,255,255,$a)"))}});function d(r){tt||(tt=r);let p=(r-tt)/1e3;tt=r;let u=ht(p,0,.033)*(et?it:0);kt(u),Xt(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(d)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(d)}export{V as Particle,dt as ShipV,ut as bullets,F as flashes,z as healthFlashes,ie as initRenderer,ne as initRendererUI,tt as lastTime,Z as levelFlashes,I as particles,Xt as render,et as running,rt as score,K as shieldFlashes,L as ships,Y as shipsVMap,st as showTrails,kt as simulate,it as speed,k as state,C as teamColor,at as toast,se as updateUI};

</script>
<script type="module">
var Et=Object.defineProperty;var Mt=(a,i,s)=>i in a?Et(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var mt=(a,i,s)=>Mt(a,typeof i!="symbol"?i+"":i,s);var Tt=!1,nt=123456789;function bt(){return Tt?(nt=1664525*nt+1013904223>>>0,nt/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*bt()}function ot(a,i){return Math.floor(c(a,i+1))}var w={RED:0,BLUE:1},lt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},Q=class Q{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=Q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,v=o.y-this.y,h=l*l+v*v;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,E=e.y-this.y,d=Math.hypot(x,E)||1,r=Math.max(0,Math.min(1.2,d/240)),p=e.x+(e.vx||0)*r,u=e.y+(e.vy||0)*r,y=p-this.x,m=u-this.y,g=Math.hypot(y,m)||1;if(n+=y/g*this.accel,o+=m/g*this.accel,d<this.range){let _=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&_>0){let R=300+c(-20,20),$=x/d,O=E/d;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],G=new lt(this.x+$*12,this.y+O*12,$*R+this.vx*.2,O*R+this.vy*.2,this.team,this.id);G.dmg*=1+.06*(this.level-1),N.push(G)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,v=0,h=0,S=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,d=this.y-x.y,r=E*E+d*d;if(r<S*S&&r>1){let p=Math.sqrt(r);l+=E/p,v+=d/p,h++}}h>0&&(n+=l/h*this.accel*.9,o+=v/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let f=Math.hypot(this.vx,this.vy);if(f>this.maxSpeed){let x=this.maxSpeed/f;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};mt(Q,"_id",1);var q=Q;function yt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=c(0,Math.PI*2),v=e.radius+12+c(4,12),h=e.x+Math.cos(l)*v,S=e.y+Math.sin(l)*v,f=new q(e.team,h,S,"fighter"),x=c(40,120);f.vx=Math.cos(l)*x+(e.vx||0)*.2,f.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(f)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,v=o.y-n.y,h=l*l+v*v,S=o.radius+n.radius;if(h<S*S){let f=n.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,d=o.damage(f),r=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),p=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(r>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:r}),p>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:p}),n.ownerId!=null){let u=a.ships.find(y=>y.id===n.ownerId);u&&u.gainXp(f*.05)}if(a.bullets.splice(e,1),d&&a.explosions&&a.explosions.push(d),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let u=a.ships.find(y=>y.id===n.ownerId);u&&u.gainXp(20+(o.level||1)*.2)}break}}}}var X,t,M,P;function ie(){X=document.getElementById("world"),t=X.getContext("2d"),M=X.width=window.innerWidth,P=X.height=window.innerHeight,window.addEventListener("resize",()=>{M=X.width=window.innerWidth,P=X.height=window.innerHeight})}function ft(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var I=[],F=[],K=[],z=[],Z=[],Y=new Map,L=[],ut=[],tt=0,et=!1,it=1,st=!0,rt={red:0,blue:0};var se=[.5,1,2,4],k={ships:L,bullets:ut,score:rt,particles:I,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,ht=(a,i,s)=>Math.max(i,Math.min(s,a)),U=(a=0,i=1)=>a+(i-a)*Math.random();function Ht(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function at(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ct=[];function At(){ct.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ct.push({x:U(0,M),y:U(0,P),r:U(.3,1.8)*i,d:i,tw:U(.4,1),phase:U(0,B)})}At();var C=(a,i=1)=>a===w.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,V=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ft(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},dt=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;ft();let s=F.some(d=>d.shieldHit&&d.x===i.x&&d.y===i.y&&d.life>0);if(st){let d=i.x-Math.cos(i.angle)*i.radius*1.2,r=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new V(d,r,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,C(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=C(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=C(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,B),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,B),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,B),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,r=e+4+(1-d)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,r,0,B);let p=t.createRadialGradient(i.x,i.y,r*.6,i.x,i.y,r);p.addColorStop(0,`rgba(140,200,255,${.06})`),p.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=p,t.globalCompositeOperation="lighter",t.fill());for(let u of K){if(u.id!==i.id)continue;let y=Math.max(0,Math.min(1,u.life/.22)),m=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),g=Math.max(.08,Math.min(1,m)),R=(Math.PI*.25+Math.PI*.6*(1-y))*(.6+1.6*g),$=u.angle-R/2,O=u.angle+R/2,N=r+4*(1-y)+2*g;t.beginPath(),t.arc(i.x,i.y,N,$,O),t.lineWidth=(3+6*y)*(1+4*g);let G=Math.min(1,.25+y*(.9+1.6*g));t.strokeStyle=`rgba(160,220,255,${G})`,t.save(),t.shadowBlur=12*g,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,v=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,v,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,v,n*d,o))}let h=i.y+(e+8),S=Math.max(0,Math.min(1,i.hp/i.hpMax)),f=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let d=String(i.level||1),p=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${p}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let u=t.measureText(d).width,y=8,m=Math.max(2,Math.round((p-o)/2)),g=Math.max(18,u+y*2),_=Math.max(o+2,p*.9),R=l-8-g,$=h+o/2-_/2,O=_/2,N=4,G=R-N,gt=$-N,vt=g+N*2,pt=_+N*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",Ht(t,G,gt,vt,pt,pt/2),t.fill(),t.restore();let j=Z.find(W=>W.id===i.id&&W.life>0),J=1;j&&(J=1+.6*Math.max(0,Math.min(1,j.life/1)));let D=g*J,H=_*J,T=R-(D-g),b=$-(H-_)/2,A=H/2;if(t.beginPath(),t.moveTo(T+A,b),t.lineTo(T+D-A,b),t.quadraticCurveTo(T+D,b,T+D,b+A),t.lineTo(T+D,b+H-A),t.quadraticCurveTo(T+D,b+H,T+D-A,b+H),t.lineTo(T+A,b+H),t.quadraticCurveTo(T,b+H,T,b+H-A),t.lineTo(T,b+A),t.quadraticCurveTo(T,b,T+A,b),t.closePath(),j){let W=Math.max(.6,Math.min(1,j.life));t.save(),t.shadowBlur=20*W,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=C(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*W})`,t.stroke()}else t.fillStyle=C(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(p*J)}px Inter, system-ui, sans-serif`,t.fillText(d,T+D/2,b+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=z.find(d=>d.id===i.id&&d.life>0),E=`rgba(120,220,120,${.95})`;if(x){let d=Math.max(0,Math.min(1,x.life/.45)),r=Math.min(1,x.amount/(i.hpMax||1)),p=Math.floor(220*(1-r*d)),u=Math.floor(60+160*(1-d*r));E=`rgba(${Math.min(255,p)},${Math.min(255,u)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.clip(),t.fillStyle=E,t.fillRect(l,h,n*S,o))}};function ne(){}function kt(a){if(yt(k,a,{W:M,H:P}),Array.isArray(k.healthHits)&&k.healthHits.length){for(let s of k.healthHits){let e=L.find(n=>n.id===s.id);if(e){z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,B),l=c(40,120);I.push(new V(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}k.healthHits.length=0}if(Array.isArray(k.shieldHits)&&k.shieldHits.length){for(let s of k.shieldHits){let e=L.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);K.push({id:e.id,angle:n,life:.22,amount:s.amount}),F.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}k.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(a),e.life<=0&&I.splice(s,1)}for(let s=F.length-1;s>=0;s--){let e=F[s];e.life-=a,e.r+=600*a,e.life<=0&&F.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}let i=new Set(L.map(s=>s.id));for(let s of L)if(Y.has(s.id)){let e=Y.get(s.id);if(e.level!==s.level){Z.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=c(0,B),l=c(60,240);I.push(new V(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,c(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new dt(s);e.level=s.level,Y.set(s.id,e)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Xt(){if(ft(),typeof t>"u"||!t)return;t.clearRect(0,0,M,P);let a=t.createRadialGradient(M*.6,P*.3,50,M*.6,P*.3,Math.max(M,P));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,M,P);for(let e of ct){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=ht(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of F){let n=ht(e.life/.25,0,1);t.strokeStyle=C(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,B),t.stroke()}for(let e of ut)t.save(),t.shadowBlur=12,t.shadowColor=C(e.team,.9),t.fillStyle=C(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,B),t.fill(),t.restore();for(let e of I)e.draw();for(let e of Y.values())e.draw();let i=L.some(e=>e.alive&&e.team===w.RED),s=L.some(e=>e.alive&&e.team===w.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?C(w.RED,.95):s?C(w.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,M/2,64),t.restore()}}function oe(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),v=document.getElementById&&document.getElementById("blueScore"),h=document.getElementById&&document.getElementById("stats"),S=document.getElementById&&document.getElementById("seedBtn"),f=document.getElementById&&document.getElementById("formationBtn");function x(){l&&(l.textContent=`Red ${rt.red}`),v&&(v.textContent=`Blue ${rt.blue}`),h&&(h.textContent=`Ships: ${L.filter(r=>r.alive).length}  Bullets: ${ut.length}  Particles: ${I.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{et=!et,a.textContent=et?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()});function E(){let r=["corvette","frigate","destroyer","carrier","fighter"];return r[ot(0,r.length-1)]}s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=E();L.push(new q(w.RED,c(40,M*.35),c(80,P-80),r)),at(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=E();L.push(new q(w.BLUE,c(M*.65,M-40),c(80,P-80),r)),at(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{st=!st,n.textContent=`\u2604 Trails: ${st?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=[.5,1,2,4],p=(r.indexOf(it)+1)%r.length;it=r[p],o.textContent=`Speed: ${it}\xD7`}),S&&typeof S.addEventListener=="function"&&S.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),f&&typeof f.addEventListener=="function"&&f.addEventListener("click",()=>{let r=L.filter(m=>m.alive&&m.team===w.RED),p=L.filter(m=>m.alive&&m.team===w.BLUE),u=20,y=6;r.forEach((m,g)=>{let _=g%y,R=Math.floor(g/y);m.x=M*.25-_*20,m.y=P*.5+(R-y/2)*u,m.vx=m.vy=0}),p.forEach((m,g)=>{let _=g%y,R=Math.floor(g/y);m.x=M*.75+_*20,m.y=P*.5+(R-y/2)*u,m.vx=m.vy=0}),at("Fleets re-formed")}),X&&typeof X.addEventListener=="function"&&X.addEventListener("click",r=>{F.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ot(0,1)});for(let u=0;u<24;u++){let y=c(0,B),m=c(40,220);I.push(new V(r.clientX,r.clientY,Math.cos(y)*m,Math.sin(y)*m,c(.2,1),"rgba(255,255,255,$a)"))}});function d(r){tt||(tt=r);let p=(r-tt)/1e3;tt=r;let u=ht(p,0,.033)*(et?it:0);kt(u),Xt(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(d)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(d)}export{V as Particle,se as SPEED_STEPS,dt as ShipV,ut as bullets,F as flashes,z as healthFlashes,ie as initRenderer,oe as initRendererUI,tt as lastTime,Z as levelFlashes,I as particles,Xt as render,et as running,rt as score,K as shieldFlashes,L as ships,Y as shipsVMap,st as showTrails,kt as simulate,it as speed,k as state,C as teamColor,at as toast,ne as updateUI};

</script>
<script type="module">
var Mt=Object.defineProperty;var Tt=(a,i,s)=>i in a?Mt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var xt=(a,i,s)=>Tt(a,typeof i!="symbol"?i+"":i,s);var bt=!1,nt=123456789;function St(){return bt?(nt=1664525*nt+1013904223>>>0,nt/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*St()}function ot(a,i){return Math.floor(c(a,i+1))}var w={RED:0,BLUE:1},lt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},Q=class Q{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=Q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,v=o.y-this.y,h=l*l+v*v;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let m=e.x-this.x,E=e.y-this.y,d=Math.hypot(m,E)||1,r=Math.max(0,Math.min(1.2,d/240)),x=e.x+(e.vx||0)*r,u=e.y+(e.vy||0)*r,y=x-this.x,p=u-this.y,g=Math.hypot(y,p)||1;if(n+=y/g*this.accel,o+=p/g*this.accel,d<this.range){let _=((this.vx||1)*m+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&_>0){let R=300+c(-20,20),$=m/d,O=E/d;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],G=new lt(this.x+$*12,this.y+O*12,$*R+this.vx*.2,O*R+this.vy*.2,this.team,this.id);G.dmg*=1+.06*(this.level-1),N.push(G)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,v=0,h=0,S=26;for(let m of s){if(!m.alive||m===this||m.team!==this.team)continue;let E=this.x-m.x,d=this.y-m.y,r=E*E+d*d;if(r<S*S&&r>1){let x=Math.sqrt(r);l+=E/x,v+=d/x,h++}}h>0&&(n+=l/h*this.accel*.9,o+=v/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let f=Math.hypot(this.vx,this.vy);if(f>this.maxSpeed){let m=this.maxSpeed/f;this.vx*=m,this.vy*=m}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};xt(Q,"_id",1);var q=Q;function gt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=c(0,Math.PI*2),v=e.radius+12+c(4,12),h=e.x+Math.cos(l)*v,S=e.y+Math.sin(l)*v,f=new q(e.team,h,S,"fighter"),m=c(40,120);f.vx=Math.cos(l)*m+(e.vx||0)*.2,f.vy=Math.sin(l)*m+(e.vy||0)*.2,a.ships.push(f)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,v=o.y-n.y,h=l*l+v*v,S=o.radius+n.radius;if(h<S*S){let f=n.dmg,m=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,d=o.damage(f),r=Math.max(0,m-(typeof o.shield=="number"?o.shield:0)),x=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(r>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:r}),x>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:x}),n.ownerId!=null){let u=a.ships.find(y=>y.id===n.ownerId);u&&u.gainXp(f*.05)}if(a.bullets.splice(e,1),d&&a.explosions&&a.explosions.push(d),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let u=a.ships.find(y=>y.id===n.ownerId);u&&u.gainXp(20+(o.level||1)*.2)}break}}}}var X,t,M,P;function se(){X=document.getElementById("world"),t=X.getContext("2d"),M=X.width=window.innerWidth,P=X.height=window.innerHeight,window.addEventListener("resize",()=>{M=X.width=window.innerWidth,P=X.height=window.innerHeight})}function ut(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var I=[],F=[],K=[],z=[],Z=[],Y=new Map,L=[],pt=[],tt=0,et=!1,it=1,st=!0,ht={red:0,blue:0};var at=[.5,1,2,4],k={ships:L,bullets:pt,score:ht,particles:I,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,ct=(a,i,s)=>Math.max(i,Math.min(s,a)),U=(a=0,i=1)=>a+(i-a)*Math.random();function At(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function rt(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var dt=[];function kt(){dt.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)dt.push({x:U(0,M),y:U(0,P),r:U(.3,1.8)*i,d:i,tw:U(.4,1),phase:U(0,B)})}kt();var C=(a,i=1)=>a===w.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,V=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ut(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ft=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;ut();let s=F.some(d=>d.shieldHit&&d.x===i.x&&d.y===i.y&&d.life>0);if(st){let d=i.x-Math.cos(i.angle)*i.radius*1.2,r=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new V(d,r,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,C(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=C(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=C(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,B),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,B),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,B),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,r=e+4+(1-d)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,r,0,B);let x=t.createRadialGradient(i.x,i.y,r*.6,i.x,i.y,r);x.addColorStop(0,`rgba(140,200,255,${.06})`),x.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=x,t.globalCompositeOperation="lighter",t.fill());for(let u of K){if(u.id!==i.id)continue;let y=Math.max(0,Math.min(1,u.life/.22)),p=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),g=Math.max(.08,Math.min(1,p)),R=(Math.PI*.25+Math.PI*.6*(1-y))*(.6+1.6*g),$=u.angle-R/2,O=u.angle+R/2,N=r+4*(1-y)+2*g;t.beginPath(),t.arc(i.x,i.y,N,$,O),t.lineWidth=(3+6*y)*(1+4*g);let G=Math.min(1,.25+y*(.9+1.6*g));t.strokeStyle=`rgba(160,220,255,${G})`,t.save(),t.shadowBlur=12*g,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,v=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,v,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,v,n*d,o))}let h=i.y+(e+8),S=Math.max(0,Math.min(1,i.hp/i.hpMax)),f=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let d=String(i.level||1),x=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${x}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let u=t.measureText(d).width,y=8,p=Math.max(2,Math.round((x-o)/2)),g=Math.max(18,u+y*2),_=Math.max(o+2,x*.9),R=l-8-g,$=h+o/2-_/2,O=_/2,N=4,G=R-N,vt=$-N,Et=g+N*2,mt=_+N*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",At(t,G,vt,Et,mt,mt/2),t.fill(),t.restore();let j=Z.find(W=>W.id===i.id&&W.life>0),J=1;j&&(J=1+.6*Math.max(0,Math.min(1,j.life/1)));let D=g*J,H=_*J,T=R-(D-g),b=$-(H-_)/2,A=H/2;if(t.beginPath(),t.moveTo(T+A,b),t.lineTo(T+D-A,b),t.quadraticCurveTo(T+D,b,T+D,b+A),t.lineTo(T+D,b+H-A),t.quadraticCurveTo(T+D,b+H,T+D-A,b+H),t.lineTo(T+A,b+H),t.quadraticCurveTo(T,b+H,T,b+H-A),t.lineTo(T,b+A),t.quadraticCurveTo(T,b,T+A,b),t.closePath(),j){let W=Math.max(.6,Math.min(1,j.life));t.save(),t.shadowBlur=20*W,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=C(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*W})`,t.stroke()}else t.fillStyle=C(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(x*J)}px Inter, system-ui, sans-serif`,t.fillText(d,T+D/2,b+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let m=z.find(d=>d.id===i.id&&d.life>0),E=`rgba(120,220,120,${.95})`;if(m){let d=Math.max(0,Math.min(1,m.life/.45)),r=Math.min(1,m.amount/(i.hpMax||1)),x=Math.floor(220*(1-r*d)),u=Math.floor(60+160*(1-d*r));E=`rgba(${Math.min(255,x)},${Math.min(255,u)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+f,h),t.lineTo(l+n-f,h),t.quadraticCurveTo(l+n,h,l+n,h+f),t.lineTo(l+n,h+o-f),t.quadraticCurveTo(l+n,h+o,l+n-f,h+o),t.lineTo(l+f,h+o),t.quadraticCurveTo(l,h+o,l,h+o-f),t.lineTo(l,h+f),t.quadraticCurveTo(l,h,l+f,h),t.closePath(),t.clip(),t.fillStyle=E,t.fillRect(l,h,n*S,o))}};function ne(){}function Xt(a){if(gt(k,a,{W:M,H:P}),Array.isArray(k.healthHits)&&k.healthHits.length){for(let s of k.healthHits){let e=L.find(n=>n.id===s.id);if(e){z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,B),l=c(40,120);I.push(new V(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}k.healthHits.length=0}if(Array.isArray(k.shieldHits)&&k.shieldHits.length){for(let s of k.shieldHits){let e=L.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);K.push({id:e.id,angle:n,life:.22,amount:s.amount}),F.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}k.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(a),e.life<=0&&I.splice(s,1)}for(let s=F.length-1;s>=0;s--){let e=F[s];e.life-=a,e.r+=600*a,e.life<=0&&F.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}let i=new Set(L.map(s=>s.id));for(let s of L)if(Y.has(s.id)){let e=Y.get(s.id);if(e.level!==s.level){Z.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=c(0,B),l=c(60,240);I.push(new V(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,c(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new ft(s);e.level=s.level,Y.set(s.id,e)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Nt(){if(ut(),typeof t>"u"||!t)return;t.clearRect(0,0,M,P);let a=t.createRadialGradient(M*.6,P*.3,50,M*.6,P*.3,Math.max(M,P));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,M,P);for(let e of dt){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=ct(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of F){let n=ct(e.life/.25,0,1);t.strokeStyle=C(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,B),t.stroke()}for(let e of pt)t.save(),t.shadowBlur=12,t.shadowColor=C(e.team,.9),t.fillStyle=C(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,B),t.fill(),t.restore();for(let e of I)e.draw();for(let e of Y.values())e.draw();let i=L.some(e=>e.alive&&e.team===w.RED),s=L.some(e=>e.alive&&e.team===w.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?C(w.RED,.95):s?C(w.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,M/2,64),t.restore()}}function oe(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),v=document.getElementById&&document.getElementById("blueScore"),h=document.getElementById&&document.getElementById("stats"),S=document.getElementById&&document.getElementById("seedBtn"),f=document.getElementById&&document.getElementById("formationBtn");function m(){l&&(l.textContent=`Red ${ht.red}`),v&&(v.textContent=`Blue ${ht.blue}`),h&&(h.textContent=`Ships: ${L.filter(r=>r.alive).length}  Bullets: ${pt.length}  Particles: ${I.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{et=!et,a.textContent=et?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()});function E(){let r=["corvette","frigate","destroyer","carrier","fighter"];return r[ot(0,r.length-1)]}s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=E();L.push(new q(w.RED,c(40,M*.35),c(80,P-80),r)),rt(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=E();L.push(new q(w.BLUE,c(M*.65,M-40),c(80,P-80),r)),rt(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{st=!st,n.textContent=`\u2604 Trails: ${st?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(at.indexOf(it)+1)%at.length;it=at[r],o.textContent=`Speed: ${it}\xD7`}),S&&typeof S.addEventListener=="function"&&S.addEventListener("click",()=>{let r=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);r!==null&&reset(Number(r))}),f&&typeof f.addEventListener=="function"&&f.addEventListener("click",()=>{let r=L.filter(p=>p.alive&&p.team===w.RED),x=L.filter(p=>p.alive&&p.team===w.BLUE),u=20,y=6;r.forEach((p,g)=>{let _=g%y,R=Math.floor(g/y);p.x=M*.25-_*20,p.y=P*.5+(R-y/2)*u,p.vx=p.vy=0}),x.forEach((p,g)=>{let _=g%y,R=Math.floor(g/y);p.x=M*.75+_*20,p.y=P*.5+(R-y/2)*u,p.vx=p.vy=0}),rt("Fleets re-formed")}),X&&typeof X.addEventListener=="function"&&X.addEventListener("click",r=>{F.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ot(0,1)});for(let u=0;u<24;u++){let y=c(0,B),p=c(40,220);I.push(new V(r.clientX,r.clientY,Math.cos(y)*p,Math.sin(y)*p,c(.2,1),"rgba(255,255,255,$a)"))}});function d(r){tt||(tt=r);let x=(r-tt)/1e3;tt=r;let u=ct(x,0,.033)*(et?it:0);Xt(u),Nt(),m(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(d)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(d)}export{V as Particle,at as SPEED_STEPS,ft as ShipV,pt as bullets,F as flashes,z as healthFlashes,se as initRenderer,oe as initRendererUI,tt as lastTime,Z as levelFlashes,I as particles,Nt as render,et as running,ht as score,K as shieldFlashes,L as ships,Y as shipsVMap,st as showTrails,Xt as simulate,it as speed,k as state,C as teamColor,rt as toast,ne as updateUI};

</script>
<script type="module">
var Tt=Object.defineProperty;var bt=(a,i,s)=>i in a?Tt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var xt=(a,i,s)=>bt(a,typeof i!="symbol"?i+"":i,s);var St=!1,ot=123456789;function Pt(){return St?(ot=1664525*ot+1013904223>>>0,ot/4294967296):Math.random()}function c(a=0,i=1){return a+(i-a)*Pt()}function Q(a,i){return Math.floor(c(a,i+1))}var L={RED:0,BLUE:1},lt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},tt=class tt{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=tt._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,y=o.y-this.y,h=l*l+y*y;h<n&&h<e&&(e=h,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,v=e.y-this.y,r=Math.hypot(x,v)||1,u=Math.max(0,Math.min(1.2,r/240)),m=e.x+(e.vx||0)*u,p=e.y+(e.vy||0)*u,f=m-this.x,R=p-this.y,g=Math.hypot(f,R)||1;if(n+=f/g*this.accel,o+=R/g*this.accel,r<this.range){let P=((this.vx||1)*x+(this.vy||1)*v)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&P>0){let X=300+c(-20,20),D=x/r,O=v/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],G=new lt(this.x+D*12,this.y+O*12,D*X+this.vx*.2,O*X+this.vy*.2,this.team,this.id);G.dmg*=1+.06*(this.level-1),F.push(G)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,y=0,h=0,b=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let v=this.x-x.x,r=this.y-x.y,u=v*v+r*r;if(u<b*b&&u>1){let m=Math.sqrt(u);l+=v/m,y+=r/m,h++}}h>0&&(n+=l/h*this.accel*.9,o+=y/h*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};xt(tt,"_id",1);var $=tt;function gt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=c(0,Math.PI*2),y=e.radius+12+c(4,12),h=e.x+Math.cos(l)*y,b=e.y+Math.sin(l)*y,d=new $(e.team,h,b,"fighter"),x=c(40,120);d.vx=Math.cos(l)*x+(e.vx||0)*.2,d.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(d)}e.launchCooldown=c(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,y=o.y-n.y,h=l*l+y*y,b=o.radius+n.radius;if(h<b*b){let d=n.dmg,x=typeof o.shield=="number"?o.shield:0,v=typeof o.hp=="number"?o.hp:0,r=o.damage(d),u=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,v-(typeof o.hp=="number"?o.hp:0));if(u>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:u}),m>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:m}),n.ownerId!=null){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(d*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(20+(o.level||1)*.2)}break}}}}var k,t,E,S;function ne(){k=document.getElementById("world"),t=k.getContext("2d"),E=k.width=window.innerWidth,S=k.height=window.innerHeight,window.addEventListener("resize",()=>{E=k.width=window.innerWidth,S=k.height=window.innerHeight})}function ut(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var w=[],q=[],K=[],z=[],Z=[],Y=new Map,_=[],pt=[],et=0,it=!1,st=1,nt=!0,ht={red:0,blue:0};var at=[.5,1,2,4],A={ships:_,bullets:pt,score:ht,particles:w,shieldHits:[],healthHits:[],explosions:[]},C=Math.PI*2,ct=(a,i,s)=>Math.max(i,Math.min(s,a)),U=(a=0,i=1)=>c(a,i);function kt(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function rt(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var dt=[];function Xt(){dt.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)dt.push({x:U(0,E),y:U(0,S),r:U(.3,1.8)*i,d:i,tw:U(.4,1),phase:U(0,C)})}Xt();var I=(a,i=1)=>a===L.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function vt(){let a=["corvette","frigate","destroyer","carrier","fighter"],i=Q(0,a.length-1);return a[i]}var V=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ut(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ft=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;ut();let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(nt){let r=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new V(r,u,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,I(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=I(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=I(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,C),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,C),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,C),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,u,0,C);let m=t.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=m,t.globalCompositeOperation="lighter",t.fill());for(let p of K){if(p.id!==i.id)continue;let f=Math.max(0,Math.min(1,p.life/.22)),R=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),g=Math.max(.08,Math.min(1,R)),X=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*g),D=p.angle-X/2,O=p.angle+X/2,F=u+4*(1-f)+2*g;t.beginPath(),t.arc(i.x,i.y,F,D,O),t.lineWidth=(3+6*f)*(1+4*g);let G=Math.min(1,.25+f*(.9+1.6*g));t.strokeStyle=`rgba(160,220,255,${G})`,t.save(),t.shadowBlur=12*g,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,y=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,y,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,y,n*r,o))}let h=i.y+(e+8),b=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${m}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let p=t.measureText(r).width,f=8,R=Math.max(2,Math.round((m-o)/2)),g=Math.max(18,p+f*2),P=Math.max(o+2,m*.9),X=l-8-g,D=h+o/2-P/2,O=P/2,F=4,G=X-F,Et=D-F,Mt=g+F*2,mt=P+F*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",kt(t,G,Et,Mt,mt,mt/2),t.fill(),t.restore();let j=Z.find(W=>W.id===i.id&&W.life>0),J=1;j&&(J=1+.6*Math.max(0,Math.min(1,j.life/1)));let N=g*J,B=P*J,M=X-(N-g),T=D-(B-P)/2,H=B/2;if(t.beginPath(),t.moveTo(M+H,T),t.lineTo(M+N-H,T),t.quadraticCurveTo(M+N,T,M+N,T+H),t.lineTo(M+N,T+B-H),t.quadraticCurveTo(M+N,T+B,M+N-H,T+B),t.lineTo(M+H,T+B),t.quadraticCurveTo(M,T+B,M,T+B-H),t.lineTo(M,T+H),t.quadraticCurveTo(M,T,M+H,T),t.closePath(),j){let W=Math.max(.6,Math.min(1,j.life));t.save(),t.shadowBlur=20*W,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=I(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*W})`,t.stroke()}else t.fillStyle=I(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(m*J)}px Inter, system-ui, sans-serif`,t.fillText(r,M+N/2,T+B/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+d,h),t.lineTo(l+n-d,h),t.quadraticCurveTo(l+n,h,l+n,h+d),t.lineTo(l+n,h+o-d),t.quadraticCurveTo(l+n,h+o,l+n-d,h+o),t.lineTo(l+d,h+o),t.quadraticCurveTo(l,h+o,l,h+o-d),t.lineTo(l,h+d),t.quadraticCurveTo(l,h,l+d,h),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=z.find(r=>r.id===i.id&&r.life>0),v=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),u=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-u*r)),p=Math.floor(60+160*(1-r*u));v=`rgba(${Math.min(255,m)},${Math.min(255,p)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+d,h),t.lineTo(l+n-d,h),t.quadraticCurveTo(l+n,h,l+n,h+d),t.lineTo(l+n,h+o-d),t.quadraticCurveTo(l+n,h+o,l+n-d,h+o),t.lineTo(l+d,h+o),t.quadraticCurveTo(l,h+o,l,h+o-d),t.lineTo(l,h+d),t.quadraticCurveTo(l,h,l+d,h),t.closePath(),t.clip(),t.fillStyle=v,t.fillRect(l,h,n*b,o))}};function oe(){}function Ft(a){if(gt(A,a,{W:E,H:S}),Array.isArray(A.healthHits)&&A.healthHits.length){for(let s of A.healthHits){let e=_.find(n=>n.id===s.id);if(e){z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=c(0,C),l=c(40,120);w.push(new V(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,c(.12,.4),"rgba(200,230,255,$a)"))}}}A.healthHits.length=0}if(Array.isArray(A.shieldHits)&&A.shieldHits.length){for(let s of A.shieldHits){let e=_.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);K.push({id:e.id,angle:n,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}A.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let e=w[s];e.update(a),e.life<=0&&w.splice(s,1)}for(let s=q.length-1;s>=0;s--){let e=q[s];e.life-=a,e.r+=600*a,e.life<=0&&q.splice(s,1)}for(let s=K.length-1;s>=0;s--){let e=K[s];e.life-=a,e.life<=0&&K.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}let i=new Set(_.map(s=>s.id));for(let s of _)if(Y.has(s.id)){let e=Y.get(s.id);if(e.level!==s.level){Z.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=c(0,C),l=c(60,240);w.push(new V(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,c(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new ft(s);e.level=s.level,Y.set(s.id,e)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Nt(){if(ut(),typeof t>"u"||!t)return;t.clearRect(0,0,E,S);let a=t.createRadialGradient(E*.6,S*.3,50,E*.6,S*.3,Math.max(E,S));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,E,S);for(let e of dt){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=ct(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of q){let n=ct(e.life/.25,0,1);t.strokeStyle=I(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,C),t.stroke()}for(let e of pt)t.save(),t.shadowBlur=12,t.shadowColor=I(e.team,.9),t.fillStyle=I(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,C),t.fill(),t.restore();for(let e of w)e.draw();for(let e of Y.values())e.draw();let i=_.some(e=>e.alive&&e.team===L.RED),s=_.some(e=>e.alive&&e.team===L.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?I(L.RED,.95):s?I(L.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,E/2,64),t.restore()}}function le(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),y=document.getElementById&&document.getElementById("blueScore"),h=document.getElementById&&document.getElementById("stats"),b=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function x(){l&&(l.textContent=`Red ${ht.red}`),y&&(y.textContent=`Blue ${ht.blue}`),h&&(h.textContent=`Ships: ${_.filter(r=>r.alive).length}  Bullets: ${pt.length}  Particles: ${w.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{it=!it,a.textContent=it?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=vt();_.push(new $(L.RED,c(40,E*.35),c(80,S-80),r)),rt(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=vt();_.push(new $(L.BLUE,c(E*.65,E-40),c(80,S-80),r)),rt(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{nt=!nt,n.textContent=`\u2604 Trails: ${nt?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(at.indexOf(st)+1)%at.length;st=at[r],o.textContent=`Speed: ${st}\xD7`}),b&&typeof b.addEventListener=="function"&&b.addEventListener("click",()=>{let r=Q(0,4294967295),u=prompt("Enter numeric seed (32-bit):",r);u!==null&&reset(Number(u))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=_.filter(f=>f.alive&&f.team===L.RED),u=_.filter(f=>f.alive&&f.team===L.BLUE),m=20,p=6;r.forEach((f,R)=>{let g=R%p,P=Math.floor(R/p);f.x=E*.25-g*20,f.y=S*.5+(P-p/2)*m,f.vx=f.vy=0}),u.forEach((f,R)=>{let g=R%p,P=Math.floor(R/p);f.x=E*.75+g*20,f.y=S*.5+(P-p/2)*m,f.vx=f.vy=0}),rt("Fleets re-formed")}),k&&typeof k.addEventListener=="function"&&k.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:Q(0,1)});for(let m=0;m<24;m++){let p=c(0,C),f=c(40,220);w.push(new V(r.clientX,r.clientY,Math.cos(p)*f,Math.sin(p)*f,c(.2,1),"rgba(255,255,255,$a)"))}});function v(r){et||(et=r);let u=(r-et)/1e3;et=r;let m=ct(u,0,.033)*(it?st:0);Ft(m),Nt(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(v)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(v)}export{V as Particle,at as SPEED_STEPS,ft as ShipV,pt as bullets,q as flashes,z as healthFlashes,ne as initRenderer,le as initRendererUI,et as lastTime,Z as levelFlashes,w as particles,vt as randomShipType,Nt as render,it as running,ht as score,K as shieldFlashes,_ as ships,Y as shipsVMap,nt as showTrails,Ft as simulate,st as speed,A as state,I as teamColor,rt as toast,oe as updateUI};

</script>
<script type="module">
var Tt=Object.defineProperty;var bt=(a,i,s)=>i in a?Tt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var yt=(a,i,s)=>bt(a,typeof i!="symbol"?i+"":i,s);var St=!1,at=123456789;function Pt(){return St?(at=1664525*at+1013904223>>>0,at/4294967296):Math.random()}function h(a=0,i=1){return a+(i-a)*Pt()}function tt(a,i){return Math.floor(h(a,i+1))}var R={RED:0,BLUE:1},rt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},et=class et{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)},fighter:{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=et._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,g=o.y-this.y,c=l*l+g*g;c<n&&c<e&&(e=c,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,E=e.y-this.y,r=Math.hypot(x,E)||1,u=Math.max(0,Math.min(1.2,r/240)),m=e.x+(e.vx||0)*u,p=e.y+(e.vy||0)*u,f=m-this.x,L=p-this.y,v=Math.hypot(f,L)||1;if(n+=f/v*this.accel,o+=L/v*this.accel,r<this.range){let _=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&_>0){let F=300+h(-20,20),$=x/r,O=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],W=new rt(this.x+$*12,this.y+O*12,$*F+this.vx*.2,O*F+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),N.push(W)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,g=0,c=0,P=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,u=E*E+r*r;if(u<P*P&&u>1){let m=Math.sqrt(u);l+=E/m,g+=r/m,c++}}c>0&&(n+=l/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};yt(et,"_id",1);var k=et;function vt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=h(0,Math.PI*2),g=e.radius+12+h(4,12),c=e.x+Math.cos(l)*g,P=e.y+Math.sin(l)*g,d=new k(e.team,c,P,"fighter"),x=h(40,120);d.vx=Math.cos(l)*x+(e.vx||0)*.2,d.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(d)}e.launchCooldown=h(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,g=o.y-n.y,c=l*l+g*g,P=o.radius+n.radius;if(c<P*P){let d=n.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(d),u=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(u>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:u}),m>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:m}),n.ownerId!=null){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(d*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(20+(o.level||1)*.2)}break}}}}var D,t,y,M;function oe(){D=document.getElementById("world"),t=D.getContext("2d"),y=D.width=window.innerWidth,M=D.height=window.innerHeight,window.addEventListener("resize",()=>{y=D.width=window.innerWidth,M=D.height=window.innerHeight})}function pt(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var I=[],q=[],z=[],Z=[],j=[],V=new Map,T=[],mt=[],it=0,st=!1,nt=1,ot=!0,ct={red:0,blue:0};var ht=[.5,1,2,4],w={ships:T,bullets:mt,score:ct,particles:I,shieldHits:[],healthHits:[],explosions:[]},C=Math.PI*2,dt=(a,i,s)=>Math.max(i,Math.min(s,a)),K=(a=0,i=1)=>h(a,i);function kt(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function G(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ft=[];function Dt(){ft.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ft.push({x:K(0,y),y:K(0,M),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,C)})}Dt();var B=(a,i=1)=>a===R.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function lt(){let a=["corvette","frigate","destroyer","carrier","fighter"],i=tt(0,a.length-1);return a[i]}function Ft(a){let i=lt();if(a===R.RED){let s=h(40,y*.35),e=h(80,M-80);T.push(new k(R.RED,s,e,i)),typeof G=="function"&&G(`+1 Red (${i})`)}else{let s=h(y*.65,y-40),e=h(80,M-80);T.push(new k(R.BLUE,s,e,i)),typeof G=="function"&&G(`+1 Blue (${i})`)}}var le={createShipFromUI:Ft,randomShipType:lt,ships:T,state:w},U=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;pt(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ut=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;pt();let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ot){let r=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new U(r,u,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,B(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=B(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=B(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,C),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,C),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,C),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,u,0,C);let m=t.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=m,t.globalCompositeOperation="lighter",t.fill());for(let p of z){if(p.id!==i.id)continue;let f=Math.max(0,Math.min(1,p.life/.22)),L=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,L)),F=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*v),$=p.angle-F/2,O=p.angle+F/2,N=u+4*(1-f)+2*v;t.beginPath(),t.arc(i.x,i.y,N,$,O),t.lineWidth=(3+6*f)*(1+4*v);let W=Math.min(1,.25+f*(.9+1.6*v));t.strokeStyle=`rgba(160,220,255,${W})`,t.save(),t.shadowBlur=12*v,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,g=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,g,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,g,n*r,o))}let c=i.y+(e+8),P=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${m}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let p=t.measureText(r).width,f=8,L=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,p+f*2),_=Math.max(o+2,m*.9),F=l-8-v,$=c+o/2-_/2,O=_/2,N=4,W=F-N,Et=$-N,Mt=v+N*2,xt=_+N*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",kt(t,W,Et,Mt,xt,xt/2),t.fill(),t.restore();let J=j.find(Y=>Y.id===i.id&&Y.life>0),Q=1;J&&(Q=1+.6*Math.max(0,Math.min(1,J.life/1)));let X=v*Q,H=_*Q,b=F-(X-v),S=$-(H-_)/2,A=H/2;if(t.beginPath(),t.moveTo(b+A,S),t.lineTo(b+X-A,S),t.quadraticCurveTo(b+X,S,b+X,S+A),t.lineTo(b+X,S+H-A),t.quadraticCurveTo(b+X,S+H,b+X-A,S+H),t.lineTo(b+A,S+H),t.quadraticCurveTo(b,S+H,b,S+H-A),t.lineTo(b,S+A),t.quadraticCurveTo(b,S,b+A,S),t.closePath(),J){let Y=Math.max(.6,Math.min(1,J.life));t.save(),t.shadowBlur=20*Y,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=B(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*Y})`,t.stroke()}else t.fillStyle=B(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(m*Q)}px Inter, system-ui, sans-serif`,t.fillText(r,b+X/2,S+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+d,c),t.lineTo(l+n-d,c),t.quadraticCurveTo(l+n,c,l+n,c+d),t.lineTo(l+n,c+o-d),t.quadraticCurveTo(l+n,c+o,l+n-d,c+o),t.lineTo(l+d,c+o),t.quadraticCurveTo(l,c+o,l,c+o-d),t.lineTo(l,c+d),t.quadraticCurveTo(l,c,l+d,c),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),u=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-u*r)),p=Math.floor(60+160*(1-r*u));E=`rgba(${Math.min(255,m)},${Math.min(255,p)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+d,c),t.lineTo(l+n-d,c),t.quadraticCurveTo(l+n,c,l+n,c+d),t.lineTo(l+n,c+o-d),t.quadraticCurveTo(l+n,c+o,l+n-d,c+o),t.lineTo(l+d,c+o),t.quadraticCurveTo(l,c+o,l,c+o-d),t.lineTo(l,c+d),t.quadraticCurveTo(l,c,l+d,c),t.closePath(),t.clip(),t.fillStyle=E,t.fillRect(l,c,n*P,o))}};function ae(){}function Nt(a){if(vt(w,a,{W:y,H:M}),Array.isArray(w.healthHits)&&w.healthHits.length){for(let s of w.healthHits){let e=T.find(n=>n.id===s.id);if(e){Z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=h(0,C),l=h(40,120);I.push(new U(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,h(.12,.4),"rgba(200,230,255,$a)"))}}}w.healthHits.length=0}if(Array.isArray(w.shieldHits)&&w.shieldHits.length){for(let s of w.shieldHits){let e=T.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);z.push({id:e.id,angle:n,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}w.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(a),e.life<=0&&I.splice(s,1)}for(let s=q.length-1;s>=0;s--){let e=q[s];e.life-=a,e.r+=600*a,e.life<=0&&q.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let e=j[s];e.life-=a,e.life<=0&&j.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let e=V.get(s.id);if(e.level!==s.level){j.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=h(0,C),l=h(60,240);I.push(new U(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,h(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new ut(s);e.level=s.level,V.set(s.id,e)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Xt(){if(pt(),typeof t>"u"||!t)return;t.clearRect(0,0,y,M);let a=t.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,y,M);for(let e of ft){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=dt(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of q){let n=dt(e.life/.25,0,1);t.strokeStyle=B(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,C),t.stroke()}for(let e of mt)t.save(),t.shadowBlur=12,t.shadowColor=B(e.team,.9),t.fillStyle=B(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,C),t.fill(),t.restore();for(let e of I)e.draw();for(let e of V.values())e.draw();let i=T.some(e=>e.alive&&e.team===R.RED),s=T.some(e=>e.alive&&e.team===R.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?B(R.RED,.95):s?B(R.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,y/2,64),t.restore()}}function re(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),P=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function x(){l&&(l.textContent=`Red ${ct.red}`),g&&(g.textContent=`Blue ${ct.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${mt.length}  Particles: ${I.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{st=!st,a.textContent=st?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=lt();T.push(new k(R.RED,h(40,y*.35),h(80,M-80),r)),G(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=lt();T.push(new k(R.BLUE,h(y*.65,y-40),h(80,M-80),r)),G(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{ot=!ot,n.textContent=`\u2604 Trails: ${ot?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ht.indexOf(nt)+1)%ht.length;nt=ht[r],o.textContent=`Speed: ${nt}\xD7`}),P&&typeof P.addEventListener=="function"&&P.addEventListener("click",()=>{let r=tt(0,4294967295),u=prompt("Enter numeric seed (32-bit):",r);u!==null&&reset(Number(u))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=T.filter(f=>f.alive&&f.team===R.RED),u=T.filter(f=>f.alive&&f.team===R.BLUE),m=20,p=6;r.forEach((f,L)=>{let v=L%p,_=Math.floor(L/p);f.x=y*.25-v*20,f.y=M*.5+(_-p/2)*m,f.vx=f.vy=0}),u.forEach((f,L)=>{let v=L%p,_=Math.floor(L/p);f.x=y*.75+v*20,f.y=M*.5+(_-p/2)*m,f.vx=f.vy=0}),G("Fleets re-formed")}),D&&typeof D.addEventListener=="function"&&D.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:tt(0,1)});for(let m=0;m<24;m++){let p=h(0,C),f=h(40,220);I.push(new U(r.clientX,r.clientY,Math.cos(p)*f,Math.sin(p)*f,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){it||(it=r);let u=(r-it)/1e3;it=r;let m=dt(u,0,.033)*(st?nt:0);Nt(m),Xt(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{U as Particle,ht as SPEED_STEPS,ut as ShipV,mt as bullets,Ft as createShipFromUI,q as flashes,Z as healthFlashes,oe as initRenderer,re as initRendererUI,it as lastTime,j as levelFlashes,I as particles,lt as randomShipType,Xt as render,st as running,ct as score,z as shieldFlashes,T as ships,V as shipsVMap,ot as showTrails,Nt as simulate,nt as speed,w as state,B as teamColor,le as testHelpers,G as toast,ae as updateUI};

</script>
<script type="module">
var Tt=Object.defineProperty;var bt=(a,i,s)=>i in a?Tt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var yt=(a,i,s)=>bt(a,typeof i!="symbol"?i+"":i,s);var St=!1,at=123456789;function Pt(){return St?(at=1664525*at+1013904223>>>0,at/4294967296):Math.random()}function h(a=0,i=1){return a+(i-a)*Pt()}function tt(a,i){return Math.floor(h(a,i+1))}var R={RED:0,BLUE:1},rt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},et=class et{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)},fighter:{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=et._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,g=o.y-this.y,c=l*l+g*g;c<n&&c<e&&(e=c,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,E=e.y-this.y,r=Math.hypot(x,E)||1,u=Math.max(0,Math.min(1.2,r/240)),m=e.x+(e.vx||0)*u,p=e.y+(e.vy||0)*u,f=m-this.x,L=p-this.y,v=Math.hypot(f,L)||1;if(n+=f/v*this.accel,o+=L/v*this.accel,r<this.range){let _=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&_>0){let F=300+h(-20,20),$=x/r,O=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],W=new rt(this.x+$*12,this.y+O*12,$*F+this.vx*.2,O*F+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),N.push(W)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,g=0,c=0,P=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,u=E*E+r*r;if(u<P*P&&u>1){let m=Math.sqrt(u);l+=E/m,g+=r/m,c++}}c>0&&(n+=l/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};yt(et,"_id",1);var k=et;function vt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=h(0,Math.PI*2),g=e.radius+12+h(4,12),c=e.x+Math.cos(l)*g,P=e.y+Math.sin(l)*g,d=new k(e.team,c,P,"fighter"),x=h(40,120);d.vx=Math.cos(l)*x+(e.vx||0)*.2,d.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(d)}e.launchCooldown=h(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,g=o.y-n.y,c=l*l+g*g,P=o.radius+n.radius;if(c<P*P){let d=n.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(d),u=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(u>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:u}),m>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:m}),n.ownerId!=null){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(d*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(20+(o.level||1)*.2)}break}}}}var D,t,y,M;function oe(){D=document.getElementById("world"),t=D.getContext("2d"),y=D.width=window.innerWidth,M=D.height=window.innerHeight,window.addEventListener("resize",()=>{y=D.width=window.innerWidth,M=D.height=window.innerHeight})}function pt(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var I=[],q=[],z=[],Z=[],j=[],V=new Map,T=[],mt=[],it=0,st=!1,nt=1,ot=!0,ct={red:0,blue:0};var ht=[.5,1,2,4],w={ships:T,bullets:mt,score:ct,particles:I,shieldHits:[],healthHits:[],explosions:[]},C=Math.PI*2,dt=(a,i,s)=>Math.max(i,Math.min(s,a)),K=(a=0,i=1)=>h(a,i);function kt(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function G(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ft=[];function Dt(){ft.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ft.push({x:K(0,y),y:K(0,M),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,C)})}Dt();var B=(a,i=1)=>a===R.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function lt(){let a=["corvette","frigate","destroyer","carrier","fighter"],i=tt(0,a.length-1);return a[i]}function Ft(a){let i=lt();if(a===R.RED){let s=h(40,y*.35),e=h(80,M-80);T.push(new k(R.RED,s,e,i)),typeof G=="function"&&G(`+1 Red (${i})`)}else{let s=h(y*.65,y-40),e=h(80,M-80);T.push(new k(R.BLUE,s,e,i)),typeof G=="function"&&G(`+1 Blue (${i})`)}}var le={createShipFromUI:Ft,randomShipType:lt,ships:T,state:w},U=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;pt(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ut=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;pt();let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ot){let r=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new U(r,u,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,B(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=B(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=B(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,C),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,C),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,C),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,u,0,C);let m=t.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=m,t.globalCompositeOperation="lighter",t.fill());for(let p of z){if(p.id!==i.id)continue;let f=Math.max(0,Math.min(1,p.life/.22)),L=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,L)),F=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*v),$=p.angle-F/2,O=p.angle+F/2,N=u+4*(1-f)+2*v;t.beginPath(),t.arc(i.x,i.y,N,$,O),t.lineWidth=(3+6*f)*(1+4*v);let W=Math.min(1,.25+f*(.9+1.6*v));t.strokeStyle=`rgba(160,220,255,${W})`,t.save(),t.shadowBlur=12*v,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,g=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,g,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,g,n*r,o))}let c=i.y+(e+8),P=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${m}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let p=t.measureText(r).width,f=8,L=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,p+f*2),_=Math.max(o+2,m*.9),F=l-8-v,$=c+o/2-_/2,O=_/2,N=4,W=F-N,Et=$-N,Mt=v+N*2,xt=_+N*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",kt(t,W,Et,Mt,xt,xt/2),t.fill(),t.restore();let J=j.find(Y=>Y.id===i.id&&Y.life>0),Q=1;J&&(Q=1+.6*Math.max(0,Math.min(1,J.life/1)));let X=v*Q,H=_*Q,b=F-(X-v),S=$-(H-_)/2,A=H/2;if(t.beginPath(),t.moveTo(b+A,S),t.lineTo(b+X-A,S),t.quadraticCurveTo(b+X,S,b+X,S+A),t.lineTo(b+X,S+H-A),t.quadraticCurveTo(b+X,S+H,b+X-A,S+H),t.lineTo(b+A,S+H),t.quadraticCurveTo(b,S+H,b,S+H-A),t.lineTo(b,S+A),t.quadraticCurveTo(b,S,b+A,S),t.closePath(),J){let Y=Math.max(.6,Math.min(1,J.life));t.save(),t.shadowBlur=20*Y,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=B(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*Y})`,t.stroke()}else t.fillStyle=B(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(m*Q)}px Inter, system-ui, sans-serif`,t.fillText(r,b+X/2,S+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+d,c),t.lineTo(l+n-d,c),t.quadraticCurveTo(l+n,c,l+n,c+d),t.lineTo(l+n,c+o-d),t.quadraticCurveTo(l+n,c+o,l+n-d,c+o),t.lineTo(l+d,c+o),t.quadraticCurveTo(l,c+o,l,c+o-d),t.lineTo(l,c+d),t.quadraticCurveTo(l,c,l+d,c),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),u=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-u*r)),p=Math.floor(60+160*(1-r*u));E=`rgba(${Math.min(255,m)},${Math.min(255,p)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+d,c),t.lineTo(l+n-d,c),t.quadraticCurveTo(l+n,c,l+n,c+d),t.lineTo(l+n,c+o-d),t.quadraticCurveTo(l+n,c+o,l+n-d,c+o),t.lineTo(l+d,c+o),t.quadraticCurveTo(l,c+o,l,c+o-d),t.lineTo(l,c+d),t.quadraticCurveTo(l,c,l+d,c),t.closePath(),t.clip(),t.fillStyle=E,t.fillRect(l,c,n*P,o))}};function ae(){}function Nt(a){if(vt(w,a,{W:y,H:M}),Array.isArray(w.healthHits)&&w.healthHits.length){for(let s of w.healthHits){let e=T.find(n=>n.id===s.id);if(e){Z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=h(0,C),l=h(40,120);I.push(new U(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,h(.12,.4),"rgba(200,230,255,$a)"))}}}w.healthHits.length=0}if(Array.isArray(w.shieldHits)&&w.shieldHits.length){for(let s of w.shieldHits){let e=T.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);z.push({id:e.id,angle:n,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}w.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(a),e.life<=0&&I.splice(s,1)}for(let s=q.length-1;s>=0;s--){let e=q[s];e.life-=a,e.r+=600*a,e.life<=0&&q.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let e=j[s];e.life-=a,e.life<=0&&j.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let e=V.get(s.id);if(e.level!==s.level){j.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=h(0,C),l=h(60,240);I.push(new U(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,h(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new ut(s);e.level=s.level,V.set(s.id,e)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Xt(){if(pt(),typeof t>"u"||!t)return;t.clearRect(0,0,y,M);let a=t.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,y,M);for(let e of ft){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=dt(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of q){let n=dt(e.life/.25,0,1);t.strokeStyle=B(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,C),t.stroke()}for(let e of mt)t.save(),t.shadowBlur=12,t.shadowColor=B(e.team,.9),t.fillStyle=B(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,C),t.fill(),t.restore();for(let e of I)e.draw();for(let e of V.values())e.draw();let i=T.some(e=>e.alive&&e.team===R.RED),s=T.some(e=>e.alive&&e.team===R.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?B(R.RED,.95):s?B(R.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,y/2,64),t.restore()}}function re(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),P=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function x(){l&&(l.textContent=`Red ${ct.red}`),g&&(g.textContent=`Blue ${ct.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${mt.length}  Particles: ${I.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{st=!st,a.textContent=st?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=lt();T.push(new k(R.RED,h(40,y*.35),h(80,M-80),r)),G(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=lt();T.push(new k(R.BLUE,h(y*.65,y-40),h(80,M-80),r)),G(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{ot=!ot,n.textContent=`\u2604 Trails: ${ot?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ht.indexOf(nt)+1)%ht.length;nt=ht[r],o.textContent=`Speed: ${nt}\xD7`}),P&&typeof P.addEventListener=="function"&&P.addEventListener("click",()=>{let r=tt(0,4294967295),u=prompt("Enter numeric seed (32-bit):",r);u!==null&&reset(Number(u))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=T.filter(f=>f.alive&&f.team===R.RED),u=T.filter(f=>f.alive&&f.team===R.BLUE),m=20,p=6;r.forEach((f,L)=>{let v=L%p,_=Math.floor(L/p);f.x=y*.25-v*20,f.y=M*.5+(_-p/2)*m,f.vx=f.vy=0}),u.forEach((f,L)=>{let v=L%p,_=Math.floor(L/p);f.x=y*.75+v*20,f.y=M*.5+(_-p/2)*m,f.vx=f.vy=0}),G("Fleets re-formed")}),D&&typeof D.addEventListener=="function"&&D.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:tt(0,1)});for(let m=0;m<24;m++){let p=h(0,C),f=h(40,220);I.push(new U(r.clientX,r.clientY,Math.cos(p)*f,Math.sin(p)*f,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){it||(it=r);let u=(r-it)/1e3;it=r;let m=dt(u,0,.033)*(st?nt:0);Nt(m),Xt(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{U as Particle,ht as SPEED_STEPS,ut as ShipV,mt as bullets,Ft as createShipFromUI,q as flashes,Z as healthFlashes,oe as initRenderer,re as initRendererUI,it as lastTime,j as levelFlashes,I as particles,lt as randomShipType,Xt as render,st as running,ct as score,z as shieldFlashes,T as ships,V as shipsVMap,ot as showTrails,Nt as simulate,nt as speed,w as state,B as teamColor,le as testHelpers,G as toast,ae as updateUI};

</script>
<script type="module">
var be=Object.defineProperty;var Re=(o,i,s)=>i in o?be(o,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[i]=s;var Ee=(o,i,s)=>Re(o,typeof i!="symbol"?i+"":i,s);var Se=!1,he=123456789,_e=1664525,Pe=1013904223,we=4294967296,Le=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),Ie=!!Le;function Ce(){if(!Se){if(Ie)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return he=_e*he+Pe>>>0,he/we}function h(o=0,i=1){if(typeof o!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return o+(i-o)*Ce()}function te(o,i){if(!Number.isFinite(o)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(o,i+1))}var b={RED:0,BLUE:1};function Fe(o){switch(o){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)};case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var ce=class{constructor(i,s,t,l,n,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=n,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},ie=class ie{constructor(i,s,t,l="corvette"){this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l;let n=Fe(l||"corvette");this.radius=n.radius,this.maxSpeed=n.maxSpeed,this.accel=n.accel,this.turn=4.5,this.hpMax=n.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=n.reload,this.vision=n.vision,this.range=n.range,this.id=ie._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=n.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let a=n.x-this.x,E=n.y-this.y,c=a*a+E*E;c<l&&c<t&&(t=c,s=n)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,n=0;if(t){let x=t.x-this.x,T=t.y-this.y,r=Math.hypot(x,T)||1,u=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*u,p=t.y+(t.vy||0)*u,f=m-this.x,w=p-this.y,g=Math.hypot(f,w)||1;if(l+=f/g*this.accel,n+=w/g*this.accel,r<this.range){let P=((this.vx||1)*x+(this.vy||1)*T)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&P>0){let F=300+h(-20,20),G=x/r,O=T/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let $=arguments[2],W=new ce(this.x+G*12,this.y+O*12,G*F+this.vx*.2,O*F+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),$.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),n+=Math.sin(this.angle)*(this.accel*.3);let a=0,E=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let T=this.x-x.x,r=this.y-x.y,u=T*T+r*r;if(u<_*_&&u>1){let m=Math.sqrt(u);a+=T/m,E+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,n+=E/c*this.accel*.9),this.vx+=l*i,this.vy+=n*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};Ee(ie,"_id",1);var L=ie;function ve(o,i,s={W:800,H:600}){o.ships=o.ships||[],o.bullets=o.bullets||[],o.explosions=o.explosions||[],o.shieldHits=o.shieldHits||[],o.healthHits=o.healthHits||[],o.score=o.score||{red:0,blue:0};for(let t of o.ships)t.alive&&t.update(i,o.ships,o.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let n of o.ships){if(!n.alive)continue;let a=n.radius||0;n.x<-a?n.x+=t+a*2:n.x>t+a&&(n.x-=t+a*2),n.y<-a?n.y+=l+a*2:n.y>l+a&&(n.y-=l+a*2)}}for(let t of o.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let n=0;n<l;n++){let a=h(0,Math.PI*2),E=t.radius+12+h(4,12),c=t.x+Math.cos(a)*E,_=t.y+Math.sin(a)*E,d=new L(t.team,c,_,"fighter"),x=h(40,120);d.vx=Math.cos(a)*x+(t.vx||0)*.2,d.vy=Math.sin(a)*x+(t.vy||0)*.2,o.ships.push(d)}t.launchCooldown=h(2.5,6)}for(let t=o.bullets.length-1;t>=0;t--){let l=o.bullets[t];l.update(i),l.alive(s)||o.bullets.splice(t,1)}for(let t=o.bullets.length-1;t>=0;t--){let l=o.bullets[t];for(let n of o.ships){if(!n.alive||n.team===l.team)continue;let a=n.x-l.x,E=n.y-l.y,c=a*a+E*E,_=n.radius+l.radius;if(c<_*_){let d=l.dmg,x=typeof n.shield=="number"?n.shield:0,T=typeof n.hp=="number"?n.hp:0,r=n.damage(d),u=Math.max(0,x-(typeof n.shield=="number"?n.shield:0)),m=Math.max(0,T-(typeof n.hp=="number"?n.hp:0));if(u>0&&o.shieldHits.push({id:n.id,hitX:l.x,hitY:l.y,team:n.team,amount:u}),m>0&&o.healthHits.push({id:n.id,hitX:l.x,hitY:l.y,team:n.team,amount:m}),l.ownerId!=null){let p=o.ships.find(f=>f.id===l.ownerId);p&&p.gainXp(d*.05)}if(o.bullets.splice(t,1),r&&o.explosions.push(r),!n.alive&&(l.team===0?o.score.red++:o.score.blue++,l.ownerId!=null)){let p=o.ships.find(f=>f.id===l.ownerId);p&&p.gainXp(20+(n.level||1)*.2)}break}}}}var D,e,y,v;function ht(){D=document.getElementById("world"),e=D.getContext("2d"),y=D.width=window.innerWidth,v=D.height=window.innerHeight,We(),window.addEventListener("resize",()=>{y=D.width=window.innerWidth,v=D.height=window.innerHeight})}function me(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var C=[],q=[],z=[],Z=[],j=[],Y=new Map,M=[],xe=[],se=0,ne=!1,oe=1,le=!0,fe={red:0,blue:0};var de=[.5,1,2,4],I={ships:M,bullets:xe,score:fe,particles:C,shieldHits:[],healthHits:[],explosions:[]},H=Math.PI*2,ae=(o,i,s)=>Math.max(i,Math.min(s,o)),K=(o=0,i=1)=>h(o,i);function qe(o,i,s,t,l,n){let a=Math.min(n,l/2,t/2);o.beginPath(),o.moveTo(i+a,s),o.lineTo(i+t-a,s),o.quadraticCurveTo(i+t,s,i+t,s+a),o.lineTo(i+t,s+l-a),o.quadraticCurveTo(i+t,s+l,i+t-a,s+l),o.lineTo(i+a,s+l),o.quadraticCurveTo(i,s+l,i,s+l-a),o.lineTo(i,s+a),o.quadraticCurveTo(i,s,i+a,s),o.closePath()}function k(o){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=o,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ue=[];function We(){if(!Number.isFinite(y)||!Number.isFinite(v))return;ue.length=0;let o=[.2,.5,1];for(let i of o)for(let s=0;s<120;s++)ue.push({x:K(0,y),y:K(0,v),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,H)})}var B=(o,i=1)=>o===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,Q=["corvette","frigate","destroyer","carrier","fighter"];function re(){if(!Array.isArray(Q)||Q.length===0)return"corvette";let o=ae(te(0,Q.length-1),0,Q.length-1);return Q[o]}function Ue(o){let i=re();if(o===b.RED){let s=h(40,y*.35),t=h(80,v-80);M.push(new L(b.RED,s,t,i)),typeof k=="function"&&k(`+1 Red (${i})`)}else if(o===b.BLUE){let s=h(y*.65,y-40),t=h(80,v-80);M.push(new L(b.BLUE,s,t,i)),typeof k=="function"&&k(`+1 Blue (${i})`)}else{let s=h(40,y*.35),t=h(80,v-80);M.push(new L(b.RED,s,t,i)),typeof k=="function"&&k(`+1 Red (${i})`)}}var ct={createShipFromUI:Ue,randomShipType:re,ships:M,state:I},V=class{constructor(i,s,t,l,n,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=n,this.max=n,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;me(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},pe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(me(),!e))return;let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(le){let r=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;C.push(new V(r,u,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,B(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=B(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=B(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,H),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,H),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,H),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,u,0,H);let m=e.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let p of z){if(p.id!==i.id)continue;let f=Math.max(0,Math.min(1,p.life/.22)),w=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),g=Math.max(.08,Math.min(1,w)),F=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*g),G=p.angle-F/2,O=p.angle+F/2,$=u+4*(1-f)+2*g;e.beginPath(),e.arc(i.x,i.y,$,G,O),e.lineWidth=(3+6*f)*(1+4*g);let W=Math.min(1,.25+f*(.9+1.6*g));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*g,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),n=Math.max(3,t*.4),a=i.x-l/2,E=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,E,l,n),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,E,l*r,n))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,n);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(n*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let p=e.measureText(r).width,f=8,w=Math.max(2,Math.round((m-n)/2)),g=Math.max(18,p+f*2),P=Math.max(n+2,m*.9),F=a-8-g,G=c+n/2-P/2,O=P/2,$=4,W=F-$,Me=G-$,Te=g+$*2,ye=P+$*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",qe(e,W,Me,Te,ye,ye/2),e.fill(),e.restore();let J=j.find(U=>U.id===i.id&&U.life>0),ee=1;J&&(ee=1+.6*Math.max(0,Math.min(1,J.life/1)));let X=g*ee,A=P*ee,R=F-(X-g),S=G-(A-P)/2,N=A/2;if(e.beginPath(),e.moveTo(R+N,S),e.lineTo(R+X-N,S),e.quadraticCurveTo(R+X,S,R+X,S+N),e.lineTo(R+X,S+A-N),e.quadraticCurveTo(R+X,S+A,R+X-N,S+A),e.lineTo(R+N,S+A),e.quadraticCurveTo(R,S+A,R,S+A-N),e.lineTo(R,S+N),e.quadraticCurveTo(R,S,R+N,S),e.closePath(),J){let U=Math.max(.6,Math.min(1,J.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=B(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=B(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*ee)}px Inter, system-ui, sans-serif`,e.fillText(r,R+X/2,S+A/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+d,c),e.lineTo(a+l-d,c),e.quadraticCurveTo(a+l,c,a+l,c+d),e.lineTo(a+l,c+n-d),e.quadraticCurveTo(a+l,c+n,a+l-d,c+n),e.lineTo(a+d,c+n),e.quadraticCurveTo(a,c+n,a,c+n-d),e.lineTo(a,c+d),e.quadraticCurveTo(a,c,a+d,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),T=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),u=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-u*r)),p=Math.floor(60+160*(1-r*u));T=`rgba(${Math.min(255,m)},${Math.min(255,p)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+d,c),e.lineTo(a+l-d,c),e.quadraticCurveTo(a+l,c,a+l,c+d),e.lineTo(a+l,c+n-d),e.quadraticCurveTo(a+l,c+n,a+l-d,c+n),e.lineTo(a+d,c+n),e.quadraticCurveTo(a,c+n,a,c+n-d),e.lineTo(a,c+d),e.quadraticCurveTo(a,c,a+d,c),e.closePath(),e.clip(),e.fillStyle=T,e.fillRect(a,c,l*_,n))}};function dt(){}function Ye(o){if(ve(I,o,{W:y,H:v}),Array.isArray(I.healthHits)&&I.healthHits.length){for(let s of I.healthHits){let t=M.find(l=>l.id===s.id);if(t){Z.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let n=h(0,H),a=h(40,120);C.push(new V(s.hitX,s.hitY,Math.cos(n)*a,Math.sin(n)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}I.healthHits.length=0}if(Array.isArray(I.shieldHits)&&I.shieldHits.length){for(let s of I.shieldHits){let t=M.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);z.push({id:t.id,angle:l,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}I.shieldHits.length=0}for(let s=C.length-1;s>=0;s--){let t=C[s];t.update(o),t.life<=0&&C.splice(s,1)}for(let s=q.length-1;s>=0;s--){let t=q[s];t.life-=o,t.r+=600*o,t.life<=0&&q.splice(s,1)}for(let s=z.length-1;s>=0;s--){let t=z[s];t.life-=o,t.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=o,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=o,t.life<=0&&j.splice(s,1)}let i=new Set(M.map(s=>s.id));for(let s of M)if(Y.has(s.id)){let t=Y.get(s.id);if(t.level!==s.level){j.push({id:s.id,life:1});for(let l=0;l<18;l++){let n=h(0,H),a=h(60,240);C.push(new V(s.x+Math.cos(n)*2,s.y+Math.sin(n)*2,Math.cos(n)*a,Math.sin(n)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new pe(s);t.level=s.level,Y.set(s.id,t)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Ve(){if(me(),typeof e>"u"||!e)return;e.clearRect(0,0,y,v);let o=e.createRadialGradient(y*.6,v*.3,50,y*.6,v*.3,Math.max(y,v));o.addColorStop(0,"rgba(60,80,140,0.10)"),o.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=o,e.fillRect(0,0,y,v);for(let t of ue){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=ae(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of q){let l=ae(t.life/.25,0,1);e.strokeStyle=B(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,H),e.stroke()}for(let t of xe)e.save(),e.shadowBlur=12,e.shadowColor=B(t.team,.9),e.fillStyle=B(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,H),e.fill(),e.restore();for(let t of C)t.draw();for(let t of Y.values())t.draw();let i=M.some(t=>t.alive&&t.team===b.RED),s=M.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?B(b.RED,.95):s?B(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function ft(){if(typeof document>"u")return;let o=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),n=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),E=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${fe.red}`),E&&(E.textContent=`Blue ${fe.blue}`),c&&(c.textContent=`Ships: ${M.filter(r=>r.alive).length}  Bullets: ${xe.length}  Particles: ${C.length}`)}o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{ne=!ne,o.textContent=ne?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=re();M.push(new L(b.RED,h(40,y*.35),h(80,v-80),r)),k(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let r=re();M.push(new L(b.BLUE,h(y*.65,y-40),h(80,v-80),r)),k(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{le=!le,l.textContent=`\u2604 Trails: ${le?"On":"Off"}`}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{let r=(de.indexOf(oe)+1)%de.length;oe=de[r],n.textContent=`Speed: ${oe}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=te(0,4294967295),u=prompt("Enter numeric seed (32-bit):",r);u!==null&&reset(Number(u))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=M.filter(f=>f.alive&&f.team===b.RED),u=M.filter(f=>f.alive&&f.team===b.BLUE),m=20,p=6;r.forEach((f,w)=>{let g=w%p,P=Math.floor(w/p);f.x=y*.25-g*20,f.y=v*.5+(P-p/2)*m,f.vx=f.vy=0}),u.forEach((f,w)=>{let g=w%p,P=Math.floor(w/p);f.x=y*.75+g*20,f.y=v*.5+(P-p/2)*m,f.vx=f.vy=0}),k("Fleets re-formed")}),D&&typeof D.addEventListener=="function"&&D.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:te(0,1)});for(let m=0;m<24;m++){let p=h(0,H),f=h(40,220);C.push(new V(r.clientX,r.clientY,Math.cos(p)*f,Math.sin(p)*f,h(.2,1),"rgba(255,255,255,$a)"))}});function T(r){se||(se=r);let u=(r-se)/1e3;se=r;let m=ae(u,0,.033)*(ne?oe:0);Ye(m),Ve(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(T)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(T)}export{V as Particle,de as SPEED_STEPS,pe as ShipV,xe as bullets,Ue as createShipFromUI,q as flashes,Z as healthFlashes,ht as initRenderer,ft as initRendererUI,se as lastTime,j as levelFlashes,C as particles,re as randomShipType,Ve as render,ne as running,fe as score,z as shieldFlashes,M as ships,Y as shipsVMap,le as showTrails,Ye as simulate,oe as speed,ue as stars,I as state,B as teamColor,ct as testHelpers,k as toast,dt as updateUI};

</script>
<script type="module">
var _e=Object.defineProperty;var Ce=(n,i,s)=>i in n?_e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var ve=(n,i,s)=>Ce(n,typeof i!="symbol"?i+"":i,s);var Pe=!1,ce=123456789,Le=1664525,we=1013904223,Ie=4294967296,Be=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),He=!!Be;function Ae(){if(!Pe){if(He)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return ce=Le*ce+we>>>0,ce/Ie}function h(n=0,i=1){if(typeof n!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return n+(i-n)*Ae()}function ie(n,i){if(!Number.isFinite(n)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(n,i+1))}var b={RED:0,BLUE:1};function Y(n){switch(n){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":{let s=h(3.5,6)*h(.8,1.4),t=Math.max(1,Math.floor(h(1,3)));return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchCooldown:s,launchAmount:t}}case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var de=class{constructor(i,s,t,l,o,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=o,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},se=class se{constructor(i,s,t,l="corvette",o){if(!o)throw new Error("Ship constructor requires a precomputed cfg. Call getClassConfig(type) and pass it to the constructor or use createShipWithConfig.");this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l,this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=se._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchCooldown,this.launchAmount=o.launchAmount):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,g=o.y-this.y,c=a*a+g*g;c<l&&c<t&&(t=c,s=o)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,o=0;if(t){let x=t.x-this.x,E=t.y-this.y,r=Math.hypot(x,E)||1,d=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*d,f=t.y+(t.vy||0)*d,u=m-this.x,P=f-this.y,v=Math.hypot(u,P)||1;if(l+=u/v*this.accel,o+=P/v*this.accel,r<this.range){let C=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&C>0){let k=300+h(-20,20),q=x/r,K=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],W=new de(this.x+q*12,this.y+K*12,q*k+this.vx*.2,K*k+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),F.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,g=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,d=E*E+r*r;if(d<_*_&&d>1){let m=Math.sqrt(d);a+=E/m,g+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=l*i,this.vy+=o*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let x=this.maxSpeed/p;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ve(se,"_id",1);var fe=se;function X(n,i,s,t="corvette",l){return new fe(n,i,s,t,l)}function Te(n,i,s={W:800,H:600}){n.ships=n.ships||[],n.bullets=n.bullets||[],n.explosions=n.explosions||[],n.shieldHits=n.shieldHits||[],n.healthHits=n.healthHits||[],n.score=n.score||{red:0,blue:0};for(let t of n.ships)t.alive&&t.update(i,n.ships,n.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=t+a*2:o.x>t+a&&(o.x-=t+a*2),o.y<-a?o.y+=l+a*2:o.y>l+a&&(o.y-=l+a*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l;o++){let a=h(0,Math.PI*2),g=t.radius+12+h(4,12),c=t.x+Math.cos(a)*g,_=t.y+Math.sin(a)*g,p=Y("fighter"),x=X(t.team,c,_,"fighter",p),E=h(40,120);x.vx=Math.cos(a)*E+(t.vx||0)*.2,x.vy=Math.sin(a)*E+(t.vy||0)*.2,n.ships.push(x)}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];l.update(i),l.alive(s)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===l.team)continue;let a=o.x-l.x,g=o.y-l.y,c=a*a+g*g,_=o.radius+l.radius;if(c<_*_){let p=l.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(p),d=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(d>0&&n.shieldHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:d}),m>0&&n.healthHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:m}),l.ownerId!=null){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(p*.05)}if(n.bullets.splice(t,1),r&&n.explosions.push(r),!o.alive&&(l.team===0?n.score.red++:n.score.blue++,l.ownerId!=null)){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(20+(o.level||1)*.2)}break}}}}function be(){let n=he(),i=Y(n);return{type:n,cfg:i}}var N,e,y,M;function ut(){N=document.getElementById("world"),e=N.getContext("2d"),y=N.width=window.innerWidth,M=N.height=window.innerHeight,Ye(),window.addEventListener("resize",()=>{y=N.width=window.innerWidth,M=N.height=window.innerHeight})}function ye(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],G=[],Z=[],j=[],J=[],V=new Map,T=[],Ee=[],ne=0,oe=!1,le=1,ae=!0,pe={red:0,blue:0};var ue=[.5,1,2,4],L={ships:T,bullets:Ee,score:pe,particles:w,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,re=(n,i,s)=>Math.max(i,Math.min(s,n)),Q=(n=0,i=1)=>h(n,i);function Ue(n,i,s,t,l,o){let a=Math.min(o,l/2,t/2);n.beginPath(),n.moveTo(i+a,s),n.lineTo(i+t-a,s),n.quadraticCurveTo(i+t,s,i+t,s+a),n.lineTo(i+t,s+l-a),n.quadraticCurveTo(i+t,s+l,i+t-a,s+l),n.lineTo(i+a,s+l),n.quadraticCurveTo(i,s+l,i,s+l-a),n.lineTo(i,s+a),n.quadraticCurveTo(i,s,i+a,s),n.closePath()}function D(n){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=n,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var me=[];function Ye(){if(!Number.isFinite(y)||!Number.isFinite(M))return;me.length=0;let n=[.2,.5,1];for(let i of n)for(let s=0;s<120;s++)me.push({x:Q(0,y),y:Q(0,M),r:Q(.3,1.8)*i,d:i,tw:Q(.4,1),phase:Q(0,B)})}var I=(n,i=1)=>n===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,z=["corvette","frigate","destroyer","carrier","fighter"];function he(){if(!Array.isArray(z)||z.length===0)return"corvette";let n=re(ie(0,z.length-1),0,z.length-1);return z[n]}function Ve(n){let{type:i,cfg:s}=be();if(n===b.RED){let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}else if(n===b.BLUE){let t=h(y*.65,y-40),l=h(80,M-80);T.push(X(b.BLUE,t,l,i,s)),typeof D=="function"&&D(`+1 Blue (${i})`)}else{let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}}var pt={createShipFromUI:Ve,randomShipType:he,chooseShipTypeAndCfg:be,ships:T,state:L},O=class{constructor(i,s,t,l,o,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ye(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},xe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(ye(),!e))return;let s=G.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ae){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new O(r,d,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,I(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=I(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=I(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,B),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,B),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,B),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,d,0,B);let m=e.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let f of Z){if(f.id!==i.id)continue;let u=Math.max(0,Math.min(1,f.life/.22)),P=i.shieldMax&&i.shieldMax>0?f.amount/i.shieldMax:Math.min(1,f.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,P)),k=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*v),q=f.angle-k/2,K=f.angle+k/2,F=d+4*(1-u)+2*v;e.beginPath(),e.arc(i.x,i.y,F,q,K),e.lineWidth=(3+6*u)*(1+4*v);let W=Math.min(1,.25+u*(.9+1.6*v));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*v,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),o=Math.max(3,t*.4),a=i.x-l/2,g=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,g,l,o),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,g,l*r,o))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,o);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let f=e.measureText(r).width,u=8,P=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,f+u*2),C=Math.max(o+2,m*.9),k=a-8-v,q=c+o/2-C/2,K=C/2,F=4,W=k-F,Se=q-F,Re=v+F*2,ge=C+F*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",Ue(e,W,Se,Re,ge,ge/2),e.fill(),e.restore();let ee=J.find(U=>U.id===i.id&&U.life>0),te=1;ee&&(te=1+.6*Math.max(0,Math.min(1,ee.life/1)));let $=v*te,H=C*te,S=k-($-v),R=q-(H-C)/2,A=H/2;if(e.beginPath(),e.moveTo(S+A,R),e.lineTo(S+$-A,R),e.quadraticCurveTo(S+$,R,S+$,R+A),e.lineTo(S+$,R+H-A),e.quadraticCurveTo(S+$,R+H,S+$-A,R+H),e.lineTo(S+A,R+H),e.quadraticCurveTo(S,R+H,S,R+H-A),e.lineTo(S,R+A),e.quadraticCurveTo(S,R,S+A,R),e.closePath(),ee){let U=Math.max(.6,Math.min(1,ee.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=I(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=I(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*te)}px Inter, system-ui, sans-serif`,e.fillText(r,S+$/2,R+H/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=j.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),d=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-d*r)),f=Math.floor(60+160*(1-r*d));E=`rgba(${Math.min(255,m)},${Math.min(255,f)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.clip(),e.fillStyle=E,e.fillRect(a,c,l*_,o))}};function mt(){}function Oe(n){if(Te(L,n,{W:y,H:M}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let t=T.find(l=>l.id===s.id);if(t){j.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let o=h(0,B),a=h(40,120);w.push(new O(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let t=T.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);Z.push({id:t.id,angle:l,life:.22,amount:s.amount}),G.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(n),t.life<=0&&w.splice(s,1)}for(let s=G.length-1;s>=0;s--){let t=G[s];t.life-=n,t.r+=600*n,t.life<=0&&G.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=n,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=n,t.life<=0&&j.splice(s,1)}for(let s=J.length-1;s>=0;s--){let t=J[s];t.life-=n,t.life<=0&&J.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let t=V.get(s.id);if(t.level!==s.level){J.push({id:s.id,life:1});for(let l=0;l<18;l++){let o=h(0,B),a=h(60,240);w.push(new O(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*a,Math.sin(o)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new xe(s);t.level=s.level,V.set(s.id,t)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Ke(){if(ye(),typeof e>"u"||!e)return;e.clearRect(0,0,y,M);let n=e.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=n,e.fillRect(0,0,y,M);for(let t of me){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=re(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of G){let l=re(t.life/.25,0,1);e.strokeStyle=I(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,B),e.stroke()}for(let t of Ee)e.save(),e.shadowBlur=12,e.shadowColor=I(t.team,.9),e.fillStyle=I(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,B),e.fill(),e.restore();for(let t of w)t.draw();for(let t of V.values())t.draw();let i=T.some(t=>t.alive&&t.team===b.RED),s=T.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?I(b.RED,.95):s?I(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function xt(){if(typeof document>"u")return;let n=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),p=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${pe.red}`),g&&(g.textContent=`Blue ${pe.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${Ee.length}  Particles: ${w.length}`)}n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{oe=!oe,n.textContent=oe?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=he(),d=h(40,y*.35),m=h(80,M-80),f=Y(r);T.push(X(b.RED,d,m,r,f)),D(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let r=he(),d=h(y*.65,y-40),m=h(80,M-80),f=Y(r);T.push(X(b.BLUE,d,m,r,f)),D(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{ae=!ae,l.textContent=`\u2604 Trails: ${ae?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ue.indexOf(le)+1)%ue.length;le=ue[r],o.textContent=`Speed: ${le}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=ie(0,4294967295),d=prompt("Enter numeric seed (32-bit):",r);d!==null&&reset(Number(d))}),p&&typeof p.addEventListener=="function"&&p.addEventListener("click",()=>{let r=T.filter(u=>u.alive&&u.team===b.RED),d=T.filter(u=>u.alive&&u.team===b.BLUE),m=20,f=6;r.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.25-v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),d.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.75+v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),D("Fleets re-formed")}),N&&typeof N.addEventListener=="function"&&N.addEventListener("click",r=>{G.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ie(0,1)});for(let m=0;m<24;m++){let f=h(0,B),u=h(40,220);w.push(new O(r.clientX,r.clientY,Math.cos(f)*u,Math.sin(f)*u,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){ne||(ne=r);let d=(r-ne)/1e3;ne=r;let m=re(d,0,.033)*(oe?le:0);Oe(m),Ke(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{O as Particle,ue as SPEED_STEPS,xe as ShipV,Ee as bullets,be as chooseShipTypeAndCfg,Ve as createShipFromUI,G as flashes,j as healthFlashes,ut as initRenderer,xt as initRendererUI,ne as lastTime,J as levelFlashes,w as particles,he as randomShipType,Ke as render,oe as running,pe as score,Z as shieldFlashes,T as ships,V as shipsVMap,ae as showTrails,Oe as simulate,le as speed,me as stars,L as state,I as teamColor,pt as testHelpers,D as toast,mt as updateUI};

</script>
<script type="module">
var _e=Object.defineProperty;var Ce=(n,i,s)=>i in n?_e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var ve=(n,i,s)=>Ce(n,typeof i!="symbol"?i+"":i,s);var Pe=!1,ce=123456789,Le=1664525,we=1013904223,Ie=4294967296,Be=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),He=!!Be;function Ae(){if(!Pe){if(He)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return ce=Le*ce+we>>>0,ce/Ie}function h(n=0,i=1){if(typeof n!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return n+(i-n)*Ae()}function ie(n,i){if(!Number.isFinite(n)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(n,i+1))}var b={RED:0,BLUE:1};function Y(n){switch(n){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":{let s=h(3.5,6)*h(.8,1.4),t=Math.max(1,Math.floor(h(1,3)));return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchCooldown:s,launchAmount:t}}case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var de=class{constructor(i,s,t,l,o,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=o,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},se=class se{constructor(i,s,t,l="corvette",o){if(!o)throw new Error("Ship constructor requires a precomputed cfg. Call getClassConfig(type) and pass it to the constructor or use createShipWithConfig.");this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l,this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=se._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchCooldown,this.launchAmount=o.launchAmount):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,g=o.y-this.y,c=a*a+g*g;c<l&&c<t&&(t=c,s=o)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,o=0;if(t){let x=t.x-this.x,E=t.y-this.y,r=Math.hypot(x,E)||1,d=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*d,f=t.y+(t.vy||0)*d,u=m-this.x,P=f-this.y,v=Math.hypot(u,P)||1;if(l+=u/v*this.accel,o+=P/v*this.accel,r<this.range){let C=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&C>0){let k=300+h(-20,20),q=x/r,K=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],W=new de(this.x+q*12,this.y+K*12,q*k+this.vx*.2,K*k+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),F.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,g=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,d=E*E+r*r;if(d<_*_&&d>1){let m=Math.sqrt(d);a+=E/m,g+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=l*i,this.vy+=o*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let x=this.maxSpeed/p;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ve(se,"_id",1);var fe=se;function X(n,i,s,t="corvette",l){return new fe(n,i,s,t,l)}function Te(n,i,s={W:800,H:600}){n.ships=n.ships||[],n.bullets=n.bullets||[],n.explosions=n.explosions||[],n.shieldHits=n.shieldHits||[],n.healthHits=n.healthHits||[],n.score=n.score||{red:0,blue:0};for(let t of n.ships)t.alive&&t.update(i,n.ships,n.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=t+a*2:o.x>t+a&&(o.x-=t+a*2),o.y<-a?o.y+=l+a*2:o.y>l+a&&(o.y-=l+a*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l;o++){let a=h(0,Math.PI*2),g=t.radius+12+h(4,12),c=t.x+Math.cos(a)*g,_=t.y+Math.sin(a)*g,p=Y("fighter"),x=X(t.team,c,_,"fighter",p),E=h(40,120);x.vx=Math.cos(a)*E+(t.vx||0)*.2,x.vy=Math.sin(a)*E+(t.vy||0)*.2,n.ships.push(x)}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];l.update(i),l.alive(s)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===l.team)continue;let a=o.x-l.x,g=o.y-l.y,c=a*a+g*g,_=o.radius+l.radius;if(c<_*_){let p=l.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(p),d=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(d>0&&n.shieldHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:d}),m>0&&n.healthHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:m}),l.ownerId!=null){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(p*.05)}if(n.bullets.splice(t,1),r&&n.explosions.push(r),!o.alive&&(l.team===0?n.score.red++:n.score.blue++,l.ownerId!=null)){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(20+(o.level||1)*.2)}break}}}}function be(){let n=he(),i=Y(n);return{type:n,cfg:i}}var N,e,y,M;function ut(){N=document.getElementById("world"),e=N.getContext("2d"),y=N.width=window.innerWidth,M=N.height=window.innerHeight,Ye(),window.addEventListener("resize",()=>{y=N.width=window.innerWidth,M=N.height=window.innerHeight})}function ye(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],G=[],Z=[],j=[],J=[],V=new Map,T=[],Ee=[],ne=0,oe=!1,le=1,ae=!0,pe={red:0,blue:0};var ue=[.5,1,2,4],L={ships:T,bullets:Ee,score:pe,particles:w,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,re=(n,i,s)=>Math.max(i,Math.min(s,n)),Q=(n=0,i=1)=>h(n,i);function Ue(n,i,s,t,l,o){let a=Math.min(o,l/2,t/2);n.beginPath(),n.moveTo(i+a,s),n.lineTo(i+t-a,s),n.quadraticCurveTo(i+t,s,i+t,s+a),n.lineTo(i+t,s+l-a),n.quadraticCurveTo(i+t,s+l,i+t-a,s+l),n.lineTo(i+a,s+l),n.quadraticCurveTo(i,s+l,i,s+l-a),n.lineTo(i,s+a),n.quadraticCurveTo(i,s,i+a,s),n.closePath()}function D(n){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=n,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var me=[];function Ye(){if(!Number.isFinite(y)||!Number.isFinite(M))return;me.length=0;let n=[.2,.5,1];for(let i of n)for(let s=0;s<120;s++)me.push({x:Q(0,y),y:Q(0,M),r:Q(.3,1.8)*i,d:i,tw:Q(.4,1),phase:Q(0,B)})}var I=(n,i=1)=>n===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,z=["corvette","frigate","destroyer","carrier","fighter"];function he(){if(!Array.isArray(z)||z.length===0)return"corvette";let n=re(ie(0,z.length-1),0,z.length-1);return z[n]}function Ve(n){let{type:i,cfg:s}=be();if(n===b.RED){let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}else if(n===b.BLUE){let t=h(y*.65,y-40),l=h(80,M-80);T.push(X(b.BLUE,t,l,i,s)),typeof D=="function"&&D(`+1 Blue (${i})`)}else{let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}}var pt={createShipFromUI:Ve,randomShipType:he,chooseShipTypeAndCfg:be,ships:T,state:L},O=class{constructor(i,s,t,l,o,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ye(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},xe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(ye(),!e))return;let s=G.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ae){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new O(r,d,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,I(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=I(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=I(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,B),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,B),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,B),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,d,0,B);let m=e.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let f of Z){if(f.id!==i.id)continue;let u=Math.max(0,Math.min(1,f.life/.22)),P=i.shieldMax&&i.shieldMax>0?f.amount/i.shieldMax:Math.min(1,f.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,P)),k=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*v),q=f.angle-k/2,K=f.angle+k/2,F=d+4*(1-u)+2*v;e.beginPath(),e.arc(i.x,i.y,F,q,K),e.lineWidth=(3+6*u)*(1+4*v);let W=Math.min(1,.25+u*(.9+1.6*v));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*v,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),o=Math.max(3,t*.4),a=i.x-l/2,g=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,g,l,o),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,g,l*r,o))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,o);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let f=e.measureText(r).width,u=8,P=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,f+u*2),C=Math.max(o+2,m*.9),k=a-8-v,q=c+o/2-C/2,K=C/2,F=4,W=k-F,Se=q-F,Re=v+F*2,ge=C+F*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",Ue(e,W,Se,Re,ge,ge/2),e.fill(),e.restore();let ee=J.find(U=>U.id===i.id&&U.life>0),te=1;ee&&(te=1+.6*Math.max(0,Math.min(1,ee.life/1)));let $=v*te,H=C*te,S=k-($-v),R=q-(H-C)/2,A=H/2;if(e.beginPath(),e.moveTo(S+A,R),e.lineTo(S+$-A,R),e.quadraticCurveTo(S+$,R,S+$,R+A),e.lineTo(S+$,R+H-A),e.quadraticCurveTo(S+$,R+H,S+$-A,R+H),e.lineTo(S+A,R+H),e.quadraticCurveTo(S,R+H,S,R+H-A),e.lineTo(S,R+A),e.quadraticCurveTo(S,R,S+A,R),e.closePath(),ee){let U=Math.max(.6,Math.min(1,ee.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=I(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=I(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*te)}px Inter, system-ui, sans-serif`,e.fillText(r,S+$/2,R+H/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=j.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),d=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-d*r)),f=Math.floor(60+160*(1-r*d));E=`rgba(${Math.min(255,m)},${Math.min(255,f)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.clip(),e.fillStyle=E,e.fillRect(a,c,l*_,o))}};function mt(){}function Oe(n){if(Te(L,n,{W:y,H:M}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let t=T.find(l=>l.id===s.id);if(t){j.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let o=h(0,B),a=h(40,120);w.push(new O(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let t=T.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);Z.push({id:t.id,angle:l,life:.22,amount:s.amount}),G.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(n),t.life<=0&&w.splice(s,1)}for(let s=G.length-1;s>=0;s--){let t=G[s];t.life-=n,t.r+=600*n,t.life<=0&&G.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=n,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=n,t.life<=0&&j.splice(s,1)}for(let s=J.length-1;s>=0;s--){let t=J[s];t.life-=n,t.life<=0&&J.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let t=V.get(s.id);if(t.level!==s.level){J.push({id:s.id,life:1});for(let l=0;l<18;l++){let o=h(0,B),a=h(60,240);w.push(new O(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*a,Math.sin(o)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new xe(s);t.level=s.level,V.set(s.id,t)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Ke(){if(ye(),typeof e>"u"||!e)return;e.clearRect(0,0,y,M);let n=e.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=n,e.fillRect(0,0,y,M);for(let t of me){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=re(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of G){let l=re(t.life/.25,0,1);e.strokeStyle=I(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,B),e.stroke()}for(let t of Ee)e.save(),e.shadowBlur=12,e.shadowColor=I(t.team,.9),e.fillStyle=I(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,B),e.fill(),e.restore();for(let t of w)t.draw();for(let t of V.values())t.draw();let i=T.some(t=>t.alive&&t.team===b.RED),s=T.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?I(b.RED,.95):s?I(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function xt(){if(typeof document>"u")return;let n=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),p=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${pe.red}`),g&&(g.textContent=`Blue ${pe.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${Ee.length}  Particles: ${w.length}`)}n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{oe=!oe,n.textContent=oe?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=he(),d=h(40,y*.35),m=h(80,M-80),f=Y(r);T.push(X(b.RED,d,m,r,f)),D(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let r=he(),d=h(y*.65,y-40),m=h(80,M-80),f=Y(r);T.push(X(b.BLUE,d,m,r,f)),D(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{ae=!ae,l.textContent=`\u2604 Trails: ${ae?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ue.indexOf(le)+1)%ue.length;le=ue[r],o.textContent=`Speed: ${le}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=ie(0,4294967295),d=prompt("Enter numeric seed (32-bit):",r);d!==null&&reset(Number(d))}),p&&typeof p.addEventListener=="function"&&p.addEventListener("click",()=>{let r=T.filter(u=>u.alive&&u.team===b.RED),d=T.filter(u=>u.alive&&u.team===b.BLUE),m=20,f=6;r.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.25-v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),d.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.75+v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),D("Fleets re-formed")}),N&&typeof N.addEventListener=="function"&&N.addEventListener("click",r=>{G.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ie(0,1)});for(let m=0;m<24;m++){let f=h(0,B),u=h(40,220);w.push(new O(r.clientX,r.clientY,Math.cos(f)*u,Math.sin(f)*u,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){ne||(ne=r);let d=(r-ne)/1e3;ne=r;let m=re(d,0,.033)*(oe?le:0);Oe(m),Ke(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{O as Particle,ue as SPEED_STEPS,xe as ShipV,Ee as bullets,be as chooseShipTypeAndCfg,Ve as createShipFromUI,G as flashes,j as healthFlashes,ut as initRenderer,xt as initRendererUI,ne as lastTime,J as levelFlashes,w as particles,he as randomShipType,Ke as render,oe as running,pe as score,Z as shieldFlashes,T as ships,V as shipsVMap,ae as showTrails,Oe as simulate,le as speed,me as stars,L as state,I as teamColor,pt as testHelpers,D as toast,mt as updateUI};

</script>
<script type="module">
var _e=Object.defineProperty;var Ce=(n,i,s)=>i in n?_e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var ve=(n,i,s)=>Ce(n,typeof i!="symbol"?i+"":i,s);var Pe=!1,ce=123456789,Le=1664525,we=1013904223,Ie=4294967296,Be=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),He=!!Be;function Ae(){if(!Pe){if(He)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return ce=Le*ce+we>>>0,ce/Ie}function h(n=0,i=1){if(typeof n!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return n+(i-n)*Ae()}function ie(n,i){if(!Number.isFinite(n)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(n,i+1))}var b={RED:0,BLUE:1};function Y(n){switch(n){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":{let s=h(3.5,6)*h(.8,1.4),t=Math.max(1,Math.floor(h(1,3)));return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchCooldown:s,launchAmount:t}}case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var de=class{constructor(i,s,t,l,o,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=o,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},se=class se{constructor(i,s,t,l="corvette",o){if(!o)throw new Error("Ship constructor requires a precomputed cfg. Call getClassConfig(type) and pass it to the constructor or use createShipWithConfig.");this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l,this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=se._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchCooldown,this.launchAmount=o.launchAmount):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,g=o.y-this.y,c=a*a+g*g;c<l&&c<t&&(t=c,s=o)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,o=0;if(t){let x=t.x-this.x,E=t.y-this.y,r=Math.hypot(x,E)||1,d=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*d,f=t.y+(t.vy||0)*d,u=m-this.x,P=f-this.y,v=Math.hypot(u,P)||1;if(l+=u/v*this.accel,o+=P/v*this.accel,r<this.range){let C=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&C>0){let k=300+h(-20,20),q=x/r,K=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],W=new de(this.x+q*12,this.y+K*12,q*k+this.vx*.2,K*k+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),F.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,g=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,d=E*E+r*r;if(d<_*_&&d>1){let m=Math.sqrt(d);a+=E/m,g+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=l*i,this.vy+=o*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let x=this.maxSpeed/p;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ve(se,"_id",1);var fe=se;function X(n,i,s,t="corvette",l){return new fe(n,i,s,t,l)}function Te(n,i,s={W:800,H:600}){n.ships=n.ships||[],n.bullets=n.bullets||[],n.explosions=n.explosions||[],n.shieldHits=n.shieldHits||[],n.healthHits=n.healthHits||[],n.score=n.score||{red:0,blue:0};for(let t of n.ships)t.alive&&t.update(i,n.ships,n.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=t+a*2:o.x>t+a&&(o.x-=t+a*2),o.y<-a?o.y+=l+a*2:o.y>l+a&&(o.y-=l+a*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l;o++){let a=h(0,Math.PI*2),g=t.radius+12+h(4,12),c=t.x+Math.cos(a)*g,_=t.y+Math.sin(a)*g,p=Y("fighter"),x=X(t.team,c,_,"fighter",p),E=h(40,120);x.vx=Math.cos(a)*E+(t.vx||0)*.2,x.vy=Math.sin(a)*E+(t.vy||0)*.2,n.ships.push(x)}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];l.update(i),l.alive(s)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===l.team)continue;let a=o.x-l.x,g=o.y-l.y,c=a*a+g*g,_=o.radius+l.radius;if(c<_*_){let p=l.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(p),d=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(d>0&&n.shieldHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:d}),m>0&&n.healthHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:m}),l.ownerId!=null){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(p*.05)}if(n.bullets.splice(t,1),r&&n.explosions.push(r),!o.alive&&(l.team===0?n.score.red++:n.score.blue++,l.ownerId!=null)){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(20+(o.level||1)*.2)}break}}}}function be(){let n=he(),i=Y(n);return{type:n,cfg:i}}var N,e,y,M;function ut(){N=document.getElementById("world"),e=N.getContext("2d"),y=N.width=window.innerWidth,M=N.height=window.innerHeight,Ye(),window.addEventListener("resize",()=>{y=N.width=window.innerWidth,M=N.height=window.innerHeight})}function ye(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],G=[],Z=[],j=[],J=[],V=new Map,T=[],Ee=[],ne=0,oe=!1,le=1,ae=!0,pe={red:0,blue:0};var ue=[.5,1,2,4],L={ships:T,bullets:Ee,score:pe,particles:w,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,re=(n,i,s)=>Math.max(i,Math.min(s,n)),Q=(n=0,i=1)=>h(n,i);function Ue(n,i,s,t,l,o){let a=Math.min(o,l/2,t/2);n.beginPath(),n.moveTo(i+a,s),n.lineTo(i+t-a,s),n.quadraticCurveTo(i+t,s,i+t,s+a),n.lineTo(i+t,s+l-a),n.quadraticCurveTo(i+t,s+l,i+t-a,s+l),n.lineTo(i+a,s+l),n.quadraticCurveTo(i,s+l,i,s+l-a),n.lineTo(i,s+a),n.quadraticCurveTo(i,s,i+a,s),n.closePath()}function D(n){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=n,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var me=[];function Ye(){if(!Number.isFinite(y)||!Number.isFinite(M))return;me.length=0;let n=[.2,.5,1];for(let i of n)for(let s=0;s<120;s++)me.push({x:Q(0,y),y:Q(0,M),r:Q(.3,1.8)*i,d:i,tw:Q(.4,1),phase:Q(0,B)})}var I=(n,i=1)=>n===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,z=["corvette","frigate","destroyer","carrier","fighter"];function he(){if(!Array.isArray(z)||z.length===0)return"corvette";let n=re(ie(0,z.length-1),0,z.length-1);return z[n]}function Ve(n){let{type:i,cfg:s}=be();if(n===b.RED){let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}else if(n===b.BLUE){let t=h(y*.65,y-40),l=h(80,M-80);T.push(X(b.BLUE,t,l,i,s)),typeof D=="function"&&D(`+1 Blue (${i})`)}else{let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}}var pt={createShipFromUI:Ve,randomShipType:he,chooseShipTypeAndCfg:be,ships:T,state:L},O=class{constructor(i,s,t,l,o,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ye(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},xe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(ye(),!e))return;let s=G.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ae){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new O(r,d,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,I(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=I(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=I(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,B),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,B),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,B),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,d,0,B);let m=e.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let f of Z){if(f.id!==i.id)continue;let u=Math.max(0,Math.min(1,f.life/.22)),P=i.shieldMax&&i.shieldMax>0?f.amount/i.shieldMax:Math.min(1,f.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,P)),k=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*v),q=f.angle-k/2,K=f.angle+k/2,F=d+4*(1-u)+2*v;e.beginPath(),e.arc(i.x,i.y,F,q,K),e.lineWidth=(3+6*u)*(1+4*v);let W=Math.min(1,.25+u*(.9+1.6*v));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*v,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),o=Math.max(3,t*.4),a=i.x-l/2,g=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,g,l,o),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,g,l*r,o))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,o);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let f=e.measureText(r).width,u=8,P=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,f+u*2),C=Math.max(o+2,m*.9),k=a-8-v,q=c+o/2-C/2,K=C/2,F=4,W=k-F,Se=q-F,Re=v+F*2,ge=C+F*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",Ue(e,W,Se,Re,ge,ge/2),e.fill(),e.restore();let ee=J.find(U=>U.id===i.id&&U.life>0),te=1;ee&&(te=1+.6*Math.max(0,Math.min(1,ee.life/1)));let $=v*te,H=C*te,S=k-($-v),R=q-(H-C)/2,A=H/2;if(e.beginPath(),e.moveTo(S+A,R),e.lineTo(S+$-A,R),e.quadraticCurveTo(S+$,R,S+$,R+A),e.lineTo(S+$,R+H-A),e.quadraticCurveTo(S+$,R+H,S+$-A,R+H),e.lineTo(S+A,R+H),e.quadraticCurveTo(S,R+H,S,R+H-A),e.lineTo(S,R+A),e.quadraticCurveTo(S,R,S+A,R),e.closePath(),ee){let U=Math.max(.6,Math.min(1,ee.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=I(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=I(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*te)}px Inter, system-ui, sans-serif`,e.fillText(r,S+$/2,R+H/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=j.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),d=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-d*r)),f=Math.floor(60+160*(1-r*d));E=`rgba(${Math.min(255,m)},${Math.min(255,f)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.clip(),e.fillStyle=E,e.fillRect(a,c,l*_,o))}};function mt(){}function Oe(n){if(Te(L,n,{W:y,H:M}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let t=T.find(l=>l.id===s.id);if(t){j.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let o=h(0,B),a=h(40,120);w.push(new O(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let t=T.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);Z.push({id:t.id,angle:l,life:.22,amount:s.amount}),G.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(n),t.life<=0&&w.splice(s,1)}for(let s=G.length-1;s>=0;s--){let t=G[s];t.life-=n,t.r+=600*n,t.life<=0&&G.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=n,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=n,t.life<=0&&j.splice(s,1)}for(let s=J.length-1;s>=0;s--){let t=J[s];t.life-=n,t.life<=0&&J.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let t=V.get(s.id);if(t.level!==s.level){J.push({id:s.id,life:1});for(let l=0;l<18;l++){let o=h(0,B),a=h(60,240);w.push(new O(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*a,Math.sin(o)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new xe(s);t.level=s.level,V.set(s.id,t)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Ke(){if(ye(),typeof e>"u"||!e)return;e.clearRect(0,0,y,M);let n=e.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=n,e.fillRect(0,0,y,M);for(let t of me){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=re(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of G){let l=re(t.life/.25,0,1);e.strokeStyle=I(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,B),e.stroke()}for(let t of Ee)e.save(),e.shadowBlur=12,e.shadowColor=I(t.team,.9),e.fillStyle=I(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,B),e.fill(),e.restore();for(let t of w)t.draw();for(let t of V.values())t.draw();let i=T.some(t=>t.alive&&t.team===b.RED),s=T.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?I(b.RED,.95):s?I(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function xt(){if(typeof document>"u")return;let n=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),p=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${pe.red}`),g&&(g.textContent=`Blue ${pe.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${Ee.length}  Particles: ${w.length}`)}n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{oe=!oe,n.textContent=oe?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=he(),d=h(40,y*.35),m=h(80,M-80),f=Y(r);T.push(X(b.RED,d,m,r,f)),D(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let r=he(),d=h(y*.65,y-40),m=h(80,M-80),f=Y(r);T.push(X(b.BLUE,d,m,r,f)),D(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{ae=!ae,l.textContent=`\u2604 Trails: ${ae?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ue.indexOf(le)+1)%ue.length;le=ue[r],o.textContent=`Speed: ${le}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=ie(0,4294967295),d=prompt("Enter numeric seed (32-bit):",r);d!==null&&reset(Number(d))}),p&&typeof p.addEventListener=="function"&&p.addEventListener("click",()=>{let r=T.filter(u=>u.alive&&u.team===b.RED),d=T.filter(u=>u.alive&&u.team===b.BLUE),m=20,f=6;r.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.25-v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),d.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.75+v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),D("Fleets re-formed")}),N&&typeof N.addEventListener=="function"&&N.addEventListener("click",r=>{G.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ie(0,1)});for(let m=0;m<24;m++){let f=h(0,B),u=h(40,220);w.push(new O(r.clientX,r.clientY,Math.cos(f)*u,Math.sin(f)*u,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){ne||(ne=r);let d=(r-ne)/1e3;ne=r;let m=re(d,0,.033)*(oe?le:0);Oe(m),Ke(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{O as Particle,ue as SPEED_STEPS,xe as ShipV,Ee as bullets,be as chooseShipTypeAndCfg,Ve as createShipFromUI,G as flashes,j as healthFlashes,ut as initRenderer,xt as initRendererUI,ne as lastTime,J as levelFlashes,w as particles,he as randomShipType,Ke as render,oe as running,pe as score,Z as shieldFlashes,T as ships,V as shipsVMap,ae as showTrails,Oe as simulate,le as speed,me as stars,L as state,I as teamColor,pt as testHelpers,D as toast,mt as updateUI};

</script>
<script type="module">
var _e=Object.defineProperty;var Ce=(n,i,s)=>i in n?_e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var ve=(n,i,s)=>Ce(n,typeof i!="symbol"?i+"":i,s);var Pe=!1,ce=123456789,Le=1664525,we=1013904223,Ie=4294967296,Be=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),He=!!Be;function Ae(){if(!Pe){if(He)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return ce=Le*ce+we>>>0,ce/Ie}function h(n=0,i=1){if(typeof n!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return n+(i-n)*Ae()}function ie(n,i){if(!Number.isFinite(n)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(n,i+1))}var b={RED:0,BLUE:1};function Y(n){switch(n){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":{let s=h(3.5,6)*h(.8,1.4),t=Math.max(1,Math.floor(h(1,3)));return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchCooldown:s,launchAmount:t}}case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var de=class{constructor(i,s,t,l,o,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=o,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},se=class se{constructor(i,s,t,l="corvette",o){if(!o)throw new Error("Ship constructor requires a precomputed cfg. Call getClassConfig(type) and pass it to the constructor or use createShipWithConfig.");this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l,this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=se._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchCooldown,this.launchAmount=o.launchAmount):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,g=o.y-this.y,c=a*a+g*g;c<l&&c<t&&(t=c,s=o)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,o=0;if(t){let x=t.x-this.x,E=t.y-this.y,r=Math.hypot(x,E)||1,d=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*d,f=t.y+(t.vy||0)*d,u=m-this.x,P=f-this.y,v=Math.hypot(u,P)||1;if(l+=u/v*this.accel,o+=P/v*this.accel,r<this.range){let C=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&C>0){let k=300+h(-20,20),q=x/r,K=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],W=new de(this.x+q*12,this.y+K*12,q*k+this.vx*.2,K*k+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),F.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,g=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,d=E*E+r*r;if(d<_*_&&d>1){let m=Math.sqrt(d);a+=E/m,g+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=l*i,this.vy+=o*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let x=this.maxSpeed/p;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ve(se,"_id",1);var fe=se;function X(n,i,s,t="corvette",l){return new fe(n,i,s,t,l)}function Te(n,i,s={W:800,H:600}){n.ships=n.ships||[],n.bullets=n.bullets||[],n.explosions=n.explosions||[],n.shieldHits=n.shieldHits||[],n.healthHits=n.healthHits||[],n.score=n.score||{red:0,blue:0};for(let t of n.ships)t.alive&&t.update(i,n.ships,n.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=t+a*2:o.x>t+a&&(o.x-=t+a*2),o.y<-a?o.y+=l+a*2:o.y>l+a&&(o.y-=l+a*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l;o++){let a=h(0,Math.PI*2),g=t.radius+12+h(4,12),c=t.x+Math.cos(a)*g,_=t.y+Math.sin(a)*g,p=Y("fighter"),x=X(t.team,c,_,"fighter",p),E=h(40,120);x.vx=Math.cos(a)*E+(t.vx||0)*.2,x.vy=Math.sin(a)*E+(t.vy||0)*.2,n.ships.push(x)}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];l.update(i),l.alive(s)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===l.team)continue;let a=o.x-l.x,g=o.y-l.y,c=a*a+g*g,_=o.radius+l.radius;if(c<_*_){let p=l.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(p),d=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(d>0&&n.shieldHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:d}),m>0&&n.healthHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:m}),l.ownerId!=null){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(p*.05)}if(n.bullets.splice(t,1),r&&n.explosions.push(r),!o.alive&&(l.team===0?n.score.red++:n.score.blue++,l.ownerId!=null)){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(20+(o.level||1)*.2)}break}}}}function be(){let n=he(),i=Y(n);return{type:n,cfg:i}}var N,e,y,M;function ut(){N=document.getElementById("world"),e=N.getContext("2d"),y=N.width=window.innerWidth,M=N.height=window.innerHeight,Ye(),window.addEventListener("resize",()=>{y=N.width=window.innerWidth,M=N.height=window.innerHeight})}function ye(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],G=[],Z=[],j=[],J=[],V=new Map,T=[],Ee=[],ne=0,oe=!1,le=1,ae=!0,pe={red:0,blue:0};var ue=[.5,1,2,4],L={ships:T,bullets:Ee,score:pe,particles:w,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,re=(n,i,s)=>Math.max(i,Math.min(s,n)),Q=(n=0,i=1)=>h(n,i);function Ue(n,i,s,t,l,o){let a=Math.min(o,l/2,t/2);n.beginPath(),n.moveTo(i+a,s),n.lineTo(i+t-a,s),n.quadraticCurveTo(i+t,s,i+t,s+a),n.lineTo(i+t,s+l-a),n.quadraticCurveTo(i+t,s+l,i+t-a,s+l),n.lineTo(i+a,s+l),n.quadraticCurveTo(i,s+l,i,s+l-a),n.lineTo(i,s+a),n.quadraticCurveTo(i,s,i+a,s),n.closePath()}function D(n){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=n,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var me=[];function Ye(){if(!Number.isFinite(y)||!Number.isFinite(M))return;me.length=0;let n=[.2,.5,1];for(let i of n)for(let s=0;s<120;s++)me.push({x:Q(0,y),y:Q(0,M),r:Q(.3,1.8)*i,d:i,tw:Q(.4,1),phase:Q(0,B)})}var I=(n,i=1)=>n===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,z=["corvette","frigate","destroyer","carrier","fighter"];function he(){if(!Array.isArray(z)||z.length===0)return"corvette";let n=re(ie(0,z.length-1),0,z.length-1);return z[n]}function Ve(n){let{type:i,cfg:s}=be();if(n===b.RED){let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}else if(n===b.BLUE){let t=h(y*.65,y-40),l=h(80,M-80);T.push(X(b.BLUE,t,l,i,s)),typeof D=="function"&&D(`+1 Blue (${i})`)}else{let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}}var pt={createShipFromUI:Ve,randomShipType:he,chooseShipTypeAndCfg:be,ships:T,state:L},O=class{constructor(i,s,t,l,o,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ye(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},xe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(ye(),!e))return;let s=G.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ae){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new O(r,d,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,I(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=I(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=I(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,B),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,B),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,B),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,d,0,B);let m=e.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let f of Z){if(f.id!==i.id)continue;let u=Math.max(0,Math.min(1,f.life/.22)),P=i.shieldMax&&i.shieldMax>0?f.amount/i.shieldMax:Math.min(1,f.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,P)),k=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*v),q=f.angle-k/2,K=f.angle+k/2,F=d+4*(1-u)+2*v;e.beginPath(),e.arc(i.x,i.y,F,q,K),e.lineWidth=(3+6*u)*(1+4*v);let W=Math.min(1,.25+u*(.9+1.6*v));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*v,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),o=Math.max(3,t*.4),a=i.x-l/2,g=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,g,l,o),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,g,l*r,o))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,o);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let f=e.measureText(r).width,u=8,P=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,f+u*2),C=Math.max(o+2,m*.9),k=a-8-v,q=c+o/2-C/2,K=C/2,F=4,W=k-F,Se=q-F,Re=v+F*2,ge=C+F*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",Ue(e,W,Se,Re,ge,ge/2),e.fill(),e.restore();let ee=J.find(U=>U.id===i.id&&U.life>0),te=1;ee&&(te=1+.6*Math.max(0,Math.min(1,ee.life/1)));let $=v*te,H=C*te,S=k-($-v),R=q-(H-C)/2,A=H/2;if(e.beginPath(),e.moveTo(S+A,R),e.lineTo(S+$-A,R),e.quadraticCurveTo(S+$,R,S+$,R+A),e.lineTo(S+$,R+H-A),e.quadraticCurveTo(S+$,R+H,S+$-A,R+H),e.lineTo(S+A,R+H),e.quadraticCurveTo(S,R+H,S,R+H-A),e.lineTo(S,R+A),e.quadraticCurveTo(S,R,S+A,R),e.closePath(),ee){let U=Math.max(.6,Math.min(1,ee.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=I(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=I(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*te)}px Inter, system-ui, sans-serif`,e.fillText(r,S+$/2,R+H/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=j.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),d=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-d*r)),f=Math.floor(60+160*(1-r*d));E=`rgba(${Math.min(255,m)},${Math.min(255,f)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.clip(),e.fillStyle=E,e.fillRect(a,c,l*_,o))}};function mt(){}function Oe(n){if(Te(L,n,{W:y,H:M}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let t=T.find(l=>l.id===s.id);if(t){j.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let o=h(0,B),a=h(40,120);w.push(new O(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let t=T.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);Z.push({id:t.id,angle:l,life:.22,amount:s.amount}),G.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(n),t.life<=0&&w.splice(s,1)}for(let s=G.length-1;s>=0;s--){let t=G[s];t.life-=n,t.r+=600*n,t.life<=0&&G.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=n,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=n,t.life<=0&&j.splice(s,1)}for(let s=J.length-1;s>=0;s--){let t=J[s];t.life-=n,t.life<=0&&J.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let t=V.get(s.id);if(t.level!==s.level){J.push({id:s.id,life:1});for(let l=0;l<18;l++){let o=h(0,B),a=h(60,240);w.push(new O(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*a,Math.sin(o)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new xe(s);t.level=s.level,V.set(s.id,t)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Ke(){if(ye(),typeof e>"u"||!e)return;e.clearRect(0,0,y,M);let n=e.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=n,e.fillRect(0,0,y,M);for(let t of me){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=re(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of G){let l=re(t.life/.25,0,1);e.strokeStyle=I(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,B),e.stroke()}for(let t of Ee)e.save(),e.shadowBlur=12,e.shadowColor=I(t.team,.9),e.fillStyle=I(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,B),e.fill(),e.restore();for(let t of w)t.draw();for(let t of V.values())t.draw();let i=T.some(t=>t.alive&&t.team===b.RED),s=T.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?I(b.RED,.95):s?I(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function xt(){if(typeof document>"u")return;let n=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),p=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${pe.red}`),g&&(g.textContent=`Blue ${pe.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${Ee.length}  Particles: ${w.length}`)}n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{oe=!oe,n.textContent=oe?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=he(),d=h(40,y*.35),m=h(80,M-80),f=Y(r);T.push(X(b.RED,d,m,r,f)),D(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let r=he(),d=h(y*.65,y-40),m=h(80,M-80),f=Y(r);T.push(X(b.BLUE,d,m,r,f)),D(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{ae=!ae,l.textContent=`\u2604 Trails: ${ae?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ue.indexOf(le)+1)%ue.length;le=ue[r],o.textContent=`Speed: ${le}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=ie(0,4294967295),d=prompt("Enter numeric seed (32-bit):",r);d!==null&&reset(Number(d))}),p&&typeof p.addEventListener=="function"&&p.addEventListener("click",()=>{let r=T.filter(u=>u.alive&&u.team===b.RED),d=T.filter(u=>u.alive&&u.team===b.BLUE),m=20,f=6;r.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.25-v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),d.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.75+v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),D("Fleets re-formed")}),N&&typeof N.addEventListener=="function"&&N.addEventListener("click",r=>{G.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:ie(0,1)});for(let m=0;m<24;m++){let f=h(0,B),u=h(40,220);w.push(new O(r.clientX,r.clientY,Math.cos(f)*u,Math.sin(f)*u,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){ne||(ne=r);let d=(r-ne)/1e3;ne=r;let m=re(d,0,.033)*(oe?le:0);Oe(m),Ke(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{O as Particle,ue as SPEED_STEPS,xe as ShipV,Ee as bullets,be as chooseShipTypeAndCfg,Ve as createShipFromUI,G as flashes,j as healthFlashes,ut as initRenderer,xt as initRendererUI,ne as lastTime,J as levelFlashes,w as particles,he as randomShipType,Ke as render,oe as running,pe as score,Z as shieldFlashes,T as ships,V as shipsVMap,ae as showTrails,Oe as simulate,le as speed,me as stars,L as state,I as teamColor,pt as testHelpers,D as toast,mt as updateUI};

</script>
<script type="module">
var _e=Object.defineProperty;var Ce=(n,i,s)=>i in n?_e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var ve=(n,i,s)=>Ce(n,typeof i!="symbol"?i+"":i,s);var Pe=!1,ce=123456789,Le=1664525,we=1013904223,Ie=4294967296,Be=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),He=!!Be;function Ae(){if(!Pe){if(He)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return ce=Le*ce+we>>>0,ce/Ie}function h(n=0,i=1){if(typeof n!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return n+(i-n)*Ae()}function te(n,i){if(!Number.isFinite(n)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(n,i+1))}var b={RED:0,BLUE:1};function se(n){switch(n){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":{let s=h(3.5,6)*h(.8,1.4),t=Math.max(1,Math.floor(h(1,3)));return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchCooldown:s,launchAmount:t}}case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var de=class{constructor(i,s,t,l,o,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=o,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},ie=class ie{constructor(i,s,t,l="corvette",o){if(!o)throw new Error("Ship constructor requires a precomputed cfg. Call getClassConfig(type) and pass it to the constructor or use createShipWithConfig.");this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l,this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=ie._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchCooldown,this.launchAmount=o.launchAmount):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,g=o.y-this.y,c=a*a+g*g;c<l&&c<t&&(t=c,s=o)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,o=0;if(t){let x=t.x-this.x,E=t.y-this.y,r=Math.hypot(x,E)||1,d=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*d,f=t.y+(t.vy||0)*d,u=m-this.x,P=f-this.y,v=Math.hypot(u,P)||1;if(l+=u/v*this.accel,o+=P/v*this.accel,r<this.range){let C=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&C>0){let k=300+h(-20,20),q=x/r,O=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],W=new de(this.x+q*12,this.y+O*12,q*k+this.vx*.2,O*k+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),F.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,g=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,d=E*E+r*r;if(d<_*_&&d>1){let m=Math.sqrt(d);a+=E/m,g+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=l*i,this.vy+=o*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let x=this.maxSpeed/p;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ve(ie,"_id",1);var fe=ie;function X(n,i,s,t="corvette",l){return new fe(n,i,s,t,l)}function Te(n,i,s={W:800,H:600}){n.ships=n.ships||[],n.bullets=n.bullets||[],n.explosions=n.explosions||[],n.shieldHits=n.shieldHits||[],n.healthHits=n.healthHits||[],n.score=n.score||{red:0,blue:0};for(let t of n.ships)t.alive&&t.update(i,n.ships,n.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=t+a*2:o.x>t+a&&(o.x-=t+a*2),o.y<-a?o.y+=l+a*2:o.y>l+a&&(o.y-=l+a*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l;o++){let a=h(0,Math.PI*2),g=t.radius+12+h(4,12),c=t.x+Math.cos(a)*g,_=t.y+Math.sin(a)*g,p=se("fighter"),x=X(t.team,c,_,"fighter",p),E=h(40,120);x.vx=Math.cos(a)*E+(t.vx||0)*.2,x.vy=Math.sin(a)*E+(t.vy||0)*.2,n.ships.push(x)}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];l.update(i),l.alive(s)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===l.team)continue;let a=o.x-l.x,g=o.y-l.y,c=a*a+g*g,_=o.radius+l.radius;if(c<_*_){let p=l.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(p),d=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(d>0&&n.shieldHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:d}),m>0&&n.healthHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:m}),l.ownerId!=null){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(p*.05)}if(n.bullets.splice(t,1),r&&n.explosions.push(r),!o.alive&&(l.team===0?n.score.red++:n.score.blue++,l.ownerId!=null)){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(20+(o.level||1)*.2)}break}}}}function re(){let n=be(),i=se(n);return{type:n,cfg:i}}var N,e,y,M;function ut(){N=document.getElementById("world"),e=N.getContext("2d"),y=N.width=window.innerWidth,M=N.height=window.innerHeight,Ye(),window.addEventListener("resize",()=>{y=N.width=window.innerWidth,M=N.height=window.innerHeight})}function ye(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],G=[],z=[],Z=[],j=[],Y=new Map,T=[],Ee=[],ne=0,oe=!1,le=1,ae=!0,pe={red:0,blue:0};var ue=[.5,1,2,4],L={ships:T,bullets:Ee,score:pe,particles:w,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,he=(n,i,s)=>Math.max(i,Math.min(s,n)),K=(n=0,i=1)=>h(n,i);function Ue(n,i,s,t,l,o){let a=Math.min(o,l/2,t/2);n.beginPath(),n.moveTo(i+a,s),n.lineTo(i+t-a,s),n.quadraticCurveTo(i+t,s,i+t,s+a),n.lineTo(i+t,s+l-a),n.quadraticCurveTo(i+t,s+l,i+t-a,s+l),n.lineTo(i+a,s+l),n.quadraticCurveTo(i,s+l,i,s+l-a),n.lineTo(i,s+a),n.quadraticCurveTo(i,s,i+a,s),n.closePath()}function D(n){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=n,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var me=[];function Ye(){if(!Number.isFinite(y)||!Number.isFinite(M))return;me.length=0;let n=[.2,.5,1];for(let i of n)for(let s=0;s<120;s++)me.push({x:K(0,y),y:K(0,M),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,B)})}var I=(n,i=1)=>n===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,Q=["corvette","frigate","destroyer","carrier","fighter"];function be(){if(!Array.isArray(Q)||Q.length===0)return"corvette";let n=he(te(0,Q.length-1),0,Q.length-1);return Q[n]}function Ve(n){let{type:i,cfg:s}=re();if(n===b.RED){let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}else if(n===b.BLUE){let t=h(y*.65,y-40),l=h(80,M-80);T.push(X(b.BLUE,t,l,i,s)),typeof D=="function"&&D(`+1 Blue (${i})`)}else{let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}}var pt={createShipFromUI:Ve,randomShipType:be,chooseShipTypeAndCfg:re,ships:T,state:L},V=class{constructor(i,s,t,l,o,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ye(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},xe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(ye(),!e))return;let s=G.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ae){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new V(r,d,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,I(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=I(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=I(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,B),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,B),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,B),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,d,0,B);let m=e.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let f of z){if(f.id!==i.id)continue;let u=Math.max(0,Math.min(1,f.life/.22)),P=i.shieldMax&&i.shieldMax>0?f.amount/i.shieldMax:Math.min(1,f.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,P)),k=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*v),q=f.angle-k/2,O=f.angle+k/2,F=d+4*(1-u)+2*v;e.beginPath(),e.arc(i.x,i.y,F,q,O),e.lineWidth=(3+6*u)*(1+4*v);let W=Math.min(1,.25+u*(.9+1.6*v));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*v,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),o=Math.max(3,t*.4),a=i.x-l/2,g=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,g,l,o),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,g,l*r,o))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,o);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let f=e.measureText(r).width,u=8,P=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,f+u*2),C=Math.max(o+2,m*.9),k=a-8-v,q=c+o/2-C/2,O=C/2,F=4,W=k-F,Se=q-F,Re=v+F*2,ge=C+F*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",Ue(e,W,Se,Re,ge,ge/2),e.fill(),e.restore();let J=j.find(U=>U.id===i.id&&U.life>0),ee=1;J&&(ee=1+.6*Math.max(0,Math.min(1,J.life/1)));let $=v*ee,H=C*ee,S=k-($-v),R=q-(H-C)/2,A=H/2;if(e.beginPath(),e.moveTo(S+A,R),e.lineTo(S+$-A,R),e.quadraticCurveTo(S+$,R,S+$,R+A),e.lineTo(S+$,R+H-A),e.quadraticCurveTo(S+$,R+H,S+$-A,R+H),e.lineTo(S+A,R+H),e.quadraticCurveTo(S,R+H,S,R+H-A),e.lineTo(S,R+A),e.quadraticCurveTo(S,R,S+A,R),e.closePath(),J){let U=Math.max(.6,Math.min(1,J.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=I(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=I(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*ee)}px Inter, system-ui, sans-serif`,e.fillText(r,S+$/2,R+H/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),d=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-d*r)),f=Math.floor(60+160*(1-r*d));E=`rgba(${Math.min(255,m)},${Math.min(255,f)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.clip(),e.fillStyle=E,e.fillRect(a,c,l*_,o))}};function mt(){}function Oe(n){if(Te(L,n,{W:y,H:M}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let t=T.find(l=>l.id===s.id);if(t){Z.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let o=h(0,B),a=h(40,120);w.push(new V(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let t=T.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);z.push({id:t.id,angle:l,life:.22,amount:s.amount}),G.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(n),t.life<=0&&w.splice(s,1)}for(let s=G.length-1;s>=0;s--){let t=G[s];t.life-=n,t.r+=600*n,t.life<=0&&G.splice(s,1)}for(let s=z.length-1;s>=0;s--){let t=z[s];t.life-=n,t.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=n,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=n,t.life<=0&&j.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(Y.has(s.id)){let t=Y.get(s.id);if(t.level!==s.level){j.push({id:s.id,life:1});for(let l=0;l<18;l++){let o=h(0,B),a=h(60,240);w.push(new V(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*a,Math.sin(o)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new xe(s);t.level=s.level,Y.set(s.id,t)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Ke(){if(ye(),typeof e>"u"||!e)return;e.clearRect(0,0,y,M);let n=e.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=n,e.fillRect(0,0,y,M);for(let t of me){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=he(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of G){let l=he(t.life/.25,0,1);e.strokeStyle=I(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,B),e.stroke()}for(let t of Ee)e.save(),e.shadowBlur=12,e.shadowColor=I(t.team,.9),e.fillStyle=I(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,B),e.fill(),e.restore();for(let t of w)t.draw();for(let t of Y.values())t.draw();let i=T.some(t=>t.alive&&t.team===b.RED),s=T.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?I(b.RED,.95):s?I(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function xt(){if(typeof document>"u")return;let n=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),p=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${pe.red}`),g&&(g.textContent=`Blue ${pe.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${Ee.length}  Particles: ${w.length}`)}n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{oe=!oe,n.textContent=oe?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let{type:r,cfg:d}=re(),m=h(40,y*.35),f=h(80,M-80);T.push(X(b.RED,m,f,r,d)),D(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let{type:r,cfg:d}=re(),m=h(y*.65,y-40),f=h(80,M-80);T.push(X(b.BLUE,m,f,r,d)),D(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{ae=!ae,l.textContent=`\u2604 Trails: ${ae?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ue.indexOf(le)+1)%ue.length;le=ue[r],o.textContent=`Speed: ${le}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=te(0,4294967295),d=prompt("Enter numeric seed (32-bit):",r);d!==null&&reset(Number(d))}),p&&typeof p.addEventListener=="function"&&p.addEventListener("click",()=>{let r=T.filter(u=>u.alive&&u.team===b.RED),d=T.filter(u=>u.alive&&u.team===b.BLUE),m=20,f=6;r.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.25-v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),d.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.75+v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),D("Fleets re-formed")}),N&&typeof N.addEventListener=="function"&&N.addEventListener("click",r=>{G.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:te(0,1)});for(let m=0;m<24;m++){let f=h(0,B),u=h(40,220);w.push(new V(r.clientX,r.clientY,Math.cos(f)*u,Math.sin(f)*u,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){ne||(ne=r);let d=(r-ne)/1e3;ne=r;let m=he(d,0,.033)*(oe?le:0);Oe(m),Ke(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{V as Particle,ue as SPEED_STEPS,xe as ShipV,Ee as bullets,re as chooseShipTypeAndCfg,Ve as createShipFromUI,G as flashes,Z as healthFlashes,ut as initRenderer,xt as initRendererUI,ne as lastTime,j as levelFlashes,w as particles,be as randomShipType,Ke as render,oe as running,pe as score,z as shieldFlashes,T as ships,Y as shipsVMap,ae as showTrails,Oe as simulate,le as speed,me as stars,L as state,I as teamColor,pt as testHelpers,D as toast,mt as updateUI};

</script>
</body>
</html>