<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
  /* moved inline styles into CSS to satisfy linter */
  #bottomRight .continuous-label { color: var(--ui-color,#eaeff8); margin-right: 6px; }
  #bottomRight .muted { opacity: .7; }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
  <input id="continuousCheckbox" type="checkbox" />
  <label for="continuousCheckbox" class="continuous-label">Continuous</label>
  <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span class="muted">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  

















































<!-- BEGIN_INLINED_BUNDLE -->
<script type="module">
var pe=Object.defineProperty;var qe=(i,e,o)=>e in i?pe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var Ve=(i,e)=>()=>(i&&(e=i(i=0)),e);var ve=(i,e)=>{for(var o in e)pe(i,o,{get:e[o],enumerable:!0})};var Ae=(i,e,o)=>qe(i,typeof e!="symbol"?e+"":e,o);var De={};ve(De,{createWebGLRenderer:()=>Ce,default:()=>hi});function Pe(i,e,o){let s=i.createShader(e);if(i.shaderSource(s,o),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS)){let a=i.getShaderInfoLog(s);throw i.deleteShader(s),new Error("Shader compile error: "+a)}return s}function Le(i,e,o){let s=Pe(i,i.VERTEX_SHADER,e),a=Pe(i,i.FRAGMENT_SHADER,o),t=i.createProgram();if(i.attachShader(t,s),i.attachShader(t,a),i.linkProgram(t),!i.getProgramParameter(t,i.LINK_STATUS)){let n=i.getProgramInfoLog(t);throw i.deleteProgram(t),new Error("Program link error: "+n)}return t}function Ce(i,e={}){let{webgl2:o=!1}=e,s=e.atlasAccessor||null,a=e.atlasLODs||[12,20,36],t=null,n=null,f=null,h=null,c=null,l=null,A=null,p=null,y=null,R=null,b=null,D=null,x=null,w=null,B=null,d=null,I=!1,H=1,tt=null;return{type:"webgl",webgl2:o,init(){try{if(t=i.getContext(o?"webgl2":"webgl"),!t)return;H=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,i.width=Math.max(1,Math.floor((i.clientWidth||i.width)*H)),i.height=Math.max(1,Math.floor((i.clientHeight||i.height)*H));let X="clamp(max(0.5, v_radius * 0.01), 0.5, 3.0)",gt=`
          attribute vec2 a_quadPos; // -0.5..0.5 unit quad
          attribute vec2 a_instPos; // per-instance pixel center
          attribute vec3 a_instColor;
          attribute float a_instSize; // ship radius in pixels
          attribute float a_instAngle; // ship orientation (radians)
          attribute float a_instShield; // shield fraction 0..1
          attribute float a_instType; // shape type id
          uniform vec2 u_resolution;
          varying vec3 v_color;
          varying vec2 v_local; // local space after scale & rotation (diameter scale)
          varying float v_shield;
          varying float v_radius;
          varying float v_type;
          varying float v_angle;
          void main(){
            float c = cos(a_instAngle);
            float s = sin(a_instAngle);
            vec2 rotated = vec2(
              a_quadPos.x * c - a_quadPos.y * s,
              a_quadPos.x * s + a_quadPos.y * c
            );
              vec2 pixelPos = a_instPos + rotated * a_instSize * 2.0; // diameter scaling (vertex position)
            vec2 zeroToOne = pixelPos / u_resolution;
            vec2 clip = zeroToOne * 2.0 - 1.0;
            gl_Position = vec4(clip * vec2(1.0, -1.0), 0.0, 1.0);
            v_color = a_instColor;
              // v_local should be in pixels from center to match v_radius (radius in pixels).
              // Use scale = a_instSize (radius) so length(v_local) ranges ~0..v_radius.
              v_local = rotated * a_instSize; // used for circle SDF (pixels)
            v_shield = a_instShield;
            v_radius = a_instSize;
            v_type = a_instType;
            v_angle = a_instAngle;
          }
        `,pt=`precision mediump float;
          varying vec3 v_color;
          varying vec2 v_local;
          varying float v_shield;
          varying float v_radius; // true circle radius in pixels
          varying float v_type;
          varying float v_angle;
          void main(){
            float d = length(v_local); // distance from center
            float edge = ${X}; // widen edge slightly for smoother look
            // Shape modulation: vary effective radius by angle to approximate different hull silhouettes.
            float theta = atan(v_local.y, v_local.x) - v_angle;
            float modFactor = 1.0;
            // type mapping: 0 circle, 1 corvette (arrow), 2 frigate (sleek), 3 destroyer (broad), 4 carrier (ellipse), 5 fighter (small triangle)
            if (v_type < 0.5) {
              modFactor = 1.0; // circle
            } else if (v_type < 1.5) {
              // corvette: pointed front \u2014 use 3-lobed variation
              modFactor = 1.0 + 0.45 * cos(3.0 * theta);
            } else if (v_type < 2.5) {
              // frigate: smoother elongation
              modFactor = 1.0 + 0.20 * cos(2.0 * theta);
            } else if (v_type < 3.5) {
              // destroyer: wider body with subtle faceting
              modFactor = 1.0 + 0.28 * cos(4.0 * theta);
            } else if (v_type < 4.5) {
              // carrier: near-ellipse (scale x by 1.6)
              // emulate by shrinking radius along lateral axis
              float ex = cos(theta);
              float ey = sin(theta);
              float scale = 1.0 + 0.6 * ex * ex; // wider on x
              modFactor = scale;
            } else {
              // fighter: small pointed triangle-ish
              modFactor = 1.0 + 0.6 * cos(3.0 * theta);
            }
            float effRadius = v_radius * modFactor;
            float alpha = 1.0 - smoothstep(effRadius - edge, effRadius + edge, d);
            if (alpha <= 0.001) discard;
            vec3 base = v_color;
            // Optional shield ring: show thin ring if shield fraction > 0
            if (v_shield > 0.0) {
              float ringOuter = v_radius * 1.05; // just outside body
              float ringInner = v_radius * 0.90; // inside overlap
              float ringEdge = ${X};
              float ringMask = smoothstep(ringInner - ringEdge, ringInner + ringEdge, d) * (1.0 - smoothstep(ringOuter - ringEdge, ringOuter + ringEdge, d));
              // ring color blend (cyan-like) scaled by shield fraction
              vec3 ringColor = mix(base, vec3(0.3,0.9,1.0), 0.6 * v_shield);
              base = mix(base, ringColor, clamp(ringMask,0.0,1.0));
            }
            gl_FragColor = vec4(base, alpha);
          }
        `;n=Le(t,gt,pt);let lt=`
          attribute vec2 a_quadPos;
          attribute vec2 a_instPos;
          attribute vec3 a_instColor;
          attribute float a_instSize;
          attribute float a_instAngle;
          attribute float a_instShield;
          uniform vec2 u_resolution;
          varying vec2 v_uv;
          varying vec3 v_color;
          varying float v_shield;
          void main(){
            float c = cos(a_instAngle);
            float s = sin(a_instAngle);
            vec2 rotated = vec2(
              a_quadPos.x * c - a_quadPos.y * s,
              a_quadPos.x * s + a_quadPos.y * c
            );
            vec2 pixelPos = a_instPos + rotated * a_instSize * 2.0;
            vec2 zeroToOne = pixelPos / u_resolution;
            vec2 clip = zeroToOne * 2.0 - 1.0;
            gl_Position = vec4(clip * vec2(1.0, -1.0), 0.0, 1.0);
            v_uv = a_quadPos + vec2(0.5, 0.5);
            v_color = a_instColor;
            v_shield = a_instShield;
          }
        `,Lt=`precision mediump float;
          varying vec2 v_uv;
          varying vec3 v_color;
          varying float v_shield;
          uniform sampler2D u_atlas;
          void main(){
            vec4 tex = texture2D(u_atlas, v_uv);
            float alpha = tex.a * tex.r; // atlas is white/alpha mask; use r as mask fallback
            if (alpha <= 0.001) discard;
            vec3 col = v_color * tex.rgb;
            // subtle shield tint
            if (v_shield > 0.0) col = mix(col, vec3(0.3,0.9,1.0), 0.25 * v_shield);
            gl_FragColor = vec4(col, alpha);
          }
        `,z=null;try{z=Le(t,lt,Lt)}catch{z=null}f=t.createBuffer();let mt=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,mt,t.STATIC_DRAW),h=t.createBuffer(),c=t.createBuffer(),l=t.createBuffer(),A=t.createBuffer(),p=t.createBuffer(),y=t.createBuffer(),R=t.createBuffer(),b=t.createBuffer(),D=t.createBuffer(),x=t.createBuffer(),w=t.createBuffer(),d=null,o||(d=t.getExtension("ANGLE_instanced_arrays")),this.a_quadPos=t.getAttribLocation(n,"a_quadPos"),this.a_instPos=t.getAttribLocation(n,"a_instPos"),this.a_instColor=t.getAttribLocation(n,"a_instColor"),this.a_instSize=t.getAttribLocation(n,"a_instSize"),this.a_instAngle=t.getAttribLocation(n,"a_instAngle"),this.a_instShield=t.getAttribLocation(n,"a_instShield"),this.a_instType=t.getAttribLocation(n,"a_instType"),this.u_resolution=t.getUniformLocation(n,"u_resolution"),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),B=t.createTexture(),t.bindTexture(t.TEXTURE_2D,B);let yt=new Uint8Array([255,255,255,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,yt),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this._atlasTextures={},this._ensureAtlasTexture=(q,Ct,Y)=>{try{this._atlasTextures[q]=this._atlasTextures[q]||{};let m=String(Ct);if(this._atlasTextures[q][m])return this._atlasTextures[q][m];let T=t.createTexture();return t.bindTexture(t.TEXTURE_2D,T),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Y.canvas),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._atlasTextures[q][m]={tex:T,atlas:Y},this._atlasTextures[q][m]}catch(m){return console.warn("Failed to create atlas texture",m),null}},this._texturedProgram=z,z&&(this._t_a_quadPos=t.getAttribLocation(z,"a_quadPos"),this._t_a_instPos=t.getAttribLocation(z,"a_instPos"),this._t_a_instColor=t.getAttribLocation(z,"a_instColor"),this._t_a_instSize=t.getAttribLocation(z,"a_instSize"),this._t_a_instAngle=t.getAttribLocation(z,"a_instAngle"),this._t_a_instShield=t.getAttribLocation(z,"a_instShield"),this._t_u_resolution=t.getUniformLocation(z,"u_resolution"),this._t_u_atlas=t.getUniformLocation(z,"u_atlas")),typeof window<"u"&&(tt=()=>{let q=window.devicePixelRatio||1;q!==H&&(H=q);let Ct=i.clientWidth||i.width/H,Y=i.clientHeight||i.height/H,m=Math.max(1,Math.floor(Ct*H)),T=Math.max(1,Math.floor(Y*H));(m!==i.width||T!==i.height)&&(i.width=m,i.height=T,t&&t.viewport(0,0,m,T))},window.addEventListener("resize",tt))}catch(X){t=null,console.warn("WebGL init failed:",X.message||X)}},start(X){I=!0,typeof X=="function"&&X()},stop(){I=!1},isRunning(){return I},render(X){if(!t)return;let{W:gt,H:pt,ships:lt,bullets:Lt=[],stars:z=[]}=X,mt=lt.length,yt=Lt.length,q=z.length;if(mt+yt+q===0)return;if(t.viewport(0,0,i.width,i.height),t.clearColor(.02,.02,.03,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(n),t.uniform2f(this.u_resolution,gt,pt),t.bindBuffer(t.ARRAY_BUFFER,f),this.a_quadPos>=0&&(t.enableVertexAttribArray(this.a_quadPos),t.vertexAttribPointer(this.a_quadPos,2,t.FLOAT,!1,0,0)),s&&this._texturedProgram){let m=Object.create(null);for(let T=0;T<mt;T++){let M=lt[T],N=s?s(M.type,M.radius||8):null;if(!N)continue;let W=M.type+"|"+String(N.baseRadius)+"|"+String(N.size||N.canvas&&N.canvas.width),V=m[W];V||(V=m[W]={atlas:N,ships:[]}),V.ships.push(M)}for(let T in m){let M=m[T],N=M.atlas,W=this._ensureAtlasTexture?this._ensureAtlasTexture(M.ships[0].type,N.baseRadius,N):null;if(!W)continue;let V=W.tex||W,E=M.ships.length,u=new Float32Array(E*2),_=new Float32Array(E*3),$=new Float32Array(E),U=new Float32Array(E),ht=new Float32Array(E);for(let S=0;S<E;S++){let F=M.ships[S];u[S*2]=F.x,u[S*2+1]=F.y,_[S*3]=F.team===0?1:.31,_[S*3+1]=F.team===0?.35:.63,_[S*3+2]=F.team===0?.35:1,$[S]=F.radius||8,U[S]=F.vx||F.vy?Math.atan2(F.vy,F.vx):F.angle||0;let at=0;typeof F.shield=="number"&&typeof F.shieldMax=="number"&&F.shieldMax>0&&(at=Math.min(1,Math.max(0,F.shield/F.shieldMax))),ht[S]=at}if(t.useProgram(this._texturedProgram),t.uniform2f(this._t_u_resolution,gt,pt),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,V),this._t_u_atlas&&t.uniform1i(this._t_u_atlas,0),t.bindBuffer(t.ARRAY_BUFFER,f),this._t_a_quadPos>=0&&(t.enableVertexAttribArray(this._t_a_quadPos),t.vertexAttribPointer(this._t_a_quadPos,2,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,u,t.DYNAMIC_DRAW),this._t_a_instPos>=0&&(t.enableVertexAttribArray(this._t_a_instPos),t.vertexAttribPointer(this._t_a_instPos,2,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,_,t.DYNAMIC_DRAW),this._t_a_instColor>=0&&(t.enableVertexAttribArray(this._t_a_instColor),t.vertexAttribPointer(this._t_a_instColor,3,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,$,t.DYNAMIC_DRAW),this._t_a_instSize>=0&&(t.enableVertexAttribArray(this._t_a_instSize),t.vertexAttribPointer(this._t_a_instSize,1,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,A),t.bufferData(t.ARRAY_BUFFER,U,t.DYNAMIC_DRAW),this._t_a_instAngle>=0&&(t.enableVertexAttribArray(this._t_a_instAngle),t.vertexAttribPointer(this._t_a_instAngle,1,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,ht,t.DYNAMIC_DRAW),this._t_a_instShield>=0&&(t.enableVertexAttribArray(this._t_a_instShield),t.vertexAttribPointer(this._t_a_instShield,1,t.FLOAT,!1,0,0)),o)this._t_a_instPos>=0&&t.vertexAttribDivisor(this._t_a_instPos,1),this._t_a_instColor>=0&&t.vertexAttribDivisor(this._t_a_instColor,1),this._t_a_instSize>=0&&t.vertexAttribDivisor(this._t_a_instSize,1),this._t_a_instAngle>=0&&t.vertexAttribDivisor(this._t_a_instAngle,1),this._t_a_instShield>=0&&t.vertexAttribDivisor(this._t_a_instShield,1),t.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,E),this._t_a_instPos>=0&&t.vertexAttribDivisor(this._t_a_instPos,0),this._t_a_instColor>=0&&t.vertexAttribDivisor(this._t_a_instColor,0),this._t_a_instSize>=0&&t.vertexAttribDivisor(this._t_a_instSize,0),this._t_a_instAngle>=0&&t.vertexAttribDivisor(this._t_a_instAngle,0),this._t_a_instShield>=0&&t.vertexAttribDivisor(this._t_a_instShield,0);else if(d)this._t_a_instPos>=0&&d.vertexAttribDivisorANGLE(this._t_a_instPos,1),this._t_a_instColor>=0&&d.vertexAttribDivisorANGLE(this._t_a_instColor,1),this._t_a_instSize>=0&&d.vertexAttribDivisorANGLE(this._t_a_instSize,1),this._t_a_instAngle>=0&&d.vertexAttribDivisorANGLE(this._t_a_instAngle,1),this._t_a_instShield>=0&&d.vertexAttribDivisorANGLE(this._t_a_instShield,1),d.drawArraysInstancedANGLE(t.TRIANGLE_STRIP,0,4,E),this._t_a_instPos>=0&&d.vertexAttribDivisorANGLE(this._t_a_instPos,0),this._t_a_instColor>=0&&d.vertexAttribDivisorANGLE(this._t_a_instColor,0),this._t_a_instSize>=0&&d.vertexAttribDivisorANGLE(this._t_a_instSize,0),this._t_a_instAngle>=0&&d.vertexAttribDivisorANGLE(this._t_a_instAngle,0),this._t_a_instShield>=0&&d.vertexAttribDivisorANGLE(this._t_a_instShield,0);else for(let S=0;S<E;S++){let F=u[S*2+0],at=u[S*2+1],bt=_[S*3+0],ze=_[S*3+1],Ye=_[S*3+2],We=$[S],Oe=U[S],Xe=ht[S];this._t_a_instPos>=0&&t.vertexAttrib2f(this._t_a_instPos,F,at),this._t_a_instColor>=0&&t.vertexAttrib3f(this._t_a_instColor,bt,ze,Ye),this._t_a_instSize>=0&&t.vertexAttrib1f(this._t_a_instSize,We),this._t_a_instAngle>=0&&t.vertexAttrib1f(this._t_a_instAngle,Oe),this._t_a_instShield>=0&&t.vertexAttrib1f(this._t_a_instShield,Xe),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}t.useProgram(n)}else{let m=mt;if(m>0){let T=new Float32Array(m*2),M=new Float32Array(m*3),N=new Float32Array(m),W=new Float32Array(m),V=new Float32Array(m),E=new Float32Array(m);for(let u=0;u<m;u++){let _=lt[u];T[u*2]=_.x,T[u*2+1]=_.y,M[u*3]=_.team===0?1:.31,M[u*3+1]=_.team===0?.35:.63,M[u*3+2]=_.team===0?.35:1,N[u]=_.radius||8,W[u]=_.vx||_.vy?Math.atan2(_.vy,_.vx):_.angle||0;let $=0;typeof _.shield=="number"&&typeof _.shieldMax=="number"&&_.shieldMax>0&&($=Math.min(1,Math.max(0,_.shield/_.shieldMax))),V[u]=$;let U=1;_.type==="corvette"?U=1:_.type==="frigate"?U=2:_.type==="destroyer"?U=3:_.type==="carrier"?U=4:_.type==="fighter"&&(U=5),E[u]=U}if(t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,T,t.DYNAMIC_DRAW),this.a_instPos>=0&&(t.enableVertexAttribArray(this.a_instPos),t.vertexAttribPointer(this.a_instPos,2,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,M,t.DYNAMIC_DRAW),this.a_instColor>=0&&(t.enableVertexAttribArray(this.a_instColor),t.vertexAttribPointer(this.a_instColor,3,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,N,t.DYNAMIC_DRAW),this.a_instSize>=0&&(t.enableVertexAttribArray(this.a_instSize),t.vertexAttribPointer(this.a_instSize,1,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,A),t.bufferData(t.ARRAY_BUFFER,W,t.DYNAMIC_DRAW),this.a_instAngle>=0&&(t.enableVertexAttribArray(this.a_instAngle),t.vertexAttribPointer(this.a_instAngle,1,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,V,t.DYNAMIC_DRAW),this.a_instShield>=0&&(t.enableVertexAttribArray(this.a_instShield),t.vertexAttribPointer(this.a_instShield,1,t.FLOAT,!1,0,0)),this.a_instType>=0&&(t.bindBuffer(t.ARRAY_BUFFER,w),t.bufferData(t.ARRAY_BUFFER,E,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.a_instType),t.vertexAttribPointer(this.a_instType,1,t.FLOAT,!1,0,0)),o)this.a_instPos>=0&&t.vertexAttribDivisor(this.a_instPos,1),this.a_instColor>=0&&t.vertexAttribDivisor(this.a_instColor,1),this.a_instSize>=0&&t.vertexAttribDivisor(this.a_instSize,1),this.a_instAngle>=0&&t.vertexAttribDivisor(this.a_instAngle,1),this.a_instShield>=0&&t.vertexAttribDivisor(this.a_instShield,1),this.a_instType>=0&&t.vertexAttribDivisor(this.a_instType,1),t.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,m),this.a_instPos>=0&&t.vertexAttribDivisor(this.a_instPos,0),this.a_instColor>=0&&t.vertexAttribDivisor(this.a_instColor,0),this.a_instSize>=0&&t.vertexAttribDivisor(this.a_instSize,0),this.a_instAngle>=0&&t.vertexAttribDivisor(this.a_instAngle,0),this.a_instShield>=0&&t.vertexAttribDivisor(this.a_instShield,0),this.a_instType>=0&&t.vertexAttribDivisor(this.a_instType,0);else if(d)this.a_instPos>=0&&d.vertexAttribDivisorANGLE(this.a_instPos,1),this.a_instColor>=0&&d.vertexAttribDivisorANGLE(this.a_instColor,1),this.a_instSize>=0&&d.vertexAttribDivisorANGLE(this.a_instSize,1),this.a_instAngle>=0&&d.vertexAttribDivisorANGLE(this.a_instAngle,1),this.a_instShield>=0&&d.vertexAttribDivisorANGLE(this.a_instShield,1),this.a_instType>=0&&d.vertexAttribDivisorANGLE(this.a_instType,1),d.drawArraysInstancedANGLE(t.TRIANGLE_STRIP,0,4,m),this.a_instPos>=0&&d.vertexAttribDivisorANGLE(this.a_instPos,0),this.a_instColor>=0&&d.vertexAttribDivisorANGLE(this.a_instColor,0),this.a_instSize>=0&&d.vertexAttribDivisorANGLE(this.a_instSize,0),this.a_instAngle>=0&&d.vertexAttribDivisorANGLE(this.a_instAngle,0),this.a_instShield>=0&&d.vertexAttribDivisorANGLE(this.a_instShield,0),this.a_instType>=0&&d.vertexAttribDivisorANGLE(this.a_instType,0);else for(let u=0;u<m;u++){let _=T[u*2+0],$=T[u*2+1],U=M[u*3+0],ht=M[u*3+1],S=M[u*3+2],F=N[u],at=W[u],bt=V[u];this.a_instPos>=0&&t.vertexAttrib2f(this.a_instPos,_,$),this.a_instColor>=0&&t.vertexAttrib3f(this.a_instColor,U,ht,S),this.a_instSize>=0&&t.vertexAttrib1f(this.a_instSize,F),this.a_instAngle>=0&&t.vertexAttrib1f(this.a_instAngle,at),this.a_instShield>=0&&t.vertexAttrib1f(this.a_instShield,bt),this.a_instType>=0&&t.vertexAttrib1f(this.a_instType,E[u]),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}}let Y=yt+q;if(Y>0){let m=new Float32Array(Y*2),T=new Float32Array(Y*3),M=new Float32Array(Y),N=new Float32Array(Y),W=new Float32Array(Y),V=new Float32Array(Y),E=0;for(let u=0;u<yt;u++,E++){let _=Lt[u];m[E*2]=_.x,m[E*2+1]=_.y,T[E*3]=_.team===0?1:.35,T[E*3+1]=_.team===0?.35:.63,T[E*3+2]=_.team===0?.35:1,M[E]=_.radius||2.2,N[E]=_.vx||_.vy?Math.atan2(_.vy,_.vx):0,W[E]=0,V[E]=0}for(let u=0;u<q;u++,E++){let _=z[u];m[E*2]=_.x,m[E*2+1]=_.y;let $=_.phase!=null?.6+.4*Math.sin(_.phase):1,U=.85+.15*$;T[E*3]=U,T[E*3+1]=U,T[E*3+2]=1,M[E]=(_.r||1)+.5*$,N[E]=0,W[E]=0,V[E]=0}if(t.bindBuffer(t.ARRAY_BUFFER,y),t.bufferData(t.ARRAY_BUFFER,m,t.DYNAMIC_DRAW),this.a_instPos>=0&&(t.enableVertexAttribArray(this.a_instPos),t.vertexAttribPointer(this.a_instPos,2,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,R),t.bufferData(t.ARRAY_BUFFER,T,t.DYNAMIC_DRAW),this.a_instColor>=0&&(t.enableVertexAttribArray(this.a_instColor),t.vertexAttribPointer(this.a_instColor,3,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,b),t.bufferData(t.ARRAY_BUFFER,M,t.DYNAMIC_DRAW),this.a_instSize>=0&&(t.enableVertexAttribArray(this.a_instSize),t.vertexAttribPointer(this.a_instSize,1,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,D),t.bufferData(t.ARRAY_BUFFER,N,t.DYNAMIC_DRAW),this.a_instAngle>=0&&(t.enableVertexAttribArray(this.a_instAngle),t.vertexAttribPointer(this.a_instAngle,1,t.FLOAT,!1,0,0)),t.bindBuffer(t.ARRAY_BUFFER,x),t.bufferData(t.ARRAY_BUFFER,W,t.DYNAMIC_DRAW),this.a_instShield>=0&&(t.enableVertexAttribArray(this.a_instShield),t.vertexAttribPointer(this.a_instShield,1,t.FLOAT,!1,0,0)),this.a_instType>=0&&(t.bindBuffer(t.ARRAY_BUFFER,w),t.bufferData(t.ARRAY_BUFFER,V,t.DYNAMIC_DRAW),t.enableVertexAttribArray(this.a_instType),t.vertexAttribPointer(this.a_instType,1,t.FLOAT,!1,0,0)),o)this.a_instPos>=0&&t.vertexAttribDivisor(this.a_instPos,1),this.a_instColor>=0&&t.vertexAttribDivisor(this.a_instColor,1),this.a_instSize>=0&&t.vertexAttribDivisor(this.a_instSize,1),this.a_instAngle>=0&&t.vertexAttribDivisor(this.a_instAngle,1),this.a_instShield>=0&&t.vertexAttribDivisor(this.a_instShield,1),this.a_instType>=0&&t.vertexAttribDivisor(this.a_instType,1),t.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,Y),this.a_instPos>=0&&t.vertexAttribDivisor(this.a_instPos,0),this.a_instColor>=0&&t.vertexAttribDivisor(this.a_instColor,0),this.a_instSize>=0&&t.vertexAttribDivisor(this.a_instSize,0),this.a_instAngle>=0&&t.vertexAttribDivisor(this.a_instAngle,0),this.a_instShield>=0&&t.vertexAttribDivisor(this.a_instShield,0),this.a_instType>=0&&t.vertexAttribDivisor(this.a_instType,0);else if(d)this.a_instPos>=0&&d.vertexAttribDivisorANGLE(this.a_instPos,1),this.a_instColor>=0&&d.vertexAttribDivisorANGLE(this.a_instColor,1),this.a_instSize>=0&&d.vertexAttribDivisorANGLE(this.a_instSize,1),this.a_instAngle>=0&&d.vertexAttribDivisorANGLE(this.a_instAngle,1),this.a_instShield>=0&&d.vertexAttribDivisorANGLE(this.a_instShield,1),this.a_instType>=0&&d.vertexAttribDivisorANGLE(this.a_instType,1),d.drawArraysInstancedANGLE(t.TRIANGLE_STRIP,0,4,Y),this.a_instPos>=0&&d.vertexAttribDivisorANGLE(this.a_instPos,0),this.a_instColor>=0&&d.vertexAttribDivisorANGLE(this.a_instColor,0),this.a_instSize>=0&&d.vertexAttribDivisorANGLE(this.a_instSize,0),this.a_instAngle>=0&&d.vertexAttribDivisorANGLE(this.a_instAngle,0),this.a_instShield>=0&&d.vertexAttribDivisorANGLE(this.a_instShield,0),this.a_instType>=0&&d.vertexAttribDivisorANGLE(this.a_instType,0);else for(let u=0;u<Y;u++){let _=m[u*2+0],$=m[u*2+1],U=T[u*3+0],ht=T[u*3+1],S=T[u*3+2],F=M[u],at=N[u],bt=W[u];this.a_instPos>=0&&t.vertexAttrib2f(this.a_instPos,_,$),this.a_instColor>=0&&t.vertexAttrib3f(this.a_instColor,U,ht,S),this.a_instSize>=0&&t.vertexAttrib1f(this.a_instSize,F),this.a_instAngle>=0&&t.vertexAttrib1f(this.a_instAngle,at),this.a_instShield>=0&&t.vertexAttrib1f(this.a_instShield,bt),this.a_instType>=0&&t.vertexAttrib1f(this.a_instType,V[u]),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}},destroy(){if(t){try{f&&t.deleteBuffer(f),instancePosBuffer&&t.deleteBuffer(instancePosBuffer),instanceColorBuffer&&t.deleteBuffer(instanceColorBuffer),instanceSizeBuffer&&t.deleteBuffer(instanceSizeBuffer),instanceAngleBuffer&&t.deleteBuffer(instanceAngleBuffer),instanceShieldBuffer&&t.deleteBuffer(instanceShieldBuffer),instanceTypeBuffer&&t.deleteBuffer(instanceTypeBuffer),n&&t.deleteProgram(n),B&&t.deleteTexture(B)}catch{}t=null}typeof window<"u"&&tt&&window.removeEventListener("resize",tt),I=!1}}}var hi,Be=Ve(()=>{hi={createWebGLRenderer:Ce}});var $t=!1,Dt=123456789;function xe(i){$t=!0,Dt=i>>>0}function me(){$t=!1}function $e(){return $t?(Dt=1664525*Dt+1013904223>>>0,Dt/4294967296):Math.random()}function g(i=0,e=1){return i+(e-i)*$e()}function Et(i,e){return Math.floor(g(i,e+1))}var ye={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},be=1.2,Kt=.6;var v={RED:0,BLUE:1},jt=class{constructor(e,o,s,a,t,n=null){this.x=e,this.y=o,this.vx=s,this.vy=a,this.team=t,this.ownerId=n,this.life=2.5,this.radius=2.2,this.dmg=g(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:o,H:s}=e;return this.x>-50&&this.x<o+50&&this.y>-50&&this.y<s+50}},Bt=class Bt{constructor(e,o,s,a="corvette"){this.team=e,this.x=o,this.y=s,this.vx=0,this.vy=0,this.angle=0,this.type=a;let t={corvette:{radius:8,maxSpeed:g(120,160),accel:240,turn:6.5,hp:g(40,70),reload:g(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:g(90,120),accel:200,turn:5,hp:g(80,120),reload:g(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:g(60,90),accel:150,turn:3.2,hp:g(150,220),reload:g(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:g(40,70),accel:90,turn:2,hp:g(220,300),reload:g(.6,1.2),vision:360,range:260,launchBase:g(3.5,6)},fighter:{radius:6,maxSpeed:g(160,220),accel:300,turn:8,hp:g(18,32),reload:g(.12,.22),vision:180,range:120}},n=t[a]||t.corvette;this.radius=n.radius,this.maxSpeed=n.maxSpeed,this.accel=n.accel,this.turn=n.turn||ye[a]||4.5,this.hpMax=n.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=n.reload,this.vision=n.vision,this.range=n.range,this.id=Bt._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,a==="carrier"?(this.isCarrier=!0,this.launchCooldown=n.launchBase*g(.8,1.4),this.launchAmount=Math.max(1,Math.floor(g(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,o=1.35){return Math.floor(e*Math.pow(o,Math.max(0,this.level-1)))}applyLevel(){let e=.06,o=.1,s=.08;this.hpMax=Math.round(this.baseHpMax*(1+o*(this.level-1)));let a=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(a*(1+s*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let o=null,s=1/0,a=this.vision*this.vision;for(let t of e){if(!t.alive||t.team===this.team)continue;let n=t.x-this.x,f=t.y-this.y,h=n*n+f*f;h<a&&h<s&&(s=h,o=t)}return o}update(e,o){if(!this.alive)return;let s=this.pickTarget(o),a=this.recentHitTimer>0,t=0,n=0,f=1;if(s&&!a){let x=s.x-this.x,w=s.y-this.y;f=Math.hypot(x,w)||1;let B=Math.max(0,Math.min(1.2,f/240)),d=s.x+(s.vx||0)*B,I=s.y+(s.vy||0)*B;t=d-this.x,n=I-this.y;let H=Math.hypot(t,n)||1;t/=H,n/=H}else if(s&&a){let x=s.x-this.x,w=s.y-this.y;f=Math.hypot(x,w)||1,t=-(x/f),n=-(w/f)}else t=Math.cos(this.angle),n=Math.sin(this.angle);let h=0,c=0,l=0,A=26;for(let x of o){if(!x.alive||x===this||x.team!==this.team)continue;let w=this.x-x.x,B=this.y-x.y,d=w*w+B*B;if(d<A*A&&d>1){let I=Math.sqrt(d);h+=w/I,c+=B/I,l++}}l>0&&(h/=l,c/=l);let y=Math.atan2(n,t)-this.angle;for(;y>Math.PI;)y-=2*Math.PI;for(;y<-Math.PI;)y+=2*Math.PI;let R=this.turn*e;y>R?y=R:y<-R&&(y=-R),this.angle+=y;let b=a?this.accel*be:this.accel;this.vx+=Math.cos(this.angle)*b*e,this.vy+=Math.sin(this.angle)*b*e,l>0&&(this.vx+=h*(this.accel*Kt)*e,this.vy+=c*(this.accel*Kt)*e);let D=Math.hypot(this.vx,this.vy);if(D>this.maxSpeed){let x=this.maxSpeed/D;this.vx*=x,this.vy*=x}if(this.x+=this.vx*e,this.y+=this.vy*e,s){let x=s.x-this.x,w=s.y-this.y,B=Math.hypot(x,w)||1;if(B<this.range){let d=Math.cos(this.angle)*(x/B)+Math.sin(this.angle)*(w/B);if(this.cooldown<=0&&d>.2){let I=300+g(-20,20),H=x/B,tt=w/B;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new jt(this.x+H*12,this.y+tt*12,H*I+this.vx*.2,tt*I+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-e))}damage(e){let o=e,s=0;return this.shield>0&&e>0&&(s=Math.min(this.shield,e),this.shield-=s,e-=s),e>0&&(this.hp-=e),(s>0||o>0&&e>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};Ae(Bt,"_id",1);var ot=Bt;function Mt(i,e,o,s,a=80){let t=[];for(let n=0;n<e;n++){let f=n%6*20+g(-10,10),h=Math.floor(n/6)*20+g(-10,10),c=g(0,1),l="corvette";c<.45?l="corvette":c<.75?l="frigate":c<.92?l="destroyer":l="carrier",t.push(new ot(i,o+(i===v.RED?-f:f),s+h,l))}return t}var ae={};ve(ae,{Particle:()=>vt,acquireParticle:()=>Tt,bullets:()=>nt,clamp:()=>Qt,evaluateReinforcement:()=>re,flashes:()=>J,getReinforcementInterval:()=>ie,handleReinforcement:()=>ct,healthFlashes:()=>st,initStars:()=>It,particlePool:()=>ut,particles:()=>Q,processStateEvents:()=>li,releaseParticle:()=>Nt,reset:()=>se,resetReinforcementCooldowns:()=>te,setCarrierLaunchStrategy:()=>ni,setContinuousCheckbox:()=>Ut,setReinforcementInterval:()=>ee,setReinforcementStrategy:()=>ri,setSpawnCompositionStrategy:()=>ai,setToast:()=>si,shieldFlashes:()=>it,ships:()=>L,simulate:()=>oe,stars:()=>dt});function Ee(i,e,o={W:800,H:600}){for(let s of i.ships)s.alive&&s.update(e,i.ships,i.bullets);if(o&&typeof o.W=="number"&&typeof o.H=="number"){let s=o.W,a=o.H;for(let t of i.ships){if(!t.alive)continue;let n=t.radius||0;t.x<-n?t.x+=s+n*2:t.x>s+n&&(t.x-=s+n*2),t.y<-n?t.y+=a+n*2:t.y>a+n&&(t.y-=a+n*2)}}for(let s=i.bullets.length-1;s>=0;s--){let a=i.bullets[s];a.update(e),a.alive(o)||i.bullets.splice(s,1)}for(let s=i.bullets.length-1;s>=0;s--){let a=i.bullets[s];for(let t of i.ships){if(!t.alive||t.team===a.team)continue;let n=t.x-a.x,f=t.y-a.y,h=n*n+f*f,c=t.radius+a.radius;if(h<c*c){let l=a.dmg,A=typeof t.shield=="number"?t.shield:0,p=typeof t.hp=="number"?t.hp:0,y=t.damage(l),R=Math.max(0,A-(typeof t.shield=="number"?t.shield:0)),b=Math.max(0,p-(typeof t.hp=="number"?t.hp:0));R>0&&i&&Array.isArray(i.shieldHits)&&i.shieldHits.push({id:t.id,hitX:a.x,hitY:a.y,team:t.team,amount:R}),b>0&&i&&Array.isArray(i.healthHits)&&i.healthHits.push({id:t.id,hitX:a.x,hitY:a.y,team:t.team,amount:b}),Array.isArray(i.damageEvents)||(i.damageEvents=[]),a.ownerId!=null&&i.damageEvents.push({ownerId:a.ownerId,dmg:l}),i.bullets.splice(s,1),y&&i.explosions&&i.explosions.push(y),t.alive||(Array.isArray(i.killEvents)||(i.killEvents=[]),i.killEvents.push({id:t.id,type:t.type,ownerCarrier:t.ownerCarrier,level:t.level,team:t.team,killerId:a.ownerId,killerTeam:a.team,x:t.x,y:t.y}));break}}}}var Ft=Math.PI*2,ft=(i,e)=>i+(e-i)*Math.random(),Qt=(i,e,o)=>Math.max(e,Math.min(o,i)),Zt=i=>{if(typeof document<"u"){let e=document.getElementById("toast");e&&(e.textContent=i,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400))}};function si(i){Zt=i}var dt=[];function It(){dt.length=0;let i=[.2,.5,1],e=typeof window<"u"?window.innerWidth:1024,o=typeof window<"u"?window.innerHeight:768;for(let s of i)for(let a=0;a<120;a++)dt.push({x:ft(0,e),y:ft(0,o),r:ft(.3,1.8)*s,d:s,tw:ft(.4,1),phase:ft(0,Ft)})}It();var ut=[],Q=[],vt=class{constructor(e,o,s,a,t,n){this.x=e,this.y=o,this.vx=s,this.vy=a,this.life=t,this.max=t,this.color=n}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}};function Tt(i,e,o,s,a,t){let n;return ut.length>0?(n=ut.pop(),n.x=i,n.y=e,n.vx=o,n.vy=s,n.life=a,n.max=a,n.color=t):n=new vt(i,e,o,s,a,t),Q.push(n),n}function Nt(i){ut.length<2e3&&ut.push(i)}var J=[],it=[],st=[],L=[],nt=[],Rt=0,et={[v.RED]:0,[v.BLUE]:0},wt={[v.RED]:0,[v.BLUE]:0};function te(){wt[v.RED]=0,wt[v.BLUE]=0}function ee(i){Rt=Number(i)||0,et[v.RED]=0,et[v.BLUE]=0}function ie(){return Rt}var Jt=null;function Ut(i){Jt=i}function ct(i,e=null){if(!Jt||!Jt.checked)return;let o=2,s=["frigate","corvette","destroyer","carrier"],a=(n,f)=>{for(let h=0;h<f;h++){let c=s[Et(0,s.length-1)],l=typeof window<"u"?window.innerWidth:1024,A=typeof window<"u"?window.innerHeight:768,p=n===v.RED?g(40,Math.max(120,l*.35)):g(Math.max(l*.65,l-240),l-40),y=g(80,Math.max(120,A-80));L.push(new ot(n,p,y,c))}},t=n=>{if(L.filter(h=>h.alive&&h.team===n).length<o&&(wt[n]-=i,wt[n]<=0)){let h=Et(1,6);a(n,h),wt[n]=g(3,8),Zt(`Reinforcements: +${h} ${n===v.RED?"Red":"Blue"}`)}};e===null?(t(v.RED),t(v.BLUE)):t(e)}function se(i=null){if(L.length=0,nt.length=0,Q.length=0,J.length=0,it.length=0,st.length=0,i!==null)xe(i>>>0),Zt(`Seed set to ${i>>>0}`);else try{me()}catch{}let e=typeof window<"u"?window.innerWidth:1024,o=typeof window<"u"?window.innerHeight:768;L.push(...Mt(v.RED,12,e*.25,o*.5)),L.push(...Mt(v.BLUE,12,e*.75,o*.5))}var ne=(i,e,o)=>{let s=[];if(i.launchCooldown-=o,i.launchCooldown<=0){if((Array.isArray(i.activeFighters)?i.activeFighters.length:0)<(i.maxFighters||6)){let t=Math.max(1,Math.floor(i.launchAmount||1));for(let n=0;n<t&&!(i.activeFighters.length>=(i.maxFighters||6));n++){let f=g(0,Ft),h=i.radius+12+g(4,12),c=i.x+Math.cos(f)*h,l=i.y+Math.sin(f)*h,A=new ot(i.team,c,l,"fighter"),p=g(40,120);A.vx=Math.cos(f)*p+(i.vx||0)*.2,A.vy=Math.sin(f)*p+(i.vy||0)*.2,A.ownerCarrier=i.id,i.activeFighters.push(A.id),s.push(A)}}i.launchCooldown=g(2.5,6)}return s};function ni(i){ne=i}var Se=(i,e)=>{ct(i)};function ri(i){Se=i}var oi=(i,e,o,s)=>Mt(i,e,o,s);function ai(i){oi=i}function re(i){if(Rt<=0){ct(i);return}et[v.RED]+=i,et[v.BLUE]+=i,et[v.RED]>=Rt&&(ct(et[v.RED],v.RED),et[v.RED]=0),et[v.BLUE]>=Rt&&(ct(et[v.BLUE],v.BLUE),et[v.BLUE]=0)}function oe(i,e,o){for(let t of dt)t.phase+=i*.8*t.d;for(let t of L){if(!t.alive||!t.isCarrier)continue;let n=ne(t,L,i);if(Array.isArray(n)&&n.length)for(let f of n)L.push(f)}for(let t of L)t.update(i,L);for(let t=nt.length-1;t>=0;t--){let n=nt[t];if(n.update(i),!n.alive()){nt.splice(t,1);continue}}let a={ships:L,bullets:nt,score:{red:0,blue:0},particles:Q,explosions:[],shieldHits:[]};if(Ee(a,i,{W:e,H:o}),a.explosions&&a.explosions.length)for(let t of a.explosions){J.push({x:t.x,y:t.y,r:2,life:.25,team:t.team});for(let n=0;n<20;n++){let f=g(0,Ft),h=g(40,220);Tt(t.x,t.y,Math.cos(f)*h,Math.sin(f)*h,ft(.2,1),"rgba(255,255,255,$a)")}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let t of a.shieldHits){let n=L.find(c=>c.id===t.id),f=n?n.x:t.hitX,h=n?n.y:t.hitY;J.push({x:f,y:h,r:6+Math.min(12,t.amount),life:.12,team:t.team,shieldHit:!0});for(let c=0;c<6;c++){let l=g(0,Ft),A=g(40,120);Tt(t.hitX,t.hitY,Math.cos(l)*A,Math.sin(l)*A,ft(.12,.4),"rgba(200,230,255,$a)")}if(n){let c=Math.atan2(t.hitY-h,t.hitX-f);it.push({id:n.id,angle:c,life:.22,amount:t.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let t of a.healthHits){let n=L.find(f=>f.id===t.id);n&&st.push({id:n.id,life:.45,amount:t.amount})}if(Array.isArray(a.damageEvents)&&a.damageEvents.length){for(let t of a.damageEvents)if(t&&t.ownerId!=null&&typeof t.dmg=="number"){let n=L.find(f=>f.id===t.ownerId);n&&n.gainXp(t.dmg*.05)}}if(Array.isArray(a.killEvents)&&a.killEvents.length){for(let t of a.killEvents)if(t){if(t.killerTeam===v.RED?a.score.red++:t.killerTeam===v.BLUE&&a.score.blue++,t.killerId!=null){let n=L.find(f=>f.id===t.killerId);n&&n.gainXp(20+(t.level||1)*.2)}if(t.type==="fighter"&&typeof t.ownerCarrier=="number"){let n=L.find(f=>f.id===t.ownerCarrier);if(n&&Array.isArray(n.activeFighters)){let f=n.activeFighters.indexOf(t.id);f>=0&&n.activeFighters.splice(f,1)}}if(t.type==="carrier"){let n=t.id;for(let h of L)h.alive&&h.type==="fighter"&&h.ownerCarrier===n&&(h.ownerCarrier=null);let f=L.find(h=>h.id===n);f&&Array.isArray(f.activeFighters)&&(f.activeFighters.length=0)}}}Se(i,L);for(let t=Q.length-1;t>=0;t--){let n=Q[t];n.update(i),n.life<=0&&(Q.splice(t,1),Nt(n))}for(let t=J.length-1;t>=0;t--){let n=J[t];n.life-=i,n.r+=600*i,n.life<=0&&J.splice(t,1)}for(let t=it.length-1;t>=0;t--){let n=it[t];n.life-=i,n.life<=0&&it.splice(t,1)}for(let t=st.length-1;t>=0;t--){let n=st[t];n.life-=i,n.life<=0&&st.splice(t,1)}return{ships:L,bullets:nt,particles:Q,flashes:J,shieldFlashes:it,healthFlashes:st,stars:dt}}function li(i,e=0){if(!(!i||!Array.isArray(i.ships))){for(let o of i.ships){if(!o.alive||!o.isCarrier)continue;let s=ne(o,i.ships,e);if(Array.isArray(s)&&s.length)for(let a of s)i.ships.push(a)}if(Array.isArray(i.damageEvents)&&i.damageEvents.length){for(let o of i.damageEvents)if(o&&o.ownerId!=null&&typeof o.dmg=="number"){let s=i.ships.find(a=>a.id===o.ownerId);s&&s.gainXp(o.dmg*.05)}}if(Array.isArray(i.killEvents)&&i.killEvents.length){for(let o of i.killEvents)if(o){if(i.score||(i.score={red:0,blue:0}),o.killerTeam===v.RED?i.score.red++:o.killerTeam===v.BLUE&&i.score.blue++,o.killerId!=null){let s=i.ships.find(a=>a.id===o.killerId);s&&s.gainXp(20+(o.level||1)*.2)}if(o.type==="fighter"&&typeof o.ownerCarrier=="number"){let s=i.ships.find(a=>a.id===o.ownerCarrier);if(s&&Array.isArray(s.activeFighters)){let a=s.activeFighters.indexOf(o.id);a>=0&&s.activeFighters.splice(a,1)}}if(o.type==="carrier"){let s=o.id;for(let t of i.ships)t.alive&&t.type==="fighter"&&t.ownerCarrier===s&&(t.ownerCarrier=null);let a=i.ships.find(t=>t.id===s);a&&Array.isArray(a.activeFighters)&&(a.activeFighters.length=0)}}}}}typeof window<"u"&&(window.initRenderer=He);var G=null;typeof document<"u"&&(G=document.getElementById("world"));!G&&typeof document<"u"&&(G=document.createElement("canvas"),G.id="world",document.body&&document.body.appendChild(G));if(typeof globalThis.Path2D>"u"){class i{constructor(){}moveTo(){}lineTo(){}quadraticCurveTo(){}ellipse(){}arc(){}closePath(){}}globalThis.Path2D=i}var r=null,k=G&&G.width?G.width=typeof window<"u"?window.innerWidth:1024:1024,O=G&&G.height?G.height=typeof window<"u"?window.innerHeight:768:768;typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",()=>{k=G.width=window.innerWidth,O=G.height=window.innerHeight,Ne(),fi()});var K=Math.PI*2,fe=Qt;function kt(i){let e=document.getElementById("toast");e.textContent=i,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var Fe=dt,fi=It,le=new Map;function ci(i){if(le.has(i))return le.get(i);let e=new Path2D;return i==="corvette"?(e.moveTo(1.5,0),e.lineTo(-1,-.7),e.lineTo(-.4,0),e.lineTo(-1,.7),e.closePath(),e.ellipse(0,0,.35,.25,0,0,K)):i==="frigate"?(e.moveTo(1.6,0),e.quadraticCurveTo(.2,-1.1,-1.1,-.6),e.lineTo(-.6,0),e.lineTo(-1.1,.6),e.quadraticCurveTo(.2,1.1,1.6,0),e.closePath()):i==="destroyer"?(e.moveTo(1.9,0),e.lineTo(.3,-1.1),e.lineTo(-1.4,-.6),e.lineTo(-1.4,.6),e.lineTo(.3,1.1),e.closePath()):i==="carrier"?e.ellipse(0,0,1.6,1,0,0,K):i==="fighter"?(e.moveTo(1.2,0),e.lineTo(-.6,-.45),e.lineTo(-.2,0),e.lineTo(-.6,.45),e.closePath(),e.ellipse(.25,0,.25,.15,0,0,K)):(e.moveTo(1.4,0),e.lineTo(-1,-.8),e.lineTo(-.4,0),e.lineTo(-1,.8),e.closePath()),le.set(i,e),e}var Ot=new Map,_e=[12,20,36];function ge(i,e){let o=Ot.get(i);if(o||(o=new Map,Ot.set(i,o)),o.has(e))return o.get(e);let a=Math.ceil(e*2.2*2+8),t=typeof document<"u"?document.createElement("canvas"):{width:a,height:a,getContext:()=>null};t.width=a,t.height=a;let n=t.getContext&&t.getContext("2d");if(!n){let c={canvas:t,size:a,baseRadius:e};return o.set(e,c),c}let f=a/2;n.clearRect(0,0,a,a),n.save(),n.translate(f,f),n.scale(e,e),n.fillStyle="white",n.strokeStyle="white",n.lineWidth=.02;try{n.fill(ci(i))}catch{n.beginPath(),n.arc(0,0,1,0,K),n.fill()}n.fillStyle="rgba(255,255,255,0.9)",i==="corvette"||i==="fighter"?(n.beginPath(),n.ellipse(.25,0,.25,.15,0,0,K),n.fill()):i==="frigate"?n.fillRect(-.2,-.25,.6,.5):i==="destroyer"?n.fillRect(-.9,-.18,1.2,.36):i==="carrier"&&(n.fillStyle="rgba(255,255,255,0.2)",n.fillRect(-.8,-.25,1.6,.5)),n.restore();let h={canvas:t,size:a,baseRadius:e};return o.set(e,h),h}function di(i){for(let e of _e)ge(i,e)}function ui(i,e=_e[1]){let o=Ot.get(i);return o&&o.has(e)?o.get(e):ge(i,e)}function Ie(i,e,o=typeof window<"u"&&window.devicePixelRatio||1){let s=Math.max(1,Math.round(e*o));di(i);let a=Ot.get(i)||new Map,t=null,n=1/0;for(let[f,h]of a.entries()){let c=Math.abs(f-s);c<n&&(n=c,t=h)}return t||(t=ge(i,s)),t}var Gt=null;function Ne(){if(!r||typeof r.createRadialGradient!="function"){Gt=null;return}Gt=r.createRadialGradient(k*.6,O*.3,50,k*.6,O*.3,Math.max(k,O)),Gt.addColorStop(0,"rgba(60,80,140,0.10)"),Gt.addColorStop(1,"rgba(10,12,20,0.0)")}Ne();var qi=ut,Ue=Tt,Vi=Nt,$i=vt;var rt=(i,e=1)=>i===v.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`;function _i(i){if(i.life<=0)return;let e=i.life/i.max;r.fillStyle=(i.color||"").replace?i.color.replace("$a",e.toFixed(3)):i.color,r.fillRect(i.x,i.y,2,2)}var ce=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let o=Pt.some(b=>b.shieldHit&&b.x===e.x&&b.y===e.y&&b.life>0);if(Wt){let b=e.x-Math.cos(e.angle)*e.radius*1.2,D=e.y-Math.sin(e.angle)*e.radius*1.2;Ue(b,D,-e.vx*.05+g(-10,10),-e.vy*.05+g(-10,10),.25,rt(e.team,"$a"))}let s=e.radius||8,a=ui(e.type),t=Ie(e.type,s,typeof window<"u"&&window.devicePixelRatio||1);if(t&&t.canvas&&r&&typeof r.drawImage=="function"){r.save(),r.translate(e.x,e.y),r.rotate(e.angle),r.shadowBlur=12,r.shadowColor=rt(e.team,.9);let b=t.size,D=s*2/(a.baseRadius*2),x=b*D,w=b*D;r.save(),r.globalCompositeOperation="source-over",r.drawImage(t.canvas,-x/2,-w/2,x,w),r.globalCompositeOperation="source-in",r.fillStyle=rt(e.team,.96),r.fillRect(-x/2,-w/2,x,w),r.restore(),r.restore()}else r.save(),r.translate(e.x,e.y),r.rotate(e.angle),r.shadowBlur=12,r.shadowColor=rt(e.team,.9),r.fillStyle=rt(e.team,.96),e.type==="corvette"?(r.beginPath(),r.moveTo(s*1.5,0),r.lineTo(-s,-s*.7),r.lineTo(-s*.4,0),r.lineTo(-s,s*.7),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.85)",r.beginPath(),r.ellipse(0,0,s*.35,s*.25,0,0,K),r.fill()):e.type==="frigate"?(r.beginPath(),r.moveTo(s*1.6,0),r.quadraticCurveTo(s*.2,-s*1.1,-s*1.1,-s*.6),r.lineTo(-s*.6,0),r.lineTo(-s*1.1,s*.6),r.quadraticCurveTo(s*.2,s*1.1,s*1.6,0),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.75)",r.fillRect(-s*.2,-s*.25,s*.6,s*.5)):e.type==="destroyer"?(r.beginPath(),r.moveTo(s*1.9,0),r.lineTo(s*.3,-s*1.1),r.lineTo(-s*1.4,-s*.6),r.lineTo(-s*1.4,s*.6),r.lineTo(s*.3,s*1.1),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.7)",r.fillRect(-s*.9,-s*.18,s*1.2,s*.36)):e.type==="carrier"?(r.beginPath(),r.ellipse(0,0,s*1.6,s*1,0,0,K),r.fill(),r.fillStyle="rgba(255,255,255,.18)",r.fillRect(-s*.8,-s*.25,s*1.6,s*.5)):e.type==="fighter"?(r.beginPath(),r.moveTo(s*1.2,0),r.lineTo(-s*.6,-s*.45),r.lineTo(-s*.2,0),r.lineTo(-s*.6,s*.45),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.9)",r.beginPath(),r.ellipse(s*.25,0,s*.25,s*.15,0,0,K),r.fill()):(r.beginPath(),r.moveTo(s*1.4,0),r.lineTo(-s,-s*.8),r.lineTo(-s*.4,0),r.lineTo(-s,s*.8),r.closePath(),r.fill()),r.restore();if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let b=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,D=s+4+(1-b)*2;r.save(),r.beginPath(),r.arc(e.x,e.y,D,0,K);let x=r.createRadialGradient(e.x,e.y,D*.6,e.x,e.y,D);x.addColorStop(0,`rgba(140,200,255,${.06})`),x.addColorStop(1,`rgba(80,160,255,${.02})`),r.fillStyle=x,r.globalCompositeOperation="lighter",r.fill();for(let w of ke){if(w.id!==e.id)continue;let B=Math.max(0,Math.min(1,w.life/.22)),d=e.shieldMax&&e.shieldMax>0?w.amount/e.shieldMax:Math.min(1,w.amount/(e.hpMax*.6||1)),I=Math.max(.08,Math.min(1,d)),tt=(Math.PI*.25+Math.PI*.6*(1-B))*(.6+1.6*I),X=w.angle-tt/2,gt=w.angle+tt/2,pt=D+4*(1-B)+2*I;r.beginPath(),r.arc(e.x,e.y,pt,X,gt),r.lineWidth=(3+6*B)*(1+4*I);let lt=Math.min(1,.25+B*(.9+1.6*I));r.strokeStyle=`rgba(160,220,255,${lt})`,r.save(),r.shadowBlur=12*I,r.shadowColor="rgba(140,200,255,0.8)",r.stroke(),r.restore()}r.restore()}let n=Math.max(16,s*3.2),f=Math.max(3,s*.4),h=e.x-n/2,c=e.y-(s+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let b=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;r.fillStyle="rgba(255,255,255,.08)",r.fillRect(h,c,n,f),r.fillStyle="rgba(80,160,255,.95)",r.fillRect(h,c,n*b,f)}let l=e.y+(s+8),A=Math.max(0,Math.min(1,e.hp/e.hpMax)),p=Math.min(6,f);r.beginPath(),r.moveTo(h+p,l),r.lineTo(h+n-p,l),r.quadraticCurveTo(h+n,l,h+n,l+p),r.lineTo(h+n,l+f-p),r.quadraticCurveTo(h+n,l+f,h+n-p,l+f),r.lineTo(h+p,l+f),r.quadraticCurveTo(h,l+f,h,l+f-p),r.lineTo(h,l+p),r.quadraticCurveTo(h,l,h+p,l),r.closePath(),r.fillStyle="rgba(255,255,255,.08)",r.fill();let y=Ge.find(b=>b.id===e.id&&b.life>0),R=`rgba(120,220,120,${.95})`;if(y){let b=Math.max(0,Math.min(1,y.life/.45)),D=Math.min(1,y.amount/(e.hpMax||1)),x=Math.floor(220*(1-D*b)),w=Math.floor(60+160*(1-b*D));R=`rgba(${Math.min(255,x)},${Math.min(255,w)},60,${.95})`}r.save(),r.beginPath(),r.moveTo(h+p,l),r.lineTo(h+n-p,l),r.quadraticCurveTo(h+n,l,h+n,l+p),r.lineTo(h+n,l+f-p),r.quadraticCurveTo(h+n,l+f,h+n-p,l+f),r.lineTo(h+p,l+f),r.quadraticCurveTo(h,l+f,h,l+f-p),r.lineTo(h,l+p),r.quadraticCurveTo(h,l,h+p,l),r.closePath(),r.clip(),r.fillStyle=R,r.fillRect(h,l,n*A,f),r.restore(),typeof e.level=="number"&&e.level>1&&(r.save(),r.fillStyle="rgba(255,255,255,0.95)",r.font="700 12px system-ui, sans-serif",r.textAlign="center",r.fillText(`Lv ${e.level}`,e.x,e.y-(s+18)),r.restore())}},j=L,qt=nt,Vt=Q,Pt=J,ke=it,Ge=st,Xt={red:0,blue:0},_t=new Map,At=!1,Yt=1,Wt=!0,Ht=0;function de(i=null){return se(i)}function gi(i){let e=oe(i,k,O);e&&e.score&&(Xt=e.score),j=L,qt=nt,Vt=Q,Pt=J,ke=it,Ge=st;let o=new Set(j.map(s=>s.id));for(let s of j)_t.has(s.id)?_t.get(s.id).syncFromLogic():_t.set(s.id,new ce(s));for(let s of Array.from(_t.keys()))o.has(s)||_t.delete(s)}function Me(){r.clearRect(0,0,k,O);let i=r.createRadialGradient(k*.6,O*.3,50,k*.6,O*.3,Math.max(k,O));i.addColorStop(0,"rgba(60,80,140,0.10)"),i.addColorStop(1,"rgba(10,12,20,0.0)"),r.fillStyle=i,r.fillRect(0,0,k,O);for(let s of Fe){let a=.6+.4*Math.sin(s.phase);r.globalAlpha=fe(.5*a*(.6+.5*s.d),0,1),r.fillStyle="#e9f2ff",r.fillRect(s.x,s.y,s.r,s.r)}r.globalAlpha=1;for(let s of Pt){let a=fe(s.life/.25,0,1);r.strokeStyle=rt(s.team,a*.6),r.lineWidth=2,r.beginPath(),r.arc(s.x,s.y,s.r,0,K),r.stroke()}for(let s of qt)r.save(),r.shadowBlur=12,r.shadowColor=rt(s.team,.9),r.fillStyle=rt(s.team,.95),r.beginPath(),r.arc(s.x,s.y,s.radius||2.2,0,K),r.fill(),r.restore();for(let s of Vt)_i(s);for(let s of _t.values())s.draw();let e=j.some(s=>s.alive&&s.team===v.RED),o=j.some(s=>s.alive&&s.team===v.BLUE);if(!e||!o){r.save(),r.textAlign="center",r.font="700 36px Inter, system-ui, sans-serif";let s=e?"Red":o?"Blue":"Nobody",a=e?rt(v.RED,.95):o?rt(v.BLUE,.95):"rgba(255,255,255,.9)";r.fillStyle=a,r.shadowBlur=14,r.shadowColor=a,r.fillText(`${s} Wins!`,k/2,64),r.restore()}}function ue(i){Ht||(Ht=i);let e=(i-Ht)/1e3;Ht=i;let o=fe(e,0,.033)*(At?Yt:0);if(gi(o),P&&P.type==="webgl"&&typeof P.render=="function")try{P.render({W:k,H:O,ships:j,bullets:qt,stars:Fe,particles:Vt,flashes:Pt,shipsVMap:_t,score:Xt})}catch(s){console.error("WebGL render error, falling back to 2D render",s),Me()}else Me();xi(),requestAnimationFrame(ue)}var Ki=document.getElementById("startPause"),ji=document.getElementById("reset"),Ji=document.getElementById("addRed"),Qi=document.getElementById("addBlue"),Zi=document.getElementById("toggleTrails"),ts=document.getElementById("speed"),pi=document.getElementById("redScore"),vi=document.getElementById("blueScore"),Ai=document.getElementById("stats"),es=document.getElementById("seedBtn"),is=document.getElementById("formationBtn"),St=document.getElementById("continuousCheckbox");St||(St=document.createElement("input"),St.type="checkbox",St.id="continuousCheckbox");ae&&typeof Ut=="function"&&Ut(St);function xi(){pi.textContent=`Red ${Xt.red}`,vi.textContent=`Blue ${Xt.blue}`,Ai.textContent=`Ships: ${j.filter(i=>i.alive).length}  Bullets: ${qt.length}  Particles: ${Vt.length}`}function mi(){if(typeof document>"u")return null;let i=document.getElementById("rendererBackendBadge");if(!i){i=document.createElement("div"),i.id="rendererBackendBadge",i.style.position="fixed",i.style.right="12px",i.style.top="12px",i.style.padding="6px 10px",i.style.background="rgba(0,0,0,0.6)",i.style.color="#fff",i.style.fontFamily="system-ui,Segoe UI,Roboto,Arial",i.style.fontSize="12px",i.style.borderRadius="6px",i.style.zIndex="99999",i.style.pointerEvents="auto",i.style.cursor="default",i.title="Renderer backend";try{document.body.appendChild(i)}catch{}}return i}function zt(i,e){let o=mi();o&&(o.textContent=i,e&&(o.title=e))}var ss=te;function yi(i){return ee(i)}function he(){return ie()}var ns=re,rs=ct;function bi(){if(typeof window>"u"||!document||window.__uiHandlersInstalled)return;Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1});let i=document.getElementById("startPause");i&&i.addEventListener("click",()=>{At=!At,i.textContent=At?"\u23F8 Pause":"\u25B6 Start"});let e=document.getElementById("reset");e&&e.addEventListener("click",()=>{de()});let o=document.getElementById("addRed");o&&o.addEventListener("click",()=>{j.push(new ot(v.RED,g(40,k*.35),g(80,O-80))),kt("+1 Red")});let s=document.getElementById("addBlue");s&&s.addEventListener("click",()=>{j.push(new ot(v.BLUE,g(k*.65,k-40),g(80,O-80))),kt("+1 Blue")});let a=document.getElementById("toggleTrails");a&&a.addEventListener("click",()=>{Wt=!Wt,a.textContent=`\u2604 Trails: ${Wt?"On":"Off"}`});let t=document.getElementById("speed");t&&t.addEventListener("click",()=>{let l=[.5,1,2,4],A=(l.indexOf(Yt)+1)%l.length;Yt=l[A],t.textContent=`Speed: ${Yt}\xD7`});let n=document.getElementById("seedBtn");n&&n.addEventListener("click",()=>{let l=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);l!==null&&de(Number(l))});let f=document.getElementById("formationBtn");f&&f.addEventListener("click",()=>{let l=j.filter(R=>R.alive&&R.team===v.RED),A=j.filter(R=>R.alive&&R.team===v.BLUE),p=20,y=6;l.forEach((R,b)=>{let D=b%y,x=Math.floor(b/y);R.x=k*.25-D*20,R.y=O*.5+(x-y/2)*p,R.vx=R.vy=0}),A.forEach((R,b)=>{let D=b%y,x=Math.floor(b/y);R.x=k*.75+D*20,R.y=O*.5+(x-y/2)*p,R.vx=R.vy=0}),kt("Fleets re-formed")});let h=document.getElementById("reinforceFreqBtn"),c=[0,.5,1,2];if(h){let l=()=>{let A=he();h.textContent=A>0?`${A}s`:"Every step"};l(),h.addEventListener("click",()=>{let A=he(),p=(c.indexOf(A)+1)%c.length;yi(c[p]),l();let y=he();kt(`Reinforcement check: ${y>0?y+"s":"every step"}`)})}G&&typeof G.addEventListener=="function"&&G.addEventListener("click",l=>{Pt.push({x:l.clientX,y:l.clientY,r:24,life:.25,team:Et(0,1)});for(let p=0;p<24;p++){let y=g(0,K),R=g(40,220);Ue(l.clientX,l.clientY,Math.cos(y)*R,Math.sin(y)*R,g(.2,1),"rgba(255,255,255,$a)")}})}j.length===0&&de();var P=null,C={triedWebGL:!1,gl2:!1,gl1:!1,importError:null,used:null};try{if(typeof window<"u"&&typeof HTMLCanvasElement<"u"&&!HTMLCanvasElement.prototype.__getContextWrapped){let i=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(e,o){try{let s=i.call(this,e,o);if(!s)try{let a=new Error("getContext returned null for type "+e).stack;if(C.getContextNullStacks=C.getContextNullStacks||[],C.getContextNullStacks.push({type:e,attrs:o,stack:a,time:Date.now()}),typeof window<"u")try{window.__rendererDiag=C}catch{}console.warn("DEBUG: HTMLCanvasElement.getContext returned null for",e,o,`
stack:`,a)}catch{}return s}catch(s){try{let a=new Error("getContext threw for type "+e).stack;if(C.getContextThrowStacks=C.getContextThrowStacks||[],C.getContextThrowStacks.push({type:e,attrs:o,err:String(s),stack:a,time:Date.now()}),typeof window<"u")try{window.__rendererDiag=C}catch{}console.warn("DEBUG: HTMLCanvasElement.getContext threw",s,`
stack:`,a)}catch{}throw s}};try{Object.defineProperty(HTMLCanvasElement.prototype,"__getContextWrapped",{value:!0,configurable:!1})}catch{HTMLCanvasElement.prototype.__getContextWrapped=!0}}}catch{}var Z=null,xt=!1;async function He(i={}){if(typeof window<"u"&&(window.initRenderer=He),typeof window<"u"&&window.__autoRendererStarted){if(xt&&P)return P;if(Z)return await Z,P}if(xt&&P)return P;if(Z)return await Z,P;typeof window<"u"&&(window.__autoRendererStarted=!0),Z=(async()=>{let{canvas:e=G,preferWebGL:o=!0,startLoop:s=!0}=i;if(!e)throw new Error("No canvas available to initialize renderer");if(bi(),o&&e.getContext){C.triedWebGL=!0;let a=[{},{antialias:!1},{powerPreference:"high-performance"},{antialias:!1,powerPreference:"high-performance"},{antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1}],t=[],n=null;for(let c of a)try{let l=e.getContext("webgl2",c);t.push({attrs:c,ok:!!l}),l&&!n&&(n=l)}catch(l){t.push({attrs:c,ok:!1,err:String(l)})}let f=[],h=null;if(!n)for(let c of a)try{let l=e.getContext("webgl",c);f.push({attrs:c,ok:!!l}),l&&!h&&(h=l)}catch(l){f.push({attrs:c,ok:!1,err:String(l)})}if(C.attempts={webgl2:t,webgl:f},C.gl2=!!n,C.gl1=!!h,n||h)try{let{createWebGLRenderer:c}=await Promise.resolve().then(()=>(Be(),De));if(P=c(e,{webgl2:!!n,atlasAccessor:(A,p)=>Ie(A,p,typeof window<"u"&&window.devicePixelRatio||1),atlasLODs:_e}),P.init(),s&&P.start(()=>{requestAnimationFrame(ue)}),C.used="webgl",typeof window<"u")try{window.__rendererDiag=C}catch{}console.info("Renderer: using WebGL",{webgl2:!!n});try{zt("WebGL"+(n?"2":"1"),C.importError||"Using GPU WebGL renderer")}catch{}return P}catch(c){C.importError=String(c&&c.stack?c.stack:c),console.warn("WebGL init failed, falling back to 2D canvas renderer",c);try{zt("Canvas (WebGL failed)",C.importError)}catch{}}else{C.importError="No WebGL context (getContext returned null)",console.info("Renderer: no WebGL context available; using Canvas 2D fallback");try{zt("Canvas (no WebGL)",C.importError)}catch{}}}if(!P){if(P={type:"canvas"},C.used="canvas",typeof window<"u")try{window.__rendererDiag=C}catch{}console.info("Renderer: using Canvas 2D fallback");try{zt("Canvas",C.importError||"Using Canvas 2D fallback")}catch{}s&&requestAnimationFrame(ue)}return P})();try{let e=await Z;return xt=!0,e}finally{Z&&(Z=null)}}function os(){return P?P.type:null}function as(){return C}function Ei(){if(P&&typeof P.stop=="function"&&P.stop(),P&&typeof P.destroy=="function"&&P.destroy(),P=null,xt=!1,Z=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function ls(){if(Ei(),xt=!1,Z=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function hs(){if(xt=!1,Z=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}typeof window<"u"&&(window.startSimulation=function(){try{At=!0;let e=document.getElementById("startPause");e&&(e.textContent="\u23F8 Pause")}catch{}},window.stopSimulation=function(){try{At=!1;let e=document.getElementById("startPause");e&&(e.textContent="\u25B6 Start")}catch{}});export{$i as Particle,hs as _internal_resetInitFlags,Ue as acquireParticle,Gt as backgroundGradient,qt as bullets,fe as clamp,ns as evaluateReinforcement,Pt as flashes,ui as getHullAtlas,Ie as getHullAtlasForRadius,ci as getHullPath,he as getReinforcementInterval,as as getRendererDiagnostics,os as getRendererType,rs as handleReinforcement,Ge as healthFlashes,Ot as hullAtlases,le as hullPaths,He as initRenderer,fi as initStars,qi as particlePool,Vt as particles,Ne as recomputeBackgroundGradient,Vi as releaseParticle,de as reset,ss as resetReinforcementCooldowns,yi as setReinforcementInterval,ke as shieldFlashes,j as ships,_t as shipsVMap,Fe as stars,Ei as stopRenderer,ls as stopRendererAndAllowReinit,rt as teamColor};

// AUTO_INIT_SNIPPET_START
// Idempotent auto-init for standalone bundle: try common exported names safely.
// This variant awaits the initializer (if it returns a promise) and then
// retries clicking the start button until the UI toggles to "Pause" or
// a timeout is reached. This is more robust against handler-installation
// races caused by inlining/minification ordering.
if (typeof window !== "undefined" && !window.__autoRendererStarted) {
  window.__autoRendererStarted = true;
  Promise.resolve().then(() => {
    try {
      try {
        console.log('[AUTO_INIT] typeof window.initRenderer ->', typeof window.initRenderer);
        console.log('[AUTO_INIT] window.initRenderer ->', window.initRenderer && (window.initRenderer.name || '[function]'));
      } catch(_){ }

      const attemptStartWith = (fn, label) => {
        try {
          const p = fn({ preferWebGL: true, startLoop: true });
          // Ensure we handle both sync and promise returns
          return Promise.resolve(p).then(() => {
            // Retry clicking the start button until its text indicates running
            let attempts = 0;
            const maxAttempts = 12; // ~1 second with 80ms interval
            const tryClick = () => {
              attempts++;
              try {
                const b = document.getElementById('startPause');
                if (b && typeof b.click === 'function') {
                  b.click();
                  console.log('[AUTO_INIT] start button clicked (' + label + ') attempt', attempts);
                  // If the button text changed to Pause, we assume running started
                  if (b.textContent && b.textContent.toLowerCase().includes('pause')) {
                    console.log('[AUTO_INIT] start confirmed via button text (' + label + ')');
                    return;
                  }
                } else {
                  console.log('[AUTO_INIT] start button not found (' + label + '), attempt', attempts);
                }
              } catch (e) {
                console.log('[AUTO_INIT] click attempt error', e && e.message);
              }
              if (attempts < maxAttempts) {
                setTimeout(tryClick, 80);
              } else {
                console.log('[AUTO_INIT] failed to confirm start after', maxAttempts, 'attempts (', label, ')');
                try {
                  if (typeof window !== 'undefined' && typeof window.startSimulation === 'function') {
                    console.log('[AUTO_INIT] calling window.startSimulation() fallback');
                    window.startSimulation();
                  }
                } catch (_) {}
              }
            };
            // start first try slightly delayed to allow handlers to be installed
            setTimeout(tryClick, 60);

            // Proactive safety: also call startSimulation directly shortly after init
            // This ensures the internal 'ae' running flag is set even if click handlers
            // are not yet installed or click events are swallowed by race conditions.
            try {
              if (typeof window !== 'undefined' && typeof window.startSimulation === 'function') {
                setTimeout(() => {
                  try {
                    console.log('[AUTO_INIT] proactive window.startSimulation() call');
                    window.startSimulation();
                  } catch (__) {}
                }, 120);
                // A second attempt after a longer delay to cover slower setups
                setTimeout(() => {
                  try {
                    console.log('[AUTO_INIT] proactive window.startSimulation() call (retry)');
                    window.startSimulation();
                  } catch (__) {}
                }, 600);
              }
            } catch (_) {}
          });
        } catch (e) { console.log('[AUTO_INIT] initializer call threw (' + label + ')', e && e.message); return Promise.resolve(); }
      };

      if (typeof initRenderer === 'function') {
        console.log('[AUTO_INIT] calling initRenderer (local export)');
        attemptStartWith(initRenderer, 'initRenderer');
      } else if (typeof Li === 'function') {
        console.log('[AUTO_INIT] calling Li (minified alias)');
        attemptStartWith(Li, 'Li');
      } else if (typeof window.initRenderer === 'function') {
        console.log('[AUTO_INIT] calling window.initRenderer');
        attemptStartWith(window.initRenderer, 'window.initRenderer');
      } else {
        console.log('[AUTO_INIT] no initRenderer found to call');
      }
    } catch (e) {
      try { console.error('Auto init failed', e); } catch (_) {}
    }
  });
}
// AUTO_INIT_SNIPPET_END

</script>
<!-- END_INLINED_BUNDLE -->