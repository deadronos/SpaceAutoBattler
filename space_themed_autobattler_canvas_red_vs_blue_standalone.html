<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
    <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span style="opacity:.7">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  































<script type="module">
var _e=Object.defineProperty;var Ce=(n,i,s)=>i in n?_e(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var ve=(n,i,s)=>Ce(n,typeof i!="symbol"?i+"":i,s);var Pe=!1,ce=123456789,Le=1664525,we=1013904223,Ie=4294967296,Be=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),He=!!Be;function Ae(){if(!Pe){if(He)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return ce=Le*ce+we>>>0,ce/Ie}function h(n=0,i=1){if(typeof n!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return n+(i-n)*Ae()}function te(n,i){if(!Number.isFinite(n)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(n,i+1))}var b={RED:0,BLUE:1};function se(n){switch(n){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":{let s=h(3.5,6)*h(.8,1.4),t=Math.max(1,Math.floor(h(1,3)));return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchCooldown:s,launchAmount:t}}case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var de=class{constructor(i,s,t,l,o,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=o,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},ie=class ie{constructor(i,s,t,l="corvette",o){if(!o)throw new Error("Ship constructor requires a precomputed cfg. Call getClassConfig(type) and pass it to the constructor or use createShipWithConfig.");this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l,this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=ie._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchCooldown,this.launchAmount=o.launchAmount):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,g=o.y-this.y,c=a*a+g*g;c<l&&c<t&&(t=c,s=o)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,o=0;if(t){let x=t.x-this.x,E=t.y-this.y,r=Math.hypot(x,E)||1,d=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*d,f=t.y+(t.vy||0)*d,u=m-this.x,P=f-this.y,v=Math.hypot(u,P)||1;if(l+=u/v*this.accel,o+=P/v*this.accel,r<this.range){let C=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&C>0){let k=300+h(-20,20),q=x/r,O=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let F=arguments[2],W=new de(this.x+q*12,this.y+O*12,q*k+this.vx*.2,O*k+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),F.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let a=0,g=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,d=E*E+r*r;if(d<_*_&&d>1){let m=Math.sqrt(d);a+=E/m,g+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=l*i,this.vy+=o*i;let p=Math.hypot(this.vx,this.vy);if(p>this.maxSpeed){let x=this.maxSpeed/p;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ve(ie,"_id",1);var fe=ie;function X(n,i,s,t="corvette",l){return new fe(n,i,s,t,l)}function Te(n,i,s={W:800,H:600}){n.ships=n.ships||[],n.bullets=n.bullets||[],n.explosions=n.explosions||[],n.shieldHits=n.shieldHits||[],n.healthHits=n.healthHits||[],n.score=n.score||{red:0,blue:0};for(let t of n.ships)t.alive&&t.update(i,n.ships,n.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=t+a*2:o.x>t+a&&(o.x-=t+a*2),o.y<-a?o.y+=l+a*2:o.y>l+a&&(o.y-=l+a*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l;o++){let a=h(0,Math.PI*2),g=t.radius+12+h(4,12),c=t.x+Math.cos(a)*g,_=t.y+Math.sin(a)*g,p=se("fighter"),x=X(t.team,c,_,"fighter",p),E=h(40,120);x.vx=Math.cos(a)*E+(t.vx||0)*.2,x.vy=Math.sin(a)*E+(t.vy||0)*.2,n.ships.push(x)}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];l.update(i),l.alive(s)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let l=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===l.team)continue;let a=o.x-l.x,g=o.y-l.y,c=a*a+g*g,_=o.radius+l.radius;if(c<_*_){let p=l.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(p),d=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(d>0&&n.shieldHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:d}),m>0&&n.healthHits.push({id:o.id,hitX:l.x,hitY:l.y,team:o.team,amount:m}),l.ownerId!=null){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(p*.05)}if(n.bullets.splice(t,1),r&&n.explosions.push(r),!o.alive&&(l.team===0?n.score.red++:n.score.blue++,l.ownerId!=null)){let f=n.ships.find(u=>u.id===l.ownerId);f&&f.gainXp(20+(o.level||1)*.2)}break}}}}function re(){let n=be(),i=se(n);return{type:n,cfg:i}}var N,e,y,M;function ut(){N=document.getElementById("world"),e=N.getContext("2d"),y=N.width=window.innerWidth,M=N.height=window.innerHeight,Ye(),window.addEventListener("resize",()=>{y=N.width=window.innerWidth,M=N.height=window.innerHeight})}function ye(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],G=[],z=[],Z=[],j=[],Y=new Map,T=[],Ee=[],ne=0,oe=!1,le=1,ae=!0,pe={red:0,blue:0};var ue=[.5,1,2,4],L={ships:T,bullets:Ee,score:pe,particles:w,shieldHits:[],healthHits:[],explosions:[]},B=Math.PI*2,he=(n,i,s)=>Math.max(i,Math.min(s,n)),K=(n=0,i=1)=>h(n,i);function Ue(n,i,s,t,l,o){let a=Math.min(o,l/2,t/2);n.beginPath(),n.moveTo(i+a,s),n.lineTo(i+t-a,s),n.quadraticCurveTo(i+t,s,i+t,s+a),n.lineTo(i+t,s+l-a),n.quadraticCurveTo(i+t,s+l,i+t-a,s+l),n.lineTo(i+a,s+l),n.quadraticCurveTo(i,s+l,i,s+l-a),n.lineTo(i,s+a),n.quadraticCurveTo(i,s,i+a,s),n.closePath()}function D(n){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=n,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var me=[];function Ye(){if(!Number.isFinite(y)||!Number.isFinite(M))return;me.length=0;let n=[.2,.5,1];for(let i of n)for(let s=0;s<120;s++)me.push({x:K(0,y),y:K(0,M),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,B)})}var I=(n,i=1)=>n===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,Q=["corvette","frigate","destroyer","carrier","fighter"];function be(){if(!Array.isArray(Q)||Q.length===0)return"corvette";let n=he(te(0,Q.length-1),0,Q.length-1);return Q[n]}function Ve(n){let{type:i,cfg:s}=re();if(n===b.RED){let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}else if(n===b.BLUE){let t=h(y*.65,y-40),l=h(80,M-80);T.push(X(b.BLUE,t,l,i,s)),typeof D=="function"&&D(`+1 Blue (${i})`)}else{let t=h(40,y*.35),l=h(80,M-80);T.push(X(b.RED,t,l,i,s)),typeof D=="function"&&D(`+1 Red (${i})`)}}var pt={createShipFromUI:Ve,randomShipType:be,chooseShipTypeAndCfg:re,ships:T,state:L},V=class{constructor(i,s,t,l,o,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=o,this.max=o,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;ye(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},xe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(ye(),!e))return;let s=G.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ae){let r=i.x-Math.cos(i.angle)*i.radius*1.2,d=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new V(r,d,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,I(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=I(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=I(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,B),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,B),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,B),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,d=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,d,0,B);let m=e.createRadialGradient(i.x,i.y,d*.6,i.x,i.y,d);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let f of z){if(f.id!==i.id)continue;let u=Math.max(0,Math.min(1,f.life/.22)),P=i.shieldMax&&i.shieldMax>0?f.amount/i.shieldMax:Math.min(1,f.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,P)),k=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*v),q=f.angle-k/2,O=f.angle+k/2,F=d+4*(1-u)+2*v;e.beginPath(),e.arc(i.x,i.y,F,q,O),e.lineWidth=(3+6*u)*(1+4*v);let W=Math.min(1,.25+u*(.9+1.6*v));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*v,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),o=Math.max(3,t*.4),a=i.x-l/2,g=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,g,l,o),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,g,l*r,o))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),p=Math.min(6,o);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let f=e.measureText(r).width,u=8,P=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,f+u*2),C=Math.max(o+2,m*.9),k=a-8-v,q=c+o/2-C/2,O=C/2,F=4,W=k-F,Se=q-F,Re=v+F*2,ge=C+F*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",Ue(e,W,Se,Re,ge,ge/2),e.fill(),e.restore();let J=j.find(U=>U.id===i.id&&U.life>0),ee=1;J&&(ee=1+.6*Math.max(0,Math.min(1,J.life/1)));let $=v*ee,H=C*ee,S=k-($-v),R=q-(H-C)/2,A=H/2;if(e.beginPath(),e.moveTo(S+A,R),e.lineTo(S+$-A,R),e.quadraticCurveTo(S+$,R,S+$,R+A),e.lineTo(S+$,R+H-A),e.quadraticCurveTo(S+$,R+H,S+$-A,R+H),e.lineTo(S+A,R+H),e.quadraticCurveTo(S,R+H,S,R+H-A),e.lineTo(S,R+A),e.quadraticCurveTo(S,R,S+A,R),e.closePath(),J){let U=Math.max(.6,Math.min(1,J.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=I(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=I(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*ee)}px Inter, system-ui, sans-serif`,e.fillText(r,S+$/2,R+H/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),d=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-d*r)),f=Math.floor(60+160*(1-r*d));E=`rgba(${Math.min(255,m)},${Math.min(255,f)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+p,c),e.lineTo(a+l-p,c),e.quadraticCurveTo(a+l,c,a+l,c+p),e.lineTo(a+l,c+o-p),e.quadraticCurveTo(a+l,c+o,a+l-p,c+o),e.lineTo(a+p,c+o),e.quadraticCurveTo(a,c+o,a,c+o-p),e.lineTo(a,c+p),e.quadraticCurveTo(a,c,a+p,c),e.closePath(),e.clip(),e.fillStyle=E,e.fillRect(a,c,l*_,o))}};function mt(){}function Oe(n){if(Te(L,n,{W:y,H:M}),Array.isArray(L.healthHits)&&L.healthHits.length){for(let s of L.healthHits){let t=T.find(l=>l.id===s.id);if(t){Z.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let o=h(0,B),a=h(40,120);w.push(new V(s.hitX,s.hitY,Math.cos(o)*a,Math.sin(o)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}L.healthHits.length=0}if(Array.isArray(L.shieldHits)&&L.shieldHits.length){for(let s of L.shieldHits){let t=T.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);z.push({id:t.id,angle:l,life:.22,amount:s.amount}),G.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}L.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(n),t.life<=0&&w.splice(s,1)}for(let s=G.length-1;s>=0;s--){let t=G[s];t.life-=n,t.r+=600*n,t.life<=0&&G.splice(s,1)}for(let s=z.length-1;s>=0;s--){let t=z[s];t.life-=n,t.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=n,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=n,t.life<=0&&j.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(Y.has(s.id)){let t=Y.get(s.id);if(t.level!==s.level){j.push({id:s.id,life:1});for(let l=0;l<18;l++){let o=h(0,B),a=h(60,240);w.push(new V(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*a,Math.sin(o)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new xe(s);t.level=s.level,Y.set(s.id,t)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Ke(){if(ye(),typeof e>"u"||!e)return;e.clearRect(0,0,y,M);let n=e.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=n,e.fillRect(0,0,y,M);for(let t of me){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=he(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of G){let l=he(t.life/.25,0,1);e.strokeStyle=I(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,B),e.stroke()}for(let t of Ee)e.save(),e.shadowBlur=12,e.shadowColor=I(t.team,.9),e.fillStyle=I(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,B),e.fill(),e.restore();for(let t of w)t.draw();for(let t of Y.values())t.draw();let i=T.some(t=>t.alive&&t.team===b.RED),s=T.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?I(b.RED,.95):s?I(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function xt(){if(typeof document>"u")return;let n=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),p=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${pe.red}`),g&&(g.textContent=`Blue ${pe.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${Ee.length}  Particles: ${w.length}`)}n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{oe=!oe,n.textContent=oe?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let{type:r,cfg:d}=re(),m=h(40,y*.35),f=h(80,M-80);T.push(X(b.RED,m,f,r,d)),D(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let{type:r,cfg:d}=re(),m=h(y*.65,y-40),f=h(80,M-80);T.push(X(b.BLUE,m,f,r,d)),D(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{ae=!ae,l.textContent=`\u2604 Trails: ${ae?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ue.indexOf(le)+1)%ue.length;le=ue[r],o.textContent=`Speed: ${le}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=te(0,4294967295),d=prompt("Enter numeric seed (32-bit):",r);d!==null&&reset(Number(d))}),p&&typeof p.addEventListener=="function"&&p.addEventListener("click",()=>{let r=T.filter(u=>u.alive&&u.team===b.RED),d=T.filter(u=>u.alive&&u.team===b.BLUE),m=20,f=6;r.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.25-v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),d.forEach((u,P)=>{let v=P%f,C=Math.floor(P/f);u.x=y*.75+v*20,u.y=M*.5+(C-f/2)*m,u.vx=u.vy=0}),D("Fleets re-formed")}),N&&typeof N.addEventListener=="function"&&N.addEventListener("click",r=>{G.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:te(0,1)});for(let m=0;m<24;m++){let f=h(0,B),u=h(40,220);w.push(new V(r.clientX,r.clientY,Math.cos(f)*u,Math.sin(f)*u,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){ne||(ne=r);let d=(r-ne)/1e3;ne=r;let m=he(d,0,.033)*(oe?le:0);Oe(m),Ke(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{V as Particle,ue as SPEED_STEPS,xe as ShipV,Ee as bullets,re as chooseShipTypeAndCfg,Ve as createShipFromUI,G as flashes,Z as healthFlashes,ut as initRenderer,xt as initRendererUI,ne as lastTime,j as levelFlashes,w as particles,be as randomShipType,Ke as render,oe as running,pe as score,z as shieldFlashes,T as ships,Y as shipsVMap,ae as showTrails,Oe as simulate,le as speed,me as stars,L as state,I as teamColor,pt as testHelpers,D as toast,mt as updateUI};

</script>
<script type="module">
window.addEventListener('DOMContentLoaded', () => {
  try{ if (typeof initRenderer === 'function') initRenderer(); } catch(e){ console.error('initRenderer failed', e); }
  try{ if (typeof initRendererUI === 'function') initRendererUI(); } catch(e){ console.error('initRendererUI failed', e); }
});
</script>
</body>
</html>