<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
  /* moved inline styles into CSS to satisfy linter */
  #bottomRight .continuous-label { color: var(--ui-color,#eaeff8); margin-right: 6px; }
  #bottomRight .muted { opacity: .7; }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
  <input id="continuousCheckbox" type="checkbox" />
  <label for="continuousCheckbox" class="continuous-label">Continuous</label>
  <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span class="muted">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  














<!-- BEGIN_INLINED_BUNDLE -->
<script type="module">
var ke=Object.defineProperty;var lt=(t,i,a)=>i in t?ke(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a;var ct=(t,i)=>()=>(t&&(i=t(t=0)),i);var He=(t,i)=>{for(var a in i)ke(t,a,{get:i[a],enumerable:!0})};var Ne=(t,i,a)=>lt(t,typeof i!="symbol"?i+"":i,a);var je={};He(je,{createWebGLRenderer:()=>ze,default:()=>_t});function Ke(t,i,a){let e=t.createShader(i);if(t.shaderSource(e,a),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS)){let r=t.getShaderInfoLog(e);throw t.deleteShader(e),new Error("Shader compile error: "+r)}return e}function At(t,i,a){let e=Ke(t,t.VERTEX_SHADER,i),r=Ke(t,t.FRAGMENT_SHADER,a),n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){let o=t.getProgramInfoLog(n);throw t.deleteProgram(n),new Error("Program link error: "+o)}return n}function ze(t,i={}){let{webgl2:a=!1}=i,e=null,r=null,n=null,o=null,c=null,l=null,u=null,h=!1;return{type:"webgl",webgl2:a,init(){try{if(e=t.getContext(a?"webgl2":"webgl"),!e)return;r=At(e,`
          attribute vec2 a_quadPos; // -0.5..0.5 quad
          attribute vec2 a_instPos; // per-instance pixel position
          attribute vec3 a_instColor;
          uniform vec2 u_resolution;
          varying vec3 v_color;
          void main(){
            // convert instance pixel pos + quad offset into clip space
            vec2 pixelPos = a_instPos + a_quadPos;
            vec2 zeroToOne = pixelPos / u_resolution;
            vec2 clip = zeroToOne * 2.0 - 1.0;
            gl_Position = vec4(clip * vec2(1.0, -1.0), 0.0, 1.0);
            v_color = a_instColor;
          }
        `,`
          precision mediump float;
          varying vec3 v_color;
          void main(){
            gl_FragColor = vec4(v_color, 1.0);
          }
        `),n=e.createBuffer();let p=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,p,e.STATIC_DRAW),o=e.createBuffer(),c=e.createBuffer(),u=null,a||(u=e.getExtension("ANGLE_instanced_arrays")),this.a_quadPos=e.getAttribLocation(r,"a_quadPos"),this.a_instPos=e.getAttribLocation(r,"a_instPos"),this.a_instColor=e.getAttribLocation(r,"a_instColor"),this.u_resolution=e.getUniformLocation(r,"u_resolution"),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),l=e.createTexture(),e.bindTexture(e.TEXTURE_2D,l);let E=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,E),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)}catch(g){e=null,console.warn("WebGL init failed:",g.message||g)}},start(g){h=!0,typeof g=="function"&&g()},stop(){h=!1},isRunning(){return h},render(g){if(!e)return;let{W:M,H:p,ships:E}=g,R=E.length,A=new Float32Array(R*2),x=new Float32Array(R*3);for(let m=0;m<R;m++){let y=E[m];A[m*2+0]=y.x,A[m*2+1]=y.y,x[m*3+0]=y.team===0?1:.31,x[m*3+1]=y.team===0?.35:.63,x[m*3+2]=y.team===0?.35:1}if(e.viewport(0,0,t.width,t.height),e.clearColor(.02,.02,.03,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(r),e.uniform2f(this.u_resolution,M,p),e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(this.a_quadPos),e.vertexAttribPointer(this.a_quadPos,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,A,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instPos),e.vertexAttribPointer(this.a_instPos,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,x,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instColor),e.vertexAttribPointer(this.a_instColor,3,e.FLOAT,!1,0,0),a||u)a?(e.vertexAttribDivisor(this.a_instPos,1),e.vertexAttribDivisor(this.a_instColor,1),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,4,R),e.vertexAttribDivisor(this.a_instPos,0),e.vertexAttribDivisor(this.a_instColor,0)):(u.vertexAttribDivisorANGLE(this.a_instPos,1),u.vertexAttribDivisorANGLE(this.a_instColor,1),u.drawArraysInstancedANGLE(e.TRIANGLE_STRIP,0,4,R),u.vertexAttribDivisorANGLE(this.a_instPos,0),u.vertexAttribDivisorANGLE(this.a_instColor,0));else for(let m=0;m<R;m++)e.bufferData(e.ARRAY_BUFFER,A.subarray(m*2,m*2+2),e.DYNAMIC_DRAW),e.vertexAttribPointer(this.a_instPos,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,x.subarray(m*3,m*3+3),e.DYNAMIC_DRAW),e.vertexAttribPointer(this.a_instColor,3,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)},destroy(){if(e){try{e.deleteBuffer(posBuffer),e.deleteBuffer(colorBuffer),e.deleteProgram(r)}catch{}e=null}h=!1}}}var _t,Je=ct(()=>{_t={createWebGLRenderer:ze}});var pe=!1,ee=123456789;function Ue(t){pe=!0,ee=t>>>0}function Ge(){pe=!1}function ht(){return pe?(ee=1664525*ee+1013904223>>>0,ee/4294967296):Math.random()}function f(t=0,i=1){return t+(i-t)*ht()}function V(t,i){return Math.floor(f(t,i+1))}var Xe={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},qe=1.2,me=.6;var d={RED:0,BLUE:1},ge=class{constructor(i,a,e,r,n,o=null){this.x=i,this.y=a,this.vx=e,this.vy=r,this.team=n,this.ownerId=o,this.life=2.5,this.radius=2.2,this.dmg=f(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:a,H:e}=i;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<e+50}},te=class te{constructor(i,a,e,r="corvette"){this.team=i,this.x=a,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=r;let n={corvette:{radius:8,maxSpeed:f(120,160),accel:240,turn:6.5,hp:f(40,70),reload:f(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:f(90,120),accel:200,turn:5,hp:f(80,120),reload:f(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:f(60,90),accel:150,turn:3.2,hp:f(150,220),reload:f(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:f(40,70),accel:90,turn:2,hp:f(220,300),reload:f(.6,1.2),vision:360,range:260,launchBase:f(3.5,6)},fighter:{radius:6,maxSpeed:f(160,220),accel:300,turn:8,hp:f(18,32),reload:f(.12,.22),vision:180,range:120}},o=n[r]||n.corvette;this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=o.turn||Xe[r]||4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=te._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,r==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchBase*f(.8,1.4),this.launchAmount=Math.max(1,Math.floor(f(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,a=1.35){return Math.floor(i*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let i=.06,a=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let r=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(r*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let a=null,e=1/0,r=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let o=n.x-this.x,c=n.y-this.y,l=o*o+c*c;l<r&&l<e&&(e=l,a=n)}return a}update(i,a){if(!this.alive)return;let e=this.pickTarget(a),r=this.recentHitTimer>0,n=0,o=0,c=1;if(e&&!r){let x=e.x-this.x,m=e.y-this.y;c=Math.hypot(x,m)||1;let y=Math.max(0,Math.min(1.2,c/240)),N=e.x+(e.vx||0)*y,S=e.y+(e.vy||0)*y;n=N-this.x,o=S-this.y;let G=Math.hypot(n,o)||1;n/=G,o/=G}else if(e&&r){let x=e.x-this.x,m=e.y-this.y;c=Math.hypot(x,m)||1,n=-(x/c),o=-(m/c)}else n=Math.cos(this.angle),o=Math.sin(this.angle);let l=0,u=0,h=0,g=26;for(let x of a){if(!x.alive||x===this||x.team!==this.team)continue;let m=this.x-x.x,y=this.y-x.y,N=m*m+y*y;if(N<g*g&&N>1){let S=Math.sqrt(N);l+=m/S,u+=y/S,h++}}h>0&&(l/=h,u/=h);let p=Math.atan2(o,n)-this.angle;for(;p>Math.PI;)p-=2*Math.PI;for(;p<-Math.PI;)p+=2*Math.PI;let E=this.turn*i;p>E?p=E:p<-E&&(p=-E),this.angle+=p;let R=r?this.accel*qe:this.accel;this.vx+=Math.cos(this.angle)*R*i,this.vy+=Math.sin(this.angle)*R*i,h>0&&(this.vx+=l*(this.accel*me)*i,this.vy+=u*(this.accel*me)*i);let A=Math.hypot(this.vx,this.vy);if(A>this.maxSpeed){let x=this.maxSpeed/A;this.vx*=x,this.vy*=x}if(this.x+=this.vx*i,this.y+=this.vy*i,e){let x=e.x-this.x,m=e.y-this.y,y=Math.hypot(x,m)||1;if(y<this.range){let N=Math.cos(this.angle)*(x/y)+Math.sin(this.angle)*(m/y);if(this.cooldown<=0&&N>.2){let S=300+f(-20,20),G=x/y,Z=m/y;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new ge(this.x+G*12,this.y+Z*12,G*S+this.vx*.2,Z*S+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-i))}damage(i){let a=i,e=0;return this.shield>0&&i>0&&(e=Math.min(this.shield,i),this.shield-=e,i-=e),i>0&&(this.hp-=i),(e>0||a>0&&i>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};Ne(te,"_id",1);var H=te;function ie(t,i,a,e,r=80){let n=[];for(let o=0;o<i;o++){let c=o%6*20+f(-10,10),l=Math.floor(o/6)*20+f(-10,10),u=f(0,1),h="corvette";u<.45?h="corvette":u<.75?h="frigate":u<.92?h="destroyer":h="carrier",n.push(new H(t,a+(t===d.RED?-c:c),e+l,h))}return n}var Me={};He(Me,{Particle:()=>Y,acquireParticle:()=>j,bullets:()=>F,clamp:()=>ye,evaluateReinforcement:()=>Ae,flashes:()=>C,getReinforcementInterval:()=>Re,handleReinforcement:()=>q,healthFlashes:()=>D,initStars:()=>oe,particlePool:()=>O,particles:()=>L,processStateEvents:()=>bt,releaseParticle:()=>se,reset:()=>we,resetReinforcementCooldowns:()=>Ee,setCarrierLaunchStrategy:()=>Et,setContinuousCheckbox:()=>re,setReinforcementInterval:()=>Te,setReinforcementStrategy:()=>Tt,setSpawnCompositionStrategy:()=>wt,setToast:()=>vt,shieldFlashes:()=>B,ships:()=>v,simulate:()=>_e,stars:()=>W});function We(t,i,a={W:800,H:600}){for(let e of t.ships)e.alive&&e.update(i,t.ships,t.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let e=a.W,r=a.H;for(let n of t.ships){if(!n.alive)continue;let o=n.radius||0;n.x<-o?n.x+=e+o*2:n.x>e+o&&(n.x-=e+o*2),n.y<-o?n.y+=r+o*2:n.y>r+o&&(n.y-=r+o*2)}}for(let e=t.bullets.length-1;e>=0;e--){let r=t.bullets[e];r.update(i),r.alive(a)||t.bullets.splice(e,1)}for(let e=t.bullets.length-1;e>=0;e--){let r=t.bullets[e];for(let n of t.ships){if(!n.alive||n.team===r.team)continue;let o=n.x-r.x,c=n.y-r.y,l=o*o+c*c,u=n.radius+r.radius;if(l<u*u){let h=r.dmg,g=typeof n.shield=="number"?n.shield:0,M=typeof n.hp=="number"?n.hp:0,p=n.damage(h),E=Math.max(0,g-(typeof n.shield=="number"?n.shield:0)),R=Math.max(0,M-(typeof n.hp=="number"?n.hp:0));E>0&&t&&Array.isArray(t.shieldHits)&&t.shieldHits.push({id:n.id,hitX:r.x,hitY:r.y,team:n.team,amount:E}),R>0&&t&&Array.isArray(t.healthHits)&&t.healthHits.push({id:n.id,hitX:r.x,hitY:r.y,team:n.team,amount:R}),Array.isArray(t.damageEvents)||(t.damageEvents=[]),r.ownerId!=null&&t.damageEvents.push({ownerId:r.ownerId,dmg:h}),t.bullets.splice(e,1),p&&t.explosions&&t.explosions.push(p),n.alive||(Array.isArray(t.killEvents)||(t.killEvents=[]),t.killEvents.push({id:n.id,type:n.type,ownerCarrier:n.ownerCarrier,level:n.level,team:n.team,killerId:r.ownerId,killerTeam:r.team,x:n.x,y:n.y}));break}}}}var ne=Math.PI*2,X=(t,i)=>t+(i-t)*Math.random(),ye=(t,i,a)=>Math.max(i,Math.min(a,t)),ve=t=>{if(typeof document<"u"){let i=document.getElementById("toast");i&&(i.textContent=t,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}};function vt(t){ve=t}var W=[];function oe(){W.length=0;let t=[.2,.5,1],i=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;for(let e of t)for(let r=0;r<120;r++)W.push({x:X(0,i),y:X(0,a),r:X(.3,1.8)*e,d:e,tw:X(.4,1),phase:X(0,ne)})}oe();var O=[],L=[],Y=class{constructor(i,a,e,r,n,o){this.x=i,this.y=a,this.vx=e,this.vy=r,this.life=n,this.max=n,this.color=o}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}};function j(t,i,a,e,r,n){let o;return O.length>0?(o=O.pop(),o.x=t,o.y=i,o.vx=a,o.vy=e,o.life=r,o.max=r,o.color=n):o=new Y(t,i,a,e,r,n),L.push(o),o}function se(t){O.length<2e3&&O.push(t)}var C=[],B=[],D=[],v=[],F=[],K=0,I={[d.RED]:0,[d.BLUE]:0},z={[d.RED]:0,[d.BLUE]:0};function Ee(){z[d.RED]=0,z[d.BLUE]=0}function Te(t){K=Number(t)||0,I[d.RED]=0,I[d.BLUE]=0}function Re(){return K}var xe=null;function re(t){xe=t}function q(t,i=null){if(!xe||!xe.checked)return;let a=2,e=["frigate","corvette","destroyer","carrier"],r=(o,c)=>{for(let l=0;l<c;l++){let u=e[V(0,e.length-1)],h=typeof window<"u"?window.innerWidth:1024,g=typeof window<"u"?window.innerHeight:768,M=o===d.RED?f(40,Math.max(120,h*.35)):f(Math.max(h*.65,h-240),h-40),p=f(80,Math.max(120,g-80));v.push(new H(o,M,p,u))}},n=o=>{if(v.filter(l=>l.alive&&l.team===o).length<a&&(z[o]-=t,z[o]<=0)){let l=V(1,6);r(o,l),z[o]=f(3,8),ve(`Reinforcements: +${l} ${o===d.RED?"Red":"Blue"}`)}};i===null?(n(d.RED),n(d.BLUE)):n(i)}function we(t=null){if(v.length=0,F.length=0,L.length=0,C.length=0,B.length=0,D.length=0,t!==null)Ue(t>>>0),ve(`Seed set to ${t>>>0}`);else try{Ge()}catch{}let i=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;v.push(...ie(d.RED,12,i*.25,a*.5)),v.push(...ie(d.BLUE,12,i*.75,a*.5))}var be=(t,i,a)=>{let e=[];if(t.launchCooldown-=a,t.launchCooldown<=0){if((Array.isArray(t.activeFighters)?t.activeFighters.length:0)<(t.maxFighters||6)){let n=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<n&&!(t.activeFighters.length>=(t.maxFighters||6));o++){let c=f(0,ne),l=t.radius+12+f(4,12),u=t.x+Math.cos(c)*l,h=t.y+Math.sin(c)*l,g=new H(t.team,u,h,"fighter"),M=f(40,120);g.vx=Math.cos(c)*M+(t.vx||0)*.2,g.vy=Math.sin(c)*M+(t.vy||0)*.2,g.ownerCarrier=t.id,t.activeFighters.push(g.id),e.push(g)}}t.launchCooldown=f(2.5,6)}return e};function Et(t){be=t}var Ve=(t,i)=>{q(t)};function Tt(t){Ve=t}var Rt=(t,i,a,e)=>ie(t,i,a,e);function wt(t){Rt=t}function Ae(t){if(K<=0){q(t);return}I[d.RED]+=t,I[d.BLUE]+=t,I[d.RED]>=K&&(q(I[d.RED],d.RED),I[d.RED]=0),I[d.BLUE]>=K&&(q(I[d.BLUE],d.BLUE),I[d.BLUE]=0)}function _e(t,i,a){for(let n of W)n.phase+=t*.8*n.d;for(let n of v){if(!n.alive||!n.isCarrier)continue;let o=be(n,v,t);if(Array.isArray(o)&&o.length)for(let c of o)v.push(c)}for(let n of v)n.update(t,v);for(let n=F.length-1;n>=0;n--){let o=F[n];if(o.update(t),!o.alive()){F.splice(n,1);continue}}let r={ships:v,bullets:F,score:{red:0,blue:0},particles:L,explosions:[],shieldHits:[]};if(We(r,t,{W:i,H:a}),r.explosions&&r.explosions.length)for(let n of r.explosions){C.push({x:n.x,y:n.y,r:2,life:.25,team:n.team});for(let o=0;o<20;o++){let c=f(0,ne),l=f(40,220);j(n.x,n.y,Math.cos(c)*l,Math.sin(c)*l,X(.2,1),"rgba(255,255,255,$a)")}}if(Array.isArray(r.shieldHits)&&r.shieldHits.length)for(let n of r.shieldHits){let o=v.find(u=>u.id===n.id),c=o?o.x:n.hitX,l=o?o.y:n.hitY;C.push({x:c,y:l,r:6+Math.min(12,n.amount),life:.12,team:n.team,shieldHit:!0});for(let u=0;u<6;u++){let h=f(0,ne),g=f(40,120);j(n.hitX,n.hitY,Math.cos(h)*g,Math.sin(h)*g,X(.12,.4),"rgba(200,230,255,$a)")}if(o){let u=Math.atan2(n.hitY-l,n.hitX-c);B.push({id:o.id,angle:u,life:.22,amount:n.amount})}}if(Array.isArray(r.healthHits)&&r.healthHits.length)for(let n of r.healthHits){let o=v.find(c=>c.id===n.id);o&&D.push({id:o.id,life:.45,amount:n.amount})}if(Array.isArray(r.damageEvents)&&r.damageEvents.length){for(let n of r.damageEvents)if(n&&n.ownerId!=null&&typeof n.dmg=="number"){let o=v.find(c=>c.id===n.ownerId);o&&o.gainXp(n.dmg*.05)}}if(Array.isArray(r.killEvents)&&r.killEvents.length){for(let n of r.killEvents)if(n){if(n.killerTeam===d.RED?r.score.red++:n.killerTeam===d.BLUE&&r.score.blue++,n.killerId!=null){let o=v.find(c=>c.id===n.killerId);o&&o.gainXp(20+(n.level||1)*.2)}if(n.type==="fighter"&&typeof n.ownerCarrier=="number"){let o=v.find(c=>c.id===n.ownerCarrier);if(o&&Array.isArray(o.activeFighters)){let c=o.activeFighters.indexOf(n.id);c>=0&&o.activeFighters.splice(c,1)}}if(n.type==="carrier"){let o=n.id;for(let l of v)l.alive&&l.type==="fighter"&&l.ownerCarrier===o&&(l.ownerCarrier=null);let c=v.find(l=>l.id===o);c&&Array.isArray(c.activeFighters)&&(c.activeFighters.length=0)}}}Ve(t,v);for(let n=L.length-1;n>=0;n--){let o=L[n];o.update(t),o.life<=0&&(L.splice(n,1),se(o))}for(let n=C.length-1;n>=0;n--){let o=C[n];o.life-=t,o.r+=600*t,o.life<=0&&C.splice(n,1)}for(let n=B.length-1;n>=0;n--){let o=B[n];o.life-=t,o.life<=0&&B.splice(n,1)}for(let n=D.length-1;n>=0;n--){let o=D[n];o.life-=t,o.life<=0&&D.splice(n,1)}return{ships:v,bullets:F,particles:L,flashes:C,shieldFlashes:B,healthFlashes:D,stars:W}}function bt(t,i=0){if(!(!t||!Array.isArray(t.ships))){for(let a of t.ships){if(!a.alive||!a.isCarrier)continue;let e=be(a,t.ships,i);if(Array.isArray(e)&&e.length)for(let r of e)t.ships.push(r)}if(Array.isArray(t.damageEvents)&&t.damageEvents.length){for(let a of t.damageEvents)if(a&&a.ownerId!=null&&typeof a.dmg=="number"){let e=t.ships.find(r=>r.id===a.ownerId);e&&e.gainXp(a.dmg*.05)}}if(Array.isArray(t.killEvents)&&t.killEvents.length){for(let a of t.killEvents)if(a){if(t.score||(t.score={red:0,blue:0}),a.killerTeam===d.RED?t.score.red++:a.killerTeam===d.BLUE&&t.score.blue++,a.killerId!=null){let e=t.ships.find(r=>r.id===a.killerId);e&&e.gainXp(20+(a.level||1)*.2)}if(a.type==="fighter"&&typeof a.ownerCarrier=="number"){let e=t.ships.find(r=>r.id===a.ownerCarrier);if(e&&Array.isArray(e.activeFighters)){let r=e.activeFighters.indexOf(a.id);r>=0&&e.activeFighters.splice(r,1)}}if(a.type==="carrier"){let e=a.id;for(let n of t.ships)n.alive&&n.type==="fighter"&&n.ownerCarrier===e&&(n.ownerCarrier=null);let r=t.ships.find(n=>n.id===e);r&&Array.isArray(r.activeFighters)&&(r.activeFighters.length=0)}}}}}var T=null;typeof document<"u"&&(T=document.getElementById("world"));!T&&typeof document<"u"&&(T=document.createElement("canvas"),T.id="world",document.body&&document.body.appendChild(T));if(typeof globalThis.Path2D>"u"){class t{constructor(){}moveTo(){}lineTo(){}quadraticCurveTo(){}ellipse(){}arc(){}closePath(){}}globalThis.Path2D=t}var s=null;if(T&&typeof T.getContext=="function")try{s=T.getContext("2d")}catch{s=null}if(!s){let t=()=>{};s={beginPath:t,moveTo:t,lineTo:t,quadraticCurveTo:t,arc:t,ellipse:t,fill:t,stroke:t,closePath:t,fillRect:t,clearRect:t,createLinearGradient:()=>({addColorStop:t}),createRadialGradient:()=>({addColorStop:t}),fillText:t,measureText:()=>({width:0}),setLineDash:t,save:t,restore:t,translate:t,rotate:t,clip:t,shadowBlur:0,shadowColor:"",globalAlpha:1,fillStyle:"",strokeStyle:"",lineWidth:1,font:"",textAlign:"start",globalCompositeOperation:"source-over"},T&&(T.getContext=()=>s)}var b=T&&T.width?T.width=typeof window<"u"?window.innerWidth:1024:1024,_=T&&T.height?T.height=typeof window<"u"?window.innerHeight:768:768;typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",()=>{b=T.width=window.innerWidth,_=T.height=window.innerHeight,nt(),Mt()});var k=Math.PI*2,Se=ye;function ae(t){let i=document.getElementById("toast");i.textContent=t,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400)}var it=W,Mt=oe,Pe=new Map;function ci(t){if(Pe.has(t))return Pe.get(t);let i=new Path2D;return t==="corvette"?(i.moveTo(1.5,0),i.lineTo(-1,-.7),i.lineTo(-.4,0),i.lineTo(-1,.7),i.closePath(),i.ellipse(0,0,.35,.25,0,0,k)):t==="frigate"?(i.moveTo(1.6,0),i.quadraticCurveTo(.2,-1.1,-1.1,-.6),i.lineTo(-.6,0),i.lineTo(-1.1,.6),i.quadraticCurveTo(.2,1.1,1.6,0),i.closePath()):t==="destroyer"?(i.moveTo(1.9,0),i.lineTo(.3,-1.1),i.lineTo(-1.4,-.6),i.lineTo(-1.4,.6),i.lineTo(.3,1.1),i.closePath()):t==="carrier"?i.ellipse(0,0,1.6,1,0,0,k):t==="fighter"?(i.moveTo(1.2,0),i.lineTo(-.6,-.45),i.lineTo(-.2,0),i.lineTo(-.6,.45),i.closePath(),i.ellipse(.25,0,.25,.15,0,0,k)):(i.moveTo(1.4,0),i.lineTo(-1,-.8),i.lineTo(-.4,0),i.lineTo(-1,.8),i.closePath()),Pe.set(t,i),i}var Ce=null;function nt(){Ce=s.createRadialGradient(b*.6,_*.3,50,b*.6,_*.3,Math.max(b,_)),Ce.addColorStop(0,"rgba(60,80,140,0.10)"),Ce.addColorStop(1,"rgba(10,12,20,0.0)")}nt();var hi=O,ot=j,fi=se,di=Y;var U=(t,i=1)=>t===d.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function Pt(t){if(t.life<=0)return;let i=t.life/t.max;s.fillStyle=(t.color||"").replace?t.color.replace("$a",i.toFixed(3)):t.color,s.fillRect(t.x,t.y,2,2)}var Ie=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;let a=Q.some(p=>p.shieldHit&&p.x===i.x&&p.y===i.y&&p.life>0);if(fe){let p=i.x-Math.cos(i.angle)*i.radius*1.2,E=i.y-Math.sin(i.angle)*i.radius*1.2;ot(p,E,-i.vx*.05+f(-10,10),-i.vy*.05+f(-10,10),.25,U(i.team,"$a"))}s.save(),s.translate(i.x,i.y),s.rotate(i.angle),s.shadowBlur=12,s.shadowColor=U(i.team,.9);let e=i.radius||8;if(s.fillStyle=U(i.team,.96),i.type==="corvette"?(s.beginPath(),s.moveTo(e*1.5,0),s.lineTo(-e,-e*.7),s.lineTo(-e*.4,0),s.lineTo(-e,e*.7),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.85)",s.beginPath(),s.ellipse(0,0,e*.35,e*.25,0,0,k),s.fill()):i.type==="frigate"?(s.beginPath(),s.moveTo(e*1.6,0),s.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),s.lineTo(-e*.6,0),s.lineTo(-e*1.1,e*.6),s.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.75)",s.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(s.beginPath(),s.moveTo(e*1.9,0),s.lineTo(e*.3,-e*1.1),s.lineTo(-e*1.4,-e*.6),s.lineTo(-e*1.4,e*.6),s.lineTo(e*.3,e*1.1),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.7)",s.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(s.beginPath(),s.ellipse(0,0,e*1.6,e*1,0,0,k),s.fill(),s.fillStyle="rgba(255,255,255,.18)",s.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(s.beginPath(),s.moveTo(e*1.2,0),s.lineTo(-e*.6,-e*.45),s.lineTo(-e*.2,0),s.lineTo(-e*.6,e*.45),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.9)",s.beginPath(),s.ellipse(e*.25,0,e*.25,e*.15,0,0,k),s.fill()):(s.beginPath(),s.moveTo(e*1.4,0),s.lineTo(-e,-e*.8),s.lineTo(-e*.4,0),s.lineTo(-e,e*.8),s.closePath(),s.fill()),s.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let p=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,E=e+4+(1-p)*2;s.save(),s.beginPath(),s.arc(i.x,i.y,E,0,k);let R=s.createRadialGradient(i.x,i.y,E*.6,i.x,i.y,E);R.addColorStop(0,`rgba(140,200,255,${.06})`),R.addColorStop(1,`rgba(80,160,255,${.02})`),s.fillStyle=R,s.globalCompositeOperation="lighter",s.fill();for(let A of st){if(A.id!==i.id)continue;let x=Math.max(0,Math.min(1,A.life/.22)),m=i.shieldMax&&i.shieldMax>0?A.amount/i.shieldMax:Math.min(1,A.amount/(i.hpMax*.6||1)),y=Math.max(.08,Math.min(1,m)),S=(Math.PI*.25+Math.PI*.6*(1-x))*(.6+1.6*y),G=A.angle-S/2,Z=A.angle+S/2,Fe=E+4*(1-x)+2*y;s.beginPath(),s.arc(i.x,i.y,Fe,G,Z),s.lineWidth=(3+6*x)*(1+4*y);let at=Math.min(1,.25+x*(.9+1.6*y));s.strokeStyle=`rgba(160,220,255,${at})`,s.save(),s.shadowBlur=12*y,s.shadowColor="rgba(140,200,255,0.8)",s.stroke(),s.restore()}s.restore()}let r=Math.max(16,e*3.2),n=Math.max(3,e*.4),o=i.x-r/2,c=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let p=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;s.fillStyle="rgba(255,255,255,.08)",s.fillRect(o,c,r,n),s.fillStyle="rgba(80,160,255,.95)",s.fillRect(o,c,r*p,n)}let l=i.y+(e+8),u=Math.max(0,Math.min(1,i.hp/i.hpMax)),h=Math.min(6,n);s.beginPath(),s.moveTo(o+h,l),s.lineTo(o+r-h,l),s.quadraticCurveTo(o+r,l,o+r,l+h),s.lineTo(o+r,l+n-h),s.quadraticCurveTo(o+r,l+n,o+r-h,l+n),s.lineTo(o+h,l+n),s.quadraticCurveTo(o,l+n,o,l+n-h),s.lineTo(o,l+h),s.quadraticCurveTo(o,l,o+h,l),s.closePath(),s.fillStyle="rgba(255,255,255,.08)",s.fill();let g=rt.find(p=>p.id===i.id&&p.life>0),M=`rgba(120,220,120,${.95})`;if(g){let p=Math.max(0,Math.min(1,g.life/.45)),E=Math.min(1,g.amount/(i.hpMax||1)),R=Math.floor(220*(1-E*p)),A=Math.floor(60+160*(1-p*E));M=`rgba(${Math.min(255,R)},${Math.min(255,A)},60,${.95})`}s.save(),s.beginPath(),s.moveTo(o+h,l),s.lineTo(o+r-h,l),s.quadraticCurveTo(o+r,l,o+r,l+h),s.lineTo(o+r,l+n-h),s.quadraticCurveTo(o+r,l+n,o+r-h,l+n),s.lineTo(o+h,l+n),s.quadraticCurveTo(o,l+n,o,l+n-h),s.lineTo(o,l+h),s.quadraticCurveTo(o,l,o+h,l),s.closePath(),s.clip(),s.fillStyle=M,s.fillRect(o,l,r*u,n),s.restore(),typeof i.level=="number"&&i.level>1&&(s.save(),s.fillStyle="rgba(255,255,255,0.95)",s.font="700 12px system-ui, sans-serif",s.textAlign="center",s.fillText(`Lv ${i.level}`,i.x,i.y-(e+18)),s.restore())}},P=v,de=F,ue=L,Q=C,st=B,rt=D,$=new Map,ce=!1,he=1,fe=!0,le=0;function Be(t=null){return we(t)}function Ct(t){let i=_e(t,b,_);P=v,de=F,ue=L,Q=C,st=B,rt=D;let a=new Set(P.map(e=>e.id));for(let e of P)$.has(e.id)?$.get(e.id).syncFromLogic():$.set(e.id,new Ie(e));for(let e of Array.from($.keys()))a.has(e)||$.delete(e)}function Qe(){s.clearRect(0,0,b,_);let t=s.createRadialGradient(b*.6,_*.3,50,b*.6,_*.3,Math.max(b,_));t.addColorStop(0,"rgba(60,80,140,0.10)"),t.addColorStop(1,"rgba(10,12,20,0.0)"),s.fillStyle=t,s.fillRect(0,0,b,_);for(let e of it){let r=.6+.4*Math.sin(e.phase);s.globalAlpha=Se(.5*r*(.6+.5*e.d),0,1),s.fillStyle="#e9f2ff",s.fillRect(e.x,e.y,e.r,e.r)}s.globalAlpha=1;for(let e of Q){let r=Se(e.life/.25,0,1);s.strokeStyle=U(e.team,r*.6),s.lineWidth=2,s.beginPath(),s.arc(e.x,e.y,e.r,0,k),s.stroke()}for(let e of de)s.save(),s.shadowBlur=12,s.shadowColor=U(e.team,.9),s.fillStyle=U(e.team,.95),s.beginPath(),s.arc(e.x,e.y,e.radius||2.2,0,k),s.fill(),s.restore();for(let e of ue)Pt(e);for(let e of $.values())e.draw();let i=P.some(e=>e.alive&&e.team===d.RED),a=P.some(e=>e.alive&&e.team===d.BLUE);if(!i||!a){s.save(),s.textAlign="center",s.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":a?"Blue":"Nobody",r=i?U(d.RED,.95):a?U(d.BLUE,.95):"rgba(255,255,255,.9)";s.fillStyle=r,s.shadowBlur=14,s.shadowColor=r,s.fillText(`${e} Wins!`,b/2,64),s.restore()}}function De(t){le||(le=t);let i=(t-le)/1e3;le=t;let a=Se(i,0,.033)*(ce?he:0);if(Ct(a),w&&w.type==="webgl"&&typeof w.render=="function")try{w.render({W:b,H:_,ships:P,bullets:de,particles:ue,flashes:Q,stars:it,shipsVMap:$,score})}catch(e){console.error("WebGL render error, falling back to 2D render",e),Qe()}else Qe();Nt(),requestAnimationFrame(De)}var Ze=document.getElementById("startPause"),Lt=document.getElementById("reset"),St=document.getElementById("addRed"),It=document.getElementById("addBlue"),et=document.getElementById("toggleTrails"),tt=document.getElementById("speed"),Bt=document.getElementById("redScore"),Dt=document.getElementById("blueScore"),Ft=document.getElementById("stats"),kt=document.getElementById("seedBtn"),Ht=document.getElementById("formationBtn"),J=document.getElementById("continuousCheckbox");J||(J=document.createElement("input"),J.type="checkbox",J.id="continuousCheckbox");Me&&typeof re=="function"&&re(J);function Nt(){Bt.textContent=`Red ${score.red}`,Dt.textContent=`Blue ${score.blue}`,Ft.textContent=`Ships: ${P.filter(t=>t.alive).length}  Bullets: ${de.length}  Particles: ${ue.length}`}var ui=Ee;function Ut(t){return Te(t)}function Le(){return Re()}var pi=Ae,mi=q;function Gt(){if(typeof window>"u"||!document||window.__uiHandlersInstalled)return;Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1}),Ze.addEventListener("click",()=>{ce=!ce,Ze.textContent=ce?"\u23F8 Pause":"\u25B6 Start"}),Lt.addEventListener("click",()=>{Be()}),St.addEventListener("click",()=>{P.push(new H(d.RED,f(40,b*.35),f(80,_-80))),ae("+1 Red")}),It.addEventListener("click",()=>{P.push(new H(d.BLUE,f(b*.65,b-40),f(80,_-80))),ae("+1 Blue")}),et.addEventListener("click",()=>{fe=!fe,et.textContent=`\u2604 Trails: ${fe?"On":"Off"}`}),tt.addEventListener("click",()=>{let a=[.5,1,2,4],e=(a.indexOf(he)+1)%a.length;he=a[e],tt.textContent=`Speed: ${he}\xD7`}),kt.addEventListener("click",()=>{let a=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);a!==null&&Be(Number(a))}),Ht.addEventListener("click",()=>{let a=P.filter(o=>o.alive&&o.team===d.RED),e=P.filter(o=>o.alive&&o.team===d.BLUE),r=20,n=6;a.forEach((o,c)=>{let l=c%n,u=Math.floor(c/n);o.x=b*.25-l*20,o.y=_*.5+(u-n/2)*r,o.vx=o.vy=0}),e.forEach((o,c)=>{let l=c%n,u=Math.floor(c/n);o.x=b*.75+l*20,o.y=_*.5+(u-n/2)*r,o.vx=o.vy=0}),ae("Fleets re-formed")});let t=document.getElementById("reinforceFreqBtn"),i=[0,.5,1,2];if(t){let a=()=>{let e=Le();t.textContent=e>0?`${e}s`:"Every step"};a(),t.addEventListener("click",()=>{let e=Le(),r=(i.indexOf(e)+1)%i.length;Ut(i[r]),a();let n=Le();ae(`Reinforcement check: ${n>0?n+"s":"every step"}`)})}T.addEventListener("click",a=>{Q.push({x:a.clientX,y:a.clientY,r:24,life:.25,team:V(0,1)});for(let r=0;r<24;r++){let n=f(0,k),o=f(40,220);ot(a.clientX,a.clientY,Math.cos(n)*o,Math.sin(n)*o,f(.2,1),"rgba(255,255,255,$a)")}})}P.length===0&&Be();var w=null;async function gi(t={}){let{canvas:i=T,preferWebGL:a=!0,startLoop:e=!0}=t;if(!i)throw new Error("No canvas available to initialize renderer");if(Gt(),a&&i.getContext){let r=i.getContext("webgl2"),n=r?null:i.getContext("webgl");if(r||n)try{let{createWebGLRenderer:o}=await Promise.resolve().then(()=>(Je(),je));w=o(i,{webgl2:!!r}),w.init(),e&&w.start(()=>{requestAnimationFrame(De)});return}catch(o){console.warn("WebGL init failed, falling back to 2D canvas renderer",o)}}w||(w={type:"canvas"},e&&requestAnimationFrame(De))}function xi(){return w?w.type:null}function yi(){w&&typeof w.stop=="function"&&w.stop(),w&&typeof w.destroy=="function"&&w.destroy(),w=null}export{di as Particle,ot as acquireParticle,Ce as backgroundGradient,de as bullets,Se as clamp,pi as evaluateReinforcement,Q as flashes,ci as getHullPath,Le as getReinforcementInterval,xi as getRendererType,mi as handleReinforcement,rt as healthFlashes,Pe as hullPaths,gi as initRenderer,Mt as initStars,hi as particlePool,ue as particles,nt as recomputeBackgroundGradient,fi as releaseParticle,Be as reset,ui as resetReinforcementCooldowns,Ut as setReinforcementInterval,st as shieldFlashes,P as ships,$ as shipsVMap,it as stars,yi as stopRenderer,U as teamColor};

</script>
<!-- END_INLINED_BUNDLE -->
</body>
</html>