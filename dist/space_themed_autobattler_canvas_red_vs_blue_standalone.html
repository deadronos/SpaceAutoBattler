<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
  /* moved inline styles into CSS to satisfy linter */
  #bottomRight .continuous-label { color: var(--ui-color,#eaeff8); margin-right: 6px; }
  #bottomRight .muted { opacity: .7; }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
  <input id="continuousCheckbox" type="checkbox" />
  <label for="continuousCheckbox" class="continuous-label">Continuous</label>
  <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span class="muted">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  























































<!-- BEGIN_INLINED_BUNDLE -->
<script type="module">
var $e=Object.defineProperty;var mt=(t,e,a)=>e in t?$e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var gt=(t,e)=>()=>(t&&(e=t(t=0)),e);var qe=(t,e)=>{for(var a in e)$e(t,a,{get:e[a],enumerable:!0})};var Ve=(t,e,a)=>mt(t,typeof e!="symbol"?e+"":e,a);var nt={};qe(nt,{createWebGLRenderer:()=>At});function At(t,e={}){let{webgl2:a=!1}=e,n=null,s=!1,i={type:"webgl",webgl2:a,init(){try{if(n=t.getContext(a?"webgl2":"webgl"),!n)return;n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),console.log("WebGL renderer initialized successfully")}catch(o){n=null,console.warn("WebGL init failed:",o.message||o)}},start(o){s=!0,typeof o=="function"&&o()},stop(){s=!1},isRunning(){return s},render(o){n&&(n.viewport(0,0,t.width,t.height),n.clearColor(.02,.02,.03,1),n.clear(n.COLOR_BUFFER_BIT))}};return i.destroy=function(){n&&(n=null),s=!1},i}var it=gt(()=>{});var ve=!1,oe=123456789;function Ye(t){ve=!0,oe=t>>>0}function ze(){ve=!1}function yt(){return ve?(oe=1664525*oe+1013904223>>>0,oe/4294967296):Math.random()}function d(t=0,e=1){return t+(e-t)*yt()}function Q(t,e){return Math.floor(d(t,e+1))}var Ke={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},je=1.2,Te=.6;var u={RED:0,BLUE:1},be=class{constructor(e,a,n,s,i,o=null){this.x=e,this.y=a,this.vx=n,this.vy=s,this.team=i,this.ownerId=o,this.life=2.5,this.radius=2.2,this.dmg=d(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:n}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<n+50}},re=class re{constructor(e,a,n,s="corvette"){this.team=e,this.x=a,this.y=n,this.vx=0,this.vy=0,this.angle=0,this.type=s;let i={corvette:{radius:8,maxSpeed:d(120,160),accel:240,turn:6.5,hp:d(40,70),reload:d(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:d(90,120),accel:200,turn:5,hp:d(80,120),reload:d(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:d(60,90),accel:150,turn:3.2,hp:d(150,220),reload:d(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:d(40,70),accel:90,turn:2,hp:d(220,300),reload:d(.6,1.2),vision:360,range:260,launchBase:d(3.5,6)},fighter:{radius:6,maxSpeed:d(160,220),accel:300,turn:8,hp:d(18,32),reload:d(.12,.22),vision:180,range:120}},o=i[s]||i.corvette;this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=o.turn||Ke[s]||4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=re._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,s==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchBase*d(.8,1.4),this.launchAmount=Math.max(1,Math.floor(d(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,n=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+n*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,n=1/0,s=this.vision*this.vision;for(let i of e){if(!i.alive||i.team===this.team)continue;let o=i.x-this.x,h=i.y-this.y,c=o*o+h*h;c<s&&c<n&&(n=c,a=i)}return a}update(e,a){if(!this.alive)return;let n=this.pickTarget(a),s=this.recentHitTimer>0,i=0,o=0,h=1;if(n&&!s){let m=n.x-this.x,E=n.y-this.y;h=Math.hypot(m,E)||1;let R=Math.max(0,Math.min(1.2,h/240)),N=n.x+(n.vx||0)*R,P=n.y+(n.vy||0)*R;i=N-this.x,o=P-this.y;let Y=Math.hypot(i,o)||1;i/=Y,o/=Y}else if(n&&s){let m=n.x-this.x,E=n.y-this.y;h=Math.hypot(m,E)||1,i=-(m/h),o=-(E/h)}else i=Math.cos(this.angle),o=Math.sin(this.angle);let c=0,f=0,l=0,g=26;for(let m of a){if(!m.alive||m===this||m.team!==this.team)continue;let E=this.x-m.x,R=this.y-m.y,N=E*E+R*R;if(N<g*g&&N>1){let P=Math.sqrt(N);c+=E/P,f+=R/P,l++}}l>0&&(c/=l,f/=l);let y=Math.atan2(o,i)-this.angle;for(;y>Math.PI;)y-=2*Math.PI;for(;y<-Math.PI;)y+=2*Math.PI;let w=this.turn*e;y>w?y=w:y<-w&&(y=-w),this.angle+=y;let x=s?this.accel*je:this.accel;this.vx+=Math.cos(this.angle)*x*e,this.vy+=Math.sin(this.angle)*x*e,l>0&&(this.vx+=c*(this.accel*Te)*e,this.vy+=f*(this.accel*Te)*e);let M=Math.hypot(this.vx,this.vy);if(M>this.maxSpeed){let m=this.maxSpeed/M;this.vx*=m,this.vy*=m}if(this.x+=this.vx*e,this.y+=this.vy*e,n){let m=n.x-this.x,E=n.y-this.y,R=Math.hypot(m,E)||1;if(R<this.range){let N=Math.cos(this.angle)*(m/R)+Math.sin(this.angle)*(E/R);if(this.cooldown<=0&&N>.2){let P=300+d(-20,20),Y=m/R,J=E/R;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new be(this.x+Y*12,this.y+J*12,Y*P+this.vx*.2,J*P+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-e))}damage(e){let a=e,n=0;return this.shield>0&&e>0&&(n=Math.min(this.shield,e),this.shield-=n,e-=n),e>0&&(this.hp-=e),(n>0||a>0&&e>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};Ve(re,"_id",1);var W=re;function se(t,e,a,n,s=80){let i=[];for(let o=0;o<e;o++){let h=o%6*20+d(-10,10),c=Math.floor(o/6)*20+d(-10,10),f=d(0,1),l="corvette";f<.45?l="corvette":f<.75?l="frigate":f<.92?l="destroyer":l="carrier",i.push(new W(t,a+(t===u.RED?-h:h),n+c,l))}return i}var ke={};qe(ke,{Particle:()=>z,acquireParticle:()=>te,bullets:()=>G,clamp:()=>Re,evaluateReinforcement:()=>Ae,flashes:()=>A,getReinforcementInterval:()=>Pe,handleReinforcement:()=>O,healthFlashes:()=>F,initStars:()=>le,particlePool:()=>q,particles:()=>B,processStateEvents:()=>It,releaseParticle:()=>ce,reset:()=>Le,resetReinforcementCooldowns:()=>_e,setCarrierLaunchStrategy:()=>_t,setContinuousCheckbox:()=>he,setReinforcementInterval:()=>Se,setReinforcementStrategy:()=>St,setSpawnCompositionStrategy:()=>Lt,setToast:()=>Ct,shieldFlashes:()=>D,ships:()=>T,simulate:()=>Be,stars:()=>$});function Je(t,e,a={W:800,H:600}){for(let n of t.ships)n.alive&&n.update(e,t.ships,t.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let n=a.W,s=a.H;for(let i of t.ships){if(!i.alive)continue;let o=i.radius||0;i.x<-o?i.x+=n+o*2:i.x>n+o&&(i.x-=n+o*2),i.y<-o?i.y+=s+o*2:i.y>s+o&&(i.y-=s+o*2)}}for(let n=t.bullets.length-1;n>=0;n--){let s=t.bullets[n];s.update(e),s.alive(a)||t.bullets.splice(n,1)}for(let n=t.bullets.length-1;n>=0;n--){let s=t.bullets[n];for(let i of t.ships){if(!i.alive||i.team===s.team)continue;let o=i.x-s.x,h=i.y-s.y,c=o*o+h*h,f=i.radius+s.radius;if(c<f*f){let l=s.dmg,g=typeof i.shield=="number"?i.shield:0,p=typeof i.hp=="number"?i.hp:0,y=i.damage(l),w=Math.max(0,g-(typeof i.shield=="number"?i.shield:0)),x=Math.max(0,p-(typeof i.hp=="number"?i.hp:0));w>0&&t&&Array.isArray(t.shieldHits)&&t.shieldHits.push({id:i.id,hitX:s.x,hitY:s.y,team:i.team,amount:w}),x>0&&t&&Array.isArray(t.healthHits)&&t.healthHits.push({id:i.id,hitX:s.x,hitY:s.y,team:i.team,amount:x}),Array.isArray(t.damageEvents)||(t.damageEvents=[]),s.ownerId!=null&&t.damageEvents.push({ownerId:s.ownerId,dmg:l}),t.bullets.splice(n,1),y&&t.explosions&&t.explosions.push(y),i.alive||(Array.isArray(t.killEvents)||(t.killEvents=[]),t.killEvents.push({id:i.id,type:i.type,ownerCarrier:i.ownerCarrier,level:i.level,team:i.team,killerId:s.ownerId,killerTeam:s.team,x:i.x,y:i.y}));break}}}}var ae=Math.PI*2,X=(t,e)=>t+(e-t)*Math.random(),Re=(t,e,a)=>Math.max(e,Math.min(a,t)),Ce=t=>{if(typeof document<"u"){let e=document.getElementById("toast");e&&(e.textContent=t,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400))}};function Ct(t){Ce=t}var $=[];function le(){$.length=0;let t=[.2,.5,1],e=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;for(let n of t)for(let s=0;s<120;s++)$.push({x:X(0,e),y:X(0,a),r:X(.3,1.8)*n,d:n,tw:X(.4,1),phase:X(0,ae)})}le();var q=[],B=[],z=class{constructor(e,a,n,s,i,o){this.x=e,this.y=a,this.vx=n,this.vy=s,this.life=i,this.max=i,this.color=o}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}};function te(t,e,a,n,s,i){let o;return q.length>0?(o=q.pop(),o.x=t,o.y=e,o.vx=a,o.vy=n,o.life=s,o.max=s,o.color=i):o=new z(t,e,a,n,s,i),B.push(o),o}function ce(t){q.length<2e3&&q.push(t)}var A=[],D=[],F=[],T=[],G=[],Z=0,H={[u.RED]:0,[u.BLUE]:0},ee={[u.RED]:0,[u.BLUE]:0};function _e(){ee[u.RED]=0,ee[u.BLUE]=0}function Se(t){Z=Number(t)||0,H[u.RED]=0,H[u.BLUE]=0}function Pe(){return Z}var Me=null;function he(t){Me=t}function O(t,e=null){if(!Me||!Me.checked)return;let a=2,n=["frigate","corvette","destroyer","carrier"],s=(o,h)=>{for(let c=0;c<h;c++){let f=n[Q(0,n.length-1)],l=typeof window<"u"?window.innerWidth:1024,g=typeof window<"u"?window.innerHeight:768,p=o===u.RED?d(40,Math.max(120,l*.35)):d(Math.max(l*.65,l-240),l-40),y=d(80,Math.max(120,g-80));T.push(new W(o,p,y,f))}},i=o=>{if(T.filter(c=>c.alive&&c.team===o).length<a&&(ee[o]-=t,ee[o]<=0)){let c=Q(1,6);s(o,c),ee[o]=d(3,8),Ce(`Reinforcements: +${c} ${o===u.RED?"Red":"Blue"}`)}};e===null?(i(u.RED),i(u.BLUE)):i(e)}function Le(t=null){if(T.length=0,G.length=0,B.length=0,A.length=0,D.length=0,F.length=0,t!==null)Ye(t>>>0),Ce(`Seed set to ${t>>>0}`);else try{ze()}catch{}let e=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;T.push(...se(u.RED,12,e*.25,a*.5)),T.push(...se(u.BLUE,12,e*.75,a*.5))}var Ie=(t,e,a)=>{let n=[];if(t.launchCooldown-=a,t.launchCooldown<=0){if((Array.isArray(t.activeFighters)?t.activeFighters.length:0)<(t.maxFighters||6)){let i=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<i&&!(t.activeFighters.length>=(t.maxFighters||6));o++){let h=d(0,ae),c=t.radius+12+d(4,12),f=t.x+Math.cos(h)*c,l=t.y+Math.sin(h)*c,g=new W(t.team,f,l,"fighter"),p=d(40,120);g.vx=Math.cos(h)*p+(t.vx||0)*.2,g.vy=Math.sin(h)*p+(t.vy||0)*.2,g.ownerCarrier=t.id,t.activeFighters.push(g.id),n.push(g)}}t.launchCooldown=d(2.5,6)}return n};function _t(t){Ie=t}var tt=(t,e)=>{O(t)};function St(t){tt=t}var Pt=(t,e,a,n)=>se(t,e,a,n);function Lt(t){Pt=t}function Ae(t){if(Z<=0){O(t);return}H[u.RED]+=t,H[u.BLUE]+=t,H[u.RED]>=Z&&(O(H[u.RED],u.RED),H[u.RED]=0),H[u.BLUE]>=Z&&(O(H[u.BLUE],u.BLUE),H[u.BLUE]=0)}function Be(t,e,a){for(let i of $)i.phase+=t*.8*i.d;for(let i of T){if(!i.alive||!i.isCarrier)continue;let o=Ie(i,T,t);if(Array.isArray(o)&&o.length)for(let h of o)T.push(h)}for(let i of T)i.update(t,T);for(let i=G.length-1;i>=0;i--){let o=G[i];if(o.update(t),!o.alive()){G.splice(i,1);continue}}let s={ships:T,bullets:G,score:{red:0,blue:0},particles:B,explosions:[],shieldHits:[]};if(Je(s,t,{W:e,H:a}),s.explosions&&s.explosions.length)for(let i of s.explosions){A.push({x:i.x,y:i.y,r:2,life:.25,team:i.team});for(let o=0;o<20;o++){let h=d(0,ae),c=d(40,220);te(i.x,i.y,Math.cos(h)*c,Math.sin(h)*c,X(.2,1),"rgba(255,255,255,$a)")}}if(Array.isArray(s.shieldHits)&&s.shieldHits.length)for(let i of s.shieldHits){let o=T.find(f=>f.id===i.id),h=o?o.x:i.hitX,c=o?o.y:i.hitY;A.push({x:h,y:c,r:6+Math.min(12,i.amount),life:.12,team:i.team,shieldHit:!0});for(let f=0;f<6;f++){let l=d(0,ae),g=d(40,120);te(i.hitX,i.hitY,Math.cos(l)*g,Math.sin(l)*g,X(.12,.4),"rgba(200,230,255,$a)")}if(o){let f=Math.atan2(i.hitY-c,i.hitX-h);D.push({id:o.id,angle:f,life:.22,amount:i.amount})}}if(Array.isArray(s.healthHits)&&s.healthHits.length)for(let i of s.healthHits){let o=T.find(h=>h.id===i.id);o&&F.push({id:o.id,life:.45,amount:i.amount})}if(Array.isArray(s.damageEvents)&&s.damageEvents.length){for(let i of s.damageEvents)if(i&&i.ownerId!=null&&typeof i.dmg=="number"){let o=T.find(h=>h.id===i.ownerId);o&&o.gainXp(i.dmg*.05)}}if(Array.isArray(s.killEvents)&&s.killEvents.length){for(let i of s.killEvents)if(i){if(i.killerTeam===u.RED?s.score.red++:i.killerTeam===u.BLUE&&s.score.blue++,i.killerId!=null){let o=T.find(h=>h.id===i.killerId);o&&o.gainXp(20+(i.level||1)*.2)}if(i.type==="fighter"&&typeof i.ownerCarrier=="number"){let o=T.find(h=>h.id===i.ownerCarrier);if(o&&Array.isArray(o.activeFighters)){let h=o.activeFighters.indexOf(i.id);h>=0&&o.activeFighters.splice(h,1)}}if(i.type==="carrier"){let o=i.id;for(let c of T)c.alive&&c.type==="fighter"&&c.ownerCarrier===o&&(c.ownerCarrier=null);let h=T.find(c=>c.id===o);h&&Array.isArray(h.activeFighters)&&(h.activeFighters.length=0)}}}tt(t,T);for(let i=B.length-1;i>=0;i--){let o=B[i];o.update(t),o.life<=0&&(B.splice(i,1),ce(o))}for(let i=A.length-1;i>=0;i--){let o=A[i];o.life-=t,o.r+=600*t,o.life<=0&&A.splice(i,1)}for(let i=D.length-1;i>=0;i--){let o=D[i];o.life-=t,o.life<=0&&D.splice(i,1)}for(let i=F.length-1;i>=0;i--){let o=F[i];o.life-=t,o.life<=0&&F.splice(i,1)}return{ships:T,bullets:G,particles:B,flashes:A,shieldFlashes:D,healthFlashes:F,stars:$}}function It(t,e=0){if(!(!t||!Array.isArray(t.ships))){for(let a of t.ships){if(!a.alive||!a.isCarrier)continue;let n=Ie(a,t.ships,e);if(Array.isArray(n)&&n.length)for(let s of n)t.ships.push(s)}if(Array.isArray(t.damageEvents)&&t.damageEvents.length){for(let a of t.damageEvents)if(a&&a.ownerId!=null&&typeof a.dmg=="number"){let n=t.ships.find(s=>s.id===a.ownerId);n&&n.gainXp(a.dmg*.05)}}if(Array.isArray(t.killEvents)&&t.killEvents.length){for(let a of t.killEvents)if(a){if(t.score||(t.score={red:0,blue:0}),a.killerTeam===u.RED?t.score.red++:a.killerTeam===u.BLUE&&t.score.blue++,a.killerId!=null){let n=t.ships.find(s=>s.id===a.killerId);n&&n.gainXp(20+(a.level||1)*.2)}if(a.type==="fighter"&&typeof a.ownerCarrier=="number"){let n=t.ships.find(s=>s.id===a.ownerCarrier);if(n&&Array.isArray(n.activeFighters)){let s=n.activeFighters.indexOf(a.id);s>=0&&n.activeFighters.splice(s,1)}}if(a.type==="carrier"){let n=a.id;for(let i of t.ships)i.alive&&i.type==="fighter"&&i.ownerCarrier===n&&(i.ownerCarrier=null);let s=t.ships.find(i=>i.id===n);s&&Array.isArray(s.activeFighters)&&(s.activeFighters.length=0)}}}}}typeof window<"u"&&(window.initRenderer=ft);var _=null;typeof document<"u"&&(_=document.getElementById("world"));!_&&typeof document<"u"&&(_=document.createElement("canvas"),_.id="world",document.body&&document.body.appendChild(_));if(typeof globalThis.Path2D>"u"){class t{constructor(){}moveTo(){}lineTo(){}quadraticCurveTo(){}ellipse(){}arc(){}closePath(){}}globalThis.Path2D=t}var r=null,C=_&&_.width?_.width=typeof window<"u"?window.innerWidth:1024:1024,S=_&&_.height?_.height=typeof window<"u"?window.innerHeight:768:768;typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",()=>{C=_.width=window.innerWidth,S=_.height=window.innerHeight,at(),Bt()});var L=Math.PI*2,Fe=Re;function fe(t){let e=document.getElementById("toast");e.textContent=t,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var rt=$,Bt=le,He=new Map;function kt(t){if(He.has(t))return He.get(t);let e=new Path2D;return t==="corvette"?(e.moveTo(1.5,0),e.lineTo(-1,-.7),e.lineTo(-.4,0),e.lineTo(-1,.7),e.closePath(),e.ellipse(0,0,.35,.25,0,0,L)):t==="frigate"?(e.moveTo(1.6,0),e.quadraticCurveTo(.2,-1.1,-1.1,-.6),e.lineTo(-.6,0),e.lineTo(-1.1,.6),e.quadraticCurveTo(.2,1.1,1.6,0),e.closePath()):t==="destroyer"?(e.moveTo(1.9,0),e.lineTo(.3,-1.1),e.lineTo(-1.4,-.6),e.lineTo(-1.4,.6),e.lineTo(.3,1.1),e.closePath()):t==="carrier"?e.ellipse(0,0,1.6,1,0,0,L):t==="fighter"?(e.moveTo(1.2,0),e.lineTo(-.6,-.45),e.lineTo(-.2,0),e.lineTo(-.6,.45),e.closePath(),e.ellipse(.25,0,.25,.15,0,0,L)):(e.moveTo(1.4,0),e.lineTo(-1,-.8),e.lineTo(-.4,0),e.lineTo(-1,.8),e.closePath()),He.set(t,e),e}var ye=new Map,We=[12,20,36];function Xe(t,e){let a=ye.get(t);if(a||(a=new Map,ye.set(t,a)),a.has(e))return a.get(e);let s=Math.ceil(e*2.2*2+8),i=typeof document<"u"?document.createElement("canvas"):{width:s,height:s,getContext:()=>null};i.width=s,i.height=s;let o=i.getContext&&i.getContext("2d");if(!o){let f={canvas:i,size:s,baseRadius:e};return a.set(e,f),f}let h=s/2;o.clearRect(0,0,s,s),o.save(),o.translate(h,h),o.scale(e,e),o.fillStyle="white",o.strokeStyle="white",o.lineWidth=.02;try{o.fill(kt(t))}catch{o.beginPath(),o.arc(0,0,1,0,L),o.fill()}o.fillStyle="rgba(255,255,255,0.9)",t==="corvette"||t==="fighter"?(o.beginPath(),o.ellipse(.25,0,.25,.15,0,0,L),o.fill()):t==="frigate"?o.fillRect(-.2,-.25,.6,.5):t==="destroyer"?o.fillRect(-.9,-.18,1.2,.36):t==="carrier"&&(o.fillStyle="rgba(255,255,255,0.2)",o.fillRect(-.8,-.25,1.6,.5)),o.restore();let c={canvas:i,size:s,baseRadius:e};return a.set(e,c),c}function Ht(t){for(let e of We)Xe(t,e)}function Dt(t,e=We[1]){let a=ye.get(t);return a&&a.has(e)?a.get(e):Xe(t,e)}function st(t,e,a=typeof window<"u"&&window.devicePixelRatio||1){let n=Math.max(1,Math.round(e*a));Ht(t);let s=ye.get(t)||new Map,i=null,o=1/0;for(let[h,c]of s.entries()){let f=Math.abs(h-n);f<o&&(o=f,i=c)}return i||(i=Xe(t,n)),i}var de=null;function at(){if(!r||typeof r.createRadialGradient!="function"){de=null;return}de=r.createRadialGradient(C*.6,S*.3,50,C*.6,S*.3,Math.max(C,S)),de.addColorStop(0,"rgba(60,80,140,0.10)"),de.addColorStop(1,"rgba(10,12,20,0.0)")}at();var gn=q,lt=te,yn=ce,xn=z;var U=(t,e=1)=>t===u.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`;function Ft(t){if(t.life<=0)return;let e=t.life/t.max;r.fillStyle=(t.color||"").replace?t.color.replace("$a",e.toFixed(3)):t.color,r.fillRect(t.x,t.y,2,2)}var Ge=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=ie.some(x=>x.shieldHit&&x.x===e.x&&x.y===e.y&&x.life>0);if(ge){let x=e.x-Math.cos(e.angle)*e.radius*1.2,M=e.y-Math.sin(e.angle)*e.radius*1.2;lt(x,M,-e.vx*.05+d(-10,10),-e.vy*.05+d(-10,10),.25,U(e.team,"$a"))}let n=e.radius||8,s=Dt(e.type),i=st(e.type,n,typeof window<"u"&&window.devicePixelRatio||1);if(i&&i.canvas&&r&&typeof r.drawImage=="function"){r.save(),r.translate(e.x,e.y),r.rotate(e.angle),r.shadowBlur=12,r.shadowColor=U(e.team,.9);let x=i.size,M=n*2/(s.baseRadius*2),m=x*M,E=x*M;r.save(),r.globalCompositeOperation="source-over",r.drawImage(i.canvas,-m/2,-E/2,m,E),r.globalCompositeOperation="source-in",r.fillStyle=U(e.team,.96),r.fillRect(-m/2,-E/2,m,E),r.restore(),r.restore()}else r.save(),r.translate(e.x,e.y),r.rotate(e.angle),r.shadowBlur=12,r.shadowColor=U(e.team,.9),r.fillStyle=U(e.team,.96),e.type==="corvette"?(r.beginPath(),r.moveTo(n*1.5,0),r.lineTo(-n,-n*.7),r.lineTo(-n*.4,0),r.lineTo(-n,n*.7),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.85)",r.beginPath(),r.ellipse(0,0,n*.35,n*.25,0,0,L),r.fill()):e.type==="frigate"?(r.beginPath(),r.moveTo(n*1.6,0),r.quadraticCurveTo(n*.2,-n*1.1,-n*1.1,-n*.6),r.lineTo(-n*.6,0),r.lineTo(-n*1.1,n*.6),r.quadraticCurveTo(n*.2,n*1.1,n*1.6,0),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.75)",r.fillRect(-n*.2,-n*.25,n*.6,n*.5)):e.type==="destroyer"?(r.beginPath(),r.moveTo(n*1.9,0),r.lineTo(n*.3,-n*1.1),r.lineTo(-n*1.4,-n*.6),r.lineTo(-n*1.4,n*.6),r.lineTo(n*.3,n*1.1),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.7)",r.fillRect(-n*.9,-n*.18,n*1.2,n*.36)):e.type==="carrier"?(r.beginPath(),r.ellipse(0,0,n*1.6,n*1,0,0,L),r.fill(),r.fillStyle="rgba(255,255,255,.18)",r.fillRect(-n*.8,-n*.25,n*1.6,n*.5)):e.type==="fighter"?(r.beginPath(),r.moveTo(n*1.2,0),r.lineTo(-n*.6,-n*.45),r.lineTo(-n*.2,0),r.lineTo(-n*.6,n*.45),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.9)",r.beginPath(),r.ellipse(n*.25,0,n*.25,n*.15,0,0,L),r.fill()):(r.beginPath(),r.moveTo(n*1.4,0),r.lineTo(-n,-n*.8),r.lineTo(-n*.4,0),r.lineTo(-n,n*.8),r.closePath(),r.fill()),r.restore();if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let x=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,M=n+4+(1-x)*2;r.save(),r.beginPath(),r.arc(e.x,e.y,M,0,L);let m=r.createRadialGradient(e.x,e.y,M*.6,e.x,e.y,M);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),r.fillStyle=m,r.globalCompositeOperation="lighter",r.fill();for(let E of ct){if(E.id!==e.id)continue;let R=Math.max(0,Math.min(1,E.life/.22)),N=e.shieldMax&&e.shieldMax>0?E.amount/e.shieldMax:Math.min(1,E.amount/(e.hpMax*.6||1)),P=Math.max(.08,Math.min(1,N)),J=(Math.PI*.25+Math.PI*.6*(1-R))*(.6+1.6*P),Oe=E.angle-J/2,dt=E.angle+J/2,ut=M+4*(1-R)+2*P;r.beginPath(),r.arc(e.x,e.y,ut,Oe,dt),r.lineWidth=(3+6*R)*(1+4*P);let pt=Math.min(1,.25+R*(.9+1.6*P));r.strokeStyle=`rgba(160,220,255,${pt})`,r.save(),r.shadowBlur=12*P,r.shadowColor="rgba(140,200,255,0.8)",r.stroke(),r.restore()}r.restore()}let o=Math.max(16,n*3.2),h=Math.max(3,n*.4),c=e.x-o/2,f=e.y-(n+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let x=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;r.fillStyle="rgba(255,255,255,.08)",r.fillRect(c,f,o,h),r.fillStyle="rgba(80,160,255,.95)",r.fillRect(c,f,o*x,h)}let l=e.y+(n+8),g=Math.max(0,Math.min(1,e.hp/e.hpMax)),p=Math.min(6,h);r.beginPath(),r.moveTo(c+p,l),r.lineTo(c+o-p,l),r.quadraticCurveTo(c+o,l,c+o,l+p),r.lineTo(c+o,l+h-p),r.quadraticCurveTo(c+o,l+h,c+o-p,l+h),r.lineTo(c+p,l+h),r.quadraticCurveTo(c,l+h,c,l+h-p),r.lineTo(c,l+p),r.quadraticCurveTo(c,l,c+p,l),r.closePath(),r.fillStyle="rgba(255,255,255,.08)",r.fill();let y=ht.find(x=>x.id===e.id&&x.life>0),w=`rgba(120,220,120,${.95})`;if(y){let x=Math.max(0,Math.min(1,y.life/.45)),M=Math.min(1,y.amount/(e.hpMax||1)),m=Math.floor(220*(1-M*x)),E=Math.floor(60+160*(1-x*M));w=`rgba(${Math.min(255,m)},${Math.min(255,E)},60,${.95})`}r.save(),r.beginPath(),r.moveTo(c+p,l),r.lineTo(c+o-p,l),r.quadraticCurveTo(c+o,l,c+o,l+p),r.lineTo(c+o,l+h-p),r.quadraticCurveTo(c+o,l+h,c+o-p,l+h),r.lineTo(c+p,l+h),r.quadraticCurveTo(c,l+h,c,l+h-p),r.lineTo(c,l+p),r.quadraticCurveTo(c,l,c+p,l),r.closePath(),r.clip(),r.fillStyle=w,r.fillRect(c,l,o*g,h),r.restore(),typeof e.level=="number"&&e.level>1&&(r.save(),r.fillStyle="rgba(255,255,255,0.95)",r.font="700 12px system-ui, sans-serif",r.textAlign="center",r.fillText(`Lv ${e.level}`,e.x,e.y-(n+18)),r.restore())}},I=T,we=G,Ee=B,ie=A,ct=D,ht=F,xe={red:0,blue:0},V=new Map,K=!1,me=1,ge=!0,ue=0;function Ue(t=null){return Le(t)}function Gt(t){let e=Be(t,C,S);e&&e.score&&(xe=e.score),I=T,we=G,Ee=B,ie=A,ct=D,ht=F;let a=new Set(I.map(n=>n.id));for(let n of I)V.has(n.id)?V.get(n.id).syncFromLogic():V.set(n.id,new Ge(n));for(let n of Array.from(V.keys()))a.has(n)||V.delete(n)}function ot(){r.clearRect(0,0,C,S);let t=r.createRadialGradient(C*.6,S*.3,50,C*.6,S*.3,Math.max(C,S));t.addColorStop(0,"rgba(60,80,140,0.10)"),t.addColorStop(1,"rgba(10,12,20,0.0)"),r.fillStyle=t,r.fillRect(0,0,C,S);for(let n of rt){let s=.6+.4*Math.sin(n.phase);r.globalAlpha=Fe(.5*s*(.6+.5*n.d),0,1),r.fillStyle="#e9f2ff",r.fillRect(n.x,n.y,n.r,n.r)}r.globalAlpha=1;for(let n of ie){let s=Fe(n.life/.25,0,1);r.strokeStyle=U(n.team,s*.6),r.lineWidth=2,r.beginPath(),r.arc(n.x,n.y,n.r,0,L),r.stroke()}for(let n of we)r.save(),r.shadowBlur=12,r.shadowColor=U(n.team,.9),r.fillStyle=U(n.team,.95),r.beginPath(),r.arc(n.x,n.y,n.radius||2.2,0,L),r.fill(),r.restore();for(let n of Ee)Ft(n);for(let n of V.values())n.draw();let e=I.some(n=>n.alive&&n.team===u.RED),a=I.some(n=>n.alive&&n.team===u.BLUE);if(!e||!a){r.save(),r.textAlign="center",r.font="700 36px Inter, system-ui, sans-serif";let n=e?"Red":a?"Blue":"Nobody",s=e?U(u.RED,.95):a?U(u.BLUE,.95):"rgba(255,255,255,.9)";r.fillStyle=s,r.shadowBlur=14,r.shadowColor=s,r.fillText(`${n} Wins!`,C/2,64),r.restore()}}function Ne(t){ue||(ue=t);let e=(t-ue)/1e3;ue=t;let a=Fe(e,0,.033)*(K?me:0);if(Gt(a),v&&v.type==="webgl"&&typeof v.render=="function")try{v.render({W:C,H:S,ships:I,bullets:we,stars:rt,particles:Ee,flashes:ie,shipsVMap:V,score:xe})}catch(n){console.error("WebGL render error, falling back to 2D render",n),ot()}else ot();Xt(),requestAnimationFrame(Ne)}var wn=document.getElementById("startPause"),En=document.getElementById("reset"),vn=document.getElementById("addRed"),Tn=document.getElementById("addBlue"),bn=document.getElementById("toggleTrails"),Mn=document.getElementById("speed"),Ut=document.getElementById("redScore"),Nt=document.getElementById("blueScore"),Wt=document.getElementById("stats"),Rn=document.getElementById("seedBtn"),Cn=document.getElementById("formationBtn"),ne=document.getElementById("continuousCheckbox");ne||(ne=document.createElement("input"),ne.type="checkbox",ne.id="continuousCheckbox");ke&&typeof he=="function"&&he(ne);function Xt(){Ut.textContent=`Red ${xe.red}`,Nt.textContent=`Blue ${xe.blue}`,Wt.textContent=`Ships: ${I.filter(t=>t.alive).length}  Bullets: ${we.length}  Particles: ${Ee.length}`}function Ot(){if(typeof document>"u")return null;let t=document.getElementById("rendererBackendBadge");if(!t){t=document.createElement("div"),t.id="rendererBackendBadge",t.style.position="fixed",t.style.right="12px",t.style.top="12px",t.style.padding="6px 10px",t.style.background="rgba(0,0,0,0.6)",t.style.color="#fff",t.style.fontFamily="system-ui,Segoe UI,Roboto,Arial",t.style.fontSize="12px",t.style.borderRadius="6px",t.style.zIndex="99999",t.style.pointerEvents="auto",t.style.cursor="default",t.title="Renderer backend";try{document.body.appendChild(t)}catch{}}return t}function pe(t,e){let a=Ot();a&&(a.textContent=t,e&&(a.title=e))}var _n=_e;function $t(t){return Se(t)}function De(){return Pe()}var Sn=Ae,Pn=O;function qt(){if(typeof window>"u"||!document||window.__uiHandlersInstalled)return;Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1});let t=document.getElementById("startPause");t&&t.addEventListener("click",()=>{K=!K,t.textContent=K?"\u23F8 Pause":"\u25B6 Start"});let e=document.getElementById("reset");e&&e.addEventListener("click",()=>{Ue()});let a=document.getElementById("addRed");a&&a.addEventListener("click",()=>{I.push(new W(u.RED,d(40,C*.35),d(80,S-80))),fe("+1 Red")});let n=document.getElementById("addBlue");n&&n.addEventListener("click",()=>{I.push(new W(u.BLUE,d(C*.65,C-40),d(80,S-80))),fe("+1 Blue")});let s=document.getElementById("toggleTrails");s&&s.addEventListener("click",()=>{ge=!ge,s.textContent=`\u2604 Trails: ${ge?"On":"Off"}`});let i=document.getElementById("speed");i&&i.addEventListener("click",()=>{let l=[.5,1,2,4],g=(l.indexOf(me)+1)%l.length;me=l[g],i.textContent=`Speed: ${me}\xD7`});let o=document.getElementById("seedBtn");o&&o.addEventListener("click",()=>{let l=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);l!==null&&Ue(Number(l))});let h=document.getElementById("formationBtn");h&&h.addEventListener("click",()=>{let l=I.filter(w=>w.alive&&w.team===u.RED),g=I.filter(w=>w.alive&&w.team===u.BLUE),p=20,y=6;l.forEach((w,x)=>{let M=x%y,m=Math.floor(x/y);w.x=C*.25-M*20,w.y=S*.5+(m-y/2)*p,w.vx=w.vy=0}),g.forEach((w,x)=>{let M=x%y,m=Math.floor(x/y);w.x=C*.75+M*20,w.y=S*.5+(m-y/2)*p,w.vx=w.vy=0}),fe("Fleets re-formed")});let c=document.getElementById("reinforceFreqBtn"),f=[0,.5,1,2];if(c){let l=()=>{let g=De();c.textContent=g>0?`${g}s`:"Every step"};l(),c.addEventListener("click",()=>{let g=De(),p=(f.indexOf(g)+1)%f.length;$t(f[p]),l();let y=De();fe(`Reinforcement check: ${y>0?y+"s":"every step"}`)})}_&&typeof _.addEventListener=="function"&&_.addEventListener("click",l=>{ie.push({x:l.clientX,y:l.clientY,r:24,life:.25,team:Q(0,1)});for(let p=0;p<24;p++){let y=d(0,L),w=d(40,220);lt(l.clientX,l.clientY,Math.cos(y)*w,Math.sin(y)*w,d(.2,1),"rgba(255,255,255,$a)")}})}I.length===0&&Ue();var v=null,b={triedWebGL:!1,gl2:!1,gl1:!1,importError:null,used:null};try{if(typeof window<"u"&&typeof HTMLCanvasElement<"u"&&!HTMLCanvasElement.prototype.__getContextWrapped){let t=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(e,a){try{let n=t.call(this,e,a);if(!n)try{let s=new Error("getContext returned null for type "+e).stack;if(b.getContextNullStacks=b.getContextNullStacks||[],b.getContextNullStacks.push({type:e,attrs:a,stack:s,time:Date.now()}),typeof window<"u")try{window.__rendererDiag=b}catch{}console.warn("DEBUG: HTMLCanvasElement.getContext returned null for",e,a,`
stack:`,s)}catch{}return n}catch(n){try{let s=new Error("getContext threw for type "+e).stack;if(b.getContextThrowStacks=b.getContextThrowStacks||[],b.getContextThrowStacks.push({type:e,attrs:a,err:String(n),stack:s,time:Date.now()}),typeof window<"u")try{window.__rendererDiag=b}catch{}console.warn("DEBUG: HTMLCanvasElement.getContext threw",n,`
stack:`,s)}catch{}throw n}};try{Object.defineProperty(HTMLCanvasElement.prototype,"__getContextWrapped",{value:!0,configurable:!1})}catch{HTMLCanvasElement.prototype.__getContextWrapped=!0}}}catch{}var k=null,j=!1;async function ft(t={}){if(typeof window<"u"&&(window.initRenderer=ft),typeof window<"u"&&window.__autoRendererStarted){if(j&&v)return v;if(k)return await k,v}if(j&&v)return v;if(k)return await k,v;typeof window<"u"&&(window.__autoRendererStarted=!0),k=(async()=>{let{canvas:e=_,preferWebGL:a=!0,startLoop:n=!0}=t;if(!e)throw new Error("No canvas available to initialize renderer");if(qt(),a&&e.getContext){b.triedWebGL=!0;let s=[{},{antialias:!1},{powerPreference:"high-performance"},{antialias:!1,powerPreference:"high-performance"},{antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1}],i=[],o=null;for(let f of s)try{let l=e.getContext("webgl2",f);i.push({attrs:f,ok:!!l}),l&&!o&&(o=l)}catch(l){i.push({attrs:f,ok:!1,err:String(l)})}let h=[],c=null;if(!o)for(let f of s)try{let l=e.getContext("webgl",f);h.push({attrs:f,ok:!!l}),l&&!c&&(c=l)}catch(l){h.push({attrs:f,ok:!1,err:String(l)})}if(b.attempts={webgl2:i,webgl:h},b.gl2=!!o,b.gl1=!!c,o||c)try{let{createWebGLRenderer:f}=await Promise.resolve().then(()=>(it(),nt));if(v=f(e,{webgl2:!!o,atlasAccessor:(g,p)=>st(g,p,typeof window<"u"&&window.devicePixelRatio||1),atlasLODs:We}),v.init(),n&&v.start(()=>{requestAnimationFrame(Ne)}),b.used="webgl",typeof window<"u")try{window.__rendererDiag=b}catch{}console.info("Renderer: using WebGL",{webgl2:!!o});try{pe("WebGL"+(o?"2":"1"),b.importError||"Using GPU WebGL renderer")}catch{}return v}catch(f){b.importError=String(f&&f.stack?f.stack:f),console.warn("WebGL init failed, falling back to 2D canvas renderer",f);try{pe("Canvas (WebGL failed)",b.importError)}catch{}}else{b.importError="No WebGL context (getContext returned null)",console.info("Renderer: no WebGL context available; using Canvas 2D fallback");try{pe("Canvas (no WebGL)",b.importError)}catch{}}}if(!v){if(v={type:"canvas"},b.used="canvas",typeof window<"u")try{window.__rendererDiag=b}catch{}console.info("Renderer: using Canvas 2D fallback");try{pe("Canvas",b.importError||"Using Canvas 2D fallback")}catch{}n&&requestAnimationFrame(Ne)}return v})();try{let e=await k;return j=!0,e}finally{k&&(k=null)}}function Ln(){return v?v.type:null}function In(){return b}function Vt(){if(v&&typeof v.stop=="function"&&v.stop(),v&&typeof v.destroy=="function"&&v.destroy(),v=null,j=!1,k=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function An(){if(Vt(),j=!1,k=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function Bn(){if(j=!1,k=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}typeof window<"u"&&(window.startSimulation=function(){try{K=!0;let e=document.getElementById("startPause");e&&(e.textContent="\u23F8 Pause")}catch{}},window.stopSimulation=function(){try{K=!1;let e=document.getElementById("startPause");e&&(e.textContent="\u25B6 Start")}catch{}});export{xn as Particle,Bn as _internal_resetInitFlags,lt as acquireParticle,de as backgroundGradient,we as bullets,Fe as clamp,Sn as evaluateReinforcement,ie as flashes,Dt as getHullAtlas,st as getHullAtlasForRadius,kt as getHullPath,De as getReinforcementInterval,In as getRendererDiagnostics,Ln as getRendererType,Pn as handleReinforcement,ht as healthFlashes,ye as hullAtlases,He as hullPaths,ft as initRenderer,Bt as initStars,gn as particlePool,Ee as particles,at as recomputeBackgroundGradient,yn as releaseParticle,Ue as reset,_n as resetReinforcementCooldowns,$t as setReinforcementInterval,ct as shieldFlashes,I as ships,V as shipsVMap,rt as stars,Vt as stopRenderer,An as stopRendererAndAllowReinit,U as teamColor};

// AUTO_INIT_SNIPPET_START
// Idempotent auto-init for standalone bundle: try common exported names safely.
// This variant awaits the initializer (if it returns a promise) and then
// retries clicking the start button until the UI toggles to "Pause" or
// a timeout is reached. This is more robust against handler-installation
// races caused by inlining/minification ordering.
if (typeof window !== "undefined" && !window.__autoRendererStarted) {
  window.__autoRendererStarted = true;
  Promise.resolve().then(() => {
    try {
      try {
        console.log('[AUTO_INIT] typeof window.initRenderer ->', typeof window.initRenderer);
        console.log('[AUTO_INIT] window.initRenderer ->', window.initRenderer && (window.initRenderer.name || '[function]'));
      } catch(_){ }

      const attemptStartWith = (fn, label) => {
        try {
          const p = fn({ preferWebGL: true, startLoop: true });
          // Ensure we handle both sync and promise returns
          return Promise.resolve(p).then(() => {
            // Retry clicking the start button until its text indicates running
            let attempts = 0;
            const maxAttempts = 12; // ~1 second with 80ms interval
            const tryClick = () => {
              attempts++;
              try {
                const b = document.getElementById('startPause');
                if (b && typeof b.click === 'function') {
                  b.click();
                  console.log('[AUTO_INIT] start button clicked (' + label + ') attempt', attempts);
                  // If the button text changed to Pause, we assume running started
                  if (b.textContent && b.textContent.toLowerCase().includes('pause')) {
                    console.log('[AUTO_INIT] start confirmed via button text (' + label + ')');
                    return;
                  }
                } else {
                  console.log('[AUTO_INIT] start button not found (' + label + '), attempt', attempts);
                }
              } catch (e) {
                console.log('[AUTO_INIT] click attempt error', e && e.message);
              }
              if (attempts < maxAttempts) {
                setTimeout(tryClick, 80);
              } else {
                console.log('[AUTO_INIT] failed to confirm start after', maxAttempts, 'attempts (', label, ')');
                try {
                  if (typeof window !== 'undefined' && typeof window.startSimulation === 'function') {
                    console.log('[AUTO_INIT] calling window.startSimulation() fallback');
                    window.startSimulation();
                  }
                } catch (_) {}
              }
            };
            // start first try slightly delayed to allow handlers to be installed
            setTimeout(tryClick, 60);

            // Proactive safety: also call startSimulation directly shortly after init
            // This ensures the internal 'ae' running flag is set even if click handlers
            // are not yet installed or click events are swallowed by race conditions.
            try {
              if (typeof window !== 'undefined' && typeof window.startSimulation === 'function') {
                setTimeout(() => {
                  try {
                    console.log('[AUTO_INIT] proactive window.startSimulation() call');
                    window.startSimulation();
                  } catch (__) {}
                }, 120);
                // A second attempt after a longer delay to cover slower setups
                setTimeout(() => {
                  try {
                    console.log('[AUTO_INIT] proactive window.startSimulation() call (retry)');
                    window.startSimulation();
                  } catch (__) {}
                }, 600);
              }
            } catch (_) {}
          });
        } catch (e) { console.log('[AUTO_INIT] initializer call threw (' + label + ')', e && e.message); return Promise.resolve(); }
      };

      if (typeof initRenderer === 'function') {
        console.log('[AUTO_INIT] calling initRenderer (local export)');
        attemptStartWith(initRenderer, 'initRenderer');
      } else if (typeof Li === 'function') {
        console.log('[AUTO_INIT] calling Li (minified alias)');
        attemptStartWith(Li, 'Li');
      } else if (typeof window.initRenderer === 'function') {
        console.log('[AUTO_INIT] calling window.initRenderer');
        attemptStartWith(window.initRenderer, 'window.initRenderer');
      } else {
        console.log('[AUTO_INIT] no initRenderer found to call');
      }
    } catch (e) {
      try { console.error('Auto init failed', e); } catch (_) {}
    }
  });
}
// AUTO_INIT_SNIPPET_END

</script>
<!-- END_INLINED_BUNDLE -->