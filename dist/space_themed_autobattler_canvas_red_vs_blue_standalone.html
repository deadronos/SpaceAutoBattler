<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
    <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span style="opacity:.7">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  







<!-- BEGIN_INLINED_BUNDLE -->
<script type="module">
var Pt=Object.defineProperty;var bt=(n,t,l)=>t in n?Pt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[t]=l;var ct=(n,t,l)=>bt(n,typeof t!="symbol"?t+"":t,l);var Z=!1,V=123456789;function dt(n){Z=!0,V=n>>>0}function ft(){Z=!1}function _t(){return Z?(V=1664525*V+1013904223>>>0,V/4294967296):Math.random()}function h(n=0,t=1){return n+(t-n)*_t()}function ut(n,t){return Math.floor(h(n,t+1))}var pt={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},mt=1.2,tt=.6;var P={RED:0,BLUE:1},et=class{constructor(t,l,e,i,o,a=null){this.x=t,this.y=l,this.vx=e,this.vy=i,this.team=o,this.ownerId=a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.life-=t}alive(t=null){if(this.life<=0)return!1;if(!t)return!0;let{W:l,H:e}=t;return this.x>-50&&this.x<l+50&&this.y>-50&&this.y<e+50}},q=class q{constructor(t,l,e,i="corvette"){this.team=t,this.x=l,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=i;let o={corvette:{radius:8,maxSpeed:h(120,160),accel:240,turn:6.5,hp:h(40,70),reload:h(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:h(90,120),accel:200,turn:5,hp:h(80,120),reload:h(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:h(60,90),accel:150,turn:3.2,hp:h(150,220),reload:h(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:h(40,70),accel:90,turn:2,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)},fighter:{radius:6,maxSpeed:h(160,220),accel:300,turn:8,hp:h(18,32),reload:h(.12,.22),vision:180,range:120}},a=o[i]||o.corvette;this.radius=a.radius,this.maxSpeed=a.maxSpeed,this.accel=a.accel,this.turn=a.turn||pt[i]||4.5,this.hpMax=a.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=a.reload,this.vision=a.vision,this.range=a.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,i==="carrier"?(this.isCarrier=!0,this.launchCooldown=a.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(t=100,l=1.35){return Math.floor(t*Math.pow(l,Math.max(0,this.level-1)))}applyLevel(){let t=.06,l=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+l*(this.level-1)));let i=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(i*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(t){if(!(t<=0))for(this.xp+=t;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(t){let l=null,e=1/0,i=this.vision*this.vision;for(let o of t){if(!o.alive||o.team===this.team)continue;let a=o.x-this.x,c=o.y-this.y,r=a*a+c*c;r<i&&r<e&&(e=r,l=o)}return l}update(t,l){if(!this.alive)return;let e=this.pickTarget(l),i=this.recentHitTimer>0,o=0,a=0,c=1;if(e&&!i){let u=e.x-this.x,T=e.y-this.y;c=Math.hypot(u,T)||1;let m=Math.max(0,Math.min(1.2,c/240)),I=e.x+(e.vx||0)*m,w=e.y+(e.vy||0)*m;o=I-this.x,a=w-this.y;let H=Math.hypot(o,a)||1;o/=H,a/=H}else if(e&&i){let u=e.x-this.x,T=e.y-this.y;c=Math.hypot(u,T)||1,o=-(u/c),a=-(T/c)}else o=Math.cos(this.angle),a=Math.sin(this.angle);let r=0,g=0,d=0,M=26;for(let u of l){if(!u.alive||u===this||u.team!==this.team)continue;let T=this.x-u.x,m=this.y-u.y,I=T*T+m*m;if(I<M*M&&I>1){let w=Math.sqrt(I);r+=T/w,g+=m/w,d++}}d>0&&(r/=d,g/=d);let f=Math.atan2(a,o)-this.angle;for(;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;let y=this.turn*t;f>y?f=y:f<-y&&(f=-y),this.angle+=f;let _=i?this.accel*mt:this.accel;this.vx+=Math.cos(this.angle)*_*t,this.vy+=Math.sin(this.angle)*_*t,d>0&&(this.vx+=r*(this.accel*tt)*t,this.vy+=g*(this.accel*tt)*t);let v=Math.hypot(this.vx,this.vy);if(v>this.maxSpeed){let u=this.maxSpeed/v;this.vx*=u,this.vy*=u}if(this.x+=this.vx*t,this.y+=this.vy*t,e){let u=e.x-this.x,T=e.y-this.y,m=Math.hypot(u,T)||1;if(m<this.range){let I=Math.cos(this.angle)*(u/m)+Math.sin(this.angle)*(T/m);if(this.cooldown<=0&&I>.2){let w=300+h(-20,20),H=u/m,U=T/m;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new et(this.x+H*12,this.y+U*12,H*w+this.vx*.2,U*w+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=t,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*t)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-t))}damage(t){let l=t,e=0;return this.shield>0&&t>0&&(e=Math.min(this.shield,t),this.shield-=e,t-=e),t>0&&(this.hp-=t),(e>0||l>0&&t>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};ct(q,"_id",1);var C=q;function it(n,t,l,e,i=80){let o=[];for(let a=0;a<t;a++){let c=a%6*20+h(-10,10),r=Math.floor(a/6)*20+h(-10,10),g=h(0,1),d="corvette";g<.45?d="corvette":g<.75?d="frigate":g<.92?d="destroyer":d="carrier",o.push(new C(n,l+(n===P.RED?-c:c),e+r,d))}return o}function xt(n,t,l={W:800,H:600}){for(let e of n.ships)e.alive&&e.update(t,n.ships,n.bullets);if(l&&typeof l.W=="number"&&typeof l.H=="number"){let e=l.W,i=l.H;for(let o of n.ships){if(!o.alive)continue;let a=o.radius||0;o.x<-a?o.x+=e+a*2:o.x>e+a&&(o.x-=e+a*2),o.y<-a?o.y+=i+a*2:o.y>i+a&&(o.y-=i+a*2)}}for(let e of n.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=t,e.launchCooldown<=0)){if((Array.isArray(e.activeFighters)?e.activeFighters.length:0)<(e.maxFighters||6)){let o=Math.max(1,Math.floor(e.launchAmount||1));for(let a=0;a<o&&!(e.activeFighters.length>=(e.maxFighters||6));a++){let c=h(0,Math.PI*2),r=e.radius+12+h(4,12),g=e.x+Math.cos(c)*r,d=e.y+Math.sin(c)*r,M=new C(e.team,g,d,"fighter"),L=h(40,120);M.vx=Math.cos(c)*L+(e.vx||0)*.2,M.vy=Math.sin(c)*L+(e.vy||0)*.2,M.ownerCarrier=e.id,e.activeFighters.push(M.id),n.ships.push(M)}}e.launchCooldown=h(2.5,6)}for(let e=n.bullets.length-1;e>=0;e--){let i=n.bullets[e];i.update(t),i.alive(l)||n.bullets.splice(e,1)}for(let e=n.bullets.length-1;e>=0;e--){let i=n.bullets[e];for(let o of n.ships){if(!o.alive||o.team===i.team)continue;let a=o.x-i.x,c=o.y-i.y,r=a*a+c*c,g=o.radius+i.radius;if(r<g*g){let d=i.dmg,M=typeof o.shield=="number"?o.shield:0,L=typeof o.hp=="number"?o.hp:0,f=o.damage(d),y=Math.max(0,M-(typeof o.shield=="number"?o.shield:0)),_=Math.max(0,L-(typeof o.hp=="number"?o.hp:0));if(y>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:i.x,hitY:i.y,team:o.team,amount:y}),_>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:i.x,hitY:i.y,team:o.team,amount:_}),i.ownerId!=null){let v=n.ships.find(u=>u.id===i.ownerId);v&&v.gainXp(d*.05)}if(n.bullets.splice(e,1),f&&n.explosions&&n.explosions.push(f),!o.alive&&(i.team===0?n.score.red++:n.score.blue++,i.ownerId!=null)){let v=n.ships.find(u=>u.id===i.ownerId);v&&v.gainXp(20+(o.level||1)*.2)}break}}}for(let e of n.explosions||[]){if(!e||!e.id)continue;let i=e;if(i.type==="fighter"&&typeof i.ownerCarrier=="number"){let o=n.ships.find(a=>a.id===i.ownerCarrier);if(o&&Array.isArray(o.activeFighters)){let a=o.activeFighters.indexOf(i.id);a>=0&&o.activeFighters.splice(a,1)}}if(i.type==="carrier"){let o=i.id;for(let c of n.ships)c.alive&&c.type==="fighter"&&c.ownerCarrier===o&&(c.ownerCarrier=null);let a=n.ships.find(c=>c.id===o);a&&Array.isArray(a.activeFighters)&&(a.activeFighters.length=0)}}}var D=document.getElementById("world"),s=D.getContext("2d"),p=D.width=window.innerWidth,E=D.height=window.innerHeight;window.addEventListener("resize",()=>{p=D.width=window.innerWidth,E=D.height=window.innerHeight,Mt(),Et()});var b=Math.PI*2,nt=(n,t,l)=>Math.max(t,Math.min(l,n)),F=(n=0,t=1)=>n+(t-n)*Math.random();function W(n){let t=document.getElementById("toast");t.textContent=n,t.classList.add("show"),setTimeout(()=>t.classList.remove("show"),1400)}var z=[];function Et(){z.length=0;let n=[.2,.5,1];for(let t of n)for(let l=0;l<120;l++)z.push({x:F(0,p),y:F(0,E),r:F(.3,1.8)*t,d:t,tw:F(.4,1),phase:F(0,b)})}Et();var st=new Map;function ue(n){if(st.has(n))return st.get(n);let t=new Path2D;return n==="corvette"?(t.moveTo(1.5,0),t.lineTo(-1,-.7),t.lineTo(-.4,0),t.lineTo(-1,.7),t.closePath(),t.ellipse(0,0,.35,.25,0,0,b)):n==="frigate"?(t.moveTo(1.6,0),t.quadraticCurveTo(.2,-1.1,-1.1,-.6),t.lineTo(-.6,0),t.lineTo(-1.1,.6),t.quadraticCurveTo(.2,1.1,1.6,0),t.closePath()):n==="destroyer"?(t.moveTo(1.9,0),t.lineTo(.3,-1.1),t.lineTo(-1.4,-.6),t.lineTo(-1.4,.6),t.lineTo(.3,1.1),t.closePath()):n==="carrier"?t.ellipse(0,0,1.6,1,0,0,b):n==="fighter"?(t.moveTo(1.2,0),t.lineTo(-.6,-.45),t.lineTo(-.2,0),t.lineTo(-.6,.45),t.closePath(),t.ellipse(.25,0,.25,.15,0,0,b)):(t.moveTo(1.4,0),t.lineTo(-1,-.8),t.lineTo(-.4,0),t.lineTo(-1,.8),t.closePath()),st.set(n,t),t}var ot=null;function Mt(){ot=s.createRadialGradient(p*.6,E*.3,50,p*.6,E*.3,Math.max(p,E)),ot.addColorStop(0,"rgba(60,80,140,0.10)"),ot.addColorStop(1,"rgba(10,12,20,0.0)")}Mt();var J=[];function Q(n,t,l,e,i,o){let a;return J.length>0?(a=J.pop(),a.x=n,a.y=t,a.vx=l,a.vy=e,a.life=i,a.max=i,a.color=o):a=new at(n,t,l,e,i,o),A.push(a),a}function Ft(n){J.length<2e3&&J.push(n)}var R=(n,t=1)=>n===P.RED?`rgba(255,90,90,${t})`:`rgba(80,160,255,${t})`,at=class{constructor(t,l,e,i,o,a){this.x=t,this.y=l,this.vx=e,this.vy=i,this.life=o,this.max=o,this.color=a}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.vx*=Math.pow(.9,t*60),this.vy*=Math.pow(.9,t*60),this.life-=t}draw(){if(this.life<=0)return;let t=this.life/this.max;s.fillStyle=this.color.replace("$a",t.toFixed(3)),s.fillRect(this.x,this.y,2,2)}},lt=class{constructor(t){this.logic=t,this.id=t.id,this.team=t.team,this.x=t.x,this.y=t.y,this.type=t.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let t=this.logic;if(!t.alive)return;let l=S.some(f=>f.shieldHit&&f.x===t.x&&f.y===t.y&&f.life>0);if(j){let f=t.x-Math.cos(t.angle)*t.radius*1.2,y=t.y-Math.sin(t.angle)*t.radius*1.2;Q(f,y,-t.vx*.05+h(-10,10),-t.vy*.05+h(-10,10),.25,R(t.team,"$a"))}s.save(),s.translate(t.x,t.y),s.rotate(t.angle),s.shadowBlur=12,s.shadowColor=R(t.team,.9);let e=t.radius||8;if(s.fillStyle=R(t.team,.96),t.type==="corvette"?(s.beginPath(),s.moveTo(e*1.5,0),s.lineTo(-e,-e*.7),s.lineTo(-e*.4,0),s.lineTo(-e,e*.7),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.85)",s.beginPath(),s.ellipse(0,0,e*.35,e*.25,0,0,b),s.fill()):t.type==="frigate"?(s.beginPath(),s.moveTo(e*1.6,0),s.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),s.lineTo(-e*.6,0),s.lineTo(-e*1.1,e*.6),s.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.75)",s.fillRect(-e*.2,-e*.25,e*.6,e*.5)):t.type==="destroyer"?(s.beginPath(),s.moveTo(e*1.9,0),s.lineTo(e*.3,-e*1.1),s.lineTo(-e*1.4,-e*.6),s.lineTo(-e*1.4,e*.6),s.lineTo(e*.3,e*1.1),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.7)",s.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):t.type==="carrier"?(s.beginPath(),s.ellipse(0,0,e*1.6,e*1,0,0,b),s.fill(),s.fillStyle="rgba(255,255,255,.18)",s.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):t.type==="fighter"?(s.beginPath(),s.moveTo(e*1.2,0),s.lineTo(-e*.6,-e*.45),s.lineTo(-e*.2,0),s.lineTo(-e*.6,e*.45),s.closePath(),s.fill(),s.fillStyle="rgba(255,255,255,.9)",s.beginPath(),s.ellipse(e*.25,0,e*.25,e*.15,0,0,b),s.fill()):(s.beginPath(),s.moveTo(e*1.4,0),s.lineTo(-e,-e*.8),s.lineTo(-e*.4,0),s.lineTo(-e,e*.8),s.closePath(),s.fill()),s.restore(),typeof t.shield=="number"&&typeof t.shieldMax=="number"){let f=t.shieldMax>0?Math.max(0,Math.min(1,t.shield/t.shieldMax)):0,y=e+4+(1-f)*2;s.save(),s.beginPath(),s.arc(t.x,t.y,y,0,b);let _=s.createRadialGradient(t.x,t.y,y*.6,t.x,t.y,y);_.addColorStop(0,`rgba(140,200,255,${.06})`),_.addColorStop(1,`rgba(80,160,255,${.02})`),s.fillStyle=_,s.globalCompositeOperation="lighter",s.fill();for(let v of X){if(v.id!==t.id)continue;let u=Math.max(0,Math.min(1,v.life/.22)),T=t.shieldMax&&t.shieldMax>0?v.amount/t.shieldMax:Math.min(1,v.amount/(t.hpMax*.6||1)),m=Math.max(.08,Math.min(1,T)),w=(Math.PI*.25+Math.PI*.6*(1-u))*(.6+1.6*m),H=v.angle-w/2,U=v.angle+w/2,ht=y+4*(1-u)+2*m;s.beginPath(),s.arc(t.x,t.y,ht,H,U),s.lineWidth=(3+6*u)*(1+4*m);let Tt=Math.min(1,.25+u*(.9+1.6*m));s.strokeStyle=`rgba(160,220,255,${Tt})`,s.save(),s.shadowBlur=12*m,s.shadowColor="rgba(140,200,255,0.8)",s.stroke(),s.restore()}s.restore()}let i=Math.max(16,e*3.2),o=Math.max(3,e*.4),a=t.x-i/2,c=t.y-(e+12);if(typeof t.shield=="number"&&typeof t.shieldMax=="number"){let f=t.shieldMax>0?Math.max(0,Math.min(1,t.shield/t.shieldMax)):0;s.fillStyle="rgba(255,255,255,.08)",s.fillRect(a,c,i,o),s.fillStyle="rgba(80,160,255,.95)",s.fillRect(a,c,i*f,o)}let r=t.y+(e+8),g=Math.max(0,Math.min(1,t.hp/t.hpMax)),d=Math.min(6,o);s.beginPath(),s.moveTo(a+d,r),s.lineTo(a+i-d,r),s.quadraticCurveTo(a+i,r,a+i,r+d),s.lineTo(a+i,r+o-d),s.quadraticCurveTo(a+i,r+o,a+i-d,r+o),s.lineTo(a+d,r+o),s.quadraticCurveTo(a,r+o,a,r+o-d),s.lineTo(a,r+d),s.quadraticCurveTo(a,r,a+d,r),s.closePath(),s.fillStyle="rgba(255,255,255,.08)",s.fill();let M=k.find(f=>f.id===t.id&&f.life>0),L=`rgba(120,220,120,${.95})`;if(M){let f=Math.max(0,Math.min(1,M.life/.45)),y=Math.min(1,M.amount/(t.hpMax||1)),_=Math.floor(220*(1-y*f)),v=Math.floor(60+160*(1-f*y));L=`rgba(${Math.min(255,_)},${Math.min(255,v)},60,${.95})`}s.save(),s.beginPath(),s.moveTo(a+d,r),s.lineTo(a+i-d,r),s.quadraticCurveTo(a+i,r,a+i,r+d),s.lineTo(a+i,r+o-d),s.quadraticCurveTo(a+i,r+o,a+i-d,r+o),s.lineTo(a+d,r+o),s.quadraticCurveTo(a,r+o,a,r+o-d),s.lineTo(a,r+d),s.quadraticCurveTo(a,r,a+d,r),s.closePath(),s.clip(),s.fillStyle=L,s.fillRect(a,r,i*g,o),s.restore(),typeof t.level=="number"&&t.level>1&&(s.save(),s.fillStyle="rgba(255,255,255,0.95)",s.font="700 12px system-ui, sans-serif",s.textAlign="center",s.fillText(`Lv ${t.level}`,t.x,t.y-(e+18)),s.restore())}},x=[],B=[],A=[],S=[],X=[],k=[],N=new Map,Y=!1,K=1,j=!0,G=0,$={red:0,blue:0};function O(n=null){x.length=0,B.length=0,A.length=0,S.length=0,$.red=0,$.blue=0,n!==null?(dt(n>>>0),W(`Seed set to ${n>>>0}`)):ft(),x.push(...it(P.RED,12,p*.25,E*.5)),x.push(...it(P.BLUE,12,p*.75,E*.5))}function Xt(n){for(let i of z)i.phase+=n*.8*i.d;for(let i of x)i.update(n,x);for(let i=B.length-1;i>=0;i--){let o=B[i];if(o.update(n),!o.alive()){B.splice(i,1);continue}}let l={ships:x,bullets:B,score:$,particles:A,explosions:[],shieldHits:[]};if(xt(l,n,{W:p,H:E}),l.explosions&&l.explosions.length)for(let i of l.explosions){S.push({x:i.x,y:i.y,r:2,life:.25,team:i.team});for(let o=0;o<20;o++){let a=h(0,b),c=h(40,220);Q(i.x,i.y,Math.cos(a)*c,Math.sin(a)*c,h(.2,1),R(i.team,"$a"))}}if(Array.isArray(l.shieldHits)&&l.shieldHits.length)for(let i of l.shieldHits){let o=x.find(r=>r.id===i.id),a=o?o.x:i.hitX,c=o?o.y:i.hitY;S.push({x:a,y:c,r:6+Math.min(12,i.amount),life:.12,team:i.team,shieldHit:!0});for(let r=0;r<6;r++){let g=h(0,b),d=h(40,120);Q(i.hitX,i.hitY,Math.cos(g)*d,Math.sin(g)*d,h(.12,.4),"rgba(200,230,255,$a)")}if(o){let r=Math.atan2(i.hitY-c,i.hitX-a);X.push({id:o.id,angle:r,life:.22,amount:i.amount})}}if(Array.isArray(l.healthHits)&&l.healthHits.length)for(let i of l.healthHits){let o=x.find(a=>a.id===i.id);o&&k.push({id:o.id,life:.45,amount:i.amount})}for(let i=A.length-1;i>=0;i--){let o=A[i];o.update(n),o.life<=0&&(A.splice(i,1),Ft(o))}for(let i=S.length-1;i>=0;i--){let o=S[i];o.life-=n,o.r+=600*n,o.life<=0&&S.splice(i,1)}for(let i=X.length-1;i>=0;i--){let o=X[i];o.life-=n,o.life<=0&&X.splice(i,1)}for(let i=k.length-1;i>=0;i--){let o=k[i];o.life-=n,o.life<=0&&k.splice(i,1)}let e=new Set(x.map(i=>i.id));for(let i of x)N.has(i.id)?N.get(i.id).syncFromLogic():N.set(i.id,new lt(i));for(let i of Array.from(N.keys()))e.has(i)||N.delete(i)}function kt(){s.clearRect(0,0,p,E);let n=s.createRadialGradient(p*.6,E*.3,50,p*.6,E*.3,Math.max(p,E));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),s.fillStyle=n,s.fillRect(0,0,p,E);for(let e of z){let i=.6+.4*Math.sin(e.phase);s.globalAlpha=nt(.5*i*(.6+.5*e.d),0,1),s.fillStyle="#e9f2ff",s.fillRect(e.x,e.y,e.r,e.r)}s.globalAlpha=1;for(let e of S){let i=nt(e.life/.25,0,1);s.strokeStyle=R(e.team,i*.6),s.lineWidth=2,s.beginPath(),s.arc(e.x,e.y,e.r,0,b),s.stroke()}for(let e of B)s.save(),s.shadowBlur=12,s.shadowColor=R(e.team,.9),s.fillStyle=R(e.team,.95),s.beginPath(),s.arc(e.x,e.y,e.radius||2.2,0,b),s.fill(),s.restore();for(let e of A)e.draw();for(let e of N.values())e.draw();let t=x.some(e=>e.alive&&e.team===P.RED),l=x.some(e=>e.alive&&e.team===P.BLUE);if(!t||!l){s.save(),s.textAlign="center",s.font="700 36px Inter, system-ui, sans-serif";let e=t?"Red":l?"Blue":"Nobody",i=t?R(P.RED,.95):l?R(P.BLUE,.95):"rgba(255,255,255,.9)";s.fillStyle=i,s.shadowBlur=14,s.shadowColor=i,s.fillText(`${e} Wins!`,p/2,64),s.restore()}}function rt(n){G||(G=n);let t=(n-G)/1e3;G=n;let l=nt(t,0,.033)*(Y?K:0);Xt(l),kt(),Kt(),requestAnimationFrame(rt)}var gt=document.getElementById("startPause"),Gt=document.getElementById("reset"),$t=document.getElementById("addRed"),Ut=document.getElementById("addBlue"),yt=document.getElementById("toggleTrails"),vt=document.getElementById("speed"),Vt=document.getElementById("redScore"),qt=document.getElementById("blueScore"),Ot=document.getElementById("stats"),Wt=document.getElementById("seedBtn"),Yt=document.getElementById("formationBtn");function Kt(){Vt.textContent=`Red ${$.red}`,qt.textContent=`Blue ${$.blue}`,Ot.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${B.length}  Particles: ${A.length}`}window.__uiHandlersInstalled?(x.length===0&&O(),G||requestAnimationFrame(rt)):(Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1}),gt.addEventListener("click",()=>{Y=!Y,gt.textContent=Y?"\u23F8 Pause":"\u25B6 Start"}),Gt.addEventListener("click",()=>{O()}),$t.addEventListener("click",()=>{x.push(new C(P.RED,h(40,p*.35),h(80,E-80))),W("+1 Red")}),Ut.addEventListener("click",()=>{x.push(new C(P.BLUE,h(p*.65,p-40),h(80,E-80))),W("+1 Blue")}),yt.addEventListener("click",()=>{j=!j,yt.textContent=`\u2604 Trails: ${j?"On":"Off"}`}),vt.addEventListener("click",()=>{let n=[.5,1,2,4],t=(n.indexOf(K)+1)%n.length;K=n[t],vt.textContent=`Speed: ${K}\xD7`}),Wt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&O(Number(n))}),Yt.addEventListener("click",()=>{let n=x.filter(i=>i.alive&&i.team===P.RED),t=x.filter(i=>i.alive&&i.team===P.BLUE),l=20,e=6;n.forEach((i,o)=>{let a=o%e,c=Math.floor(o/e);i.x=p*.25-a*20,i.y=E*.5+(c-e/2)*l,i.vx=i.vy=0}),t.forEach((i,o)=>{let a=o%e,c=Math.floor(o/e);i.x=p*.75+a*20,i.y=E*.5+(c-e/2)*l,i.vx=i.vy=0}),W("Fleets re-formed")}),D.addEventListener("click",n=>{S.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:ut(0,1)});for(let l=0;l<24;l++){let e=h(0,b),i=h(40,220);Q(n.clientX,n.clientY,Math.cos(e)*i,Math.sin(e)*i,h(.2,1),"rgba(255,255,255,$a)")}}),O(),requestAnimationFrame(rt));export{at as Particle,Q as acquireParticle,ot as backgroundGradient,B as bullets,nt as clamp,S as flashes,ue as getHullPath,k as healthFlashes,st as hullPaths,Et as initStars,J as particlePool,A as particles,Mt as recomputeBackgroundGradient,Ft as releaseParticle,X as shieldFlashes,x as ships,N as shipsVMap,z as stars,R as teamColor};

</script>
<!-- END_INLINED_BUNDLE -->
</body>
</html>