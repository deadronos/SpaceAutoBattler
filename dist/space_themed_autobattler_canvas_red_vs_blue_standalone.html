<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Autobattler ‚Äì Red vs Blue (standalone)</title>
  <style>
    html, body { height: 100%; margin: 0; background: radial-gradient(1200px 800px at 50% 40%, #0b1220, #05070c); color: #eaeff8; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    #ui { position: fixed; top: 12px; left: 12px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; z-index: 10; background: rgba(10,12,20,0.5); border: 1px solid rgba(255,255,255,0.08); padding: 10px; border-radius: 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .btn { cursor: pointer; padding: 8px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: linear-gradient(#1b2335,#141b2a); color: #eaeff8; font-weight: 600; letter-spacing: .2px; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    .badge { font-weight: 700; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
    .red { color:#ffd1d1; background: linear-gradient(180deg, rgba(255,79,79,0.2), rgba(255,79,79,0.05)); border-color: rgba(255,79,79,0.35); }
    .blue { color:#cfe0ff; background: linear-gradient(180deg, rgba(64,160,255,0.2), rgba(64,160,255,0.05)); border-color: rgba(64,160,255,0.35); }
    #stats { margin-left: 8px; font-variant-numeric: tabular-nums; opacity:.95 }
    #bottomRight { position: fixed; right: 12px; bottom: 12px; z-index: 10; display: flex; gap: 8px; align-items: center; background: rgba(10,12,20,0.5); border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(6px); }
    #world { position: fixed; inset: 0; display:block; }
    #toast { position: fixed; top: 12px; right: 12px; background: rgba(15,18,30,.85); border: 1px solid rgba(255,255,255,0.08); padding: 10px 14px; border-radius: 12px; opacity: 0; transform: translateY(-8px); transition: all .35s ease; pointer-events: none; }
    #toast.show { opacity: 1; transform: translateY(0); }
    a { color: #9ecbff; text-decoration: none; }
  </style>
</head>
<body>
  <canvas id="world"></canvas>
  <div id="ui">
    <button id="startPause" class="btn">‚ñ∂ Start</button>
    <button id="reset" class="btn">‚Ü∫ Reset</button>
    <button id="addRed" class="btn" title="Add Red ship">+ Red</button>
    <button id="addBlue" class="btn" title="Add Blue ship">+ Blue</button>
    <button id="toggleTrails" class="btn">‚òÑ Trails: On</button>
    <div class="btn" id="speed">Speed: 1√ó</div>
    <div class="badge red" id="redScore">Red 0</div>
    <div class="badge blue" id="blueScore">Blue 0</div>
    <div id="stats"></div>
  </div>
  <div id="bottomRight">
    <button id="seedBtn" class="btn" title="Re-seed RNG for reproducible battles">üé≤ Seed</button>
    <button id="formationBtn" class="btn" title="Re-form fleets">üõ∞Ô∏è Form</button>
    <span style="opacity:.7">Space Autobattler</span>
  </div>
  <div id="toast"></div>

  <!-- Use module imports so this page loads the current source files (renderer -> simulate -> entities -> rng). -->
  <script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
<script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
<script type="module">
var ut=Object.defineProperty;var xt=(n,e,a)=>e in n?ut(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var ot=(n,e,a)=>xt(n,typeof e!="symbol"?e+"":e,a);var j=!1,W=123456789;function nt(n){j=!0,W=n>>>0}function lt(){j=!1}function mt(){return j?(W=1664525*W+1013904223>>>0,W/4294967296):Math.random()}function r(n=0,e=1){return n+(e-n)*mt()}function at(n,e){return Math.floor(r(n,e+1))}var M={RED:0,BLUE:1},J=class{constructor(e,a,t,s,o,l=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=r(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},q=class q{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:r(120,160),accel:240,hp:r(40,70),reload:r(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:r(90,120),accel:200,hp:r(80,120),reload:r(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:r(60,90),accel:150,hp:r(150,220),reload:r(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:r(40,70),accel:90,hp:r(220,300),reload:r(.6,1.2),vision:360,range:260,launchBase:r(3.5,6)},fighter:{radius:6,maxSpeed:r(160,220),accel:300,hp:r(18,32),reload:r(.12,.22),vision:180,range:120}},l=o[s]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=q._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),s==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*r(.8,1.4),this.launchAmount=Math.max(1,Math.floor(r(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,f=o.y-this.y,h=l*l+f*f;h<s&&h<t&&(t=h,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=0,o=0;if(t){let p=t.x-this.x,b=t.y-this.y,d=Math.hypot(p,b)||1,u=Math.max(0,Math.min(1.2,d/240)),E=t.x+(t.vx||0)*u,y=t.y+(t.vy||0)*u,T=E-this.x,k=y-this.y,L=Math.hypot(T,k)||1;if(s+=T/L*this.accel,o+=k/L*this.accel,d<this.range){let it=((this.vx||1)*p+(this.vy||1)*b)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&it>0){let A=300+r(-20,20),G=p/d,F=b/d;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new J(this.x+G*12,this.y+F*12,G*A+this.vx*.2,F*A+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}else s+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,f=0,h=0,m=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,d=this.y-p.y,u=b*b+d*d;if(u<m*m&&u>1){let E=Math.sqrt(u);l+=b/E,f+=d/E,h++}}h>0&&(s+=l/h*this.accel*.9,o+=f/h*this.accel*.9),this.vx+=s*e,this.vy+=o*e;let c=Math.hypot(this.vx,this.vy);if(c>this.maxSpeed){let p=this.maxSpeed/c;this.vx*=p,this.vy*=p}this.x+=this.vx*e,this.y+=this.vy*e,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e))}damage(e){if(this.shield>0&&e>0){let a=Math.min(this.shield,e);this.shield-=a,e-=a}return e>0&&(this.hp-=e),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(q,"_id",1);var S=q;function Q(n,e,a,t,s=80){let o=[];for(let l=0;l<e;l++){let f=l%6*20+r(-10,10),h=Math.floor(l/6)*20+r(-10,10),m=r(0,1),c="corvette";m<.45?c="corvette":m<.75?c="frigate":m<.92?c="destroyer":c="carrier",o.push(new S(n,a+(n===M.RED?-f:f),t+h,c))}return o}function ht(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of n.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=t+l*2:o.x>t+l&&(o.x-=t+l*2),o.y<-l?o.y+=s+l*2:o.y>s+l&&(o.y-=s+l*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){let s=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<s;o++){let l=r(0,Math.PI*2),f=t.radius+12+r(4,12),h=t.x+Math.cos(l)*f,m=t.y+Math.sin(l)*f,c=new S(t.team,h,m,"fighter"),p=r(40,120);c.vx=Math.cos(l)*p+(t.vx||0)*.2,c.vy=Math.sin(l)*p+(t.vy||0)*.2,n.ships.push(c)}t.launchCooldown=r(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let o of n.ships){if(!o.alive||o.team===s.team)continue;let l=o.x-s.x,f=o.y-s.y,h=l*l+f*f,m=o.radius+s.radius;if(h<m*m){let c=s.dmg,p=typeof o.shield=="number"?o.shield:0,b=typeof o.hp=="number"?o.hp:0,d=o.damage(c),u=Math.max(0,p-(typeof o.shield=="number"?o.shield:0)),E=Math.max(0,b-(typeof o.hp=="number"?o.hp:0));if(u>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:u}),E>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:E}),s.ownerId!=null){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(c*.05)}if(n.bullets.splice(t,1),d&&n.explosions&&n.explosions.push(d),!o.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let y=n.ships.find(T=>T.id===s.ownerId);y&&y.gainXp(20+(o.level||1)*.2)}break}}}}var I=document.getElementById("world"),i=I.getContext("2d"),g=I.width=window.innerWidth,v=I.height=window.innerHeight;window.addEventListener("resize",()=>{g=I.width=window.innerWidth,v=I.height=window.innerHeight});var P=Math.PI*2,Z=(n,e,a)=>Math.max(e,Math.min(a,n)),D=(n=0,e=1)=>n+(e-n)*Math.random();function z(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var K=[];function wt(){K.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)K.push({x:D(0,g),y:D(0,v),r:D(.3,1.8)*e,d:e,tw:D(.4,1),phase:D(0,P)})}wt();var R=(n,e=1)=>n===M.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,H=class{constructor(e,a,t,s,o,l){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=l}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},tt=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=w.some(d=>d.shieldHit&&d.x===e.x&&d.y===e.y&&d.life>0);if(U){let d=e.x-Math.cos(e.angle)*e.radius*1.2,u=e.y-Math.sin(e.angle)*e.radius*1.2;_.push(new H(d,u,-e.vx*.05+r(-10,10),-e.vy*.05+r(-10,10),.25,R(e.team,"$a")))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=R(e.team,.9);let t=e.radius||8;if(i.fillStyle=R(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,P),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,P),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,P),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,u=t+4+(1-d)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,u,0,P);let E=i.createRadialGradient(e.x,e.y,u*.6,e.x,e.y,u);E.addColorStop(0,`rgba(140,200,255,${.06})`),E.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=E,i.globalCompositeOperation="lighter",i.fill();for(let y of N){if(y.id!==e.id)continue;let T=Math.max(0,Math.min(1,y.life/.22)),k=e.shieldMax&&e.shieldMax>0?y.amount/e.shieldMax:Math.min(1,y.amount/(e.hpMax*.6||1)),L=Math.max(.08,Math.min(1,k)),A=(Math.PI*.25+Math.PI*.6*(1-T))*(.6+1.6*L),G=y.angle-A/2,F=y.angle+A/2,st=u+4*(1-T)+2*L;i.beginPath(),i.arc(e.x,e.y,st,G,F),i.lineWidth=(3+6*T)*(1+4*L);let pt=Math.min(1,.25+T*(.9+1.6*L));i.strokeStyle=`rgba(160,220,255,${pt})`,i.save(),i.shadowBlur=12*L,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),l=e.x-s/2,f=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let d=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(l,f,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(l,f,s*d,o)}let h=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),c=Math.min(6,o);i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let p=X.find(d=>d.id===e.id&&d.life>0),b=`rgba(120,220,120,${.95})`;if(p){let d=Math.max(0,Math.min(1,p.life/.45)),u=Math.min(1,p.amount/(e.hpMax||1)),E=Math.floor(220*(1-u*d)),y=Math.floor(60+160*(1-d*u));b=`rgba(${Math.min(255,E)},${Math.min(255,y)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(l+c,h),i.lineTo(l+s-c,h),i.quadraticCurveTo(l+s,h,l+s,h+c),i.lineTo(l+s,h+o-c),i.quadraticCurveTo(l+s,h+o,l+s-c,h+o),i.lineTo(l+c,h+o),i.quadraticCurveTo(l,h+o,l,h+o-c),i.lineTo(l,h+c),i.quadraticCurveTo(l,h,l+c,h),i.closePath(),i.clip(),i.fillStyle=b,i.fillRect(l,h,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},x=[],C=[],_=[],w=[],N=[],X=[],B=new Map,V=!1,O=1,U=!0,Y=0,$={red:0,blue:0};function et(n=null){x.length=0,C.length=0,_.length=0,w.length=0,$.red=0,$.blue=0,n!==null?(nt(n>>>0),z(`Seed set to ${n>>>0}`)):lt(),x.push(...Q(M.RED,12,g*.25,v*.5)),x.push(...Q(M.BLUE,12,g*.75,v*.5))}function Lt(n){for(let s of K)s.phase+=n*.8*s.d;for(let s of x)s.update(n,x);for(let s=C.length-1;s>=0;s--){let o=C[s];if(o.update(n),!o.alive()){C.splice(s,1);continue}}let a={ships:x,bullets:C,score:$,particles:_,explosions:[],shieldHits:[]};if(ht(a,n,{W:g,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){w.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let l=r(0,P),f=r(40,220);_.push(new H(s.x,s.y,Math.cos(l)*f,Math.sin(l)*f,r(.2,1),R(s.team,"$a")))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=x.find(h=>h.id===s.id),l=o?o.x:s.hitX,f=o?o.y:s.hitY;w.push({x:l,y:f,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let h=0;h<6;h++){let m=r(0,P),c=r(40,120);_.push(new H(s.hitX,s.hitY,Math.cos(m)*c,Math.sin(m)*c,r(.12,.4),"rgba(200,230,255,$a)"))}if(o){let h=Math.atan2(s.hitY-f,s.hitX-l);N.push({id:o.id,angle:h,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=x.find(l=>l.id===s.id);o&&X.push({id:o.id,life:.45,amount:s.amount})}for(let s=_.length-1;s>=0;s--){let o=_[s];o.update(n),o.life<=0&&_.splice(s,1)}for(let s=w.length-1;s>=0;s--){let o=w[s];o.life-=n,o.r+=600*n,o.life<=0&&w.splice(s,1)}for(let s=N.length-1;s>=0;s--){let o=N[s];o.life-=n,o.life<=0&&N.splice(s,1)}for(let s=X.length-1;s>=0;s--){let o=X[s];o.life-=n,o.life<=0&&X.splice(s,1)}let t=new Set(x.map(s=>s.id));for(let s of x)B.has(s.id)?B.get(s.id).syncFromLogic():B.set(s.id,new tt(s));for(let s of Array.from(B.keys()))t.has(s)||B.delete(s)}function St(){i.clearRect(0,0,g,v);let n=i.createRadialGradient(g*.6,v*.3,50,g*.6,v*.3,Math.max(g,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,g,v);for(let t of K){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=Z(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of w){let s=Z(t.life/.25,0,1);i.strokeStyle=R(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,P),i.stroke()}for(let t of C)i.save(),i.shadowBlur=12,i.shadowColor=R(t.team,.9),i.fillStyle=R(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,P),i.fill(),i.restore();for(let t of _)t.draw();for(let t of B.values())t.draw();let e=x.some(t=>t.alive&&t.team===M.RED),a=x.some(t=>t.alive&&t.team===M.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?R(M.RED,.95):a?R(M.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,g/2,64),i.restore()}}function ft(n){Y||(Y=n);let e=(n-Y)/1e3;Y=n;let a=Z(e,0,.033)*(V?O:0);Lt(a),St(),$t(),requestAnimationFrame(ft)}var rt=document.getElementById("startPause"),Ct=document.getElementById("reset"),Bt=document.getElementById("addRed"),It=document.getElementById("addBlue"),ct=document.getElementById("toggleTrails"),dt=document.getElementById("speed"),Ht=document.getElementById("redScore"),At=document.getElementById("blueScore"),Dt=document.getElementById("stats"),Nt=document.getElementById("seedBtn"),Xt=document.getElementById("formationBtn");function $t(){Ht.textContent=`Red ${$.red}`,At.textContent=`Blue ${$.blue}`,Dt.textContent=`Ships: ${x.filter(n=>n.alive).length}  Bullets: ${C.length}  Particles: ${_.length}`}rt.addEventListener("click",()=>{V=!V,rt.textContent=V?"\u23F8 Pause":"\u25B6 Start"});Ct.addEventListener("click",()=>{et()});Bt.addEventListener("click",()=>{x.push(new S(M.RED,r(40,g*.35),r(80,v-80))),z("+1 Red")});It.addEventListener("click",()=>{x.push(new S(M.BLUE,r(g*.65,g-40),r(80,v-80))),z("+1 Blue")});ct.addEventListener("click",()=>{U=!U,ct.textContent=`\u2604 Trails: ${U?"On":"Off"}`});dt.addEventListener("click",()=>{let n=[.5,1,2,4],e=(n.indexOf(O)+1)%n.length;O=n[e],dt.textContent=`Speed: ${O}\xD7`});Nt.addEventListener("click",()=>{let n=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);n!==null&&et(Number(n))});Xt.addEventListener("click",()=>{let n=x.filter(s=>s.alive&&s.team===M.RED),e=x.filter(s=>s.alive&&s.team===M.BLUE),a=20,t=6;n.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.25-l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),e.forEach((s,o)=>{let l=o%t,f=Math.floor(o/t);s.x=g*.75+l*20,s.y=v*.5+(f-t/2)*a,s.vx=s.vy=0}),z("Fleets re-formed")});I.addEventListener("click",n=>{w.push({x:n.clientX,y:n.clientY,r:24,life:.25,team:at(0,1)});for(let a=0;a<24;a++){let t=r(0,P),s=r(40,220);_.push(new H(n.clientX,n.clientY,Math.cos(t)*s,Math.sin(t)*s,r(.2,1),"rgba(255,255,255,$a)"))}});et();requestAnimationFrame(ft);

</script>
</body>
</html>