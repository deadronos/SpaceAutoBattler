var nt=Object.defineProperty;var Tt=(t,i,a)=>i in t?nt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a;var St=(t,i)=>()=>(t&&(i=t(t=0)),i);var st=(t,i)=>{for(var a in i)nt(t,a,{get:i[a],enumerable:!0})};var rt=(t,i,a)=>Tt(t,typeof i!="symbol"?i+"":i,a);var xt={};st(xt,{createWebGLRenderer:()=>mt,default:()=>zt});function gt(t,i,a){let e=t.createShader(i);if(t.shaderSource(e,a),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS)){let o=t.getShaderInfoLog(e);throw t.deleteShader(e),new Error("Shader compile error: "+o)}return e}function qt(t,i,a){let e=gt(t,t.VERTEX_SHADER,i),o=gt(t,t.FRAGMENT_SHADER,a),n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,o),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){let s=t.getProgramInfoLog(n);throw t.deleteProgram(n),new Error("Program link error: "+s)}return n}function mt(t,i={}){let{webgl2:a=!1}=i,e=null,o=null,n=null,s=null,h=null,c=null,f=null,l=null,x=null,y=null,d=!1,p=1,S=null;return{type:"webgl",webgl2:a,init(){try{if(e=t.getContext(a?"webgl2":"webgl"),!e)return;p=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,t.width=Math.max(1,Math.floor((t.clientWidth||t.width)*p)),t.height=Math.max(1,Math.floor((t.clientHeight||t.height)*p));let E="clamp(max(0.5, v_radius * 0.01), 0.5, 3.0)",_=`
          attribute vec2 a_quadPos; // -0.5..0.5 unit quad
          attribute vec2 a_instPos; // per-instance pixel center
          attribute vec3 a_instColor;
          attribute float a_instSize; // ship radius in pixels
          attribute float a_instAngle; // ship orientation (radians)
          attribute float a_instShield; // shield fraction 0..1
          uniform vec2 u_resolution;
          varying vec3 v_color;
          varying vec2 v_local; // local space after scale & rotation (diameter scale)
          varying float v_shield;
          varying float v_radius;
          void main(){
            float c = cos(a_instAngle);
            float s = sin(a_instAngle);
            vec2 rotated = vec2(
              a_quadPos.x * c - a_quadPos.y * s,
              a_quadPos.x * s + a_quadPos.y * c
            );
              vec2 pixelPos = a_instPos + rotated * a_instSize * 2.0; // diameter scaling (vertex position)
            vec2 zeroToOne = pixelPos / u_resolution;
            vec2 clip = zeroToOne * 2.0 - 1.0;
            gl_Position = vec4(clip * vec2(1.0, -1.0), 0.0, 1.0);
            v_color = a_instColor;
              // v_local should be in pixels from center to match v_radius (radius in pixels).
              // Use scale = a_instSize (radius) so length(v_local) ranges ~0..v_radius.
              v_local = rotated * a_instSize; // used for circle SDF (pixels)
            v_shield = a_instShield;
            v_radius = a_instSize;
          }
        `,M=`precision mediump float;
          varying vec3 v_color;
          varying vec2 v_local;
          varying float v_shield;
          varying float v_radius; // true circle radius in pixels
          void main(){
            float d = length(v_local); // distance from center
            float edge = ${E}; // widen edge slightly for smoother look
            float alpha = 1.0 - smoothstep(v_radius - edge, v_radius + edge, d);
            if (alpha <= 0.001) discard;
            vec3 base = v_color;
            // Optional shield ring: show thin ring if shield fraction > 0
            if (v_shield > 0.0) {
              float ringOuter = v_radius * 1.05; // just outside body
              float ringInner = v_radius * 0.90; // inside overlap
              float ringEdge = ${E};
              float ringMask = smoothstep(ringInner - ringEdge, ringInner + ringEdge, d) * (1.0 - smoothstep(ringOuter - ringEdge, ringOuter + ringEdge, d));
              // ring color blend (cyan-like) scaled by shield fraction
              vec3 ringColor = mix(base, vec3(0.3,0.9,1.0), 0.6 * v_shield);
              base = mix(base, ringColor, clamp(ringMask,0.0,1.0));
            }
            gl_FragColor = vec4(base, alpha);
          }
        `;o=qt(e,_,M),n=e.createBuffer();let R=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,R,e.STATIC_DRAW),s=e.createBuffer(),h=e.createBuffer(),c=e.createBuffer(),f=e.createBuffer(),l=e.createBuffer(),y=null,a||(y=e.getExtension("ANGLE_instanced_arrays")),this.a_quadPos=e.getAttribLocation(o,"a_quadPos"),this.a_instPos=e.getAttribLocation(o,"a_instPos"),this.a_instColor=e.getAttribLocation(o,"a_instColor"),this.a_instSize=e.getAttribLocation(o,"a_instSize"),this.a_instAngle=e.getAttribLocation(o,"a_instAngle"),this.a_instShield=e.getAttribLocation(o,"a_instShield"),this.u_resolution=e.getUniformLocation(o,"u_resolution"),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),x=e.createTexture(),e.bindTexture(e.TEXTURE_2D,x);let k=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,k),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),typeof window<"u"&&(S=()=>{let L=window.devicePixelRatio||1;L!==p&&(p=L);let F=t.clientWidth||t.width/p,$=t.clientHeight||t.height/p,V=Math.max(1,Math.floor(F*p)),B=Math.max(1,Math.floor($*p));(V!==t.width||B!==t.height)&&(t.width=V,t.height=B,e&&e.viewport(0,0,V,B))},window.addEventListener("resize",S))}catch(E){e=null,console.warn("WebGL init failed:",E.message||E)}},start(E){d=!0,typeof E=="function"&&E()},stop(){d=!1},isRunning(){return d},render(E){if(!e)return;let{W:_,H:M,ships:R,bullets:k=[],stars:L=[]}=E,F=R.length,$=k.length,V=L.length,B=F+$+V;if(B===0)return;let N=new Float32Array(B*2),I=new Float32Array(B*3),ne=new Float32Array(B),se=new Float32Array(B),re=new Float32Array(B),w=0;for(let v=0;v<F;v++,w++){let m=R[v];N[w*2]=m.x,N[w*2+1]=m.y,I[w*3]=m.team===0?1:.31,I[w*3+1]=m.team===0?.35:.63,I[w*3+2]=m.team===0?.35:1,ne[w]=m.radius||8,se[w]=m.vx||m.vy?Math.atan2(m.vy,m.vx):m.angle||0;let K=0;typeof m.shield=="number"&&typeof m.shieldMax=="number"&&m.shieldMax>0&&(K=Math.min(1,Math.max(0,m.shield/m.shieldMax))),re[w]=K}for(let v=0;v<$;v++,w++){let m=k[v];N[w*2]=m.x,N[w*2+1]=m.y,I[w*3]=m.team===0?1:.35,I[w*3+1]=m.team===0?.35:.63,I[w*3+2]=m.team===0?.35:1,ne[w]=m.radius||2.2,se[w]=m.vx||m.vy?Math.atan2(m.vy,m.vx):0,re[w]=0}for(let v=0;v<V;v++,w++){let m=L[v];N[w*2]=m.x,N[w*2+1]=m.y;let K=m.phase!=null?.6+.4*Math.sin(m.phase):1,oe=.85+.15*K;I[w*3]=oe,I[w*3+1]=oe,I[w*3+2]=1,ne[w]=(m.r||1)+.5*K,se[w]=0,re[w]=0}if(e.viewport(0,0,t.width,t.height),e.clearColor(.02,.02,.03,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(o),e.uniform2f(this.u_resolution,_,M),e.bindBuffer(e.ARRAY_BUFFER,n),this.a_quadPos>=0&&(e.enableVertexAttribArray(this.a_quadPos),e.vertexAttribPointer(this.a_quadPos,2,e.FLOAT,!1,0,0)),this.a_instPos>=0&&(e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,N,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instPos),e.vertexAttribPointer(this.a_instPos,2,e.FLOAT,!1,0,0)),this.a_instColor>=0&&(e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,I,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instColor),e.vertexAttribPointer(this.a_instColor,3,e.FLOAT,!1,0,0)),this.a_instSize>=0&&(e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,ne,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instSize),e.vertexAttribPointer(this.a_instSize,1,e.FLOAT,!1,0,0)),this.a_instAngle>=0&&(e.bindBuffer(e.ARRAY_BUFFER,f),e.bufferData(e.ARRAY_BUFFER,se,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instAngle),e.vertexAttribPointer(this.a_instAngle,1,e.FLOAT,!1,0,0)),this.a_instShield>=0&&(e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,re,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instShield),e.vertexAttribPointer(this.a_instShield,1,e.FLOAT,!1,0,0)),a||y)if(a)this.a_instPos>=0&&e.vertexAttribDivisor(this.a_instPos,1),this.a_instColor>=0&&e.vertexAttribDivisor(this.a_instColor,1),this.a_instSize>=0&&e.vertexAttribDivisor(this.a_instSize,1),this.a_instAngle>=0&&e.vertexAttribDivisor(this.a_instAngle,1),this.a_instShield>=0&&e.vertexAttribDivisor(this.a_instShield,1),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,4,B),this.a_instPos>=0&&e.vertexAttribDivisor(this.a_instPos,0),this.a_instColor>=0&&e.vertexAttribDivisor(this.a_instColor,0),this.a_instSize>=0&&e.vertexAttribDivisor(this.a_instSize,0),this.a_instAngle>=0&&e.vertexAttribDivisor(this.a_instAngle,0),this.a_instShield>=0&&e.vertexAttribDivisor(this.a_instShield,0);else if(y)this.a_instPos>=0&&y.vertexAttribDivisorANGLE(this.a_instPos,1),this.a_instColor>=0&&y.vertexAttribDivisorANGLE(this.a_instColor,1),this.a_instSize>=0&&y.vertexAttribDivisorANGLE(this.a_instSize,1),this.a_instAngle>=0&&y.vertexAttribDivisorANGLE(this.a_instAngle,1),this.a_instShield>=0&&y.vertexAttribDivisorANGLE(this.a_instShield,1),y.drawArraysInstancedANGLE(e.TRIANGLE_STRIP,0,4,B),this.a_instPos>=0&&y.vertexAttribDivisorANGLE(this.a_instPos,0),this.a_instColor>=0&&y.vertexAttribDivisorANGLE(this.a_instColor,0),this.a_instSize>=0&&y.vertexAttribDivisorANGLE(this.a_instSize,0),this.a_instAngle>=0&&y.vertexAttribDivisorANGLE(this.a_instAngle,0),this.a_instShield>=0&&y.vertexAttribDivisorANGLE(this.a_instShield,0);else for(let v=0;v<B;v++){let m=N[v*2+0],K=N[v*2+1],oe=I[v*3+0],Be=I[v*3+1],Ie=I[v*3+2],De=ne[v],ke=se[v],Fe=re[v];this.a_instPos>=0&&e.vertexAttrib2f(this.a_instPos,m,K),this.a_instColor>=0&&e.vertexAttrib3f(this.a_instColor,oe,Be,Ie),this.a_instSize>=0&&e.vertexAttrib1f(this.a_instSize,De),this.a_instAngle>=0&&e.vertexAttrib1f(this.a_instAngle,ke),this.a_instShield>=0&&e.vertexAttrib1f(this.a_instShield,Fe),e.drawArrays(e.TRIANGLE_STRIP,0,4)}else for(let v=0;v<B;v++){let m=N[v*2+0],K=N[v*2+1],oe=I[v*3+0],Be=I[v*3+1],Ie=I[v*3+2],De=ne[v],ke=se[v],Fe=re[v];this.a_instPos>=0&&e.vertexAttrib2f(this.a_instPos,m,K),this.a_instColor>=0&&e.vertexAttrib3f(this.a_instColor,oe,Be,Ie),this.a_instSize>=0&&e.vertexAttrib1f(this.a_instSize,De),this.a_instAngle>=0&&e.vertexAttrib1f(this.a_instAngle,ke),this.a_instShield>=0&&e.vertexAttrib1f(this.a_instShield,Fe),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},destroy(){if(e){try{n&&e.deleteBuffer(n),s&&e.deleteBuffer(s),h&&e.deleteBuffer(h),c&&e.deleteBuffer(c),f&&e.deleteBuffer(f),l&&e.deleteBuffer(l),o&&e.deleteProgram(o),x&&e.deleteTexture(x)}catch{}e=null}typeof window<"u"&&S&&window.removeEventListener("resize",S),d=!1}}}var zt,yt=St(()=>{zt={createWebGLRenderer:mt}});var He=!1,me=123456789;function ot(t){He=!0,me=t>>>0}function at(){He=!1}function Mt(){return He?(me=1664525*me+1013904223>>>0,me/4294967296):Math.random()}function u(t=0,i=1){return t+(i-t)*Mt()}function he(t,i){return Math.floor(u(t,i+1))}var lt={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},ct=1.2,Ne=.6;var g={RED:0,BLUE:1},Ge=class{constructor(i,a,e,o,n,s=null){this.x=i,this.y=a,this.vx=e,this.vy=o,this.team=n,this.ownerId=s,this.life=2.5,this.radius=2.2,this.dmg=u(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:a,H:e}=i;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<e+50}},xe=class xe{constructor(i,a,e,o="corvette"){this.team=i,this.x=a,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=o;let n={corvette:{radius:8,maxSpeed:u(120,160),accel:240,turn:6.5,hp:u(40,70),reload:u(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:u(90,120),accel:200,turn:5,hp:u(80,120),reload:u(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:u(60,90),accel:150,turn:3.2,hp:u(150,220),reload:u(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:u(40,70),accel:90,turn:2,hp:u(220,300),reload:u(.6,1.2),vision:360,range:260,launchBase:u(3.5,6)},fighter:{radius:6,maxSpeed:u(160,220),accel:300,turn:8,hp:u(18,32),reload:u(.12,.22),vision:180,range:120}},s=n[o]||n.corvette;this.radius=s.radius,this.maxSpeed=s.maxSpeed,this.accel=s.accel,this.turn=s.turn||lt[o]||4.5,this.hpMax=s.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=s.reload,this.vision=s.vision,this.range=s.range,this.id=xe._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,o==="carrier"?(this.isCarrier=!0,this.launchCooldown=s.launchBase*u(.8,1.4),this.launchAmount=Math.max(1,Math.floor(u(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,a=1.35){return Math.floor(i*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let i=.06,a=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let o=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(o*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let a=null,e=1/0,o=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let s=n.x-this.x,h=n.y-this.y,c=s*s+h*h;c<o&&c<e&&(e=c,a=n)}return a}update(i,a){if(!this.alive)return;let e=this.pickTarget(a),o=this.recentHitTimer>0,n=0,s=0,h=1;if(e&&!o){let _=e.x-this.x,M=e.y-this.y;h=Math.hypot(_,M)||1;let R=Math.max(0,Math.min(1.2,h/240)),k=e.x+(e.vx||0)*R,L=e.y+(e.vy||0)*R;n=k-this.x,s=L-this.y;let F=Math.hypot(n,s)||1;n/=F,s/=F}else if(e&&o){let _=e.x-this.x,M=e.y-this.y;h=Math.hypot(_,M)||1,n=-(_/h),s=-(M/h)}else n=Math.cos(this.angle),s=Math.sin(this.angle);let c=0,f=0,l=0,x=26;for(let _ of a){if(!_.alive||_===this||_.team!==this.team)continue;let M=this.x-_.x,R=this.y-_.y,k=M*M+R*R;if(k<x*x&&k>1){let L=Math.sqrt(k);c+=M/L,f+=R/L,l++}}l>0&&(c/=l,f/=l);let d=Math.atan2(s,n)-this.angle;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;let p=this.turn*i;d>p?d=p:d<-p&&(d=-p),this.angle+=d;let S=o?this.accel*ct:this.accel;this.vx+=Math.cos(this.angle)*S*i,this.vy+=Math.sin(this.angle)*S*i,l>0&&(this.vx+=c*(this.accel*Ne)*i,this.vy+=f*(this.accel*Ne)*i);let E=Math.hypot(this.vx,this.vy);if(E>this.maxSpeed){let _=this.maxSpeed/E;this.vx*=_,this.vy*=_}if(this.x+=this.vx*i,this.y+=this.vy*i,e){let _=e.x-this.x,M=e.y-this.y,R=Math.hypot(_,M)||1;if(R<this.range){let k=Math.cos(this.angle)*(_/R)+Math.sin(this.angle)*(M/R);if(this.cooldown<=0&&k>.2){let L=300+u(-20,20),F=_/R,$=M/R;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new Ge(this.x+F*12,this.y+$*12,F*L+this.vx*.2,$*L+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-i))}damage(i){let a=i,e=0;return this.shield>0&&i>0&&(e=Math.min(this.shield,i),this.shield-=e,i-=e),i>0&&(this.hp-=i),(e>0||a>0&&i>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};rt(xe,"_id",1);var j=xe;function ye(t,i,a,e,o=80){let n=[];for(let s=0;s<i;s++){let h=s%6*20+u(-10,10),c=Math.floor(s/6)*20+u(-10,10),f=u(0,1),l="corvette";f<.45?l="corvette":f<.75?l="frigate":f<.92?l="destroyer":l="carrier",n.push(new j(t,a+(t===g.RED?-h:h),e+c,l))}return n}var je={};st(je,{Particle:()=>ae,acquireParticle:()=>ue,bullets:()=>O,clamp:()=>We,evaluateReinforcement:()=>Ve,flashes:()=>G,getReinforcementInterval:()=>Oe,handleReinforcement:()=>Z,healthFlashes:()=>z,initStars:()=>_e,particlePool:()=>te,particles:()=>U,processStateEvents:()=>Xt,releaseParticle:()=>Ee,reset:()=>Ye,resetReinforcementCooldowns:()=>qe,setCarrierLaunchStrategy:()=>Nt,setContinuousCheckbox:()=>we,setReinforcementInterval:()=>ze,setReinforcementStrategy:()=>Gt,setSpawnCompositionStrategy:()=>Wt,setToast:()=>Ht,shieldFlashes:()=>q,ships:()=>A,simulate:()=>Ke,stars:()=>ee});function ht(t,i,a={W:800,H:600}){for(let e of t.ships)e.alive&&e.update(i,t.ships,t.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let e=a.W,o=a.H;for(let n of t.ships){if(!n.alive)continue;let s=n.radius||0;n.x<-s?n.x+=e+s*2:n.x>e+s&&(n.x-=e+s*2),n.y<-s?n.y+=o+s*2:n.y>o+s&&(n.y-=o+s*2)}}for(let e=t.bullets.length-1;e>=0;e--){let o=t.bullets[e];o.update(i),o.alive(a)||t.bullets.splice(e,1)}for(let e=t.bullets.length-1;e>=0;e--){let o=t.bullets[e];for(let n of t.ships){if(!n.alive||n.team===o.team)continue;let s=n.x-o.x,h=n.y-o.y,c=s*s+h*h,f=n.radius+o.radius;if(c<f*f){let l=o.dmg,x=typeof n.shield=="number"?n.shield:0,y=typeof n.hp=="number"?n.hp:0,d=n.damage(l),p=Math.max(0,x-(typeof n.shield=="number"?n.shield:0)),S=Math.max(0,y-(typeof n.hp=="number"?n.hp:0));p>0&&t&&Array.isArray(t.shieldHits)&&t.shieldHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:p}),S>0&&t&&Array.isArray(t.healthHits)&&t.healthHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:S}),Array.isArray(t.damageEvents)||(t.damageEvents=[]),o.ownerId!=null&&t.damageEvents.push({ownerId:o.ownerId,dmg:l}),t.bullets.splice(e,1),d&&t.explosions&&t.explosions.push(d),n.alive||(Array.isArray(t.killEvents)||(t.killEvents=[]),t.killEvents.push({id:n.id,type:n.type,ownerCarrier:n.ownerCarrier,level:n.level,team:n.team,killerId:o.ownerId,killerTeam:o.team,x:n.x,y:n.y}));break}}}}var ve=Math.PI*2,Q=(t,i)=>t+(i-t)*Math.random(),We=(t,i,a)=>Math.max(i,Math.min(a,t)),Xe=t=>{if(typeof document<"u"){let i=document.getElementById("toast");i&&(i.textContent=t,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}};function Ht(t){Xe=t}var ee=[];function _e(){ee.length=0;let t=[.2,.5,1],i=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;for(let e of t)for(let o=0;o<120;o++)ee.push({x:Q(0,i),y:Q(0,a),r:Q(.3,1.8)*e,d:e,tw:Q(.4,1),phase:Q(0,ve)})}_e();var te=[],U=[],ae=class{constructor(i,a,e,o,n,s){this.x=i,this.y=a,this.vx=e,this.vy=o,this.life=n,this.max=n,this.color=s}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}};function ue(t,i,a,e,o,n){let s;return te.length>0?(s=te.pop(),s.x=t,s.y=i,s.vx=a,s.vy=e,s.life=o,s.max=o,s.color=n):s=new ae(t,i,a,e,o,n),U.push(s),s}function Ee(t){te.length<2e3&&te.push(t)}var G=[],q=[],z=[],A=[],O=[],fe=0,X={[g.RED]:0,[g.BLUE]:0},de={[g.RED]:0,[g.BLUE]:0};function qe(){de[g.RED]=0,de[g.BLUE]=0}function ze(t){fe=Number(t)||0,X[g.RED]=0,X[g.BLUE]=0}function Oe(){return fe}var Ue=null;function we(t){Ue=t}function Z(t,i=null){if(!Ue||!Ue.checked)return;let a=2,e=["frigate","corvette","destroyer","carrier"],o=(s,h)=>{for(let c=0;c<h;c++){let f=e[he(0,e.length-1)],l=typeof window<"u"?window.innerWidth:1024,x=typeof window<"u"?window.innerHeight:768,y=s===g.RED?u(40,Math.max(120,l*.35)):u(Math.max(l*.65,l-240),l-40),d=u(80,Math.max(120,x-80));A.push(new j(s,y,d,f))}},n=s=>{if(A.filter(c=>c.alive&&c.team===s).length<a&&(de[s]-=t,de[s]<=0)){let c=he(1,6);o(s,c),de[s]=u(3,8),Xe(`Reinforcements: +${c} ${s===g.RED?"Red":"Blue"}`)}};i===null?(n(g.RED),n(g.BLUE)):n(i)}function Ye(t=null){if(A.length=0,O.length=0,U.length=0,G.length=0,q.length=0,z.length=0,t!==null)ot(t>>>0),Xe(`Seed set to ${t>>>0}`);else try{at()}catch{}let i=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;A.push(...ye(g.RED,12,i*.25,a*.5)),A.push(...ye(g.BLUE,12,i*.75,a*.5))}var $e=(t,i,a)=>{let e=[];if(t.launchCooldown-=a,t.launchCooldown<=0){if((Array.isArray(t.activeFighters)?t.activeFighters.length:0)<(t.maxFighters||6)){let n=Math.max(1,Math.floor(t.launchAmount||1));for(let s=0;s<n&&!(t.activeFighters.length>=(t.maxFighters||6));s++){let h=u(0,ve),c=t.radius+12+u(4,12),f=t.x+Math.cos(h)*c,l=t.y+Math.sin(h)*c,x=new j(t.team,f,l,"fighter"),y=u(40,120);x.vx=Math.cos(h)*y+(t.vx||0)*.2,x.vy=Math.sin(h)*y+(t.vy||0)*.2,x.ownerCarrier=t.id,t.activeFighters.push(x.id),e.push(x)}}t.launchCooldown=u(2.5,6)}return e};function Nt(t){$e=t}var pt=(t,i)=>{Z(t)};function Gt(t){pt=t}var Ut=(t,i,a,e)=>ye(t,i,a,e);function Wt(t){Ut=t}function Ve(t){if(fe<=0){Z(t);return}X[g.RED]+=t,X[g.BLUE]+=t,X[g.RED]>=fe&&(Z(X[g.RED],g.RED),X[g.RED]=0),X[g.BLUE]>=fe&&(Z(X[g.BLUE],g.BLUE),X[g.BLUE]=0)}function Ke(t,i,a){for(let n of ee)n.phase+=t*.8*n.d;for(let n of A){if(!n.alive||!n.isCarrier)continue;let s=$e(n,A,t);if(Array.isArray(s)&&s.length)for(let h of s)A.push(h)}for(let n of A)n.update(t,A);for(let n=O.length-1;n>=0;n--){let s=O[n];if(s.update(t),!s.alive()){O.splice(n,1);continue}}let o={ships:A,bullets:O,score:{red:0,blue:0},particles:U,explosions:[],shieldHits:[]};if(ht(o,t,{W:i,H:a}),o.explosions&&o.explosions.length)for(let n of o.explosions){G.push({x:n.x,y:n.y,r:2,life:.25,team:n.team});for(let s=0;s<20;s++){let h=u(0,ve),c=u(40,220);ue(n.x,n.y,Math.cos(h)*c,Math.sin(h)*c,Q(.2,1),"rgba(255,255,255,$a)")}}if(Array.isArray(o.shieldHits)&&o.shieldHits.length)for(let n of o.shieldHits){let s=A.find(f=>f.id===n.id),h=s?s.x:n.hitX,c=s?s.y:n.hitY;G.push({x:h,y:c,r:6+Math.min(12,n.amount),life:.12,team:n.team,shieldHit:!0});for(let f=0;f<6;f++){let l=u(0,ve),x=u(40,120);ue(n.hitX,n.hitY,Math.cos(l)*x,Math.sin(l)*x,Q(.12,.4),"rgba(200,230,255,$a)")}if(s){let f=Math.atan2(n.hitY-c,n.hitX-h);q.push({id:s.id,angle:f,life:.22,amount:n.amount})}}if(Array.isArray(o.healthHits)&&o.healthHits.length)for(let n of o.healthHits){let s=A.find(h=>h.id===n.id);s&&z.push({id:s.id,life:.45,amount:n.amount})}if(Array.isArray(o.damageEvents)&&o.damageEvents.length){for(let n of o.damageEvents)if(n&&n.ownerId!=null&&typeof n.dmg=="number"){let s=A.find(h=>h.id===n.ownerId);s&&s.gainXp(n.dmg*.05)}}if(Array.isArray(o.killEvents)&&o.killEvents.length){for(let n of o.killEvents)if(n){if(n.killerTeam===g.RED?o.score.red++:n.killerTeam===g.BLUE&&o.score.blue++,n.killerId!=null){let s=A.find(h=>h.id===n.killerId);s&&s.gainXp(20+(n.level||1)*.2)}if(n.type==="fighter"&&typeof n.ownerCarrier=="number"){let s=A.find(h=>h.id===n.ownerCarrier);if(s&&Array.isArray(s.activeFighters)){let h=s.activeFighters.indexOf(n.id);h>=0&&s.activeFighters.splice(h,1)}}if(n.type==="carrier"){let s=n.id;for(let c of A)c.alive&&c.type==="fighter"&&c.ownerCarrier===s&&(c.ownerCarrier=null);let h=A.find(c=>c.id===s);h&&Array.isArray(h.activeFighters)&&(h.activeFighters.length=0)}}}pt(t,A);for(let n=U.length-1;n>=0;n--){let s=U[n];s.update(t),s.life<=0&&(U.splice(n,1),Ee(s))}for(let n=G.length-1;n>=0;n--){let s=G[n];s.life-=t,s.r+=600*t,s.life<=0&&G.splice(n,1)}for(let n=q.length-1;n>=0;n--){let s=q[n];s.life-=t,s.life<=0&&q.splice(n,1)}for(let n=z.length-1;n>=0;n--){let s=z[n];s.life-=t,s.life<=0&&z.splice(n,1)}return{ships:A,bullets:O,particles:U,flashes:G,shieldFlashes:q,healthFlashes:z,stars:ee}}function Xt(t,i=0){if(!(!t||!Array.isArray(t.ships))){for(let a of t.ships){if(!a.alive||!a.isCarrier)continue;let e=$e(a,t.ships,i);if(Array.isArray(e)&&e.length)for(let o of e)t.ships.push(o)}if(Array.isArray(t.damageEvents)&&t.damageEvents.length){for(let a of t.damageEvents)if(a&&a.ownerId!=null&&typeof a.dmg=="number"){let e=t.ships.find(o=>o.id===a.ownerId);e&&e.gainXp(a.dmg*.05)}}if(Array.isArray(t.killEvents)&&t.killEvents.length){for(let a of t.killEvents)if(a){if(t.score||(t.score={red:0,blue:0}),a.killerTeam===g.RED?t.score.red++:a.killerTeam===g.BLUE&&t.score.blue++,a.killerId!=null){let e=t.ships.find(o=>o.id===a.killerId);e&&e.gainXp(20+(a.level||1)*.2)}if(a.type==="fighter"&&typeof a.ownerCarrier=="number"){let e=t.ships.find(o=>o.id===a.ownerCarrier);if(e&&Array.isArray(e.activeFighters)){let o=e.activeFighters.indexOf(a.id);o>=0&&e.activeFighters.splice(o,1)}}if(a.type==="carrier"){let e=a.id;for(let n of t.ships)n.alive&&n.type==="fighter"&&n.ownerCarrier===e&&(n.ownerCarrier=null);let o=t.ships.find(n=>n.id===e);o&&Array.isArray(o.activeFighters)&&(o.activeFighters.length=0)}}}}}typeof window<"u"&&(window.initRenderer=Rt);var C=null;typeof document<"u"&&(C=document.getElementById("world"));!C&&typeof document<"u"&&(C=document.createElement("canvas"),C.id="world",document.body&&document.body.appendChild(C));if(typeof globalThis.Path2D>"u"){class t{constructor(){}moveTo(){}lineTo(){}quadraticCurveTo(){}ellipse(){}arc(){}closePath(){}}globalThis.Path2D=t}var r=null,P=C&&C.width?C.width=typeof window<"u"?window.innerWidth:1024:1024,D=C&&C.height?C.height=typeof window<"u"?window.innerHeight:768:768;typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",()=>{P=C.width=window.innerWidth,D=C.height=window.innerHeight,Et(),Ot()});var Y=Math.PI*2,Ze=We;function be(t){let i=document.getElementById("toast");i.textContent=t,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400)}var _t=ee,Ot=_e,Je=new Map;function Ai(t){if(Je.has(t))return Je.get(t);let i=new Path2D;return t==="corvette"?(i.moveTo(1.5,0),i.lineTo(-1,-.7),i.lineTo(-.4,0),i.lineTo(-1,.7),i.closePath(),i.ellipse(0,0,.35,.25,0,0,Y)):t==="frigate"?(i.moveTo(1.6,0),i.quadraticCurveTo(.2,-1.1,-1.1,-.6),i.lineTo(-.6,0),i.lineTo(-1.1,.6),i.quadraticCurveTo(.2,1.1,1.6,0),i.closePath()):t==="destroyer"?(i.moveTo(1.9,0),i.lineTo(.3,-1.1),i.lineTo(-1.4,-.6),i.lineTo(-1.4,.6),i.lineTo(.3,1.1),i.closePath()):t==="carrier"?i.ellipse(0,0,1.6,1,0,0,Y):t==="fighter"?(i.moveTo(1.2,0),i.lineTo(-.6,-.45),i.lineTo(-.2,0),i.lineTo(-.6,.45),i.closePath(),i.ellipse(.25,0,.25,.15,0,0,Y)):(i.moveTo(1.4,0),i.lineTo(-1,-.8),i.lineTo(-.4,0),i.lineTo(-1,.8),i.closePath()),Je.set(t,i),i}var Ae=null;function Et(){if(!r||typeof r.createRadialGradient!="function"){Ae=null;return}Ae=r.createRadialGradient(P*.6,D*.3,50,P*.6,D*.3,Math.max(P,D)),Ae.addColorStop(0,"rgba(60,80,140,0.10)"),Ae.addColorStop(1,"rgba(10,12,20,0.0)")}Et();var Ri=te,wt=ue,Ti=Ee,Si=ae;var J=(t,i=1)=>t===g.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function Yt(t){if(t.life<=0)return;let i=t.life/t.max;r.fillStyle=(t.color||"").replace?t.color.replace("$a",i.toFixed(3)):t.color,r.fillRect(t.x,t.y,2,2)}var et=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;let a=ge.some(d=>d.shieldHit&&d.x===i.x&&d.y===i.y&&d.life>0);if(Me){let d=i.x-Math.cos(i.angle)*i.radius*1.2,p=i.y-Math.sin(i.angle)*i.radius*1.2;wt(d,p,-i.vx*.05+u(-10,10),-i.vy*.05+u(-10,10),.25,J(i.team,"$a"))}r.save(),r.translate(i.x,i.y),r.rotate(i.angle),r.shadowBlur=12,r.shadowColor=J(i.team,.9);let e=i.radius||8;if(r.fillStyle=J(i.team,.96),i.type==="corvette"?(r.beginPath(),r.moveTo(e*1.5,0),r.lineTo(-e,-e*.7),r.lineTo(-e*.4,0),r.lineTo(-e,e*.7),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.85)",r.beginPath(),r.ellipse(0,0,e*.35,e*.25,0,0,Y),r.fill()):i.type==="frigate"?(r.beginPath(),r.moveTo(e*1.6,0),r.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),r.lineTo(-e*.6,0),r.lineTo(-e*1.1,e*.6),r.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.75)",r.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(r.beginPath(),r.moveTo(e*1.9,0),r.lineTo(e*.3,-e*1.1),r.lineTo(-e*1.4,-e*.6),r.lineTo(-e*1.4,e*.6),r.lineTo(e*.3,e*1.1),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.7)",r.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(r.beginPath(),r.ellipse(0,0,e*1.6,e*1,0,0,Y),r.fill(),r.fillStyle="rgba(255,255,255,.18)",r.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(r.beginPath(),r.moveTo(e*1.2,0),r.lineTo(-e*.6,-e*.45),r.lineTo(-e*.2,0),r.lineTo(-e*.6,e*.45),r.closePath(),r.fill(),r.fillStyle="rgba(255,255,255,.9)",r.beginPath(),r.ellipse(e*.25,0,e*.25,e*.15,0,0,Y),r.fill()):(r.beginPath(),r.moveTo(e*1.4,0),r.lineTo(-e,-e*.8),r.lineTo(-e*.4,0),r.lineTo(-e,e*.8),r.closePath(),r.fill()),r.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,p=e+4+(1-d)*2;r.save(),r.beginPath(),r.arc(i.x,i.y,p,0,Y);let S=r.createRadialGradient(i.x,i.y,p*.6,i.x,i.y,p);S.addColorStop(0,`rgba(140,200,255,${.06})`),S.addColorStop(1,`rgba(80,160,255,${.02})`),r.fillStyle=S,r.globalCompositeOperation="lighter",r.fill();for(let E of bt){if(E.id!==i.id)continue;let _=Math.max(0,Math.min(1,E.life/.22)),M=i.shieldMax&&i.shieldMax>0?E.amount/i.shieldMax:Math.min(1,E.amount/(i.hpMax*.6||1)),R=Math.max(.08,Math.min(1,M)),L=(Math.PI*.25+Math.PI*.6*(1-_))*(.6+1.6*R),F=E.angle-L/2,$=E.angle+L/2,V=p+4*(1-_)+2*R;r.beginPath(),r.arc(i.x,i.y,V,F,$),r.lineWidth=(3+6*_)*(1+4*R);let B=Math.min(1,.25+_*(.9+1.6*R));r.strokeStyle=`rgba(160,220,255,${B})`,r.save(),r.shadowBlur=12*R,r.shadowColor="rgba(140,200,255,0.8)",r.stroke(),r.restore()}r.restore()}let o=Math.max(16,e*3.2),n=Math.max(3,e*.4),s=i.x-o/2,h=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let d=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;r.fillStyle="rgba(255,255,255,.08)",r.fillRect(s,h,o,n),r.fillStyle="rgba(80,160,255,.95)",r.fillRect(s,h,o*d,n)}let c=i.y+(e+8),f=Math.max(0,Math.min(1,i.hp/i.hpMax)),l=Math.min(6,n);r.beginPath(),r.moveTo(s+l,c),r.lineTo(s+o-l,c),r.quadraticCurveTo(s+o,c,s+o,c+l),r.lineTo(s+o,c+n-l),r.quadraticCurveTo(s+o,c+n,s+o-l,c+n),r.lineTo(s+l,c+n),r.quadraticCurveTo(s,c+n,s,c+n-l),r.lineTo(s,c+l),r.quadraticCurveTo(s,c,s+l,c),r.closePath(),r.fillStyle="rgba(255,255,255,.08)",r.fill();let x=At.find(d=>d.id===i.id&&d.life>0),y=`rgba(120,220,120,${.95})`;if(x){let d=Math.max(0,Math.min(1,x.life/.45)),p=Math.min(1,x.amount/(i.hpMax||1)),S=Math.floor(220*(1-p*d)),E=Math.floor(60+160*(1-d*p));y=`rgba(${Math.min(255,S)},${Math.min(255,E)},60,${.95})`}r.save(),r.beginPath(),r.moveTo(s+l,c),r.lineTo(s+o-l,c),r.quadraticCurveTo(s+o,c,s+o,c+l),r.lineTo(s+o,c+n-l),r.quadraticCurveTo(s+o,c+n,s+o-l,c+n),r.lineTo(s+l,c+n),r.quadraticCurveTo(s,c+n,s,c+n-l),r.lineTo(s,c+l),r.quadraticCurveTo(s,c,s+l,c),r.closePath(),r.clip(),r.fillStyle=y,r.fillRect(s,c,o*f,n),r.restore(),typeof i.level=="number"&&i.level>1&&(r.save(),r.fillStyle="rgba(255,255,255,0.95)",r.font="700 12px system-ui, sans-serif",r.textAlign="center",r.fillText(`Lv ${i.level}`,i.x,i.y-(e+18)),r.restore())}},H=A,Ce=O,Le=U,ge=G,bt=q,At=z,Pe={red:0,blue:0},ie=new Map,le=!1,Se=1,Me=!0,Re=0;function tt(t=null){return Ye(t)}function $t(t){let i=Ke(t,P,D);i&&i.score&&(Pe=i.score),H=A,Ce=O,Le=U,ge=G,bt=q,At=z;let a=new Set(H.map(e=>e.id));for(let e of H)ie.has(e.id)?ie.get(e.id).syncFromLogic():ie.set(e.id,new et(e));for(let e of Array.from(ie.keys()))a.has(e)||ie.delete(e)}function vt(){r.clearRect(0,0,P,D);let t=r.createRadialGradient(P*.6,D*.3,50,P*.6,D*.3,Math.max(P,D));t.addColorStop(0,"rgba(60,80,140,0.10)"),t.addColorStop(1,"rgba(10,12,20,0.0)"),r.fillStyle=t,r.fillRect(0,0,P,D);for(let e of _t){let o=.6+.4*Math.sin(e.phase);r.globalAlpha=Ze(.5*o*(.6+.5*e.d),0,1),r.fillStyle="#e9f2ff",r.fillRect(e.x,e.y,e.r,e.r)}r.globalAlpha=1;for(let e of ge){let o=Ze(e.life/.25,0,1);r.strokeStyle=J(e.team,o*.6),r.lineWidth=2,r.beginPath(),r.arc(e.x,e.y,e.r,0,Y),r.stroke()}for(let e of Ce)r.save(),r.shadowBlur=12,r.shadowColor=J(e.team,.9),r.fillStyle=J(e.team,.95),r.beginPath(),r.arc(e.x,e.y,e.radius||2.2,0,Y),r.fill(),r.restore();for(let e of Le)Yt(e);for(let e of ie.values())e.draw();let i=H.some(e=>e.alive&&e.team===g.RED),a=H.some(e=>e.alive&&e.team===g.BLUE);if(!i||!a){r.save(),r.textAlign="center",r.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":a?"Blue":"Nobody",o=i?J(g.RED,.95):a?J(g.BLUE,.95):"rgba(255,255,255,.9)";r.fillStyle=o,r.shadowBlur=14,r.shadowColor=o,r.fillText(`${e} Wins!`,P/2,64),r.restore()}}function it(t){Re||(Re=t);let i=(t-Re)/1e3;Re=t;let a=Ze(i,0,.033)*(le?Se:0);if($t(a),b&&b.type==="webgl"&&typeof b.render=="function")try{b.render({W:P,H:D,ships:H,bullets:Ce,stars:_t,particles:Le,flashes:ge,shipsVMap:ie,score:Pe})}catch(e){console.error("WebGL render error, falling back to 2D render",e),vt()}else vt();Jt(),requestAnimationFrame(it)}var Mi=document.getElementById("startPause"),Pi=document.getElementById("reset"),Ci=document.getElementById("addRed"),Li=document.getElementById("addBlue"),Bi=document.getElementById("toggleTrails"),Ii=document.getElementById("speed"),Vt=document.getElementById("redScore"),Kt=document.getElementById("blueScore"),jt=document.getElementById("stats"),Di=document.getElementById("seedBtn"),ki=document.getElementById("formationBtn"),pe=document.getElementById("continuousCheckbox");pe||(pe=document.createElement("input"),pe.type="checkbox",pe.id="continuousCheckbox");je&&typeof we=="function"&&we(pe);function Jt(){Vt.textContent=`Red ${Pe.red}`,Kt.textContent=`Blue ${Pe.blue}`,jt.textContent=`Ships: ${H.filter(t=>t.alive).length}  Bullets: ${Ce.length}  Particles: ${Le.length}`}function Qt(){if(typeof document>"u")return null;let t=document.getElementById("rendererBackendBadge");if(!t){t=document.createElement("div"),t.id="rendererBackendBadge",t.style.position="fixed",t.style.right="12px",t.style.top="12px",t.style.padding="6px 10px",t.style.background="rgba(0,0,0,0.6)",t.style.color="#fff",t.style.fontFamily="system-ui,Segoe UI,Roboto,Arial",t.style.fontSize="12px",t.style.borderRadius="6px",t.style.zIndex="99999",t.style.pointerEvents="auto",t.style.cursor="default",t.title="Renderer backend";try{document.body.appendChild(t)}catch{}}return t}function Te(t,i){let a=Qt();a&&(a.textContent=t,i&&(a.title=i))}var Fi=qe;function Zt(t){return ze(t)}function Qe(){return Oe()}var Hi=Ve,Ni=Z;function ei(){if(typeof window>"u"||!document||window.__uiHandlersInstalled)return;Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1});let t=document.getElementById("startPause");t&&t.addEventListener("click",()=>{le=!le,t.textContent=le?"\u23F8 Pause":"\u25B6 Start"});let i=document.getElementById("reset");i&&i.addEventListener("click",()=>{tt()});let a=document.getElementById("addRed");a&&a.addEventListener("click",()=>{H.push(new j(g.RED,u(40,P*.35),u(80,D-80))),be("+1 Red")});let e=document.getElementById("addBlue");e&&e.addEventListener("click",()=>{H.push(new j(g.BLUE,u(P*.65,P-40),u(80,D-80))),be("+1 Blue")});let o=document.getElementById("toggleTrails");o&&o.addEventListener("click",()=>{Me=!Me,o.textContent=`\u2604 Trails: ${Me?"On":"Off"}`});let n=document.getElementById("speed");n&&n.addEventListener("click",()=>{let l=[.5,1,2,4],x=(l.indexOf(Se)+1)%l.length;Se=l[x],n.textContent=`Speed: ${Se}\xD7`});let s=document.getElementById("seedBtn");s&&s.addEventListener("click",()=>{let l=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);l!==null&&tt(Number(l))});let h=document.getElementById("formationBtn");h&&h.addEventListener("click",()=>{let l=H.filter(p=>p.alive&&p.team===g.RED),x=H.filter(p=>p.alive&&p.team===g.BLUE),y=20,d=6;l.forEach((p,S)=>{let E=S%d,_=Math.floor(S/d);p.x=P*.25-E*20,p.y=D*.5+(_-d/2)*y,p.vx=p.vy=0}),x.forEach((p,S)=>{let E=S%d,_=Math.floor(S/d);p.x=P*.75+E*20,p.y=D*.5+(_-d/2)*y,p.vx=p.vy=0}),be("Fleets re-formed")});let c=document.getElementById("reinforceFreqBtn"),f=[0,.5,1,2];if(c){let l=()=>{let x=Qe();c.textContent=x>0?`${x}s`:"Every step"};l(),c.addEventListener("click",()=>{let x=Qe(),y=(f.indexOf(x)+1)%f.length;Zt(f[y]),l();let d=Qe();be(`Reinforcement check: ${d>0?d+"s":"every step"}`)})}C&&typeof C.addEventListener=="function"&&C.addEventListener("click",l=>{ge.push({x:l.clientX,y:l.clientY,r:24,life:.25,team:he(0,1)});for(let y=0;y<24;y++){let d=u(0,Y),p=u(40,220);wt(l.clientX,l.clientY,Math.cos(d)*p,Math.sin(d)*p,u(.2,1),"rgba(255,255,255,$a)")}})}H.length===0&&tt();var b=null,T={triedWebGL:!1,gl2:!1,gl1:!1,importError:null,used:null};try{if(typeof window<"u"&&typeof HTMLCanvasElement<"u"&&!HTMLCanvasElement.prototype.__getContextWrapped){let t=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(i,a){try{let e=t.call(this,i,a);if(!e)try{let o=new Error("getContext returned null for type "+i).stack;if(T.getContextNullStacks=T.getContextNullStacks||[],T.getContextNullStacks.push({type:i,attrs:a,stack:o,time:Date.now()}),typeof window<"u")try{window.__rendererDiag=T}catch{}console.warn("DEBUG: HTMLCanvasElement.getContext returned null for",i,a,`
stack:`,o)}catch{}return e}catch(e){try{let o=new Error("getContext threw for type "+i).stack;if(T.getContextThrowStacks=T.getContextThrowStacks||[],T.getContextThrowStacks.push({type:i,attrs:a,err:String(e),stack:o,time:Date.now()}),typeof window<"u")try{window.__rendererDiag=T}catch{}console.warn("DEBUG: HTMLCanvasElement.getContext threw",e,`
stack:`,o)}catch{}throw e}};try{Object.defineProperty(HTMLCanvasElement.prototype,"__getContextWrapped",{value:!0,configurable:!1})}catch{HTMLCanvasElement.prototype.__getContextWrapped=!0}}}catch{}var W=null,ce=!1;async function Rt(t={}){if(typeof window<"u"&&(window.initRenderer=Rt),typeof window<"u"&&window.__autoRendererStarted){if(ce&&b)return b;if(W)return await W,b}if(ce&&b)return b;if(W)return await W,b;typeof window<"u"&&(window.__autoRendererStarted=!0),W=(async()=>{let{canvas:i=C,preferWebGL:a=!0,startLoop:e=!0}=t;if(!i)throw new Error("No canvas available to initialize renderer");if(ei(),a&&i.getContext){T.triedWebGL=!0;let o=[{},{antialias:!1},{powerPreference:"high-performance"},{antialias:!1,powerPreference:"high-performance"},{antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1}],n=[],s=null;for(let f of o)try{let l=i.getContext("webgl2",f);n.push({attrs:f,ok:!!l}),l&&!s&&(s=l)}catch(l){n.push({attrs:f,ok:!1,err:String(l)})}let h=[],c=null;if(!s)for(let f of o)try{let l=i.getContext("webgl",f);h.push({attrs:f,ok:!!l}),l&&!c&&(c=l)}catch(l){h.push({attrs:f,ok:!1,err:String(l)})}if(T.attempts={webgl2:n,webgl:h},T.gl2=!!s,T.gl1=!!c,s||c)try{let{createWebGLRenderer:f}=await Promise.resolve().then(()=>(yt(),xt));if(b=f(i,{webgl2:!!s}),b.init(),e&&b.start(()=>{requestAnimationFrame(it)}),T.used="webgl",typeof window<"u")try{window.__rendererDiag=T}catch{}console.info("Renderer: using WebGL",{webgl2:!!s});try{Te("WebGL"+(s?"2":"1"),T.importError||"Using GPU WebGL renderer")}catch{}return b}catch(f){T.importError=String(f&&f.stack?f.stack:f),console.warn("WebGL init failed, falling back to 2D canvas renderer",f);try{Te("Canvas (WebGL failed)",T.importError)}catch{}}else{T.importError="No WebGL context (getContext returned null)",console.info("Renderer: no WebGL context available; using Canvas 2D fallback");try{Te("Canvas (no WebGL)",T.importError)}catch{}}}if(!b){if(b={type:"canvas"},T.used="canvas",typeof window<"u")try{window.__rendererDiag=T}catch{}console.info("Renderer: using Canvas 2D fallback");try{Te("Canvas",T.importError||"Using Canvas 2D fallback")}catch{}e&&requestAnimationFrame(it)}return b})();try{let i=await W;return ce=!0,i}finally{W&&(W=null)}}function Gi(){return b?b.type:null}function Ui(){return T}function ti(){if(b&&typeof b.stop=="function"&&b.stop(),b&&typeof b.destroy=="function"&&b.destroy(),b=null,ce=!1,W=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function Wi(){if(ti(),ce=!1,W=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function Xi(){if(ce=!1,W=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}typeof window<"u"&&(window.startSimulation=function(){try{le=!0;let i=document.getElementById("startPause");i&&(i.textContent="\u23F8 Pause")}catch{}},window.stopSimulation=function(){try{le=!1;let i=document.getElementById("startPause");i&&(i.textContent="\u25B6 Start")}catch{}});export{Si as Particle,Xi as _internal_resetInitFlags,wt as acquireParticle,Ae as backgroundGradient,Ce as bullets,Ze as clamp,Hi as evaluateReinforcement,ge as flashes,Ai as getHullPath,Qe as getReinforcementInterval,Ui as getRendererDiagnostics,Gi as getRendererType,Ni as handleReinforcement,At as healthFlashes,Je as hullPaths,Rt as initRenderer,Ot as initStars,Ri as particlePool,Le as particles,Et as recomputeBackgroundGradient,Ti as releaseParticle,tt as reset,Fi as resetReinforcementCooldowns,Zt as setReinforcementInterval,bt as shieldFlashes,H as ships,ie as shipsVMap,_t as stars,ti as stopRenderer,Wi as stopRendererAndAllowReinit,J as teamColor};
