var Le=Object.defineProperty;var Se=(n,e,a)=>e in n?Le(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var xe=(n,e,a)=>Se(n,typeof e!="symbol"?e+"":e,a);var ne=!1,K=123456789;function ge(n){ne=!0,K=n>>>0}function ye(){ne=!1}function Ce(){return ne?(K=1664525*K+1013904223>>>0,K/4294967296):Math.random()}function h(n=0,e=1){return n+(e-n)*Ce()}function j(n,e){return Math.floor(h(n,e+1))}var Ee={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},ve=1.2,oe=.6;var f={RED:0,BLUE:1},le=class{constructor(e,a,t,s,l,o=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=l,this.ownerId=o,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},z=class z{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let l={corvette:{radius:8,maxSpeed:h(120,160),accel:240,turn:6.5,hp:h(40,70),reload:h(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:h(90,120),accel:200,turn:5,hp:h(80,120),reload:h(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:h(60,90),accel:150,turn:3.2,hp:h(150,220),reload:h(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:h(40,70),accel:90,turn:2,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)},fighter:{radius:6,maxSpeed:h(160,220),accel:300,turn:8,hp:h(18,32),reload:h(.12,.22),vision:180,range:120}},o=l[s]||l.corvette;this.radius=o.radius,this.maxSpeed=o.maxSpeed,this.accel=o.accel,this.turn=o.turn||Ee[s]||4.5,this.hpMax=o.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=o.reload,this.vision=o.vision,this.range=o.range,this.id=z._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,s==="carrier"?(this.isCarrier=!0,this.launchCooldown=o.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let l of e){if(!l.alive||l.team===this.team)continue;let o=l.x-this.x,c=l.y-this.y,r=o*o+c*c;r<s&&r<t&&(t=r,a=l)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=this.recentHitTimer>0,l=0,o=0,c=1;if(t&&!s){let p=t.x-this.x,b=t.y-this.y;c=Math.hypot(p,b)||1;let E=Math.max(0,Math.min(1.2,c/240)),H=t.x+(t.vx||0)*E,L=t.y+(t.vy||0)*E;l=H-this.x,o=L-this.y;let k=Math.hypot(l,o)||1;l/=k,o/=k}else if(t&&s){let p=t.x-this.x,b=t.y-this.y;c=Math.hypot(p,b)||1,l=-(p/c),o=-(b/c)}else l=Math.cos(this.angle),o=Math.sin(this.angle);let r=0,m=0,d=0,R=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let b=this.x-p.x,E=this.y-p.y,H=b*b+E*E;if(H<R*R&&H>1){let L=Math.sqrt(H);r+=b/L,m+=E/L,d++}}d>0&&(r/=d,m/=d);let u=Math.atan2(o,l)-this.angle;for(;u>Math.PI;)u-=2*Math.PI;for(;u<-Math.PI;)u+=2*Math.PI;let M=this.turn*e;u>M?u=M:u<-M&&(u=-M),this.angle+=u;let _=s?this.accel*ve:this.accel;this.vx+=Math.cos(this.angle)*_*e,this.vy+=Math.sin(this.angle)*_*e,d>0&&(this.vx+=r*(this.accel*oe)*e,this.vy+=m*(this.accel*oe)*e);let T=Math.hypot(this.vx,this.vy);if(T>this.maxSpeed){let p=this.maxSpeed/T;this.vx*=p,this.vy*=p}if(this.x+=this.vx*e,this.y+=this.vy*e,t){let p=t.x-this.x,b=t.y-this.y,E=Math.hypot(p,b)||1;if(E<this.range){let H=Math.cos(this.angle)*(p/E)+Math.sin(this.angle)*(b/E);if(this.cooldown<=0&&H>.2){let L=300+h(-20,20),k=p/E,Y=b/E;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new le(this.x+k*12,this.y+Y*12,k*L+this.vx*.2,Y*L+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-e))}damage(e){let a=e,t=0;return this.shield>0&&e>0&&(t=Math.min(this.shield,e),this.shield-=t,e-=t),e>0&&(this.hp-=e),(t>0||a>0&&e>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};xe(z,"_id",1);var C=z;function ae(n,e,a,t,s=80){let l=[];for(let o=0;o<e;o++){let c=o%6*20+h(-10,10),r=Math.floor(o/6)*20+h(-10,10),m=h(0,1),d="corvette";m<.45?d="corvette":m<.75?d="frigate":m<.92?d="destroyer":d="carrier",l.push(new C(n,a+(n===f.RED?-c:c),t+r,d))}return l}function Me(n,e,a={W:800,H:600}){for(let t of n.ships)t.alive&&t.update(e,n.ships,n.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let l of n.ships){if(!l.alive)continue;let o=l.radius||0;l.x<-o?l.x+=t+o*2:l.x>t+o&&(l.x-=t+o*2),l.y<-o?l.y+=s+o*2:l.y>s+o&&(l.y-=s+o*2)}}for(let t of n.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){if((Array.isArray(t.activeFighters)?t.activeFighters.length:0)<(t.maxFighters||6)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let o=0;o<l&&!(t.activeFighters.length>=(t.maxFighters||6));o++){let c=h(0,Math.PI*2),r=t.radius+12+h(4,12),m=t.x+Math.cos(c)*r,d=t.y+Math.sin(c)*r,R=new C(t.team,m,d,"fighter"),A=h(40,120);R.vx=Math.cos(c)*A+(t.vx||0)*.2,R.vy=Math.sin(c)*A+(t.vy||0)*.2,R.ownerCarrier=t.id,t.activeFighters.push(R.id),n.ships.push(R)}}t.launchCooldown=h(2.5,6)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];s.update(e),s.alive(a)||n.bullets.splice(t,1)}for(let t=n.bullets.length-1;t>=0;t--){let s=n.bullets[t];for(let l of n.ships){if(!l.alive||l.team===s.team)continue;let o=l.x-s.x,c=l.y-s.y,r=o*o+c*c,m=l.radius+s.radius;if(r<m*m){let d=s.dmg,R=typeof l.shield=="number"?l.shield:0,A=typeof l.hp=="number"?l.hp:0,u=l.damage(d),M=Math.max(0,R-(typeof l.shield=="number"?l.shield:0)),_=Math.max(0,A-(typeof l.hp=="number"?l.hp:0));if(M>0&&n&&Array.isArray(n.shieldHits)&&n.shieldHits.push({id:l.id,hitX:s.x,hitY:s.y,team:l.team,amount:M}),_>0&&n&&Array.isArray(n.healthHits)&&n.healthHits.push({id:l.id,hitX:s.x,hitY:s.y,team:l.team,amount:_}),s.ownerId!=null){let T=n.ships.find(p=>p.id===s.ownerId);T&&T.gainXp(d*.05)}if(n.bullets.splice(t,1),u&&n.explosions&&n.explosions.push(u),!l.alive&&(s.team===0?n.score.red++:n.score.blue++,s.ownerId!=null)){let T=n.ships.find(p=>p.id===s.ownerId);T&&T.gainXp(20+(l.level||1)*.2)}break}}}for(let t of n.explosions||[]){if(!t||!t.id)continue;let s=t;if(s.type==="fighter"&&typeof s.ownerCarrier=="number"){let l=n.ships.find(o=>o.id===s.ownerCarrier);if(l&&Array.isArray(l.activeFighters)){let o=l.activeFighters.indexOf(s.id);o>=0&&l.activeFighters.splice(o,1)}}if(s.type==="carrier"){let l=s.id;for(let c of n.ships)c.alive&&c.type==="fighter"&&c.ownerCarrier===l&&(c.ownerCarrier=null);let o=n.ships.find(c=>c.id===l);o&&Array.isArray(o.activeFighters)&&(o.activeFighters.length=0)}}}var y=null;typeof document<"u"&&(y=document.getElementById("world"));!y&&typeof document<"u"&&(y=document.createElement("canvas"),y.id="world",document.body&&document.body.appendChild(y));if(typeof globalThis.Path2D>"u"){class n{constructor(){}moveTo(){}lineTo(){}quadraticCurveTo(){}ellipse(){}arc(){}closePath(){}}globalThis.Path2D=n}var i=null;if(y&&typeof y.getContext=="function")try{i=y.getContext("2d")}catch{i=null}if(!i){let n=()=>{};i={beginPath:n,moveTo:n,lineTo:n,quadraticCurveTo:n,arc:n,ellipse:n,fill:n,stroke:n,closePath:n,fillRect:n,clearRect:n,createLinearGradient:()=>({addColorStop:n}),createRadialGradient:()=>({addColorStop:n}),fillText:n,measureText:()=>({width:0}),setLineDash:n,save:n,restore:n,translate:n,rotate:n,clip:n,shadowBlur:0,shadowColor:"",globalAlpha:1,fillStyle:"",strokeStyle:"",lineWidth:1,font:"",textAlign:"start",globalCompositeOperation:"source-over"},y&&(y.getContext=()=>i)}var x=y&&y.width?y.width=typeof window<"u"?window.innerWidth:1024:1024,v=y&&y.height?y.height=typeof window<"u"?window.innerHeight:768:768;typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",()=>{x=y.width=window.innerWidth,v=y.height=window.innerHeight,Pe(),we()});var w=Math.PI*2,de=(n,e,a)=>Math.max(e,Math.min(a,n)),X=(n=0,e=1)=>n+(e-n)*Math.random();function $(n){let e=document.getElementById("toast");e.textContent=n,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var te=[];function we(){te.length=0;let n=[.2,.5,1];for(let e of n)for(let a=0;a<120;a++)te.push({x:X(0,x),y:X(0,v),r:X(.3,1.8)*e,d:e,tw:X(.4,1),phase:X(0,w)})}we();var re=new Map;function vt(n){if(re.has(n))return re.get(n);let e=new Path2D;return n==="corvette"?(e.moveTo(1.5,0),e.lineTo(-1,-.7),e.lineTo(-.4,0),e.lineTo(-1,.7),e.closePath(),e.ellipse(0,0,.35,.25,0,0,w)):n==="frigate"?(e.moveTo(1.6,0),e.quadraticCurveTo(.2,-1.1,-1.1,-.6),e.lineTo(-.6,0),e.lineTo(-1.1,.6),e.quadraticCurveTo(.2,1.1,1.6,0),e.closePath()):n==="destroyer"?(e.moveTo(1.9,0),e.lineTo(.3,-1.1),e.lineTo(-1.4,-.6),e.lineTo(-1.4,.6),e.lineTo(.3,1.1),e.closePath()):n==="carrier"?e.ellipse(0,0,1.6,1,0,0,w):n==="fighter"?(e.moveTo(1.2,0),e.lineTo(-.6,-.45),e.lineTo(-.2,0),e.lineTo(-.6,.45),e.closePath(),e.ellipse(.25,0,.25,.15,0,0,w)):(e.moveTo(1.4,0),e.lineTo(-1,-.8),e.lineTo(-.4,0),e.lineTo(-1,.8),e.closePath()),re.set(n,e),e}var he=null;function Pe(){he=i.createRadialGradient(x*.6,v*.3,50,x*.6,v*.3,Math.max(x,v)),he.addColorStop(0,"rgba(60,80,140,0.10)"),he.addColorStop(1,"rgba(10,12,20,0.0)")}Pe();var ie=[];function se(n,e,a,t,s,l){let o;return ie.length>0?(o=ie.pop(),o.x=n,o.y=e,o.vx=a,o.vy=t,o.life=s,o.max=s,o.color=l):o=new fe(n,e,a,t,s,l),D.push(o),o}function Ge(n){ie.length<2e3&&ie.push(n)}var I=(n,e=1)=>n===f.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,fe=class{constructor(e,a,t,s,l,o){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=l,this.max=l,this.color=o}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},ue=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=B.some(u=>u.shieldHit&&u.x===e.x&&u.y===e.y&&u.life>0);if(ee){let u=e.x-Math.cos(e.angle)*e.radius*1.2,M=e.y-Math.sin(e.angle)*e.radius*1.2;se(u,M,-e.vx*.05+h(-10,10),-e.vy*.05+h(-10,10),.25,I(e.team,"$a"))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=I(e.team,.9);let t=e.radius||8;if(i.fillStyle=I(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,w),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,w),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,w),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let u=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,M=t+4+(1-u)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,M,0,w);let _=i.createRadialGradient(e.x,e.y,M*.6,e.x,e.y,M);_.addColorStop(0,`rgba(140,200,255,${.06})`),_.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=_,i.globalCompositeOperation="lighter",i.fill();for(let T of G){if(T.id!==e.id)continue;let p=Math.max(0,Math.min(1,T.life/.22)),b=e.shieldMax&&e.shieldMax>0?T.amount/e.shieldMax:Math.min(1,T.amount/(e.hpMax*.6||1)),E=Math.max(.08,Math.min(1,b)),L=(Math.PI*.25+Math.PI*.6*(1-p))*(.6+1.6*E),k=T.angle-L/2,Y=T.angle+L/2,me=M+4*(1-p)+2*E;i.beginPath(),i.arc(e.x,e.y,me,k,Y),i.lineWidth=(3+6*p)*(1+4*E);let _e=Math.min(1,.25+p*(.9+1.6*E));i.strokeStyle=`rgba(160,220,255,${_e})`,i.save(),i.shadowBlur=12*E,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),l=Math.max(3,t*.4),o=e.x-s/2,c=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let u=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(o,c,s,l),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(o,c,s*u,l)}let r=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),d=Math.min(6,l);i.beginPath(),i.moveTo(o+d,r),i.lineTo(o+s-d,r),i.quadraticCurveTo(o+s,r,o+s,r+d),i.lineTo(o+s,r+l-d),i.quadraticCurveTo(o+s,r+l,o+s-d,r+l),i.lineTo(o+d,r+l),i.quadraticCurveTo(o,r+l,o,r+l-d),i.lineTo(o,r+d),i.quadraticCurveTo(o,r,o+d,r),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let R=q.find(u=>u.id===e.id&&u.life>0),A=`rgba(120,220,120,${.95})`;if(R){let u=Math.max(0,Math.min(1,R.life/.45)),M=Math.min(1,R.amount/(e.hpMax||1)),_=Math.floor(220*(1-M*u)),T=Math.floor(60+160*(1-u*M));A=`rgba(${Math.min(255,_)},${Math.min(255,T)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(o+d,r),i.lineTo(o+s-d,r),i.quadraticCurveTo(o+s,r,o+s,r+d),i.lineTo(o+s,r+l-d),i.quadraticCurveTo(o+s,r+l,o+s-d,r+l),i.lineTo(o+d,r+l),i.quadraticCurveTo(o,r+l,o,r+l-d),i.lineTo(o,r+d),i.quadraticCurveTo(o,r,o+d,r),i.closePath(),i.clip(),i.fillStyle=A,i.fillRect(o,r,s*m,l),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},g=[],N=[],D=[],B=[],G=[],q=[],F=new Map,Q=!1,Z=1,ee=!0,V=0,W={red:0,blue:0};function J(n=null){g.length=0,N.length=0,D.length=0,B.length=0,W.red=0,W.blue=0,n!==null?(ge(n>>>0),$(`Seed set to ${n>>>0}`)):ye(),g.push(...ae(f.RED,12,x*.25,v*.5)),g.push(...ae(f.BLUE,12,x*.75,v*.5))}function qe(n){for(let s of te)s.phase+=n*.8*s.d;for(let s of g)s.update(n,g);for(let s=N.length-1;s>=0;s--){let l=N[s];if(l.update(n),!l.alive()){N.splice(s,1);continue}}let a={ships:g,bullets:N,score:W,particles:D,explosions:[],shieldHits:[]};if(Me(a,n,{W:x,H:v}),a.explosions&&a.explosions.length)for(let s of a.explosions){B.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let l=0;l<20;l++){let o=h(0,w),c=h(40,220);se(s.x,s.y,Math.cos(o)*c,Math.sin(o)*c,h(.2,1),I(s.team,"$a"))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let l=g.find(r=>r.id===s.id),o=l?l.x:s.hitX,c=l?l.y:s.hitY;B.push({x:o,y:c,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let r=0;r<6;r++){let m=h(0,w),d=h(40,120);se(s.hitX,s.hitY,Math.cos(m)*d,Math.sin(m)*d,h(.12,.4),"rgba(200,230,255,$a)")}if(l){let r=Math.atan2(s.hitY-c,s.hitX-o);G.push({id:l.id,angle:r,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let l=g.find(o=>o.id===s.id);l&&q.push({id:l.id,life:.45,amount:s.amount})}tt(n);for(let s=D.length-1;s>=0;s--){let l=D[s];l.update(n),l.life<=0&&(D.splice(s,1),Ge(l))}for(let s=B.length-1;s>=0;s--){let l=B[s];l.life-=n,l.r+=600*n,l.life<=0&&B.splice(s,1)}for(let s=G.length-1;s>=0;s--){let l=G[s];l.life-=n,l.life<=0&&G.splice(s,1)}for(let s=q.length-1;s>=0;s--){let l=q[s];l.life-=n,l.life<=0&&q.splice(s,1)}let t=new Set(g.map(s=>s.id));for(let s of g)F.has(s.id)?F.get(s.id).syncFromLogic():F.set(s.id,new ue(s));for(let s of Array.from(F.keys()))t.has(s)||F.delete(s)}function Ve(){i.clearRect(0,0,x,v);let n=i.createRadialGradient(x*.6,v*.3,50,x*.6,v*.3,Math.max(x,v));n.addColorStop(0,"rgba(60,80,140,0.10)"),n.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=n,i.fillRect(0,0,x,v);for(let t of te){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=de(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of B){let s=de(t.life/.25,0,1);i.strokeStyle=I(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,w),i.stroke()}for(let t of N)i.save(),i.shadowBlur=12,i.shadowColor=I(t.team,.9),i.fillStyle=I(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,w),i.fill(),i.restore();for(let t of D)t.draw();for(let t of F.values())t.draw();let e=g.some(t=>t.alive&&t.team===f.RED),a=g.some(t=>t.alive&&t.team===f.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?I(f.RED,.95):a?I(f.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,x/2,64),i.restore()}}function pe(n){V||(V=n);let e=(n-V)/1e3;V=n;let a=de(e,0,.033)*(Q?Z:0);qe(a),Ve(),Ze(),requestAnimationFrame(pe)}var Te=document.getElementById("startPause"),Oe=document.getElementById("reset"),We=document.getElementById("addRed"),Ye=document.getElementById("addBlue"),Re=document.getElementById("toggleTrails"),be=document.getElementById("speed"),Ke=document.getElementById("redScore"),je=document.getElementById("blueScore"),ze=document.getElementById("stats"),Je=document.getElementById("seedBtn"),Qe=document.getElementById("formationBtn"),U=document.getElementById("continuousCheckbox");U||(U=document.createElement("input"),U.type="checkbox",U.id="continuousCheckbox");function Ze(){Ke.textContent=`Red ${W.red}`,je.textContent=`Blue ${W.blue}`,ze.textContent=`Ships: ${g.filter(n=>n.alive).length}  Bullets: ${N.length}  Particles: ${D.length}`}var O={[f.RED]:0,[f.BLUE]:0};function Mt(){O[f.RED]=0,O[f.BLUE]=0}var P=0,S={[f.RED]:0,[f.BLUE]:0};function et(n){P=Number(n)||0,S[f.RED]=0,S[f.BLUE]=0}function Tt(){return P}function tt(n){if(P<=0){ce(n);return}S[f.RED]+=n,S[f.BLUE]+=n,S[f.RED]>=P&&(ce(S[f.RED],f.RED),S[f.RED]=0),S[f.BLUE]>=P&&(ce(S[f.BLUE],f.BLUE),S[f.BLUE]=0)}function ce(n,e=null){if(!U||!U.checked)return;let a=2,t=["frigate","corvette","destroyer","carrier"],s=(o,c)=>{for(let r=0;r<c;r++){let m=t[j(0,t.length-1)],d=o===f.RED?h(40,Math.max(120,x*.35)):h(Math.max(x*.65,x-240),x-40),R=h(80,Math.max(120,v-80));g.push(new C(o,d,R,m))}},l=o=>{if(g.filter(r=>r.alive&&r.team===o).length<a&&(O[o]-=n,O[o]<=0)){let r=j(1,6);s(o,r),O[o]=h(3,8),$(`Reinforcements: +${r} ${o===f.RED?"Red":"Blue"}`)}};e===null?(l(f.RED),l(f.BLUE)):l(e)}if(window.__uiHandlersInstalled)g.length===0&&J(),V||requestAnimationFrame(pe);else{Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1}),Te.addEventListener("click",()=>{Q=!Q,Te.textContent=Q?"\u23F8 Pause":"\u25B6 Start"}),Oe.addEventListener("click",()=>{J()}),We.addEventListener("click",()=>{g.push(new C(f.RED,h(40,x*.35),h(80,v-80))),$("+1 Red")}),Ye.addEventListener("click",()=>{g.push(new C(f.BLUE,h(x*.65,x-40),h(80,v-80))),$("+1 Blue")}),Re.addEventListener("click",()=>{ee=!ee,Re.textContent=`\u2604 Trails: ${ee?"On":"Off"}`}),be.addEventListener("click",()=>{let a=[.5,1,2,4],t=(a.indexOf(Z)+1)%a.length;Z=a[t],be.textContent=`Speed: ${Z}\xD7`}),Je.addEventListener("click",()=>{let a=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);a!==null&&J(Number(a))}),Qe.addEventListener("click",()=>{let a=g.filter(o=>o.alive&&o.team===f.RED),t=g.filter(o=>o.alive&&o.team===f.BLUE),s=20,l=6;a.forEach((o,c)=>{let r=c%l,m=Math.floor(c/l);o.x=x*.25-r*20,o.y=v*.5+(m-l/2)*s,o.vx=o.vy=0}),t.forEach((o,c)=>{let r=c%l,m=Math.floor(c/l);o.x=x*.75+r*20,o.y=v*.5+(m-l/2)*s,o.vx=o.vy=0}),$("Fleets re-formed")});let n=document.getElementById("reinforceFreqBtn"),e=[0,.5,1,2];n&&(n.textContent=P>0?`${P}s`:"Every step",n.addEventListener("click",()=>{let a=(e.indexOf(P)+1)%e.length;et(e[a]),n.textContent=P>0?`${P}s`:"Every step",$(`Reinforcement check: ${P>0?P+"s":"every step"}`)})),y.addEventListener("click",a=>{B.push({x:a.clientX,y:a.clientY,r:24,life:.25,team:j(0,1)});for(let s=0;s<24;s++){let l=h(0,w),o=h(40,220);se(a.clientX,a.clientY,Math.cos(l)*o,Math.sin(l)*o,h(.2,1),"rgba(255,255,255,$a)")}}),J(),requestAnimationFrame(pe)}export{fe as Particle,se as acquireParticle,he as backgroundGradient,N as bullets,de as clamp,tt as evaluateReinforcement,B as flashes,vt as getHullPath,Tt as getReinforcementInterval,ce as handleReinforcement,q as healthFlashes,re as hullPaths,we as initStars,ie as particlePool,D as particles,Pe as recomputeBackgroundGradient,P as reinforcementIntervalSeconds,Ge as releaseParticle,J as reset,Mt as resetReinforcementCooldowns,et as setReinforcementInterval,G as shieldFlashes,g as ships,F as shipsVMap,te as stars,I as teamColor};
