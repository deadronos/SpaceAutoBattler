var ht=Object.defineProperty;var rt=(l,i,s)=>i in l?ht(l,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[i]=s;var ot=(l,i,s)=>(rt(l,typeof i!="symbol"?i+"":i,s),s);var ct=!1,z=123456789;function dt(){return ct?(z=1664525*z+1013904223>>>0,z/4294967296):Math.random()}function c(l=0,i=1){return l+(i-l)*dt()}function nt(l,i){return Math.floor(c(l,i+1))}var P={RED:0,BLUE:1},j=class{constructor(i,s,t,o,n,a=null){this.x=i,this.y=s,this.vx=t,this.vy=o,this.team=n,this.ownerId=a,this.life=2.5,this.radius=2.2,this.dmg=c(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},W=class W{constructor(i,s,t,o="corvette"){this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=o;let n={corvette:{radius:8,maxSpeed:c(120,160),accel:240,hp:c(40,70),reload:c(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:c(90,120),accel:200,hp:c(80,120),reload:c(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:c(60,90),accel:150,hp:c(150,220),reload:c(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:c(40,70),accel:90,hp:c(220,300),reload:c(.6,1.2),vision:360,range:260,launchBase:c(3.5,6)},fighter:{radius:6,maxSpeed:c(160,220),accel:300,hp:c(18,32),reload:c(.12,.22),vision:180,range:120}},a=n[o]||n.corvette;this.radius=a.radius,this.maxSpeed=a.maxSpeed,this.accel=a.accel,this.turn=4.5,this.hpMax=a.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=a.reload,this.vision=a.vision,this.range=a.range,this.id=W._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),o==="carrier"?(this.isCarrier=!0,this.launchCooldown=a.launchBase*c(.8,1.4),this.launchAmount=Math.max(1,Math.floor(c(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let o=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(o*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,o=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let a=n.x-this.x,y=n.y-this.y,r=a*a+y*y;r<o&&r<t&&(t=r,s=n)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),o=0,n=0;if(t){let x=t.x-this.x,g=t.y-this.y,h=Math.hypot(x,g)||1,p=Math.max(0,Math.min(1.2,h/240)),m=t.x+(t.vx||0)*p,u=t.y+(t.vy||0)*p,f=m-this.x,_=u-this.y,M=Math.hypot(f,_)||1;if(o+=f/M*this.accel,n+=_/M*this.accel,h<this.range){let H=((this.vx||1)*x+(this.vy||1)*g)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&H>0){let D=300+c(-20,20),G=x/h,F=g/h;if(arguments.length>=3&&Array.isArray(arguments[2])){let K=arguments[2],q=new j(this.x+G*12,this.y+F*12,G*D+this.vx*.2,F*D+this.vy*.2,this.team,this.id);q.dmg*=1+.06*(this.level-1),K.push(q)}this.cooldown=this.reload}}}else o+=Math.cos(this.angle)*(this.accel*.3),n+=Math.sin(this.angle)*(this.accel*.3);let a=0,y=0,r=0,b=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let g=this.x-x.x,h=this.y-x.y,p=g*g+h*h;if(p<b*b&&p>1){let m=Math.sqrt(p);a+=g/m,y+=h/m,r++}}r>0&&(o+=a/r*this.accel*.9,n+=y/r*this.accel*.9),this.vx+=o*i,this.vy+=n*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};ot(W,"_id",1);var C=W;function lt(l,i,s={W:800,H:600}){for(let t of l.ships)t.alive&&t.update(i,l.ships,l.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,o=s.H;for(let n of l.ships){if(!n.alive)continue;let a=n.radius||0;n.x<-a?n.x+=t+a*2:n.x>t+a&&(n.x-=t+a*2),n.y<-a?n.y+=o+a*2:n.y>o+a&&(n.y-=o+a*2)}}for(let t of l.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let o=Math.max(1,Math.floor(t.launchAmount||1));for(let n=0;n<o;n++){let a=c(0,Math.PI*2),y=t.radius+12+c(4,12),r=t.x+Math.cos(a)*y,b=t.y+Math.sin(a)*y,d=new C(t.team,r,b,"fighter"),x=c(40,120);d.vx=Math.cos(a)*x+(t.vx||0)*.2,d.vy=Math.sin(a)*x+(t.vy||0)*.2,l.ships.push(d)}t.launchCooldown=c(2.5,6)}for(let t=l.bullets.length-1;t>=0;t--){let o=l.bullets[t];o.update(i),o.alive(s)||l.bullets.splice(t,1)}for(let t=l.bullets.length-1;t>=0;t--){let o=l.bullets[t];for(let n of l.ships){if(!n.alive||n.team===o.team)continue;let a=n.x-o.x,y=n.y-o.y,r=a*a+y*y,b=n.radius+o.radius;if(r<b*b){let d=o.dmg,x=typeof n.shield=="number"?n.shield:0,g=typeof n.hp=="number"?n.hp:0,h=n.damage(d),p=Math.max(0,x-(typeof n.shield=="number"?n.shield:0)),m=Math.max(0,g-(typeof n.hp=="number"?n.hp:0));if(p>0&&l&&Array.isArray(l.shieldHits)&&l.shieldHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:p}),m>0&&l&&Array.isArray(l.healthHits)&&l.healthHits.push({id:n.id,hitX:o.x,hitY:o.y,team:n.team,amount:m}),o.ownerId!=null){let u=l.ships.find(f=>f.id===o.ownerId);u&&u.gainXp(d*.05)}if(l.bullets.splice(t,1),h&&l.explosions&&l.explosions.push(h),!n.alive&&(o.team===0?l.score.red++:l.score.blue++,o.ownerId!=null)){let u=l.ships.find(f=>f.id===o.ownerId);u&&u.gainXp(20+(n.level||1)*.2)}break}}}}var I,e,E,v;function Wt(){I=document.getElementById("world"),e=I.getContext("2d"),E=I.width=window.innerWidth,v=I.height=window.innerHeight,window.addEventListener("resize",()=>{E=I.width=window.innerWidth,v=I.height=window.innerHeight})}function it(){return(typeof e>"u"||e===void 0)&&typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var w=[],B=[],X=[],k=[],A=new Map,T=[],st=[],V=0,Y=!1,U=1,O=!0,Q={red:0,blue:0},R={ships:T,bullets:st,score:Q,particles:w,shieldHits:[],healthHits:[],explosions:[]},L=Math.PI*2,Z=(l,i,s)=>Math.max(i,Math.min(s,l)),N=(l=0,i=1)=>l+(i-l)*Math.random();function J(l){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=l,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var tt=[];function Mt(){tt.length=0;let l=[.2,.5,1];for(let i of l)for(let s=0;s<120;s++)tt.push({x:N(0,E),y:N(0,v),r:N(.3,1.8)*i,d:i,tw:N(.4,1),phase:N(0,L)})}Mt();var S=(l,i=1)=>l===P.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,$=class{constructor(i,s,t,o,n,a){this.x=i,this.y=s,this.vx=t,this.vy=o,this.life=n,this.max=n,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;it(),!(typeof e>"u"||!e)&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},et=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;it();let s=B.some(h=>h.shieldHit&&h.x===i.x&&h.y===i.y&&h.life>0);if(O){let h=i.x-Math.cos(i.angle)*i.radius*1.2,p=i.y-Math.sin(i.angle)*i.radius*1.2;w.push(new $(h,p,-i.vx*.05+c(-10,10),-i.vy*.05+c(-10,10),.25,S(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=S(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=S(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,L),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,L),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,L),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let h=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,p=t+4+(1-h)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,p,0,L);let m=e.createRadialGradient(i.x,i.y,p*.6,i.x,i.y,p);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let u of X){if(u.id!==i.id)continue;let f=Math.max(0,Math.min(1,u.life/.22)),_=i.shieldMax&&i.shieldMax>0?u.amount/i.shieldMax:Math.min(1,u.amount/(i.hpMax*.6||1)),M=Math.max(.08,Math.min(1,_)),D=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*M),G=u.angle-D/2,F=u.angle+D/2,K=p+4*(1-f)+2*M;e.beginPath(),e.arc(i.x,i.y,K,G,F),e.lineWidth=(3+6*f)*(1+4*M);let q=Math.min(1,.25+f*(.9+1.6*M));e.strokeStyle=`rgba(160,220,255,${q})`,e.save(),e.shadowBlur=12*M,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let o=Math.max(16,t*3.2),n=Math.max(3,t*.4),a=i.x-o/2,y=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let h=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,y,o,n),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,y,o*h,n))}let r=i.y+(t+8),b=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,n);typeof e<"u"&&(e.beginPath(),e.moveTo(a+d,r),e.lineTo(a+o-d,r),e.quadraticCurveTo(a+o,r,a+o,r+d),e.lineTo(a+o,r+n-d),e.quadraticCurveTo(a+o,r+n,a+o-d,r+n),e.lineTo(a+d,r+n),e.quadraticCurveTo(a,r+n,a,r+n-d),e.lineTo(a,r+d),e.quadraticCurveTo(a,r,a+d,r),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=k.find(h=>h.id===i.id&&h.life>0),g=`rgba(120,220,120,${.95})`;if(x){let h=Math.max(0,Math.min(1,x.life/.45)),p=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-p*h)),u=Math.floor(60+160*(1-h*p));g=`rgba(${Math.min(255,m)},${Math.min(255,u)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+d,r),e.lineTo(a+o-d,r),e.quadraticCurveTo(a+o,r,a+o,r+d),e.lineTo(a+o,r+n-d),e.quadraticCurveTo(a+o,r+n,a+o-d,r+n),e.lineTo(a+d,r+n),e.quadraticCurveTo(a,r+n,a,r+n-d),e.lineTo(a,r+d),e.quadraticCurveTo(a,r,a+d,r),e.closePath(),e.clip(),e.fillStyle=g,e.fillRect(a,r,o*b,n))}};function Vt(){}function Tt(l){if(lt(R,l,{W:E,H:v}),Array.isArray(R.healthHits)&&R.healthHits.length){for(let s of R.healthHits){let t=T.find(o=>o.id===s.id);if(t){k.push({id:t.id,life:.45,amount:s.amount});for(let o=0;o<6;o++){let n=c(0,L),a=c(40,120);w.push(new $(s.hitX,s.hitY,Math.cos(n)*a,Math.sin(n)*a,c(.12,.4),"rgba(200,230,255,$a)"))}}}R.healthHits.length=0}if(Array.isArray(R.shieldHits)&&R.shieldHits.length){for(let s of R.shieldHits){let t=T.find(o=>o.id===s.id);if(t){let o=Math.atan2(s.hitY-t.y,s.hitX-t.x);X.push({id:t.id,angle:o,life:.22,amount:s.amount}),B.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}R.shieldHits.length=0}for(let s=w.length-1;s>=0;s--){let t=w[s];t.update(l),t.life<=0&&w.splice(s,1)}for(let s=B.length-1;s>=0;s--){let t=B[s];t.life-=l,t.r+=600*l,t.life<=0&&B.splice(s,1)}for(let s=X.length-1;s>=0;s--){let t=X[s];t.life-=l,t.life<=0&&X.splice(s,1)}for(let s=k.length-1;s>=0;s--){let t=k[s];t.life-=l,t.life<=0&&k.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)A.has(s.id)?A.get(s.id).syncFromLogic():A.set(s.id,new et(s));for(let s of Array.from(A.keys()))i.has(s)||A.delete(s)}function bt(){if(it(),typeof e>"u"||!e)return;e.clearRect(0,0,E,v);let l=e.createRadialGradient(E*.6,v*.3,50,E*.6,v*.3,Math.max(E,v));l.addColorStop(0,"rgba(60,80,140,0.10)"),l.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=l,e.fillRect(0,0,E,v);for(let t of tt){let o=.6+.4*Math.sin(t.phase);e.globalAlpha=Z(.5*o*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of B){let o=Z(t.life/.25,0,1);e.strokeStyle=S(t.team,o*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,L),e.stroke()}for(let t of st)e.save(),e.shadowBlur=12,e.shadowColor=S(t.team,.9),e.fillStyle=S(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,L),e.fill(),e.restore();for(let t of w)t.draw();for(let t of A.values())t.draw();let i=T.some(t=>t.alive&&t.team===P.RED),s=T.some(t=>t.alive&&t.team===P.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",o=i?S(P.RED,.95):s?S(P.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=o,e.shadowBlur=14,e.shadowColor=o,e.fillText(`${t} Wins!`,E/2,64),e.restore()}}function Yt(){if(typeof document>"u")return;let l=document.getElementById("startPause"),i=document.getElementById("reset"),s=document.getElementById("addRed"),t=document.getElementById("addBlue"),o=document.getElementById("toggleTrails"),n=document.getElementById("speed"),a=document.getElementById("redScore"),y=document.getElementById("blueScore"),r=document.getElementById("stats"),b=document.getElementById("seedBtn"),d=document.getElementById("formationBtn");function x(){a.textContent=`Red ${Q.red}`,y.textContent=`Blue ${Q.blue}`,r.textContent=`Ships: ${T.filter(h=>h.alive).length}  Bullets: ${st.length}  Particles: ${w.length}`}l.addEventListener("click",()=>{Y=!Y,l.textContent=Y?"\u23F8 Pause":"\u25B6 Start"}),i.addEventListener("click",()=>{reset()}),s.addEventListener("click",()=>{T.push(new C(P.RED,c(40,E*.35),c(80,v-80))),J("+1 Red")}),t.addEventListener("click",()=>{T.push(new C(P.BLUE,c(E*.65,E-40),c(80,v-80))),J("+1 Blue")}),o.addEventListener("click",()=>{O=!O,o.textContent=`\u2604 Trails: ${O?"On":"Off"}`}),n.addEventListener("click",()=>{let h=[.5,1,2,4],p=(h.indexOf(U)+1)%h.length;U=h[p],n.textContent=`Speed: ${U}\xD7`}),b.addEventListener("click",()=>{let h=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);h!==null&&reset(Number(h))}),d.addEventListener("click",()=>{let h=T.filter(f=>f.alive&&f.team===P.RED),p=T.filter(f=>f.alive&&f.team===P.BLUE),m=20,u=6;h.forEach((f,_)=>{let M=_%u,H=Math.floor(_/u);f.x=E*.25-M*20,f.y=v*.5+(H-u/2)*m,f.vx=f.vy=0}),p.forEach((f,_)=>{let M=_%u,H=Math.floor(_/u);f.x=E*.75+M*20,f.y=v*.5+(H-u/2)*m,f.vx=f.vy=0}),J("Fleets re-formed")}),I.addEventListener("click",h=>{B.push({x:h.clientX,y:h.clientY,r:24,life:.25,team:nt(0,1)});for(let m=0;m<24;m++){let u=c(0,L),f=c(40,220);w.push(new $(h.clientX,h.clientY,Math.cos(u)*f,Math.sin(u)*f,c(.2,1),"rgba(255,255,255,$a)"))}});function g(h){V||(V=h);let p=(h-V)/1e3;V=h;let m=Z(p,0,.033)*(Y?U:0);Tt(m),bt(),x(),requestAnimationFrame(g)}reset(),requestAnimationFrame(g)}export{$ as Particle,et as ShipV,st as bullets,B as flashes,k as healthFlashes,Wt as initRenderer,Yt as initRendererUI,V as lastTime,w as particles,bt as render,Y as running,Q as score,X as shieldFlashes,T as ships,A as shipsVMap,O as showTrails,Tt as simulate,U as speed,R as state,S as teamColor,J as toast,Vt as updateUI};
