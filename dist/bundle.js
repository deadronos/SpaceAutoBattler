var be=Object.defineProperty;var Re=(o,i,s)=>i in o?be(o,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[i]=s;var Ee=(o,i,s)=>Re(o,typeof i!="symbol"?i+"":i,s);var Se=!1,he=123456789,_e=1664525,Pe=1013904223,we=4294967296,Le=typeof process<"u"&&process&&process.env&&(process.env.RNG_REQUIRE_SEEDED==="1"||process.env.RNG_REQUIRE_SEEDED==="true"),Ie=!!Le;function Ce(){if(!Se){if(Ie)throw new Error("RNG must be seeded with srand(seed) before use when RNG_REQUIRE_SEEDED mode is enabled");return Math.random()}return he=_e*he+Pe>>>0,he/we}function h(o=0,i=1){if(typeof o!="number"||typeof i!="number")throw new TypeError("srange expects numeric a and b");return o+(i-o)*Ce()}function te(o,i){if(!Number.isFinite(o)||!Number.isFinite(i))throw new TypeError("srangeInt expects finite numeric a and b");return Math.floor(h(o,i+1))}var b={RED:0,BLUE:1};function Fe(o){switch(o){case"frigate":return{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180};case"destroyer":return{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220};case"carrier":return{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)};case"fighter":return{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120};case"corvette":default:return{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140}}}var ce=class{constructor(i,s,t,l,n,a=null){this.x=i,this.y=s,this.vx=t,this.vy=l,this.team=n,this.ownerId=a===null?void 0:a,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:t}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<t+50}},ie=class ie{constructor(i,s,t,l="corvette"){this.team=i,this.x=s,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=l;let n=Fe(l||"corvette");this.radius=n.radius,this.maxSpeed=n.maxSpeed,this.accel=n.accel,this.turn=4.5,this.hpMax=n.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=n.reload,this.vision=n.vision,this.range=n.range,this.id=ie._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),l==="carrier"?(this.isCarrier=!0,this.launchCooldown=n.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let l=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(l*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,t=1/0,l=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let a=n.x-this.x,E=n.y-this.y,c=a*a+E*E;c<l&&c<t&&(t=c,s=n)}return s}update(i,s){if(!this.alive)return;let t=this.pickTarget(s),l=0,n=0;if(t){let x=t.x-this.x,T=t.y-this.y,r=Math.hypot(x,T)||1,u=Math.max(0,Math.min(1.2,r/240)),m=t.x+(t.vx||0)*u,p=t.y+(t.vy||0)*u,f=m-this.x,w=p-this.y,g=Math.hypot(f,w)||1;if(l+=f/g*this.accel,n+=w/g*this.accel,r<this.range){let P=((this.vx||1)*x+(this.vy||1)*T)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&P>0){let F=300+h(-20,20),G=x/r,O=T/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let $=arguments[2],W=new ce(this.x+G*12,this.y+O*12,G*F+this.vx*.2,O*F+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),$.push(W)}this.cooldown=this.reload}}}else l+=Math.cos(this.angle)*(this.accel*.3),n+=Math.sin(this.angle)*(this.accel*.3);let a=0,E=0,c=0,_=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let T=this.x-x.x,r=this.y-x.y,u=T*T+r*r;if(u<_*_&&u>1){let m=Math.sqrt(u);a+=T/m,E+=r/m,c++}}c>0&&(l+=a/c*this.accel*.9,n+=E/c*this.accel*.9),this.vx+=l*i,this.vy+=n*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};Ee(ie,"_id",1);var L=ie;function ve(o,i,s={W:800,H:600}){o.ships=o.ships||[],o.bullets=o.bullets||[],o.explosions=o.explosions||[],o.shieldHits=o.shieldHits||[],o.healthHits=o.healthHits||[],o.score=o.score||{red:0,blue:0};for(let t of o.ships)t.alive&&t.update(i,o.ships,o.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let t=s.W,l=s.H;for(let n of o.ships){if(!n.alive)continue;let a=n.radius||0;n.x<-a?n.x+=t+a*2:n.x>t+a&&(n.x-=t+a*2),n.y<-a?n.y+=l+a*2:n.y>l+a&&(n.y-=l+a*2)}}for(let t of o.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=i,t.launchCooldown<=0)){let l=Math.max(1,Math.floor(t.launchAmount||1));for(let n=0;n<l;n++){let a=h(0,Math.PI*2),E=t.radius+12+h(4,12),c=t.x+Math.cos(a)*E,_=t.y+Math.sin(a)*E,d=new L(t.team,c,_,"fighter"),x=h(40,120);d.vx=Math.cos(a)*x+(t.vx||0)*.2,d.vy=Math.sin(a)*x+(t.vy||0)*.2,o.ships.push(d)}t.launchCooldown=h(2.5,6)}for(let t=o.bullets.length-1;t>=0;t--){let l=o.bullets[t];l.update(i),l.alive(s)||o.bullets.splice(t,1)}for(let t=o.bullets.length-1;t>=0;t--){let l=o.bullets[t];for(let n of o.ships){if(!n.alive||n.team===l.team)continue;let a=n.x-l.x,E=n.y-l.y,c=a*a+E*E,_=n.radius+l.radius;if(c<_*_){let d=l.dmg,x=typeof n.shield=="number"?n.shield:0,T=typeof n.hp=="number"?n.hp:0,r=n.damage(d),u=Math.max(0,x-(typeof n.shield=="number"?n.shield:0)),m=Math.max(0,T-(typeof n.hp=="number"?n.hp:0));if(u>0&&o.shieldHits.push({id:n.id,hitX:l.x,hitY:l.y,team:n.team,amount:u}),m>0&&o.healthHits.push({id:n.id,hitX:l.x,hitY:l.y,team:n.team,amount:m}),l.ownerId!=null){let p=o.ships.find(f=>f.id===l.ownerId);p&&p.gainXp(d*.05)}if(o.bullets.splice(t,1),r&&o.explosions.push(r),!n.alive&&(l.team===0?o.score.red++:o.score.blue++,l.ownerId!=null)){let p=o.ships.find(f=>f.id===l.ownerId);p&&p.gainXp(20+(n.level||1)*.2)}break}}}}var D,e,y,v;function ht(){D=document.getElementById("world"),e=D.getContext("2d"),y=D.width=window.innerWidth,v=D.height=window.innerHeight,We(),window.addEventListener("resize",()=>{y=D.width=window.innerWidth,v=D.height=window.innerHeight})}function me(){return typeof globalThis<"u"&&globalThis.ctx&&(e=globalThis.ctx),e}var C=[],q=[],z=[],Z=[],j=[],Y=new Map,M=[],xe=[],se=0,ne=!1,oe=1,le=!0,fe={red:0,blue:0};var de=[.5,1,2,4],I={ships:M,bullets:xe,score:fe,particles:C,shieldHits:[],healthHits:[],explosions:[]},H=Math.PI*2,ae=(o,i,s)=>Math.max(i,Math.min(s,o)),K=(o=0,i=1)=>h(o,i);function qe(o,i,s,t,l,n){let a=Math.min(n,l/2,t/2);o.beginPath(),o.moveTo(i+a,s),o.lineTo(i+t-a,s),o.quadraticCurveTo(i+t,s,i+t,s+a),o.lineTo(i+t,s+l-a),o.quadraticCurveTo(i+t,s+l,i+t-a,s+l),o.lineTo(i+a,s+l),o.quadraticCurveTo(i,s+l,i,s+l-a),o.lineTo(i,s+a),o.quadraticCurveTo(i,s,i+a,s),o.closePath()}function k(o){if(typeof document>"u"||!document)return;let i=document.getElementById("toast");i&&(i.textContent=o,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ue=[];function We(){if(!Number.isFinite(y)||!Number.isFinite(v))return;ue.length=0;let o=[.2,.5,1];for(let i of o)for(let s=0;s<120;s++)ue.push({x:K(0,y),y:K(0,v),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,H)})}var B=(o,i=1)=>o===b.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`,Q=["corvette","frigate","destroyer","carrier","fighter"];function re(){if(!Array.isArray(Q)||Q.length===0)return"corvette";let o=ae(te(0,Q.length-1),0,Q.length-1);return Q[o]}function Ue(o){let i=re();if(o===b.RED){let s=h(40,y*.35),t=h(80,v-80);M.push(new L(b.RED,s,t,i)),typeof k=="function"&&k(`+1 Red (${i})`)}else if(o===b.BLUE){let s=h(y*.65,y-40),t=h(80,v-80);M.push(new L(b.BLUE,s,t,i)),typeof k=="function"&&k(`+1 Blue (${i})`)}else{let s=h(40,y*.35),t=h(80,v-80);M.push(new L(b.RED,s,t,i)),typeof k=="function"&&k(`+1 Red (${i})`)}}var ct={createShipFromUI:Ue,randomShipType:re,ships:M,state:I},V=class{constructor(i,s,t,l,n,a){this.x=i,this.y=s,this.vx=t,this.vy=l,this.life=n,this.max=n,this.color=a}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;me(),e&&(e.fillStyle=this.color.replace("$a",i.toFixed(3)),e.fillRect(this.x,this.y,2,2))}},pe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive||(me(),!e))return;let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(le){let r=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;C.push(new V(r,u,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,B(i.team,"$a")))}typeof e<"u"&&(e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.shadowBlur=12,e.shadowColor=B(i.team,.9));let t=i.radius||8;if(typeof e<"u"&&(e.fillStyle=B(i.team,.96)),i.type==="corvette"?(e.beginPath(),e.moveTo(t*1.5,0),e.lineTo(-t,-t*.7),e.lineTo(-t*.4,0),e.lineTo(-t,t*.7),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.85)",e.beginPath(),e.ellipse(0,0,t*.35,t*.25,0,0,H),e.fill()):i.type==="frigate"?(e.beginPath(),e.moveTo(t*1.6,0),e.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),e.lineTo(-t*.6,0),e.lineTo(-t*1.1,t*.6),e.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.75)",e.fillRect(-t*.2,-t*.25,t*.6,t*.5)):i.type==="destroyer"?(e.beginPath(),e.moveTo(t*1.9,0),e.lineTo(t*.3,-t*1.1),e.lineTo(-t*1.4,-t*.6),e.lineTo(-t*1.4,t*.6),e.lineTo(t*.3,t*1.1),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):i.type==="carrier"?(e.beginPath(),e.ellipse(0,0,t*1.6,t*1,0,0,H),e.fill(),e.fillStyle="rgba(255,255,255,.18)",e.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):i.type==="fighter"?(e.beginPath(),e.moveTo(t*1.2,0),e.lineTo(-t*.6,-t*.45),e.lineTo(-t*.2,0),e.lineTo(-t*.6,t*.45),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,.9)",e.beginPath(),e.ellipse(t*.25,0,t*.25,t*.15,0,0,H),e.fill()):(e.beginPath(),e.moveTo(t*1.4,0),e.lineTo(-t,-t*.8),e.lineTo(-t*.4,0),e.lineTo(-t,t*.8),e.closePath(),e.fill()),typeof e<"u"&&e.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=t+4+(1-r)*2;typeof e<"u"&&e.save(),e.beginPath(),e.arc(i.x,i.y,u,0,H);let m=e.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof e<"u"&&(e.fillStyle=m,e.globalCompositeOperation="lighter",e.fill());for(let p of z){if(p.id!==i.id)continue;let f=Math.max(0,Math.min(1,p.life/.22)),w=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),g=Math.max(.08,Math.min(1,w)),F=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*g),G=p.angle-F/2,O=p.angle+F/2,$=u+4*(1-f)+2*g;e.beginPath(),e.arc(i.x,i.y,$,G,O),e.lineWidth=(3+6*f)*(1+4*g);let W=Math.min(1,.25+f*(.9+1.6*g));e.strokeStyle=`rgba(160,220,255,${W})`,e.save(),e.shadowBlur=12*g,e.shadowColor="rgba(140,200,255,0.8)",e.stroke(),e.restore()}typeof e<"u"&&e.restore()}let l=Math.max(16,t*3.2),n=Math.max(3,t*.4),a=i.x-l/2,E=i.y-(t+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof e<"u"&&(e.fillStyle="rgba(255,255,255,.08)",e.fillRect(a,E,l,n),e.fillStyle="rgba(80,160,255,.95)",e.fillRect(a,E,l*r,n))}let c=i.y+(t+8),_=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,n);if(typeof e<"u"&&e&&typeof e.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(n*6));e.save(),e.font=`700 ${m}px Inter, system-ui, sans-serif`,e.textAlign="center",e.textBaseline="middle";let p=e.measureText(r).width,f=8,w=Math.max(2,Math.round((m-n)/2)),g=Math.max(18,p+f*2),P=Math.max(n+2,m*.9),F=a-8-g,G=c+n/2-P/2,O=P/2,$=4,W=F-$,Me=G-$,Te=g+$*2,ye=P+$*2;e.save(),e.fillStyle="rgba(0,0,0,0.45)",qe(e,W,Me,Te,ye,ye/2),e.fill(),e.restore();let J=j.find(U=>U.id===i.id&&U.life>0),ee=1;J&&(ee=1+.6*Math.max(0,Math.min(1,J.life/1)));let X=g*ee,A=P*ee,R=F-(X-g),S=G-(A-P)/2,N=A/2;if(e.beginPath(),e.moveTo(R+N,S),e.lineTo(R+X-N,S),e.quadraticCurveTo(R+X,S,R+X,S+N),e.lineTo(R+X,S+A-N),e.quadraticCurveTo(R+X,S+A,R+X-N,S+A),e.lineTo(R+N,S+A),e.quadraticCurveTo(R,S+A,R,S+A-N),e.lineTo(R,S+N),e.quadraticCurveTo(R,S,R+N,S),e.closePath(),J){let U=Math.max(.6,Math.min(1,J.life));e.save(),e.shadowBlur=20*U,e.shadowColor="rgba(255,255,255,0.95)",e.fillStyle=B(i.team,.98),e.fill(),e.restore(),e.lineWidth=2,e.strokeStyle=`rgba(255,255,255,${.28+.6*U})`,e.stroke()}else e.fillStyle=B(i.team,.98),e.fill(),e.lineWidth=1.25,e.strokeStyle="rgba(255,255,255,0.14)",e.stroke();e.fillStyle="rgba(255,255,255,1)",e.font=`700 ${Math.round(m*ee)}px Inter, system-ui, sans-serif`,e.fillText(r,R+X/2,S+A/2+.5),e.restore()}catch{}typeof e<"u"&&(e.beginPath(),e.moveTo(a+d,c),e.lineTo(a+l-d,c),e.quadraticCurveTo(a+l,c,a+l,c+d),e.lineTo(a+l,c+n-d),e.quadraticCurveTo(a+l,c+n,a+l-d,c+n),e.lineTo(a+d,c+n),e.quadraticCurveTo(a,c+n,a,c+n-d),e.lineTo(a,c+d),e.quadraticCurveTo(a,c,a+d,c),e.closePath(),e.fillStyle="rgba(255,255,255,.08)",e.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),T=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),u=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-u*r)),p=Math.floor(60+160*(1-r*u));T=`rgba(${Math.min(255,m)},${Math.min(255,p)},60,${.95})`}typeof e<"u"&&(e.save(),e.beginPath(),e.moveTo(a+d,c),e.lineTo(a+l-d,c),e.quadraticCurveTo(a+l,c,a+l,c+d),e.lineTo(a+l,c+n-d),e.quadraticCurveTo(a+l,c+n,a+l-d,c+n),e.lineTo(a+d,c+n),e.quadraticCurveTo(a,c+n,a,c+n-d),e.lineTo(a,c+d),e.quadraticCurveTo(a,c,a+d,c),e.closePath(),e.clip(),e.fillStyle=T,e.fillRect(a,c,l*_,n))}};function dt(){}function Ye(o){if(ve(I,o,{W:y,H:v}),Array.isArray(I.healthHits)&&I.healthHits.length){for(let s of I.healthHits){let t=M.find(l=>l.id===s.id);if(t){Z.push({id:t.id,life:.45,amount:s.amount});for(let l=0;l<6;l++){let n=h(0,H),a=h(40,120);C.push(new V(s.hitX,s.hitY,Math.cos(n)*a,Math.sin(n)*a,h(.12,.4),"rgba(200,230,255,$a)"))}}}I.healthHits.length=0}if(Array.isArray(I.shieldHits)&&I.shieldHits.length){for(let s of I.shieldHits){let t=M.find(l=>l.id===s.id);if(t){let l=Math.atan2(s.hitY-t.y,s.hitX-t.x);z.push({id:t.id,angle:l,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}I.shieldHits.length=0}for(let s=C.length-1;s>=0;s--){let t=C[s];t.update(o),t.life<=0&&C.splice(s,1)}for(let s=q.length-1;s>=0;s--){let t=q[s];t.life-=o,t.r+=600*o,t.life<=0&&q.splice(s,1)}for(let s=z.length-1;s>=0;s--){let t=z[s];t.life-=o,t.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let t=Z[s];t.life-=o,t.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let t=j[s];t.life-=o,t.life<=0&&j.splice(s,1)}let i=new Set(M.map(s=>s.id));for(let s of M)if(Y.has(s.id)){let t=Y.get(s.id);if(t.level!==s.level){j.push({id:s.id,life:1});for(let l=0;l<18;l++){let n=h(0,H),a=h(60,240);C.push(new V(s.x+Math.cos(n)*2,s.y+Math.sin(n)*2,Math.cos(n)*a,Math.sin(n)*a,h(.3,.9),"rgba(200,255,220,$a)"))}t.level=s.level}t.syncFromLogic()}else{let t=new pe(s);t.level=s.level,Y.set(s.id,t)}for(let s of Array.from(Y.keys()))i.has(s)||Y.delete(s)}function Ve(){if(me(),typeof e>"u"||!e)return;e.clearRect(0,0,y,v);let o=e.createRadialGradient(y*.6,v*.3,50,y*.6,v*.3,Math.max(y,v));o.addColorStop(0,"rgba(60,80,140,0.10)"),o.addColorStop(1,"rgba(10,12,20,0.0)"),e.fillStyle=o,e.fillRect(0,0,y,v);for(let t of ue){let l=.6+.4*Math.sin(t.phase);e.globalAlpha=ae(.5*l*(.6+.5*t.d),0,1),e.fillStyle="#e9f2ff",e.fillRect(t.x,t.y,t.r,t.r)}e.globalAlpha=1;for(let t of q){let l=ae(t.life/.25,0,1);e.strokeStyle=B(t.team,l*.6),e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,t.r,0,H),e.stroke()}for(let t of xe)e.save(),e.shadowBlur=12,e.shadowColor=B(t.team,.9),e.fillStyle=B(t.team,.95),e.beginPath(),e.arc(t.x,t.y,t.radius||2.2,0,H),e.fill(),e.restore();for(let t of C)t.draw();for(let t of Y.values())t.draw();let i=M.some(t=>t.alive&&t.team===b.RED),s=M.some(t=>t.alive&&t.team===b.BLUE);if(!i||!s){e.save(),e.textAlign="center",e.font="700 36px Inter, system-ui, sans-serif";let t=i?"Red":s?"Blue":"Nobody",l=i?B(b.RED,.95):s?B(b.BLUE,.95):"rgba(255,255,255,.9)";e.fillStyle=l,e.shadowBlur=14,e.shadowColor=l,e.fillText(`${t} Wins!`,y/2,64),e.restore()}}function ft(){if(typeof document>"u")return;let o=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),t=document.getElementById&&document.getElementById("addBlue"),l=document.getElementById&&document.getElementById("toggleTrails"),n=document.getElementById&&document.getElementById("speed"),a=document.getElementById&&document.getElementById("redScore"),E=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),_=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function x(){a&&(a.textContent=`Red ${fe.red}`),E&&(E.textContent=`Blue ${fe.blue}`),c&&(c.textContent=`Ships: ${M.filter(r=>r.alive).length}  Bullets: ${xe.length}  Particles: ${C.length}`)}o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{ne=!ne,o.textContent=ne?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=re();M.push(new L(b.RED,h(40,y*.35),h(80,v-80),r)),k(`+1 Red (${r})`)}),t&&typeof t.addEventListener=="function"&&t.addEventListener("click",()=>{let r=re();M.push(new L(b.BLUE,h(y*.65,y-40),h(80,v-80),r)),k(`+1 Blue (${r})`)}),l&&typeof l.addEventListener=="function"&&l.addEventListener("click",()=>{le=!le,l.textContent=`\u2604 Trails: ${le?"On":"Off"}`}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{let r=(de.indexOf(oe)+1)%de.length;oe=de[r],n.textContent=`Speed: ${oe}\xD7`}),_&&typeof _.addEventListener=="function"&&_.addEventListener("click",()=>{let r=te(0,4294967295),u=prompt("Enter numeric seed (32-bit):",r);u!==null&&reset(Number(u))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=M.filter(f=>f.alive&&f.team===b.RED),u=M.filter(f=>f.alive&&f.team===b.BLUE),m=20,p=6;r.forEach((f,w)=>{let g=w%p,P=Math.floor(w/p);f.x=y*.25-g*20,f.y=v*.5+(P-p/2)*m,f.vx=f.vy=0}),u.forEach((f,w)=>{let g=w%p,P=Math.floor(w/p);f.x=y*.75+g*20,f.y=v*.5+(P-p/2)*m,f.vx=f.vy=0}),k("Fleets re-formed")}),D&&typeof D.addEventListener=="function"&&D.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:te(0,1)});for(let m=0;m<24;m++){let p=h(0,H),f=h(40,220);C.push(new V(r.clientX,r.clientY,Math.cos(p)*f,Math.sin(p)*f,h(.2,1),"rgba(255,255,255,$a)"))}});function T(r){se||(se=r);let u=(r-se)/1e3;se=r;let m=ae(u,0,.033)*(ne?oe:0);Ye(m),Ve(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(T)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(T)}export{V as Particle,de as SPEED_STEPS,pe as ShipV,xe as bullets,Ue as createShipFromUI,q as flashes,Z as healthFlashes,ht as initRenderer,ft as initRendererUI,se as lastTime,j as levelFlashes,C as particles,re as randomShipType,Ve as render,ne as running,fe as score,z as shieldFlashes,M as ships,Y as shipsVMap,le as showTrails,Ye as simulate,oe as speed,ue as stars,I as state,B as teamColor,ct as testHelpers,k as toast,dt as updateUI};
