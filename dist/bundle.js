var Tt=Object.defineProperty;var bt=(a,i,s)=>i in a?Tt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s;var yt=(a,i,s)=>bt(a,typeof i!="symbol"?i+"":i,s);var St=!1,at=123456789;function Pt(){return St?(at=1664525*at+1013904223>>>0,at/4294967296):Math.random()}function h(a=0,i=1){return a+(i-a)*Pt()}function tt(a,i){return Math.floor(h(a,i+1))}var R={RED:0,BLUE:1},rt=class{constructor(i,s,e,n,o,l=null){this.x=i,this.y=s,this.vx=e,this.vy=n,this.team=o,this.ownerId=l,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:s,H:e}=i;return this.x>-50&&this.x<s+50&&this.y>-50&&this.y<e+50}},et=class et{constructor(i,s,e,n="corvette"){this.team=i,this.x=s,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=n;let o={corvette:{radius:8,maxSpeed:h(120,160),accel:240,hp:h(40,70),reload:h(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:h(90,120),accel:200,hp:h(80,120),reload:h(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:h(60,90),accel:150,hp:h(150,220),reload:h(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:h(40,70),accel:90,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)},fighter:{radius:6,maxSpeed:h(160,220),accel:300,hp:h(18,32),reload:h(.12,.22),vision:180,range:120}},l=o[n]||o.corvette;this.radius=l.radius,this.maxSpeed=l.maxSpeed,this.accel=l.accel,this.turn=4.5,this.hpMax=l.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=l.reload,this.vision=l.vision,this.range=l.range,this.id=et._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),n==="carrier"?(this.isCarrier=!0,this.launchCooldown=l.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3)))):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,s=1.35){return Math.floor(i*Math.pow(s,Math.max(0,this.level-1)))}applyLevel(){let i=.06,s=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+s*(this.level-1)));let n=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(n*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let s=null,e=1/0,n=this.vision*this.vision;for(let o of i){if(!o.alive||o.team===this.team)continue;let l=o.x-this.x,g=o.y-this.y,c=l*l+g*g;c<n&&c<e&&(e=c,s=o)}return s}update(i,s){if(!this.alive)return;let e=this.pickTarget(s),n=0,o=0;if(e){let x=e.x-this.x,E=e.y-this.y,r=Math.hypot(x,E)||1,u=Math.max(0,Math.min(1.2,r/240)),m=e.x+(e.vx||0)*u,p=e.y+(e.vy||0)*u,f=m-this.x,L=p-this.y,v=Math.hypot(f,L)||1;if(n+=f/v*this.accel,o+=L/v*this.accel,r<this.range){let _=((this.vx||1)*x+(this.vy||1)*E)/(Math.hypot(this.vx,this.vy)+1);if(this.cooldown<=0&&_>0){let F=300+h(-20,20),$=x/r,O=E/r;if(arguments.length>=3&&Array.isArray(arguments[2])){let N=arguments[2],W=new rt(this.x+$*12,this.y+O*12,$*F+this.vx*.2,O*F+this.vy*.2,this.team,this.id);W.dmg*=1+.06*(this.level-1),N.push(W)}this.cooldown=this.reload}}}else n+=Math.cos(this.angle)*(this.accel*.3),o+=Math.sin(this.angle)*(this.accel*.3);let l=0,g=0,c=0,P=26;for(let x of s){if(!x.alive||x===this||x.team!==this.team)continue;let E=this.x-x.x,r=this.y-x.y,u=E*E+r*r;if(u<P*P&&u>1){let m=Math.sqrt(u);l+=E/m,g+=r/m,c++}}c>0&&(n+=l/c*this.accel*.9,o+=g/c*this.accel*.9),this.vx+=n*i,this.vy+=o*i;let d=Math.hypot(this.vx,this.vy);if(d>this.maxSpeed){let x=this.maxSpeed/d;this.vx*=x,this.vy*=x}this.x+=this.vx*i,this.y+=this.vy*i,this.angle=Math.atan2(this.vy,this.vx),this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i))}damage(i){if(this.shield>0&&i>0){let s=Math.min(this.shield,i);this.shield-=s,i-=s}return i>0&&(this.hp-=i),this.hp<=0&&this.alive?(this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team}):null}};yt(et,"_id",1);var k=et;function vt(a,i,s={W:800,H:600}){for(let e of a.ships)e.alive&&e.update(i,a.ships,a.bullets);if(s&&typeof s.W=="number"&&typeof s.H=="number"){let e=s.W,n=s.H;for(let o of a.ships){if(!o.alive)continue;let l=o.radius||0;o.x<-l?o.x+=e+l*2:o.x>e+l&&(o.x-=e+l*2),o.y<-l?o.y+=n+l*2:o.y>n+l&&(o.y-=n+l*2)}}for(let e of a.ships)if(!(!e.alive||!e.isCarrier)&&(e.launchCooldown-=i,e.launchCooldown<=0)){let n=Math.max(1,Math.floor(e.launchAmount||1));for(let o=0;o<n;o++){let l=h(0,Math.PI*2),g=e.radius+12+h(4,12),c=e.x+Math.cos(l)*g,P=e.y+Math.sin(l)*g,d=new k(e.team,c,P,"fighter"),x=h(40,120);d.vx=Math.cos(l)*x+(e.vx||0)*.2,d.vy=Math.sin(l)*x+(e.vy||0)*.2,a.ships.push(d)}e.launchCooldown=h(2.5,6)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];n.update(i),n.alive(s)||a.bullets.splice(e,1)}for(let e=a.bullets.length-1;e>=0;e--){let n=a.bullets[e];for(let o of a.ships){if(!o.alive||o.team===n.team)continue;let l=o.x-n.x,g=o.y-n.y,c=l*l+g*g,P=o.radius+n.radius;if(c<P*P){let d=n.dmg,x=typeof o.shield=="number"?o.shield:0,E=typeof o.hp=="number"?o.hp:0,r=o.damage(d),u=Math.max(0,x-(typeof o.shield=="number"?o.shield:0)),m=Math.max(0,E-(typeof o.hp=="number"?o.hp:0));if(u>0&&a&&Array.isArray(a.shieldHits)&&a.shieldHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:u}),m>0&&a&&Array.isArray(a.healthHits)&&a.healthHits.push({id:o.id,hitX:n.x,hitY:n.y,team:o.team,amount:m}),n.ownerId!=null){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(d*.05)}if(a.bullets.splice(e,1),r&&a.explosions&&a.explosions.push(r),!o.alive&&(n.team===0?a.score.red++:a.score.blue++,n.ownerId!=null)){let p=a.ships.find(f=>f.id===n.ownerId);p&&p.gainXp(20+(o.level||1)*.2)}break}}}}var D,t,y,M;function oe(){D=document.getElementById("world"),t=D.getContext("2d"),y=D.width=window.innerWidth,M=D.height=window.innerHeight,window.addEventListener("resize",()=>{y=D.width=window.innerWidth,M=D.height=window.innerHeight})}function pt(){return typeof globalThis<"u"&&globalThis.ctx?(t=globalThis.ctx,t):((typeof t>"u"||t===void 0||t===null)&&typeof globalThis<"u"&&globalThis.ctx&&(t=globalThis.ctx),t)}var I=[],q=[],z=[],Z=[],j=[],V=new Map,T=[],mt=[],it=0,st=!1,nt=1,ot=!0,ct={red:0,blue:0};var ht=[.5,1,2,4],w={ships:T,bullets:mt,score:ct,particles:I,shieldHits:[],healthHits:[],explosions:[]},C=Math.PI*2,dt=(a,i,s)=>Math.max(i,Math.min(s,a)),K=(a=0,i=1)=>h(a,i);function kt(a,i,s,e,n,o){let l=Math.min(o,n/2,e/2);a.beginPath(),a.moveTo(i+l,s),a.lineTo(i+e-l,s),a.quadraticCurveTo(i+e,s,i+e,s+l),a.lineTo(i+e,s+n-l),a.quadraticCurveTo(i+e,s+n,i+e-l,s+n),a.lineTo(i+l,s+n),a.quadraticCurveTo(i,s+n,i,s+n-l),a.lineTo(i,s+l),a.quadraticCurveTo(i,s,i+l,s),a.closePath()}function G(a){if(!document)return;let i=document.getElementById("toast");i&&(i.textContent=a,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}var ft=[];function Dt(){ft.length=0;let a=[.2,.5,1];for(let i of a)for(let s=0;s<120;s++)ft.push({x:K(0,y),y:K(0,M),r:K(.3,1.8)*i,d:i,tw:K(.4,1),phase:K(0,C)})}Dt();var B=(a,i=1)=>a===R.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function lt(){let a=["corvette","frigate","destroyer","carrier","fighter"],i=tt(0,a.length-1);return a[i]}function Ft(a){let i=lt();if(a===R.RED){let s=h(40,y*.35),e=h(80,M-80);T.push(new k(R.RED,s,e,i)),typeof G=="function"&&G(`+1 Red (${i})`)}else{let s=h(y*.65,y-40),e=h(80,M-80);T.push(new k(R.BLUE,s,e,i)),typeof G=="function"&&G(`+1 Blue (${i})`)}}var le={createShipFromUI:Ft,randomShipType:lt,ships:T,state:w},U=class{constructor(i,s,e,n,o,l){this.x=i,this.y=s,this.vx=e,this.vy=n,this.life=o,this.max=o,this.color=l}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}draw(){if(this.life<=0)return;let i=this.life/this.max;pt(),!(typeof t>"u"||!t)&&(t.fillStyle=this.color.replace("$a",i.toFixed(3)),t.fillRect(this.x,this.y,2,2))}},ut=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;pt();let s=q.some(r=>r.shieldHit&&r.x===i.x&&r.y===i.y&&r.life>0);if(ot){let r=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;I.push(new U(r,u,-i.vx*.05+h(-10,10),-i.vy*.05+h(-10,10),.25,B(i.team,"$a")))}typeof t<"u"&&(t.save(),t.translate(i.x,i.y),t.rotate(i.angle),t.shadowBlur=12,t.shadowColor=B(i.team,.9));let e=i.radius||8;if(typeof t<"u"&&(t.fillStyle=B(i.team,.96)),i.type==="corvette"?(t.beginPath(),t.moveTo(e*1.5,0),t.lineTo(-e,-e*.7),t.lineTo(-e*.4,0),t.lineTo(-e,e*.7),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.85)",t.beginPath(),t.ellipse(0,0,e*.35,e*.25,0,0,C),t.fill()):i.type==="frigate"?(t.beginPath(),t.moveTo(e*1.6,0),t.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),t.lineTo(-e*.6,0),t.lineTo(-e*1.1,e*.6),t.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.75)",t.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(t.beginPath(),t.moveTo(e*1.9,0),t.lineTo(e*.3,-e*1.1),t.lineTo(-e*1.4,-e*.6),t.lineTo(-e*1.4,e*.6),t.lineTo(e*.3,e*1.1),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.7)",t.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(t.beginPath(),t.ellipse(0,0,e*1.6,e*1,0,0,C),t.fill(),t.fillStyle="rgba(255,255,255,.18)",t.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(t.beginPath(),t.moveTo(e*1.2,0),t.lineTo(-e*.6,-e*.45),t.lineTo(-e*.2,0),t.lineTo(-e*.6,e*.45),t.closePath(),t.fill(),t.fillStyle="rgba(255,255,255,.9)",t.beginPath(),t.ellipse(e*.25,0,e*.25,e*.15,0,0,C),t.fill()):(t.beginPath(),t.moveTo(e*1.4,0),t.lineTo(-e,-e*.8),t.lineTo(-e*.4,0),t.lineTo(-e,e*.8),t.closePath(),t.fill()),typeof t<"u"&&t.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=e+4+(1-r)*2;typeof t<"u"&&t.save(),t.beginPath(),t.arc(i.x,i.y,u,0,C);let m=t.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);m.addColorStop(0,`rgba(140,200,255,${.06})`),m.addColorStop(1,`rgba(80,160,255,${.02})`),typeof t<"u"&&(t.fillStyle=m,t.globalCompositeOperation="lighter",t.fill());for(let p of z){if(p.id!==i.id)continue;let f=Math.max(0,Math.min(1,p.life/.22)),L=i.shieldMax&&i.shieldMax>0?p.amount/i.shieldMax:Math.min(1,p.amount/(i.hpMax*.6||1)),v=Math.max(.08,Math.min(1,L)),F=(Math.PI*.25+Math.PI*.6*(1-f))*(.6+1.6*v),$=p.angle-F/2,O=p.angle+F/2,N=u+4*(1-f)+2*v;t.beginPath(),t.arc(i.x,i.y,N,$,O),t.lineWidth=(3+6*f)*(1+4*v);let W=Math.min(1,.25+f*(.9+1.6*v));t.strokeStyle=`rgba(160,220,255,${W})`,t.save(),t.shadowBlur=12*v,t.shadowColor="rgba(140,200,255,0.8)",t.stroke(),t.restore()}typeof t<"u"&&t.restore()}let n=Math.max(16,e*3.2),o=Math.max(3,e*.4),l=i.x-n/2,g=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let r=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;typeof t<"u"&&(t.fillStyle="rgba(255,255,255,.08)",t.fillRect(l,g,n,o),t.fillStyle="rgba(80,160,255,.95)",t.fillRect(l,g,n*r,o))}let c=i.y+(e+8),P=Math.max(0,Math.min(1,i.hp/i.hpMax)),d=Math.min(6,o);if(typeof t<"u"&&t&&typeof t.measureText=="function")try{let r=String(i.level||1),m=Math.max(12,Math.round(o*6));t.save(),t.font=`700 ${m}px Inter, system-ui, sans-serif`,t.textAlign="center",t.textBaseline="middle";let p=t.measureText(r).width,f=8,L=Math.max(2,Math.round((m-o)/2)),v=Math.max(18,p+f*2),_=Math.max(o+2,m*.9),F=l-8-v,$=c+o/2-_/2,O=_/2,N=4,W=F-N,Et=$-N,Mt=v+N*2,xt=_+N*2;t.save(),t.fillStyle="rgba(0,0,0,0.45)",kt(t,W,Et,Mt,xt,xt/2),t.fill(),t.restore();let J=j.find(Y=>Y.id===i.id&&Y.life>0),Q=1;J&&(Q=1+.6*Math.max(0,Math.min(1,J.life/1)));let X=v*Q,H=_*Q,b=F-(X-v),S=$-(H-_)/2,A=H/2;if(t.beginPath(),t.moveTo(b+A,S),t.lineTo(b+X-A,S),t.quadraticCurveTo(b+X,S,b+X,S+A),t.lineTo(b+X,S+H-A),t.quadraticCurveTo(b+X,S+H,b+X-A,S+H),t.lineTo(b+A,S+H),t.quadraticCurveTo(b,S+H,b,S+H-A),t.lineTo(b,S+A),t.quadraticCurveTo(b,S,b+A,S),t.closePath(),J){let Y=Math.max(.6,Math.min(1,J.life));t.save(),t.shadowBlur=20*Y,t.shadowColor="rgba(255,255,255,0.95)",t.fillStyle=B(i.team,.98),t.fill(),t.restore(),t.lineWidth=2,t.strokeStyle=`rgba(255,255,255,${.28+.6*Y})`,t.stroke()}else t.fillStyle=B(i.team,.98),t.fill(),t.lineWidth=1.25,t.strokeStyle="rgba(255,255,255,0.14)",t.stroke();t.fillStyle="rgba(255,255,255,1)",t.font=`700 ${Math.round(m*Q)}px Inter, system-ui, sans-serif`,t.fillText(r,b+X/2,S+H/2+.5),t.restore()}catch{}typeof t<"u"&&(t.beginPath(),t.moveTo(l+d,c),t.lineTo(l+n-d,c),t.quadraticCurveTo(l+n,c,l+n,c+d),t.lineTo(l+n,c+o-d),t.quadraticCurveTo(l+n,c+o,l+n-d,c+o),t.lineTo(l+d,c+o),t.quadraticCurveTo(l,c+o,l,c+o-d),t.lineTo(l,c+d),t.quadraticCurveTo(l,c,l+d,c),t.closePath(),t.fillStyle="rgba(255,255,255,.08)",t.fill());let x=Z.find(r=>r.id===i.id&&r.life>0),E=`rgba(120,220,120,${.95})`;if(x){let r=Math.max(0,Math.min(1,x.life/.45)),u=Math.min(1,x.amount/(i.hpMax||1)),m=Math.floor(220*(1-u*r)),p=Math.floor(60+160*(1-r*u));E=`rgba(${Math.min(255,m)},${Math.min(255,p)},60,${.95})`}typeof t<"u"&&(t.save(),t.beginPath(),t.moveTo(l+d,c),t.lineTo(l+n-d,c),t.quadraticCurveTo(l+n,c,l+n,c+d),t.lineTo(l+n,c+o-d),t.quadraticCurveTo(l+n,c+o,l+n-d,c+o),t.lineTo(l+d,c+o),t.quadraticCurveTo(l,c+o,l,c+o-d),t.lineTo(l,c+d),t.quadraticCurveTo(l,c,l+d,c),t.closePath(),t.clip(),t.fillStyle=E,t.fillRect(l,c,n*P,o))}};function ae(){}function Nt(a){if(vt(w,a,{W:y,H:M}),Array.isArray(w.healthHits)&&w.healthHits.length){for(let s of w.healthHits){let e=T.find(n=>n.id===s.id);if(e){Z.push({id:e.id,life:.45,amount:s.amount});for(let n=0;n<6;n++){let o=h(0,C),l=h(40,120);I.push(new U(s.hitX,s.hitY,Math.cos(o)*l,Math.sin(o)*l,h(.12,.4),"rgba(200,230,255,$a)"))}}}w.healthHits.length=0}if(Array.isArray(w.shieldHits)&&w.shieldHits.length){for(let s of w.shieldHits){let e=T.find(n=>n.id===s.id);if(e){let n=Math.atan2(s.hitY-e.y,s.hitX-e.x);z.push({id:e.id,angle:n,life:.22,amount:s.amount}),q.push({x:s.hitX,y:s.hitY,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0})}}w.shieldHits.length=0}for(let s=I.length-1;s>=0;s--){let e=I[s];e.update(a),e.life<=0&&I.splice(s,1)}for(let s=q.length-1;s>=0;s--){let e=q[s];e.life-=a,e.r+=600*a,e.life<=0&&q.splice(s,1)}for(let s=z.length-1;s>=0;s--){let e=z[s];e.life-=a,e.life<=0&&z.splice(s,1)}for(let s=Z.length-1;s>=0;s--){let e=Z[s];e.life-=a,e.life<=0&&Z.splice(s,1)}for(let s=j.length-1;s>=0;s--){let e=j[s];e.life-=a,e.life<=0&&j.splice(s,1)}let i=new Set(T.map(s=>s.id));for(let s of T)if(V.has(s.id)){let e=V.get(s.id);if(e.level!==s.level){j.push({id:s.id,life:1});for(let n=0;n<18;n++){let o=h(0,C),l=h(60,240);I.push(new U(s.x+Math.cos(o)*2,s.y+Math.sin(o)*2,Math.cos(o)*l,Math.sin(o)*l,h(.3,.9),"rgba(200,255,220,$a)"))}e.level=s.level}e.syncFromLogic()}else{let e=new ut(s);e.level=s.level,V.set(s.id,e)}for(let s of Array.from(V.keys()))i.has(s)||V.delete(s)}function Xt(){if(pt(),typeof t>"u"||!t)return;t.clearRect(0,0,y,M);let a=t.createRadialGradient(y*.6,M*.3,50,y*.6,M*.3,Math.max(y,M));a.addColorStop(0,"rgba(60,80,140,0.10)"),a.addColorStop(1,"rgba(10,12,20,0.0)"),t.fillStyle=a,t.fillRect(0,0,y,M);for(let e of ft){let n=.6+.4*Math.sin(e.phase);t.globalAlpha=dt(.5*n*(.6+.5*e.d),0,1),t.fillStyle="#e9f2ff",t.fillRect(e.x,e.y,e.r,e.r)}t.globalAlpha=1;for(let e of q){let n=dt(e.life/.25,0,1);t.strokeStyle=B(e.team,n*.6),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,e.r,0,C),t.stroke()}for(let e of mt)t.save(),t.shadowBlur=12,t.shadowColor=B(e.team,.9),t.fillStyle=B(e.team,.95),t.beginPath(),t.arc(e.x,e.y,e.radius||2.2,0,C),t.fill(),t.restore();for(let e of I)e.draw();for(let e of V.values())e.draw();let i=T.some(e=>e.alive&&e.team===R.RED),s=T.some(e=>e.alive&&e.team===R.BLUE);if(!i||!s){t.save(),t.textAlign="center",t.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":s?"Blue":"Nobody",n=i?B(R.RED,.95):s?B(R.BLUE,.95):"rgba(255,255,255,.9)";t.fillStyle=n,t.shadowBlur=14,t.shadowColor=n,t.fillText(`${e} Wins!`,y/2,64),t.restore()}}function re(){if(typeof document>"u")return;let a=document.getElementById&&document.getElementById("startPause"),i=document.getElementById&&document.getElementById("reset"),s=document.getElementById&&document.getElementById("addRed"),e=document.getElementById&&document.getElementById("addBlue"),n=document.getElementById&&document.getElementById("toggleTrails"),o=document.getElementById&&document.getElementById("speed"),l=document.getElementById&&document.getElementById("redScore"),g=document.getElementById&&document.getElementById("blueScore"),c=document.getElementById&&document.getElementById("stats"),P=document.getElementById&&document.getElementById("seedBtn"),d=document.getElementById&&document.getElementById("formationBtn");function x(){l&&(l.textContent=`Red ${ct.red}`),g&&(g.textContent=`Blue ${ct.blue}`),c&&(c.textContent=`Ships: ${T.filter(r=>r.alive).length}  Bullets: ${mt.length}  Particles: ${I.length}`)}a&&typeof a.addEventListener=="function"&&a.addEventListener("click",()=>{st=!st,a.textContent=st?"\u23F8 Pause":"\u25B6 Start"}),i&&typeof i.addEventListener=="function"&&i.addEventListener("click",()=>{reset()}),s&&typeof s.addEventListener=="function"&&s.addEventListener("click",()=>{let r=lt();T.push(new k(R.RED,h(40,y*.35),h(80,M-80),r)),G(`+1 Red (${r})`)}),e&&typeof e.addEventListener=="function"&&e.addEventListener("click",()=>{let r=lt();T.push(new k(R.BLUE,h(y*.65,y-40),h(80,M-80),r)),G(`+1 Blue (${r})`)}),n&&typeof n.addEventListener=="function"&&n.addEventListener("click",()=>{ot=!ot,n.textContent=`\u2604 Trails: ${ot?"On":"Off"}`}),o&&typeof o.addEventListener=="function"&&o.addEventListener("click",()=>{let r=(ht.indexOf(nt)+1)%ht.length;nt=ht[r],o.textContent=`Speed: ${nt}\xD7`}),P&&typeof P.addEventListener=="function"&&P.addEventListener("click",()=>{let r=tt(0,4294967295),u=prompt("Enter numeric seed (32-bit):",r);u!==null&&reset(Number(u))}),d&&typeof d.addEventListener=="function"&&d.addEventListener("click",()=>{let r=T.filter(f=>f.alive&&f.team===R.RED),u=T.filter(f=>f.alive&&f.team===R.BLUE),m=20,p=6;r.forEach((f,L)=>{let v=L%p,_=Math.floor(L/p);f.x=y*.25-v*20,f.y=M*.5+(_-p/2)*m,f.vx=f.vy=0}),u.forEach((f,L)=>{let v=L%p,_=Math.floor(L/p);f.x=y*.75+v*20,f.y=M*.5+(_-p/2)*m,f.vx=f.vy=0}),G("Fleets re-formed")}),D&&typeof D.addEventListener=="function"&&D.addEventListener("click",r=>{q.push({x:r.clientX,y:r.clientY,r:24,life:.25,team:tt(0,1)});for(let m=0;m<24;m++){let p=h(0,C),f=h(40,220);I.push(new U(r.clientX,r.clientY,Math.cos(p)*f,Math.sin(p)*f,h(.2,1),"rgba(255,255,255,$a)"))}});function E(r){it||(it=r);let u=(r-it)/1e3;it=r;let m=dt(u,0,.033)*(st?nt:0);Nt(m),Xt(),x(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}typeof reset=="function"&&reset(),typeof requestAnimationFrame=="function"&&requestAnimationFrame(E)}export{U as Particle,ht as SPEED_STEPS,ut as ShipV,mt as bullets,Ft as createShipFromUI,q as flashes,Z as healthFlashes,oe as initRenderer,re as initRendererUI,it as lastTime,j as levelFlashes,I as particles,lt as randomShipType,Xt as render,st as running,ct as score,z as shieldFlashes,T as ships,V as shipsVMap,ot as showTrails,Nt as simulate,nt as speed,w as state,B as teamColor,le as testHelpers,G as toast,ae as updateUI};
