var Le=Object.defineProperty;var Se=(l,e,a)=>e in l?Le(l,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[e]=a;var xe=(l,e,a)=>Se(l,typeof e!="symbol"?e+"":e,a);var ne=!1,K=123456789;function ge(l){ne=!0,K=l>>>0}function ye(){ne=!1}function Ce(){return ne?(K=1664525*K+1013904223>>>0,K/4294967296):Math.random()}function h(l=0,e=1){return l+(e-l)*Ce()}function j(l,e){return Math.floor(h(l,e+1))}var Ee={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},ve=1.2,oe=.6;var d={RED:0,BLUE:1},le=class{constructor(e,a,t,s,o,n=null){this.x=e,this.y=a,this.vx=t,this.vy=s,this.team=o,this.ownerId=n,this.life=2.5,this.radius=2.2,this.dmg=h(8,14)}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.life-=e}alive(e=null){if(this.life<=0)return!1;if(!e)return!0;let{W:a,H:t}=e;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<t+50}},z=class z{constructor(e,a,t,s="corvette"){this.team=e,this.x=a,this.y=t,this.vx=0,this.vy=0,this.angle=0,this.type=s;let o={corvette:{radius:8,maxSpeed:h(120,160),accel:240,turn:6.5,hp:h(40,70),reload:h(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:h(90,120),accel:200,turn:5,hp:h(80,120),reload:h(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:h(60,90),accel:150,turn:3.2,hp:h(150,220),reload:h(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:h(40,70),accel:90,turn:2,hp:h(220,300),reload:h(.6,1.2),vision:360,range:260,launchBase:h(3.5,6)},fighter:{radius:6,maxSpeed:h(160,220),accel:300,turn:8,hp:h(18,32),reload:h(.12,.22),vision:180,range:120}},n=o[s]||o.corvette;this.radius=n.radius,this.maxSpeed=n.maxSpeed,this.accel=n.accel,this.turn=n.turn||Ee[s]||4.5,this.hpMax=n.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=n.reload,this.vision=n.vision,this.range=n.range,this.id=z._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,s==="carrier"?(this.isCarrier=!0,this.launchCooldown=n.launchBase*h(.8,1.4),this.launchAmount=Math.max(1,Math.floor(h(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(e=100,a=1.35){return Math.floor(e*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let e=.06,a=.1,t=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let s=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(s*(1+t*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(e){if(!(e<=0))for(this.xp+=e;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(e){let a=null,t=1/0,s=this.vision*this.vision;for(let o of e){if(!o.alive||o.team===this.team)continue;let n=o.x-this.x,c=o.y-this.y,r=n*n+c*c;r<s&&r<t&&(t=r,a=o)}return a}update(e,a){if(!this.alive)return;let t=this.pickTarget(a),s=this.recentHitTimer>0,o=0,n=0,c=1;if(t&&!s){let p=t.x-this.x,R=t.y-this.y;c=Math.hypot(p,R)||1;let y=Math.max(0,Math.min(1.2,c/240)),A=t.x+(t.vx||0)*y,_=t.y+(t.vy||0)*y;o=A-this.x,n=_-this.y;let D=Math.hypot(o,n)||1;o/=D,n/=D}else if(t&&s){let p=t.x-this.x,R=t.y-this.y;c=Math.hypot(p,R)||1,o=-(p/c),n=-(R/c)}else o=Math.cos(this.angle),n=Math.sin(this.angle);let r=0,m=0,f=0,T=26;for(let p of a){if(!p.alive||p===this||p.team!==this.team)continue;let R=this.x-p.x,y=this.y-p.y,A=R*R+y*y;if(A<T*T&&A>1){let _=Math.sqrt(A);r+=R/_,m+=y/_,f++}}f>0&&(r/=f,m/=f);let u=Math.atan2(n,o)-this.angle;for(;u>Math.PI;)u-=2*Math.PI;for(;u<-Math.PI;)u+=2*Math.PI;let v=this.turn*e;u>v?u=v:u<-v&&(u=-v),this.angle+=u;let w=s?this.accel*ve:this.accel;this.vx+=Math.cos(this.angle)*w*e,this.vy+=Math.sin(this.angle)*w*e,f>0&&(this.vx+=r*(this.accel*oe)*e,this.vy+=m*(this.accel*oe)*e);let M=Math.hypot(this.vx,this.vy);if(M>this.maxSpeed){let p=this.maxSpeed/M;this.vx*=p,this.vy*=p}if(this.x+=this.vx*e,this.y+=this.vy*e,t){let p=t.x-this.x,R=t.y-this.y,y=Math.hypot(p,R)||1;if(y<this.range){let A=Math.cos(this.angle)*(p/y)+Math.sin(this.angle)*(R/y);if(this.cooldown<=0&&A>.2){let _=300+h(-20,20),D=p/y,Y=R/y;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new le(this.x+D*12,this.y+Y*12,D*_+this.vx*.2,Y*_+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=e,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*e)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-e))}damage(e){let a=e,t=0;return this.shield>0&&e>0&&(t=Math.min(this.shield,e),this.shield-=t,e-=t),e>0&&(this.hp-=e),(t>0||a>0&&e>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};xe(z,"_id",1);var S=z;function ae(l,e,a,t,s=80){let o=[];for(let n=0;n<e;n++){let c=n%6*20+h(-10,10),r=Math.floor(n/6)*20+h(-10,10),m=h(0,1),f="corvette";m<.45?f="corvette":m<.75?f="frigate":m<.92?f="destroyer":f="carrier",o.push(new S(l,a+(l===d.RED?-c:c),t+r,f))}return o}function Me(l,e,a={W:800,H:600}){for(let t of l.ships)t.alive&&t.update(e,l.ships,l.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let t=a.W,s=a.H;for(let o of l.ships){if(!o.alive)continue;let n=o.radius||0;o.x<-n?o.x+=t+n*2:o.x>t+n&&(o.x-=t+n*2),o.y<-n?o.y+=s+n*2:o.y>s+n&&(o.y-=s+n*2)}}for(let t of l.ships)if(!(!t.alive||!t.isCarrier)&&(t.launchCooldown-=e,t.launchCooldown<=0)){if((Array.isArray(t.activeFighters)?t.activeFighters.length:0)<(t.maxFighters||6)){let o=Math.max(1,Math.floor(t.launchAmount||1));for(let n=0;n<o&&!(t.activeFighters.length>=(t.maxFighters||6));n++){let c=h(0,Math.PI*2),r=t.radius+12+h(4,12),m=t.x+Math.cos(c)*r,f=t.y+Math.sin(c)*r,T=new S(t.team,m,f,"fighter"),B=h(40,120);T.vx=Math.cos(c)*B+(t.vx||0)*.2,T.vy=Math.sin(c)*B+(t.vy||0)*.2,T.ownerCarrier=t.id,t.activeFighters.push(T.id),l.ships.push(T)}}t.launchCooldown=h(2.5,6)}for(let t=l.bullets.length-1;t>=0;t--){let s=l.bullets[t];s.update(e),s.alive(a)||l.bullets.splice(t,1)}for(let t=l.bullets.length-1;t>=0;t--){let s=l.bullets[t];for(let o of l.ships){if(!o.alive||o.team===s.team)continue;let n=o.x-s.x,c=o.y-s.y,r=n*n+c*c,m=o.radius+s.radius;if(r<m*m){let f=s.dmg,T=typeof o.shield=="number"?o.shield:0,B=typeof o.hp=="number"?o.hp:0,u=o.damage(f),v=Math.max(0,T-(typeof o.shield=="number"?o.shield:0)),w=Math.max(0,B-(typeof o.hp=="number"?o.hp:0));if(v>0&&l&&Array.isArray(l.shieldHits)&&l.shieldHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:v}),w>0&&l&&Array.isArray(l.healthHits)&&l.healthHits.push({id:o.id,hitX:s.x,hitY:s.y,team:o.team,amount:w}),s.ownerId!=null){let M=l.ships.find(p=>p.id===s.ownerId);M&&M.gainXp(f*.05)}if(l.bullets.splice(t,1),u&&l.explosions&&l.explosions.push(u),!o.alive&&(s.team===0?l.score.red++:l.score.blue++,s.ownerId!=null)){let M=l.ships.find(p=>p.id===s.ownerId);M&&M.gainXp(20+(o.level||1)*.2)}break}}}for(let t of l.explosions||[]){if(!t||!t.id)continue;let s=t;if(s.type==="fighter"&&typeof s.ownerCarrier=="number"){let o=l.ships.find(n=>n.id===s.ownerCarrier);if(o&&Array.isArray(o.activeFighters)){let n=o.activeFighters.indexOf(s.id);n>=0&&o.activeFighters.splice(n,1)}}if(s.type==="carrier"){let o=s.id;for(let c of l.ships)c.alive&&c.type==="fighter"&&c.ownerCarrier===o&&(c.ownerCarrier=null);let n=l.ships.find(c=>c.id===o);n&&Array.isArray(n.activeFighters)&&(n.activeFighters.length=0)}}}var U=document.getElementById("world"),i=U.getContext("2d"),x=U.width=window.innerWidth,E=U.height=window.innerHeight;window.addEventListener("resize",()=>{x=U.width=window.innerWidth,E=U.height=window.innerHeight,we(),Pe()});var b=Math.PI*2,fe=(l,e,a)=>Math.max(e,Math.min(a,l)),X=(l=0,e=1)=>l+(e-l)*Math.random();function F(l){let e=document.getElementById("toast");e.textContent=l,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1400)}var te=[];function Pe(){te.length=0;let l=[.2,.5,1];for(let e of l)for(let a=0;a<120;a++)te.push({x:X(0,x),y:X(0,E),r:X(.3,1.8)*e,d:e,tw:X(.4,1),phase:X(0,b)})}Pe();var re=new Map;function vt(l){if(re.has(l))return re.get(l);let e=new Path2D;return l==="corvette"?(e.moveTo(1.5,0),e.lineTo(-1,-.7),e.lineTo(-.4,0),e.lineTo(-1,.7),e.closePath(),e.ellipse(0,0,.35,.25,0,0,b)):l==="frigate"?(e.moveTo(1.6,0),e.quadraticCurveTo(.2,-1.1,-1.1,-.6),e.lineTo(-.6,0),e.lineTo(-1.1,.6),e.quadraticCurveTo(.2,1.1,1.6,0),e.closePath()):l==="destroyer"?(e.moveTo(1.9,0),e.lineTo(.3,-1.1),e.lineTo(-1.4,-.6),e.lineTo(-1.4,.6),e.lineTo(.3,1.1),e.closePath()):l==="carrier"?e.ellipse(0,0,1.6,1,0,0,b):l==="fighter"?(e.moveTo(1.2,0),e.lineTo(-.6,-.45),e.lineTo(-.2,0),e.lineTo(-.6,.45),e.closePath(),e.ellipse(.25,0,.25,.15,0,0,b)):(e.moveTo(1.4,0),e.lineTo(-1,-.8),e.lineTo(-.4,0),e.lineTo(-1,.8),e.closePath()),re.set(l,e),e}var he=null;function we(){he=i.createRadialGradient(x*.6,E*.3,50,x*.6,E*.3,Math.max(x,E)),he.addColorStop(0,"rgba(60,80,140,0.10)"),he.addColorStop(1,"rgba(10,12,20,0.0)")}we();var ie=[];function se(l,e,a,t,s,o){let n;return ie.length>0?(n=ie.pop(),n.x=l,n.y=e,n.vx=a,n.vy=t,n.life=s,n.max=s,n.color=o):n=new de(l,e,a,t,s,o),H.push(n),n}function Ge(l){ie.length<2e3&&ie.push(l)}var C=(l,e=1)=>l===d.RED?`rgba(255,90,90,${e})`:`rgba(80,160,255,${e})`,de=class{constructor(e,a,t,s,o,n){this.x=e,this.y=a,this.vx=t,this.vy=s,this.life=o,this.max=o,this.color=n}update(e){this.x+=this.vx*e,this.y+=this.vy*e,this.vx*=Math.pow(.9,e*60),this.vy*=Math.pow(.9,e*60),this.life-=e}draw(){if(this.life<=0)return;let e=this.life/this.max;i.fillStyle=this.color.replace("$a",e.toFixed(3)),i.fillRect(this.x,this.y,2,2)}},ue=class{constructor(e){this.logic=e,this.id=e.id,this.team=e.team,this.x=e.x,this.y=e.y,this.type=e.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let e=this.logic;if(!e.alive)return;let a=I.some(u=>u.shieldHit&&u.x===e.x&&u.y===e.y&&u.life>0);if(ee){let u=e.x-Math.cos(e.angle)*e.radius*1.2,v=e.y-Math.sin(e.angle)*e.radius*1.2;se(u,v,-e.vx*.05+h(-10,10),-e.vy*.05+h(-10,10),.25,C(e.team,"$a"))}i.save(),i.translate(e.x,e.y),i.rotate(e.angle),i.shadowBlur=12,i.shadowColor=C(e.team,.9);let t=e.radius||8;if(i.fillStyle=C(e.team,.96),e.type==="corvette"?(i.beginPath(),i.moveTo(t*1.5,0),i.lineTo(-t,-t*.7),i.lineTo(-t*.4,0),i.lineTo(-t,t*.7),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.85)",i.beginPath(),i.ellipse(0,0,t*.35,t*.25,0,0,b),i.fill()):e.type==="frigate"?(i.beginPath(),i.moveTo(t*1.6,0),i.quadraticCurveTo(t*.2,-t*1.1,-t*1.1,-t*.6),i.lineTo(-t*.6,0),i.lineTo(-t*1.1,t*.6),i.quadraticCurveTo(t*.2,t*1.1,t*1.6,0),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.75)",i.fillRect(-t*.2,-t*.25,t*.6,t*.5)):e.type==="destroyer"?(i.beginPath(),i.moveTo(t*1.9,0),i.lineTo(t*.3,-t*1.1),i.lineTo(-t*1.4,-t*.6),i.lineTo(-t*1.4,t*.6),i.lineTo(t*.3,t*1.1),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.7)",i.fillRect(-t*.9,-t*.18,t*1.2,t*.36)):e.type==="carrier"?(i.beginPath(),i.ellipse(0,0,t*1.6,t*1,0,0,b),i.fill(),i.fillStyle="rgba(255,255,255,.18)",i.fillRect(-t*.8,-t*.25,t*1.6,t*.5)):e.type==="fighter"?(i.beginPath(),i.moveTo(t*1.2,0),i.lineTo(-t*.6,-t*.45),i.lineTo(-t*.2,0),i.lineTo(-t*.6,t*.45),i.closePath(),i.fill(),i.fillStyle="rgba(255,255,255,.9)",i.beginPath(),i.ellipse(t*.25,0,t*.25,t*.15,0,0,b),i.fill()):(i.beginPath(),i.moveTo(t*1.4,0),i.lineTo(-t,-t*.8),i.lineTo(-t*.4,0),i.lineTo(-t,t*.8),i.closePath(),i.fill()),i.restore(),typeof e.shield=="number"&&typeof e.shieldMax=="number"){let u=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0,v=t+4+(1-u)*2;i.save(),i.beginPath(),i.arc(e.x,e.y,v,0,b);let w=i.createRadialGradient(e.x,e.y,v*.6,e.x,e.y,v);w.addColorStop(0,`rgba(140,200,255,${.06})`),w.addColorStop(1,`rgba(80,160,255,${.02})`),i.fillStyle=w,i.globalCompositeOperation="lighter",i.fill();for(let M of G){if(M.id!==e.id)continue;let p=Math.max(0,Math.min(1,M.life/.22)),R=e.shieldMax&&e.shieldMax>0?M.amount/e.shieldMax:Math.min(1,M.amount/(e.hpMax*.6||1)),y=Math.max(.08,Math.min(1,R)),_=(Math.PI*.25+Math.PI*.6*(1-p))*(.6+1.6*y),D=M.angle-_/2,Y=M.angle+_/2,me=v+4*(1-p)+2*y;i.beginPath(),i.arc(e.x,e.y,me,D,Y),i.lineWidth=(3+6*p)*(1+4*y);let _e=Math.min(1,.25+p*(.9+1.6*y));i.strokeStyle=`rgba(160,220,255,${_e})`,i.save(),i.shadowBlur=12*y,i.shadowColor="rgba(140,200,255,0.8)",i.stroke(),i.restore()}i.restore()}let s=Math.max(16,t*3.2),o=Math.max(3,t*.4),n=e.x-s/2,c=e.y-(t+12);if(typeof e.shield=="number"&&typeof e.shieldMax=="number"){let u=e.shieldMax>0?Math.max(0,Math.min(1,e.shield/e.shieldMax)):0;i.fillStyle="rgba(255,255,255,.08)",i.fillRect(n,c,s,o),i.fillStyle="rgba(80,160,255,.95)",i.fillRect(n,c,s*u,o)}let r=e.y+(t+8),m=Math.max(0,Math.min(1,e.hp/e.hpMax)),f=Math.min(6,o);i.beginPath(),i.moveTo(n+f,r),i.lineTo(n+s-f,r),i.quadraticCurveTo(n+s,r,n+s,r+f),i.lineTo(n+s,r+o-f),i.quadraticCurveTo(n+s,r+o,n+s-f,r+o),i.lineTo(n+f,r+o),i.quadraticCurveTo(n,r+o,n,r+o-f),i.lineTo(n,r+f),i.quadraticCurveTo(n,r,n+f,r),i.closePath(),i.fillStyle="rgba(255,255,255,.08)",i.fill();let T=q.find(u=>u.id===e.id&&u.life>0),B=`rgba(120,220,120,${.95})`;if(T){let u=Math.max(0,Math.min(1,T.life/.45)),v=Math.min(1,T.amount/(e.hpMax||1)),w=Math.floor(220*(1-v*u)),M=Math.floor(60+160*(1-u*v));B=`rgba(${Math.min(255,w)},${Math.min(255,M)},60,${.95})`}i.save(),i.beginPath(),i.moveTo(n+f,r),i.lineTo(n+s-f,r),i.quadraticCurveTo(n+s,r,n+s,r+f),i.lineTo(n+s,r+o-f),i.quadraticCurveTo(n+s,r+o,n+s-f,r+o),i.lineTo(n+f,r+o),i.quadraticCurveTo(n,r+o,n,r+o-f),i.lineTo(n,r+f),i.quadraticCurveTo(n,r,n+f,r),i.closePath(),i.clip(),i.fillStyle=B,i.fillRect(n,r,s*m,o),i.restore(),typeof e.level=="number"&&e.level>1&&(i.save(),i.fillStyle="rgba(255,255,255,0.95)",i.font="700 12px system-ui, sans-serif",i.textAlign="center",i.fillText(`Lv ${e.level}`,e.x,e.y-(t+18)),i.restore())}},g=[],k=[],H=[],I=[],G=[],q=[],N=new Map,Q=!1,Z=1,ee=!0,V=0,W={red:0,blue:0};function J(l=null){g.length=0,k.length=0,H.length=0,I.length=0,W.red=0,W.blue=0,l!==null?(ge(l>>>0),F(`Seed set to ${l>>>0}`)):ye(),g.push(...ae(d.RED,12,x*.25,E*.5)),g.push(...ae(d.BLUE,12,x*.75,E*.5))}function qe(l){for(let s of te)s.phase+=l*.8*s.d;for(let s of g)s.update(l,g);for(let s=k.length-1;s>=0;s--){let o=k[s];if(o.update(l),!o.alive()){k.splice(s,1);continue}}let a={ships:g,bullets:k,score:W,particles:H,explosions:[],shieldHits:[]};if(Me(a,l,{W:x,H:E}),a.explosions&&a.explosions.length)for(let s of a.explosions){I.push({x:s.x,y:s.y,r:2,life:.25,team:s.team});for(let o=0;o<20;o++){let n=h(0,b),c=h(40,220);se(s.x,s.y,Math.cos(n)*c,Math.sin(n)*c,h(.2,1),C(s.team,"$a"))}}if(Array.isArray(a.shieldHits)&&a.shieldHits.length)for(let s of a.shieldHits){let o=g.find(r=>r.id===s.id),n=o?o.x:s.hitX,c=o?o.y:s.hitY;I.push({x:n,y:c,r:6+Math.min(12,s.amount),life:.12,team:s.team,shieldHit:!0});for(let r=0;r<6;r++){let m=h(0,b),f=h(40,120);se(s.hitX,s.hitY,Math.cos(m)*f,Math.sin(m)*f,h(.12,.4),"rgba(200,230,255,$a)")}if(o){let r=Math.atan2(s.hitY-c,s.hitX-n);G.push({id:o.id,angle:r,life:.22,amount:s.amount})}}if(Array.isArray(a.healthHits)&&a.healthHits.length)for(let s of a.healthHits){let o=g.find(n=>n.id===s.id);o&&q.push({id:o.id,life:.45,amount:s.amount})}tt(l);for(let s=H.length-1;s>=0;s--){let o=H[s];o.update(l),o.life<=0&&(H.splice(s,1),Ge(o))}for(let s=I.length-1;s>=0;s--){let o=I[s];o.life-=l,o.r+=600*l,o.life<=0&&I.splice(s,1)}for(let s=G.length-1;s>=0;s--){let o=G[s];o.life-=l,o.life<=0&&G.splice(s,1)}for(let s=q.length-1;s>=0;s--){let o=q[s];o.life-=l,o.life<=0&&q.splice(s,1)}let t=new Set(g.map(s=>s.id));for(let s of g)N.has(s.id)?N.get(s.id).syncFromLogic():N.set(s.id,new ue(s));for(let s of Array.from(N.keys()))t.has(s)||N.delete(s)}function Ve(){i.clearRect(0,0,x,E);let l=i.createRadialGradient(x*.6,E*.3,50,x*.6,E*.3,Math.max(x,E));l.addColorStop(0,"rgba(60,80,140,0.10)"),l.addColorStop(1,"rgba(10,12,20,0.0)"),i.fillStyle=l,i.fillRect(0,0,x,E);for(let t of te){let s=.6+.4*Math.sin(t.phase);i.globalAlpha=fe(.5*s*(.6+.5*t.d),0,1),i.fillStyle="#e9f2ff",i.fillRect(t.x,t.y,t.r,t.r)}i.globalAlpha=1;for(let t of I){let s=fe(t.life/.25,0,1);i.strokeStyle=C(t.team,s*.6),i.lineWidth=2,i.beginPath(),i.arc(t.x,t.y,t.r,0,b),i.stroke()}for(let t of k)i.save(),i.shadowBlur=12,i.shadowColor=C(t.team,.9),i.fillStyle=C(t.team,.95),i.beginPath(),i.arc(t.x,t.y,t.radius||2.2,0,b),i.fill(),i.restore();for(let t of H)t.draw();for(let t of N.values())t.draw();let e=g.some(t=>t.alive&&t.team===d.RED),a=g.some(t=>t.alive&&t.team===d.BLUE);if(!e||!a){i.save(),i.textAlign="center",i.font="700 36px Inter, system-ui, sans-serif";let t=e?"Red":a?"Blue":"Nobody",s=e?C(d.RED,.95):a?C(d.BLUE,.95):"rgba(255,255,255,.9)";i.fillStyle=s,i.shadowBlur=14,i.shadowColor=s,i.fillText(`${t} Wins!`,x/2,64),i.restore()}}function pe(l){V||(V=l);let e=(l-V)/1e3;V=l;let a=fe(e,0,.033)*(Q?Z:0);qe(a),Ve(),Ze(),requestAnimationFrame(pe)}var Te=document.getElementById("startPause"),Oe=document.getElementById("reset"),We=document.getElementById("addRed"),Ye=document.getElementById("addBlue"),Re=document.getElementById("toggleTrails"),be=document.getElementById("speed"),Ke=document.getElementById("redScore"),je=document.getElementById("blueScore"),ze=document.getElementById("stats"),Je=document.getElementById("seedBtn"),Qe=document.getElementById("formationBtn"),$=document.getElementById("continuousCheckbox");$||($=document.createElement("input"),$.type="checkbox",$.id="continuousCheckbox");function Ze(){Ke.textContent=`Red ${W.red}`,je.textContent=`Blue ${W.blue}`,ze.textContent=`Ships: ${g.filter(l=>l.alive).length}  Bullets: ${k.length}  Particles: ${H.length}`}var O={[d.RED]:0,[d.BLUE]:0};function Mt(){O[d.RED]=0,O[d.BLUE]=0}var P=0,L={[d.RED]:0,[d.BLUE]:0};function et(l){P=Number(l)||0,L[d.RED]=0,L[d.BLUE]=0}function Tt(){return P}function tt(l){if(P<=0){ce(l);return}L[d.RED]+=l,L[d.BLUE]+=l,L[d.RED]>=P&&(ce(L[d.RED],d.RED),L[d.RED]=0),L[d.BLUE]>=P&&(ce(L[d.BLUE],d.BLUE),L[d.BLUE]=0)}function ce(l,e=null){if(!$||!$.checked)return;let a=2,t=["frigate","corvette","destroyer","carrier"],s=(n,c)=>{for(let r=0;r<c;r++){let m=t[j(0,t.length-1)],f=n===d.RED?h(40,Math.max(120,x*.35)):h(Math.max(x*.65,x-240),x-40),T=h(80,Math.max(120,E-80));g.push(new S(n,f,T,m))}},o=n=>{if(g.filter(r=>r.alive&&r.team===n).length<a&&(O[n]-=l,O[n]<=0)){let r=j(1,6);s(n,r),O[n]=h(3,8),F(`Reinforcements: +${r} ${n===d.RED?"Red":"Blue"}`)}};e===null?(o(d.RED),o(d.BLUE)):o(e)}if(window.__uiHandlersInstalled)g.length===0&&J(),V||requestAnimationFrame(pe);else{Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1}),Te.addEventListener("click",()=>{Q=!Q,Te.textContent=Q?"\u23F8 Pause":"\u25B6 Start"}),Oe.addEventListener("click",()=>{J()}),We.addEventListener("click",()=>{g.push(new S(d.RED,h(40,x*.35),h(80,E-80))),F("+1 Red")}),Ye.addEventListener("click",()=>{g.push(new S(d.BLUE,h(x*.65,x-40),h(80,E-80))),F("+1 Blue")}),Re.addEventListener("click",()=>{ee=!ee,Re.textContent=`\u2604 Trails: ${ee?"On":"Off"}`}),be.addEventListener("click",()=>{let a=[.5,1,2,4],t=(a.indexOf(Z)+1)%a.length;Z=a[t],be.textContent=`Speed: ${Z}\xD7`}),Je.addEventListener("click",()=>{let a=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);a!==null&&J(Number(a))}),Qe.addEventListener("click",()=>{let a=g.filter(n=>n.alive&&n.team===d.RED),t=g.filter(n=>n.alive&&n.team===d.BLUE),s=20,o=6;a.forEach((n,c)=>{let r=c%o,m=Math.floor(c/o);n.x=x*.25-r*20,n.y=E*.5+(m-o/2)*s,n.vx=n.vy=0}),t.forEach((n,c)=>{let r=c%o,m=Math.floor(c/o);n.x=x*.75+r*20,n.y=E*.5+(m-o/2)*s,n.vx=n.vy=0}),F("Fleets re-formed")});let l=document.getElementById("reinforceFreqBtn"),e=[0,.5,1,2];l&&(l.textContent=P>0?`${P}s`:"Every step",l.addEventListener("click",()=>{let a=(e.indexOf(P)+1)%e.length;et(e[a]),l.textContent=P>0?`${P}s`:"Every step",F(`Reinforcement check: ${P>0?P+"s":"every step"}`)})),U.addEventListener("click",a=>{I.push({x:a.clientX,y:a.clientY,r:24,life:.25,team:j(0,1)});for(let s=0;s<24;s++){let o=h(0,b),n=h(40,220);se(a.clientX,a.clientY,Math.cos(o)*n,Math.sin(o)*n,h(.2,1),"rgba(255,255,255,$a)")}}),J(),requestAnimationFrame(pe)}export{de as Particle,se as acquireParticle,he as backgroundGradient,k as bullets,fe as clamp,tt as evaluateReinforcement,I as flashes,vt as getHullPath,Tt as getReinforcementInterval,ce as handleReinforcement,q as healthFlashes,re as hullPaths,Pe as initStars,ie as particlePool,H as particles,we as recomputeBackgroundGradient,P as reinforcementIntervalSeconds,Ge as releaseParticle,J as reset,Mt as resetReinforcementCooldowns,et as setReinforcementInterval,G as shieldFlashes,g as ships,N as shipsVMap,te as stars,C as teamColor};
