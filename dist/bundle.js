var tt=Object.defineProperty;var bt=(t,i,a)=>i in t?tt(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a;var Rt=(t,i)=>()=>(t&&(i=t(t=0)),i);var it=(t,i)=>{for(var a in i)tt(t,a,{get:i[a],enumerable:!0})};var nt=(t,i,a)=>bt(t,typeof i!="symbol"?i+"":i,a);var pt={};it(pt,{createWebGLRenderer:()=>mt,default:()=>qt});function ut(t,i,a){let e=t.createShader(i);if(t.shaderSource(e,a),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS)){let r=t.getShaderInfoLog(e);throw t.deleteShader(e),new Error("Shader compile error: "+r)}return e}function Wt(t,i,a){let e=ut(t,t.VERTEX_SHADER,i),r=ut(t,t.FRAGMENT_SHADER,a),n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){let s=t.getProgramInfoLog(n);throw t.deleteProgram(n),new Error("Program link error: "+s)}return n}function mt(t,i={}){let{webgl2:a=!1}=i,e=null,r=null,n=null,s=null,c=null,l=null,v=null,h=null,g=null,x=null,f=!1,u=1,T=null;return{type:"webgl",webgl2:a,init(){try{if(e=t.getContext(a?"webgl2":"webgl"),!e)return;u=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,t.width=Math.max(1,Math.floor((t.clientWidth||t.width)*u)),t.height=Math.max(1,Math.floor((t.clientHeight||t.height)*u)),r=Wt(e,`
          attribute vec2 a_quadPos; // -0.5..0.5 unit quad
          attribute vec2 a_instPos; // per-instance pixel center
          attribute vec3 a_instColor;
          attribute float a_instSize; // ship radius in pixels
          attribute float a_instAngle; // ship orientation (radians)
          attribute float a_instShield; // shield fraction 0..1
          uniform vec2 u_resolution;
          varying vec3 v_color;
          varying vec2 v_local; // local space after scale & rotation (diameter scale)
          varying float v_shield;
          varying float v_radius;
          void main(){
            float c = cos(a_instAngle);
            float s = sin(a_instAngle);
            vec2 rotated = vec2(
              a_quadPos.x * c - a_quadPos.y * s,
              a_quadPos.x * s + a_quadPos.y * c
            );
            vec2 pixelPos = a_instPos + rotated * a_instSize * 2.0; // diameter scaling
            vec2 zeroToOne = pixelPos / u_resolution;
            vec2 clip = zeroToOne * 2.0 - 1.0;
            gl_Position = vec4(clip * vec2(1.0, -1.0), 0.0, 1.0);
            v_color = a_instColor;
            v_local = rotated * a_instSize * 2.0; // used for circle SDF
            v_shield = a_instShield;
            v_radius = a_instSize;
          }
        `,`
          precision mediump float;
          varying vec3 v_color;
          varying vec2 v_local;
          varying float v_shield;
          varying float v_radius; // true circle radius in pixels
          void main(){
            float d = length(v_local); // distance from center
            float edge = fwidth(d) * 1.5; // widen edge slightly for smoother look
            float alpha = 1.0 - smoothstep(v_radius - edge, v_radius + edge, d);
            if (alpha <= 0.001) discard;
            vec3 base = v_color;
            // Optional shield ring: show thin ring if shield fraction > 0
            if (v_shield > 0.0) {
              float ringOuter = v_radius * 1.05; // just outside body
              float ringInner = v_radius * 0.90; // inside overlap
              float ringEdge = fwidth(d)*1.5;
              float ringMask = smoothstep(ringInner - ringEdge, ringInner + ringEdge, d) * (1.0 - smoothstep(ringOuter - ringEdge, ringOuter + ringEdge, d));
              // ring color blend (cyan-like) scaled by shield fraction
              vec3 ringColor = mix(base, vec3(0.3,0.9,1.0), 0.6 * v_shield);
              base = mix(base, ringColor, clamp(ringMask,0.0,1.0));
            }
            gl_FragColor = vec4(base, alpha);
          }
        `),n=e.createBuffer();let S=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,S,e.STATIC_DRAW),s=e.createBuffer(),c=e.createBuffer(),l=e.createBuffer(),v=e.createBuffer(),h=e.createBuffer(),x=null,a||(x=e.getExtension("ANGLE_instanced_arrays")),this.a_quadPos=e.getAttribLocation(r,"a_quadPos"),this.a_instPos=e.getAttribLocation(r,"a_instPos"),this.a_instColor=e.getAttribLocation(r,"a_instColor"),this.a_instSize=e.getAttribLocation(r,"a_instSize"),this.a_instAngle=e.getAttribLocation(r,"a_instAngle"),this.a_instShield=e.getAttribLocation(r,"a_instShield"),this.u_resolution=e.getUniformLocation(r,"u_resolution"),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),g=e.createTexture(),e.bindTexture(e.TEXTURE_2D,g);let R=new Uint8Array([255,255,255,255]);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,R),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),typeof window<"u"&&(T=()=>{let I=window.devicePixelRatio||1;I!==u&&(u=I);let L=t.clientWidth||t.width/u,D=t.clientHeight||t.height/u,H=Math.max(1,Math.floor(L*u)),$=Math.max(1,Math.floor(D*u));(H!==t.width||$!==t.height)&&(t.width=H,t.height=$,e&&e.viewport(0,0,H,$))},window.addEventListener("resize",T))}catch(A){e=null,console.warn("WebGL init failed:",A.message||A)}},start(A){f=!0,typeof A=="function"&&A()},stop(){f=!1},isRunning(){return f},render(A){if(!e)return;let{W:_,H:S,ships:R,bullets:I=[],stars:L=[]}=A,D=R.length,H=I.length,$=L.length,F=D+H+$;if(F===0)return;let N=new Float32Array(F*2),C=new Float32Array(F*3),ie=new Float32Array(F),ne=new Float32Array(F),se=new Float32Array(F),E=0;for(let y=0;y<D;y++,E++){let p=R[y];N[E*2]=p.x,N[E*2+1]=p.y,C[E*3]=p.team===0?1:.31,C[E*3+1]=p.team===0?.35:.63,C[E*3+2]=p.team===0?.35:1,ie[E]=p.radius||8,ne[E]=p.vx||p.vy?Math.atan2(p.vy,p.vx):p.angle||0;let V=0;typeof p.shield=="number"&&typeof p.shieldMax=="number"&&p.shieldMax>0&&(V=Math.min(1,Math.max(0,p.shield/p.shieldMax))),se[E]=V}for(let y=0;y<H;y++,E++){let p=I[y];N[E*2]=p.x,N[E*2+1]=p.y,C[E*3]=p.team===0?1:.35,C[E*3+1]=p.team===0?.35:.63,C[E*3+2]=p.team===0?.35:1,ie[E]=p.radius||2.2,ne[E]=p.vx||p.vy?Math.atan2(p.vy,p.vx):0,se[E]=0}for(let y=0;y<$;y++,E++){let p=L[y];N[E*2]=p.x,N[E*2+1]=p.y;let V=p.phase!=null?.6+.4*Math.sin(p.phase):1,oe=.85+.15*V;C[E*3]=oe,C[E*3+1]=oe,C[E*3+2]=1,ie[E]=(p.r||1)+.5*V,ne[E]=0,se[E]=0}if(e.viewport(0,0,t.width,t.height),e.clearColor(.02,.02,.03,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(r),e.uniform2f(this.u_resolution,_,S),e.bindBuffer(e.ARRAY_BUFFER,n),this.a_quadPos>=0&&(e.enableVertexAttribArray(this.a_quadPos),e.vertexAttribPointer(this.a_quadPos,2,e.FLOAT,!1,0,0)),this.a_instPos>=0&&(e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,N,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instPos),e.vertexAttribPointer(this.a_instPos,2,e.FLOAT,!1,0,0)),this.a_instColor>=0&&(e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,C,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instColor),e.vertexAttribPointer(this.a_instColor,3,e.FLOAT,!1,0,0)),this.a_instSize>=0&&(e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,ie,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instSize),e.vertexAttribPointer(this.a_instSize,1,e.FLOAT,!1,0,0)),this.a_instAngle>=0&&(e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,ne,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instAngle),e.vertexAttribPointer(this.a_instAngle,1,e.FLOAT,!1,0,0)),this.a_instShield>=0&&(e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,se,e.DYNAMIC_DRAW),e.enableVertexAttribArray(this.a_instShield),e.vertexAttribPointer(this.a_instShield,1,e.FLOAT,!1,0,0)),a||x)if(a)this.a_instPos>=0&&e.vertexAttribDivisor(this.a_instPos,1),this.a_instColor>=0&&e.vertexAttribDivisor(this.a_instColor,1),this.a_instSize>=0&&e.vertexAttribDivisor(this.a_instSize,1),this.a_instAngle>=0&&e.vertexAttribDivisor(this.a_instAngle,1),this.a_instShield>=0&&e.vertexAttribDivisor(this.a_instShield,1),e.drawArraysInstanced(e.TRIANGLE_STRIP,0,4,F),this.a_instPos>=0&&e.vertexAttribDivisor(this.a_instPos,0),this.a_instColor>=0&&e.vertexAttribDivisor(this.a_instColor,0),this.a_instSize>=0&&e.vertexAttribDivisor(this.a_instSize,0),this.a_instAngle>=0&&e.vertexAttribDivisor(this.a_instAngle,0),this.a_instShield>=0&&e.vertexAttribDivisor(this.a_instShield,0);else if(x)this.a_instPos>=0&&x.vertexAttribDivisorANGLE(this.a_instPos,1),this.a_instColor>=0&&x.vertexAttribDivisorANGLE(this.a_instColor,1),this.a_instSize>=0&&x.vertexAttribDivisorANGLE(this.a_instSize,1),this.a_instAngle>=0&&x.vertexAttribDivisorANGLE(this.a_instAngle,1),this.a_instShield>=0&&x.vertexAttribDivisorANGLE(this.a_instShield,1),x.drawArraysInstancedANGLE(e.TRIANGLE_STRIP,0,4,F),this.a_instPos>=0&&x.vertexAttribDivisorANGLE(this.a_instPos,0),this.a_instColor>=0&&x.vertexAttribDivisorANGLE(this.a_instColor,0),this.a_instSize>=0&&x.vertexAttribDivisorANGLE(this.a_instSize,0),this.a_instAngle>=0&&x.vertexAttribDivisorANGLE(this.a_instAngle,0),this.a_instShield>=0&&x.vertexAttribDivisorANGLE(this.a_instShield,0);else for(let y=0;y<F;y++){let p=N[y*2+0],V=N[y*2+1],oe=C[y*3+0],Me=C[y*3+1],Ce=C[y*3+2],Le=ie[y],Be=ne[y],Ie=se[y];this.a_instPos>=0&&e.vertexAttrib2f(this.a_instPos,p,V),this.a_instColor>=0&&e.vertexAttrib3f(this.a_instColor,oe,Me,Ce),this.a_instSize>=0&&e.vertexAttrib1f(this.a_instSize,Le),this.a_instAngle>=0&&e.vertexAttrib1f(this.a_instAngle,Be),this.a_instShield>=0&&e.vertexAttrib1f(this.a_instShield,Ie),e.drawArrays(e.TRIANGLE_STRIP,0,4)}else for(let y=0;y<F;y++){let p=N[y*2+0],V=N[y*2+1],oe=C[y*3+0],Me=C[y*3+1],Ce=C[y*3+2],Le=ie[y],Be=ne[y],Ie=se[y];this.a_instPos>=0&&e.vertexAttrib2f(this.a_instPos,p,V),this.a_instColor>=0&&e.vertexAttrib3f(this.a_instColor,oe,Me,Ce),this.a_instSize>=0&&e.vertexAttrib1f(this.a_instSize,Le),this.a_instAngle>=0&&e.vertexAttrib1f(this.a_instAngle,Be),this.a_instShield>=0&&e.vertexAttrib1f(this.a_instShield,Ie),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},destroy(){if(e){try{n&&e.deleteBuffer(n),s&&e.deleteBuffer(s),c&&e.deleteBuffer(c),l&&e.deleteBuffer(l),v&&e.deleteBuffer(v),h&&e.deleteBuffer(h),r&&e.deleteProgram(r),g&&e.deleteTexture(g)}catch{}e=null}typeof window<"u"&&T&&window.removeEventListener("resize",T),f=!1}}}var qt,gt=Rt(()=>{qt={createWebGLRenderer:mt}});var De=!1,pe=123456789;function st(t){De=!0,pe=t>>>0}function ot(){De=!1}function Tt(){return De?(pe=1664525*pe+1013904223>>>0,pe/4294967296):Math.random()}function d(t=0,i=1){return t+(i-t)*Tt()}function he(t,i){return Math.floor(d(t,i+1))}var rt={corvette:6.5,frigate:5,destroyer:3.2,carrier:2,fighter:8},at=1.2,Fe=.6;var m={RED:0,BLUE:1},ke=class{constructor(i,a,e,r,n,s=null){this.x=i,this.y=a,this.vx=e,this.vy=r,this.team=n,this.ownerId=s,this.life=2.5,this.radius=2.2,this.dmg=d(8,14)}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.life-=i}alive(i=null){if(this.life<=0)return!1;if(!i)return!0;let{W:a,H:e}=i;return this.x>-50&&this.x<a+50&&this.y>-50&&this.y<e+50}},ge=class ge{constructor(i,a,e,r="corvette"){this.team=i,this.x=a,this.y=e,this.vx=0,this.vy=0,this.angle=0,this.type=r;let n={corvette:{radius:8,maxSpeed:d(120,160),accel:240,turn:6.5,hp:d(40,70),reload:d(.18,.28),vision:220,range:140},frigate:{radius:10,maxSpeed:d(90,120),accel:200,turn:5,hp:d(80,120),reload:d(.24,.4),vision:280,range:180},destroyer:{radius:14,maxSpeed:d(60,90),accel:150,turn:3.2,hp:d(150,220),reload:d(.4,.7),vision:320,range:220},carrier:{radius:18,maxSpeed:d(40,70),accel:90,turn:2,hp:d(220,300),reload:d(.6,1.2),vision:360,range:260,launchBase:d(3.5,6)},fighter:{radius:6,maxSpeed:d(160,220),accel:300,turn:8,hp:d(18,32),reload:d(.12,.22),vision:180,range:120}},s=n[r]||n.corvette;this.radius=s.radius,this.maxSpeed=s.maxSpeed,this.accel=s.accel,this.turn=s.turn||rt[r]||4.5,this.hpMax=s.hp,this.hp=this.hpMax,this.cooldown=0,this.reload=s.reload,this.vision=s.vision,this.range=s.range,this.id=ge._id++,this.kills=0,this.alive=!0,this._exploded=!1,this.level=1,this.xp=0,this.baseHpMax=this.hpMax,this.baseDmg=10,this.shieldMax=Math.round(this.hpMax*.6),this.shield=this.shieldMax,this.shieldRegen=Math.max(.5,this.shieldMax*.06),this.recentHitTimer=0,r==="carrier"?(this.isCarrier=!0,this.launchCooldown=s.launchBase*d(.8,1.4),this.launchAmount=Math.max(1,Math.floor(d(1,3))),this.maxFighters=6,this.activeFighters=[]):(this.isCarrier=!1,this.launchCooldown=0)}xpToNext(i=100,a=1.35){return Math.floor(i*Math.pow(a,Math.max(0,this.level-1)))}applyLevel(){let i=.06,a=.1,e=.08;this.hpMax=Math.round(this.baseHpMax*(1+a*(this.level-1)));let r=Math.round(this.baseHpMax*.6);this.shieldMax=Math.round(r*(1+e*(this.level-1))),this.hp=Math.min(this.hp,this.hpMax),this.shield=Math.min(this.shield,this.shieldMax)}gainXp(i){if(!(i<=0))for(this.xp+=i;this.xp>=this.xpToNext();)this.xp-=this.xpToNext(),this.level++,this.applyLevel()}pickTarget(i){let a=null,e=1/0,r=this.vision*this.vision;for(let n of i){if(!n.alive||n.team===this.team)continue;let s=n.x-this.x,c=n.y-this.y,l=s*s+c*c;l<r&&l<e&&(e=l,a=n)}return a}update(i,a){if(!this.alive)return;let e=this.pickTarget(a),r=this.recentHitTimer>0,n=0,s=0,c=1;if(e&&!r){let _=e.x-this.x,S=e.y-this.y;c=Math.hypot(_,S)||1;let R=Math.max(0,Math.min(1.2,c/240)),I=e.x+(e.vx||0)*R,L=e.y+(e.vy||0)*R;n=I-this.x,s=L-this.y;let D=Math.hypot(n,s)||1;n/=D,s/=D}else if(e&&r){let _=e.x-this.x,S=e.y-this.y;c=Math.hypot(_,S)||1,n=-(_/c),s=-(S/c)}else n=Math.cos(this.angle),s=Math.sin(this.angle);let l=0,v=0,h=0,g=26;for(let _ of a){if(!_.alive||_===this||_.team!==this.team)continue;let S=this.x-_.x,R=this.y-_.y,I=S*S+R*R;if(I<g*g&&I>1){let L=Math.sqrt(I);l+=S/L,v+=R/L,h++}}h>0&&(l/=h,v/=h);let f=Math.atan2(s,n)-this.angle;for(;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;let u=this.turn*i;f>u?f=u:f<-u&&(f=-u),this.angle+=f;let T=r?this.accel*at:this.accel;this.vx+=Math.cos(this.angle)*T*i,this.vy+=Math.sin(this.angle)*T*i,h>0&&(this.vx+=l*(this.accel*Fe)*i,this.vy+=v*(this.accel*Fe)*i);let A=Math.hypot(this.vx,this.vy);if(A>this.maxSpeed){let _=this.maxSpeed/A;this.vx*=_,this.vy*=_}if(this.x+=this.vx*i,this.y+=this.vy*i,e){let _=e.x-this.x,S=e.y-this.y,R=Math.hypot(_,S)||1;if(R<this.range){let I=Math.cos(this.angle)*(_/R)+Math.sin(this.angle)*(S/R);if(this.cooldown<=0&&I>.2){let L=300+d(-20,20),D=_/R,H=S/R;arguments.length>=3&&Array.isArray(arguments[2])&&arguments[2].push(new ke(this.x+D*12,this.y+H*12,D*L+this.vx*.2,H*L+this.vy*.2,this.team,this.id)),this.cooldown=this.reload}}}this.cooldown-=i,this.shield<this.shieldMax&&(this.shield=Math.min(this.shieldMax,this.shield+this.shieldRegen*i)),this.recentHitTimer>0&&(this.recentHitTimer=Math.max(0,this.recentHitTimer-i))}damage(i){let a=i,e=0;return this.shield>0&&i>0&&(e=Math.min(this.shield,i),this.shield-=e,i-=e),i>0&&(this.hp-=i),(e>0||a>0&&i>0)&&(this.recentHitTimer=Math.max(this.recentHitTimer,1.2)),this.hp<=0&&this.alive?(this.type==="fighter"&&this.ownerCarrier,this.alive=!1,this._exploded=!0,{x:this.x,y:this.y,team:this.team,id:this.id,type:this.type,ownerCarrier:this.ownerCarrier}):null}};nt(ge,"_id",1);var K=ge;function xe(t,i,a,e,r=80){let n=[];for(let s=0;s<i;s++){let c=s%6*20+d(-10,10),l=Math.floor(s/6)*20+d(-10,10),v=d(0,1),h="corvette";v<.45?h="corvette":v<.75?h="frigate":v<.92?h="destroyer":h="carrier",n.push(new K(t,a+(t===m.RED?-c:c),e+l,h))}return n}var $e={};it($e,{Particle:()=>re,acquireParticle:()=>de,bullets:()=>z,clamp:()=>Ne,evaluateReinforcement:()=>ze,flashes:()=>U,getReinforcementInterval:()=>qe,handleReinforcement:()=>Q,healthFlashes:()=>O,initStars:()=>ve,particlePool:()=>ee,particles:()=>G,processStateEvents:()=>Gt,releaseParticle:()=>_e,reset:()=>Xe,resetReinforcementCooldowns:()=>Ge,setCarrierLaunchStrategy:()=>kt,setContinuousCheckbox:()=>Ee,setReinforcementInterval:()=>We,setReinforcementStrategy:()=>Ht,setSpawnCompositionStrategy:()=>Ut,setToast:()=>Ft,shieldFlashes:()=>X,ships:()=>b,simulate:()=>Ye,stars:()=>Z});function lt(t,i,a={W:800,H:600}){for(let e of t.ships)e.alive&&e.update(i,t.ships,t.bullets);if(a&&typeof a.W=="number"&&typeof a.H=="number"){let e=a.W,r=a.H;for(let n of t.ships){if(!n.alive)continue;let s=n.radius||0;n.x<-s?n.x+=e+s*2:n.x>e+s&&(n.x-=e+s*2),n.y<-s?n.y+=r+s*2:n.y>r+s&&(n.y-=r+s*2)}}for(let e=t.bullets.length-1;e>=0;e--){let r=t.bullets[e];r.update(i),r.alive(a)||t.bullets.splice(e,1)}for(let e=t.bullets.length-1;e>=0;e--){let r=t.bullets[e];for(let n of t.ships){if(!n.alive||n.team===r.team)continue;let s=n.x-r.x,c=n.y-r.y,l=s*s+c*c,v=n.radius+r.radius;if(l<v*v){let h=r.dmg,g=typeof n.shield=="number"?n.shield:0,x=typeof n.hp=="number"?n.hp:0,f=n.damage(h),u=Math.max(0,g-(typeof n.shield=="number"?n.shield:0)),T=Math.max(0,x-(typeof n.hp=="number"?n.hp:0));u>0&&t&&Array.isArray(t.shieldHits)&&t.shieldHits.push({id:n.id,hitX:r.x,hitY:r.y,team:n.team,amount:u}),T>0&&t&&Array.isArray(t.healthHits)&&t.healthHits.push({id:n.id,hitX:r.x,hitY:r.y,team:n.team,amount:T}),Array.isArray(t.damageEvents)||(t.damageEvents=[]),r.ownerId!=null&&t.damageEvents.push({ownerId:r.ownerId,dmg:h}),t.bullets.splice(e,1),f&&t.explosions&&t.explosions.push(f),n.alive||(Array.isArray(t.killEvents)||(t.killEvents=[]),t.killEvents.push({id:n.id,type:n.type,ownerCarrier:n.ownerCarrier,level:n.level,team:n.team,killerId:r.ownerId,killerTeam:r.team,x:n.x,y:n.y}));break}}}}var ye=Math.PI*2,J=(t,i)=>t+(i-t)*Math.random(),Ne=(t,i,a)=>Math.max(i,Math.min(a,t)),Ue=t=>{if(typeof document<"u"){let i=document.getElementById("toast");i&&(i.textContent=t,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400))}};function Ft(t){Ue=t}var Z=[];function ve(){Z.length=0;let t=[.2,.5,1],i=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;for(let e of t)for(let r=0;r<120;r++)Z.push({x:J(0,i),y:J(0,a),r:J(.3,1.8)*e,d:e,tw:J(.4,1),phase:J(0,ye)})}ve();var ee=[],G=[],re=class{constructor(i,a,e,r,n,s){this.x=i,this.y=a,this.vx=e,this.vy=r,this.life=n,this.max=n,this.color=s}update(i){this.x+=this.vx*i,this.y+=this.vy*i,this.vx*=Math.pow(.9,i*60),this.vy*=Math.pow(.9,i*60),this.life-=i}};function de(t,i,a,e,r,n){let s;return ee.length>0?(s=ee.pop(),s.x=t,s.y=i,s.vx=a,s.vy=e,s.life=r,s.max=r,s.color=n):s=new re(t,i,a,e,r,n),G.push(s),s}function _e(t){ee.length<2e3&&ee.push(t)}var U=[],X=[],O=[],b=[],z=[],ce=0,q={[m.RED]:0,[m.BLUE]:0},fe={[m.RED]:0,[m.BLUE]:0};function Ge(){fe[m.RED]=0,fe[m.BLUE]=0}function We(t){ce=Number(t)||0,q[m.RED]=0,q[m.BLUE]=0}function qe(){return ce}var He=null;function Ee(t){He=t}function Q(t,i=null){if(!He||!He.checked)return;let a=2,e=["frigate","corvette","destroyer","carrier"],r=(s,c)=>{for(let l=0;l<c;l++){let v=e[he(0,e.length-1)],h=typeof window<"u"?window.innerWidth:1024,g=typeof window<"u"?window.innerHeight:768,x=s===m.RED?d(40,Math.max(120,h*.35)):d(Math.max(h*.65,h-240),h-40),f=d(80,Math.max(120,g-80));b.push(new K(s,x,f,v))}},n=s=>{if(b.filter(l=>l.alive&&l.team===s).length<a&&(fe[s]-=t,fe[s]<=0)){let l=he(1,6);r(s,l),fe[s]=d(3,8),Ue(`Reinforcements: +${l} ${s===m.RED?"Red":"Blue"}`)}};i===null?(n(m.RED),n(m.BLUE)):n(i)}function Xe(t=null){if(b.length=0,z.length=0,G.length=0,U.length=0,X.length=0,O.length=0,t!==null)st(t>>>0),Ue(`Seed set to ${t>>>0}`);else try{ot()}catch{}let i=typeof window<"u"?window.innerWidth:1024,a=typeof window<"u"?window.innerHeight:768;b.push(...xe(m.RED,12,i*.25,a*.5)),b.push(...xe(m.BLUE,12,i*.75,a*.5))}var Oe=(t,i,a)=>{let e=[];if(t.launchCooldown-=a,t.launchCooldown<=0){if((Array.isArray(t.activeFighters)?t.activeFighters.length:0)<(t.maxFighters||6)){let n=Math.max(1,Math.floor(t.launchAmount||1));for(let s=0;s<n&&!(t.activeFighters.length>=(t.maxFighters||6));s++){let c=d(0,ye),l=t.radius+12+d(4,12),v=t.x+Math.cos(c)*l,h=t.y+Math.sin(c)*l,g=new K(t.team,v,h,"fighter"),x=d(40,120);g.vx=Math.cos(c)*x+(t.vx||0)*.2,g.vy=Math.sin(c)*x+(t.vy||0)*.2,g.ownerCarrier=t.id,t.activeFighters.push(g.id),e.push(g)}}t.launchCooldown=d(2.5,6)}return e};function kt(t){Oe=t}var dt=(t,i)=>{Q(t)};function Ht(t){dt=t}var Nt=(t,i,a,e)=>xe(t,i,a,e);function Ut(t){Nt=t}function ze(t){if(ce<=0){Q(t);return}q[m.RED]+=t,q[m.BLUE]+=t,q[m.RED]>=ce&&(Q(q[m.RED],m.RED),q[m.RED]=0),q[m.BLUE]>=ce&&(Q(q[m.BLUE],m.BLUE),q[m.BLUE]=0)}function Ye(t,i,a){for(let n of Z)n.phase+=t*.8*n.d;for(let n of b){if(!n.alive||!n.isCarrier)continue;let s=Oe(n,b,t);if(Array.isArray(s)&&s.length)for(let c of s)b.push(c)}for(let n of b)n.update(t,b);for(let n=z.length-1;n>=0;n--){let s=z[n];if(s.update(t),!s.alive()){z.splice(n,1);continue}}let r={ships:b,bullets:z,score:{red:0,blue:0},particles:G,explosions:[],shieldHits:[]};if(lt(r,t,{W:i,H:a}),r.explosions&&r.explosions.length)for(let n of r.explosions){U.push({x:n.x,y:n.y,r:2,life:.25,team:n.team});for(let s=0;s<20;s++){let c=d(0,ye),l=d(40,220);de(n.x,n.y,Math.cos(c)*l,Math.sin(c)*l,J(.2,1),"rgba(255,255,255,$a)")}}if(Array.isArray(r.shieldHits)&&r.shieldHits.length)for(let n of r.shieldHits){let s=b.find(v=>v.id===n.id),c=s?s.x:n.hitX,l=s?s.y:n.hitY;U.push({x:c,y:l,r:6+Math.min(12,n.amount),life:.12,team:n.team,shieldHit:!0});for(let v=0;v<6;v++){let h=d(0,ye),g=d(40,120);de(n.hitX,n.hitY,Math.cos(h)*g,Math.sin(h)*g,J(.12,.4),"rgba(200,230,255,$a)")}if(s){let v=Math.atan2(n.hitY-l,n.hitX-c);X.push({id:s.id,angle:v,life:.22,amount:n.amount})}}if(Array.isArray(r.healthHits)&&r.healthHits.length)for(let n of r.healthHits){let s=b.find(c=>c.id===n.id);s&&O.push({id:s.id,life:.45,amount:n.amount})}if(Array.isArray(r.damageEvents)&&r.damageEvents.length){for(let n of r.damageEvents)if(n&&n.ownerId!=null&&typeof n.dmg=="number"){let s=b.find(c=>c.id===n.ownerId);s&&s.gainXp(n.dmg*.05)}}if(Array.isArray(r.killEvents)&&r.killEvents.length){for(let n of r.killEvents)if(n){if(n.killerTeam===m.RED?r.score.red++:n.killerTeam===m.BLUE&&r.score.blue++,n.killerId!=null){let s=b.find(c=>c.id===n.killerId);s&&s.gainXp(20+(n.level||1)*.2)}if(n.type==="fighter"&&typeof n.ownerCarrier=="number"){let s=b.find(c=>c.id===n.ownerCarrier);if(s&&Array.isArray(s.activeFighters)){let c=s.activeFighters.indexOf(n.id);c>=0&&s.activeFighters.splice(c,1)}}if(n.type==="carrier"){let s=n.id;for(let l of b)l.alive&&l.type==="fighter"&&l.ownerCarrier===s&&(l.ownerCarrier=null);let c=b.find(l=>l.id===s);c&&Array.isArray(c.activeFighters)&&(c.activeFighters.length=0)}}}dt(t,b);for(let n=G.length-1;n>=0;n--){let s=G[n];s.update(t),s.life<=0&&(G.splice(n,1),_e(s))}for(let n=U.length-1;n>=0;n--){let s=U[n];s.life-=t,s.r+=600*t,s.life<=0&&U.splice(n,1)}for(let n=X.length-1;n>=0;n--){let s=X[n];s.life-=t,s.life<=0&&X.splice(n,1)}for(let n=O.length-1;n>=0;n--){let s=O[n];s.life-=t,s.life<=0&&O.splice(n,1)}return{ships:b,bullets:z,particles:G,flashes:U,shieldFlashes:X,healthFlashes:O,stars:Z}}function Gt(t,i=0){if(!(!t||!Array.isArray(t.ships))){for(let a of t.ships){if(!a.alive||!a.isCarrier)continue;let e=Oe(a,t.ships,i);if(Array.isArray(e)&&e.length)for(let r of e)t.ships.push(r)}if(Array.isArray(t.damageEvents)&&t.damageEvents.length){for(let a of t.damageEvents)if(a&&a.ownerId!=null&&typeof a.dmg=="number"){let e=t.ships.find(r=>r.id===a.ownerId);e&&e.gainXp(a.dmg*.05)}}if(Array.isArray(t.killEvents)&&t.killEvents.length){for(let a of t.killEvents)if(a){if(t.score||(t.score={red:0,blue:0}),a.killerTeam===m.RED?t.score.red++:a.killerTeam===m.BLUE&&t.score.blue++,a.killerId!=null){let e=t.ships.find(r=>r.id===a.killerId);e&&e.gainXp(20+(a.level||1)*.2)}if(a.type==="fighter"&&typeof a.ownerCarrier=="number"){let e=t.ships.find(r=>r.id===a.ownerCarrier);if(e&&Array.isArray(e.activeFighters)){let r=e.activeFighters.indexOf(a.id);r>=0&&e.activeFighters.splice(r,1)}}if(a.type==="carrier"){let e=a.id;for(let n of t.ships)n.alive&&n.type==="fighter"&&n.ownerCarrier===e&&(n.ownerCarrier=null);let r=t.ships.find(n=>n.id===e);r&&Array.isArray(r.activeFighters)&&(r.activeFighters.length=0)}}}}}typeof window<"u"&&(window.initRenderer=At);var P=null;typeof document<"u"&&(P=document.getElementById("world"));!P&&typeof document<"u"&&(P=document.createElement("canvas"),P.id="world",document.body&&document.body.appendChild(P));if(typeof globalThis.Path2D>"u"){class t{constructor(){}moveTo(){}lineTo(){}quadraticCurveTo(){}ellipse(){}arc(){}closePath(){}}globalThis.Path2D=t}var o=null;if(P&&typeof P.getContext=="function")try{o=P.getContext("2d")}catch{o=null}if(!o){let t=()=>{};o={beginPath:t,moveTo:t,lineTo:t,quadraticCurveTo:t,arc:t,ellipse:t,fill:t,stroke:t,closePath:t,fillRect:t,clearRect:t,createLinearGradient:()=>({addColorStop:t}),createRadialGradient:()=>({addColorStop:t}),fillText:t,measureText:()=>({width:0}),setLineDash:t,save:t,restore:t,translate:t,rotate:t,clip:t,shadowBlur:0,shadowColor:"",globalAlpha:1,fillStyle:"",strokeStyle:"",lineWidth:1,font:"",textAlign:"start",globalCompositeOperation:"source-over"},P&&(P.getContext=()=>o)}var M=P&&P.width?P.width=typeof window<"u"?window.innerWidth:1024:1024,B=P&&P.height?P.height=typeof window<"u"?window.innerHeight:768:768;typeof window<"u"&&typeof window.addEventListener=="function"&&window.addEventListener("resize",()=>{M=P.width=window.innerWidth,B=P.height=window.innerHeight,vt(),Xt()});var Y=Math.PI*2,Je=Ne;function we(t){let i=document.getElementById("toast");i.textContent=t,i.classList.add("show"),setTimeout(()=>i.classList.remove("show"),1400)}var yt=Z,Xt=ve,Ve=new Map;function Ei(t){if(Ve.has(t))return Ve.get(t);let i=new Path2D;return t==="corvette"?(i.moveTo(1.5,0),i.lineTo(-1,-.7),i.lineTo(-.4,0),i.lineTo(-1,.7),i.closePath(),i.ellipse(0,0,.35,.25,0,0,Y)):t==="frigate"?(i.moveTo(1.6,0),i.quadraticCurveTo(.2,-1.1,-1.1,-.6),i.lineTo(-.6,0),i.lineTo(-1.1,.6),i.quadraticCurveTo(.2,1.1,1.6,0),i.closePath()):t==="destroyer"?(i.moveTo(1.9,0),i.lineTo(.3,-1.1),i.lineTo(-1.4,-.6),i.lineTo(-1.4,.6),i.lineTo(.3,1.1),i.closePath()):t==="carrier"?i.ellipse(0,0,1.6,1,0,0,Y):t==="fighter"?(i.moveTo(1.2,0),i.lineTo(-.6,-.45),i.lineTo(-.2,0),i.lineTo(-.6,.45),i.closePath(),i.ellipse(.25,0,.25,.15,0,0,Y)):(i.moveTo(1.4,0),i.lineTo(-1,-.8),i.lineTo(-.4,0),i.lineTo(-1,.8),i.closePath()),Ve.set(t,i),i}var Ke=null;function vt(){Ke=o.createRadialGradient(M*.6,B*.3,50,M*.6,B*.3,Math.max(M,B)),Ke.addColorStop(0,"rgba(60,80,140,0.10)"),Ke.addColorStop(1,"rgba(10,12,20,0.0)")}vt();var wi=ee,_t=de,Ai=_e,bi=re;var j=(t,i=1)=>t===m.RED?`rgba(255,90,90,${i})`:`rgba(80,160,255,${i})`;function Ot(t){if(t.life<=0)return;let i=t.life/t.max;o.fillStyle=(t.color||"").replace?t.color.replace("$a",i.toFixed(3)):t.color,o.fillRect(t.x,t.y,2,2)}var Qe=class{constructor(i){this.logic=i,this.id=i.id,this.team=i.team,this.x=i.x,this.y=i.y,this.type=i.type}syncFromLogic(){this.x=this.logic.x,this.y=this.logic.y,this.type=this.logic.type,this.alive=this.logic.alive}draw(){let i=this.logic;if(!i.alive)return;let a=me.some(f=>f.shieldHit&&f.x===i.x&&f.y===i.y&&f.life>0);if(Re){let f=i.x-Math.cos(i.angle)*i.radius*1.2,u=i.y-Math.sin(i.angle)*i.radius*1.2;_t(f,u,-i.vx*.05+d(-10,10),-i.vy*.05+d(-10,10),.25,j(i.team,"$a"))}o.save(),o.translate(i.x,i.y),o.rotate(i.angle),o.shadowBlur=12,o.shadowColor=j(i.team,.9);let e=i.radius||8;if(o.fillStyle=j(i.team,.96),i.type==="corvette"?(o.beginPath(),o.moveTo(e*1.5,0),o.lineTo(-e,-e*.7),o.lineTo(-e*.4,0),o.lineTo(-e,e*.7),o.closePath(),o.fill(),o.fillStyle="rgba(255,255,255,.85)",o.beginPath(),o.ellipse(0,0,e*.35,e*.25,0,0,Y),o.fill()):i.type==="frigate"?(o.beginPath(),o.moveTo(e*1.6,0),o.quadraticCurveTo(e*.2,-e*1.1,-e*1.1,-e*.6),o.lineTo(-e*.6,0),o.lineTo(-e*1.1,e*.6),o.quadraticCurveTo(e*.2,e*1.1,e*1.6,0),o.closePath(),o.fill(),o.fillStyle="rgba(255,255,255,.75)",o.fillRect(-e*.2,-e*.25,e*.6,e*.5)):i.type==="destroyer"?(o.beginPath(),o.moveTo(e*1.9,0),o.lineTo(e*.3,-e*1.1),o.lineTo(-e*1.4,-e*.6),o.lineTo(-e*1.4,e*.6),o.lineTo(e*.3,e*1.1),o.closePath(),o.fill(),o.fillStyle="rgba(255,255,255,.7)",o.fillRect(-e*.9,-e*.18,e*1.2,e*.36)):i.type==="carrier"?(o.beginPath(),o.ellipse(0,0,e*1.6,e*1,0,0,Y),o.fill(),o.fillStyle="rgba(255,255,255,.18)",o.fillRect(-e*.8,-e*.25,e*1.6,e*.5)):i.type==="fighter"?(o.beginPath(),o.moveTo(e*1.2,0),o.lineTo(-e*.6,-e*.45),o.lineTo(-e*.2,0),o.lineTo(-e*.6,e*.45),o.closePath(),o.fill(),o.fillStyle="rgba(255,255,255,.9)",o.beginPath(),o.ellipse(e*.25,0,e*.25,e*.15,0,0,Y),o.fill()):(o.beginPath(),o.moveTo(e*1.4,0),o.lineTo(-e,-e*.8),o.lineTo(-e*.4,0),o.lineTo(-e,e*.8),o.closePath(),o.fill()),o.restore(),typeof i.shield=="number"&&typeof i.shieldMax=="number"){let f=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0,u=e+4+(1-f)*2;o.save(),o.beginPath(),o.arc(i.x,i.y,u,0,Y);let T=o.createRadialGradient(i.x,i.y,u*.6,i.x,i.y,u);T.addColorStop(0,`rgba(140,200,255,${.06})`),T.addColorStop(1,`rgba(80,160,255,${.02})`),o.fillStyle=T,o.globalCompositeOperation="lighter",o.fill();for(let A of Et){if(A.id!==i.id)continue;let _=Math.max(0,Math.min(1,A.life/.22)),S=i.shieldMax&&i.shieldMax>0?A.amount/i.shieldMax:Math.min(1,A.amount/(i.hpMax*.6||1)),R=Math.max(.08,Math.min(1,S)),L=(Math.PI*.25+Math.PI*.6*(1-_))*(.6+1.6*R),D=A.angle-L/2,H=A.angle+L/2,$=u+4*(1-_)+2*R;o.beginPath(),o.arc(i.x,i.y,$,D,H),o.lineWidth=(3+6*_)*(1+4*R);let F=Math.min(1,.25+_*(.9+1.6*R));o.strokeStyle=`rgba(160,220,255,${F})`,o.save(),o.shadowBlur=12*R,o.shadowColor="rgba(140,200,255,0.8)",o.stroke(),o.restore()}o.restore()}let r=Math.max(16,e*3.2),n=Math.max(3,e*.4),s=i.x-r/2,c=i.y-(e+12);if(typeof i.shield=="number"&&typeof i.shieldMax=="number"){let f=i.shieldMax>0?Math.max(0,Math.min(1,i.shield/i.shieldMax)):0;o.fillStyle="rgba(255,255,255,.08)",o.fillRect(s,c,r,n),o.fillStyle="rgba(80,160,255,.95)",o.fillRect(s,c,r*f,n)}let l=i.y+(e+8),v=Math.max(0,Math.min(1,i.hp/i.hpMax)),h=Math.min(6,n);o.beginPath(),o.moveTo(s+h,l),o.lineTo(s+r-h,l),o.quadraticCurveTo(s+r,l,s+r,l+h),o.lineTo(s+r,l+n-h),o.quadraticCurveTo(s+r,l+n,s+r-h,l+n),o.lineTo(s+h,l+n),o.quadraticCurveTo(s,l+n,s,l+n-h),o.lineTo(s,l+h),o.quadraticCurveTo(s,l,s+h,l),o.closePath(),o.fillStyle="rgba(255,255,255,.08)",o.fill();let g=wt.find(f=>f.id===i.id&&f.life>0),x=`rgba(120,220,120,${.95})`;if(g){let f=Math.max(0,Math.min(1,g.life/.45)),u=Math.min(1,g.amount/(i.hpMax||1)),T=Math.floor(220*(1-u*f)),A=Math.floor(60+160*(1-f*u));x=`rgba(${Math.min(255,T)},${Math.min(255,A)},60,${.95})`}o.save(),o.beginPath(),o.moveTo(s+h,l),o.lineTo(s+r-h,l),o.quadraticCurveTo(s+r,l,s+r,l+h),o.lineTo(s+r,l+n-h),o.quadraticCurveTo(s+r,l+n,s+r-h,l+n),o.lineTo(s+h,l+n),o.quadraticCurveTo(s,l+n,s,l+n-h),o.lineTo(s,l+h),o.quadraticCurveTo(s,l,s+h,l),o.closePath(),o.clip(),o.fillStyle=x,o.fillRect(s,l,r*v,n),o.restore(),typeof i.level=="number"&&i.level>1&&(o.save(),o.fillStyle="rgba(255,255,255,0.95)",o.font="700 12px system-ui, sans-serif",o.textAlign="center",o.fillText(`Lv ${i.level}`,i.x,i.y-(e+18)),o.restore())}},k=b,Pe=z,Se=G,me=U,Et=X,wt=O,Te={red:0,blue:0},te=new Map,ae=!1,be=1,Re=!0,Ae=0;function Ze(t=null){return Xe(t)}function zt(t){let i=Ye(t,M,B);i&&i.score&&(Te=i.score),k=b,Pe=z,Se=G,me=U,Et=X,wt=O;let a=new Set(k.map(e=>e.id));for(let e of k)te.has(e.id)?te.get(e.id).syncFromLogic():te.set(e.id,new Qe(e));for(let e of Array.from(te.keys()))a.has(e)||te.delete(e)}function xt(){o.clearRect(0,0,M,B);let t=o.createRadialGradient(M*.6,B*.3,50,M*.6,B*.3,Math.max(M,B));t.addColorStop(0,"rgba(60,80,140,0.10)"),t.addColorStop(1,"rgba(10,12,20,0.0)"),o.fillStyle=t,o.fillRect(0,0,M,B);for(let e of yt){let r=.6+.4*Math.sin(e.phase);o.globalAlpha=Je(.5*r*(.6+.5*e.d),0,1),o.fillStyle="#e9f2ff",o.fillRect(e.x,e.y,e.r,e.r)}o.globalAlpha=1;for(let e of me){let r=Je(e.life/.25,0,1);o.strokeStyle=j(e.team,r*.6),o.lineWidth=2,o.beginPath(),o.arc(e.x,e.y,e.r,0,Y),o.stroke()}for(let e of Pe)o.save(),o.shadowBlur=12,o.shadowColor=j(e.team,.9),o.fillStyle=j(e.team,.95),o.beginPath(),o.arc(e.x,e.y,e.radius||2.2,0,Y),o.fill(),o.restore();for(let e of Se)Ot(e);for(let e of te.values())e.draw();let i=k.some(e=>e.alive&&e.team===m.RED),a=k.some(e=>e.alive&&e.team===m.BLUE);if(!i||!a){o.save(),o.textAlign="center",o.font="700 36px Inter, system-ui, sans-serif";let e=i?"Red":a?"Blue":"Nobody",r=i?j(m.RED,.95):a?j(m.BLUE,.95):"rgba(255,255,255,.9)";o.fillStyle=r,o.shadowBlur=14,o.shadowColor=r,o.fillText(`${e} Wins!`,M/2,64),o.restore()}}function et(t){Ae||(Ae=t);let i=(t-Ae)/1e3;Ae=t;let a=Je(i,0,.033)*(ae?be:0);if(zt(a),w&&w.type==="webgl"&&typeof w.render=="function")try{w.render({W:M,H:B,ships:k,bullets:Pe,stars:yt,particles:Se,flashes:me,shipsVMap:te,score:Te})}catch(e){console.error("WebGL render error, falling back to 2D render",e),xt()}else xt();Kt(),requestAnimationFrame(et)}var Ri=document.getElementById("startPause"),Ti=document.getElementById("reset"),Pi=document.getElementById("addRed"),Si=document.getElementById("addBlue"),Mi=document.getElementById("toggleTrails"),Ci=document.getElementById("speed"),Yt=document.getElementById("redScore"),$t=document.getElementById("blueScore"),Vt=document.getElementById("stats"),Li=document.getElementById("seedBtn"),Bi=document.getElementById("formationBtn"),ue=document.getElementById("continuousCheckbox");ue||(ue=document.createElement("input"),ue.type="checkbox",ue.id="continuousCheckbox");$e&&typeof Ee=="function"&&Ee(ue);function Kt(){Yt.textContent=`Red ${Te.red}`,$t.textContent=`Blue ${Te.blue}`,Vt.textContent=`Ships: ${k.filter(t=>t.alive).length}  Bullets: ${Pe.length}  Particles: ${Se.length}`}var Ii=Ge;function jt(t){return We(t)}function je(){return qe()}var Di=ze,Fi=Q;function Jt(){if(typeof window>"u"||!document||window.__uiHandlersInstalled)return;Object.defineProperty(window,"__uiHandlersInstalled",{value:!0,configurable:!1,writable:!1});let t=document.getElementById("startPause");t&&t.addEventListener("click",()=>{ae=!ae,t.textContent=ae?"\u23F8 Pause":"\u25B6 Start"});let i=document.getElementById("reset");i&&i.addEventListener("click",()=>{Ze()});let a=document.getElementById("addRed");a&&a.addEventListener("click",()=>{k.push(new K(m.RED,d(40,M*.35),d(80,B-80))),we("+1 Red")});let e=document.getElementById("addBlue");e&&e.addEventListener("click",()=>{k.push(new K(m.BLUE,d(M*.65,M-40),d(80,B-80))),we("+1 Blue")});let r=document.getElementById("toggleTrails");r&&r.addEventListener("click",()=>{Re=!Re,r.textContent=`\u2604 Trails: ${Re?"On":"Off"}`});let n=document.getElementById("speed");n&&n.addEventListener("click",()=>{let h=[.5,1,2,4],g=(h.indexOf(be)+1)%h.length;be=h[g],n.textContent=`Speed: ${be}\xD7`});let s=document.getElementById("seedBtn");s&&s.addEventListener("click",()=>{let h=prompt("Enter numeric seed (32-bit):",Math.random()*1e9>>>0);h!==null&&Ze(Number(h))});let c=document.getElementById("formationBtn");c&&c.addEventListener("click",()=>{let h=k.filter(u=>u.alive&&u.team===m.RED),g=k.filter(u=>u.alive&&u.team===m.BLUE),x=20,f=6;h.forEach((u,T)=>{let A=T%f,_=Math.floor(T/f);u.x=M*.25-A*20,u.y=B*.5+(_-f/2)*x,u.vx=u.vy=0}),g.forEach((u,T)=>{let A=T%f,_=Math.floor(T/f);u.x=M*.75+A*20,u.y=B*.5+(_-f/2)*x,u.vx=u.vy=0}),we("Fleets re-formed")});let l=document.getElementById("reinforceFreqBtn"),v=[0,.5,1,2];if(l){let h=()=>{let g=je();l.textContent=g>0?`${g}s`:"Every step"};h(),l.addEventListener("click",()=>{let g=je(),x=(v.indexOf(g)+1)%v.length;jt(v[x]),h();let f=je();we(`Reinforcement check: ${f>0?f+"s":"every step"}`)})}P&&typeof P.addEventListener=="function"&&P.addEventListener("click",h=>{me.push({x:h.clientX,y:h.clientY,r:24,life:.25,team:he(0,1)});for(let x=0;x<24;x++){let f=d(0,Y),u=d(40,220);_t(h.clientX,h.clientY,Math.cos(f)*u,Math.sin(f)*u,d(.2,1),"rgba(255,255,255,$a)")}})}k.length===0&&Ze();var w=null,W=null,le=!1;async function At(t={}){if(typeof window<"u"&&(window.initRenderer=At),typeof window<"u"&&window.__autoRendererStarted){if(le&&w)return w;if(W)return await W,w}if(le&&w)return w;if(W)return await W,w;typeof window<"u"&&(window.__autoRendererStarted=!0),W=(async()=>{let{canvas:i=P,preferWebGL:a=!0,startLoop:e=!0}=t;if(!i)throw new Error("No canvas available to initialize renderer");if(Jt(),a&&i.getContext){let r=i.getContext("webgl2"),n=r?null:i.getContext("webgl");if(r||n)try{let{createWebGLRenderer:s}=await Promise.resolve().then(()=>(gt(),pt));return w=s(i,{webgl2:!!r}),w.init(),e&&w.start(()=>{requestAnimationFrame(et)}),w}catch(s){console.warn("WebGL init failed, falling back to 2D canvas renderer",s)}}return w||(w={type:"canvas"},e&&requestAnimationFrame(et)),w})();try{let i=await W;return le=!0,i}finally{W&&(W=null)}}function ki(){return w?w.type:null}function Qt(){if(w&&typeof w.stop=="function"&&w.stop(),w&&typeof w.destroy=="function"&&w.destroy(),w=null,le=!1,W=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function Hi(){if(Qt(),le=!1,W=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}function Ni(){if(le=!1,W=null,typeof window<"u")try{delete window.__autoRendererStarted}catch{}}typeof window<"u"&&(window.startSimulation=function(){try{ae=!0;let i=document.getElementById("startPause");i&&(i.textContent="\u23F8 Pause")}catch{}},window.stopSimulation=function(){try{ae=!1;let i=document.getElementById("startPause");i&&(i.textContent="\u25B6 Start")}catch{}});export{bi as Particle,Ni as _internal_resetInitFlags,_t as acquireParticle,Ke as backgroundGradient,Pe as bullets,Je as clamp,Di as evaluateReinforcement,me as flashes,Ei as getHullPath,je as getReinforcementInterval,ki as getRendererType,Fi as handleReinforcement,wt as healthFlashes,Ve as hullPaths,At as initRenderer,Xt as initStars,wi as particlePool,Se as particles,vt as recomputeBackgroundGradient,Ai as releaseParticle,Ze as reset,Ii as resetReinforcementCooldowns,jt as setReinforcementInterval,Et as shieldFlashes,k as ships,te as shipsVMap,yt as stars,Qt as stopRenderer,Hi as stopRendererAndAllowReinit,j as teamColor};
